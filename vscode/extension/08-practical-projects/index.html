<!doctype html><html lang=zh-CN data-theme=dark><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><title>VS Code 扩展开发阶段八：综合实战项目 - 从设计到发布的完整开发流程 | AlunWorker</title><meta name=author content=AlunWorker><meta name=copyright content=AlunWorker><meta name=format-detection content="telephone=no"><meta name=theme-color content=#0d0d0d><meta name=description content="VS Code扩展开发第八阶段：通过5个完整的实战项目，掌握从需求分析到发布维护的整个开发流程，涵盖AI工具、数据可视化、API测试等热门应用场景"><meta property=og:type content=article><meta property=og:title content="VS Code 扩展开发阶段八：综合实战项目 - 从设计到发布的完整开发流程"><meta property=og:url content=https://alunworker.com/vscode/extension/08-practical-projects/index.html><meta property=og:site_name content=AlunWorker><meta property=og:description content="VS Code扩展开发第八阶段：通过5个完整的实战项目，掌握从需求分析到发布维护的整个开发流程，涵盖AI工具、数据可视化、API测试等热门应用场景"><meta property=og:locale content=zh_CN><meta property=og:image content=https://alunworker.com/images/icon.webp><meta property=article:published_time content=2025-09-19T16:00:00.000Z><meta property=article:modified_time content=2025-09-19T17:39:15.224Z><meta property=article:author content=AlunWorker><meta property=article:tag content=VSCode><meta property=article:tag content=插件开发><meta property=article:tag content=AI集成><meta property=article:tag content=实战项目><meta property=article:tag content=项目管理><meta property=article:tag content=全栈开发><meta name=twitter:card content=summary><meta name=twitter:image content=https://alunworker.com/images/icon.webp><link rel="shortcut icon" href=/images/favicon.webp><link rel=canonical href=https://alunworker.com/vscode/extension/08-practical-projects/index.html><link rel=preconnect><link rel=preconnect href=//busuanzi.ibruce.info><link rel=stylesheet href="/css/index.css?v=4.13.0"><link rel=stylesheet href=https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/6.0.0/css/all.min.css><link rel=stylesheet href=/ media=print onload='this.media="all"'><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: '/',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id=config-diff>var GLOBAL_CONFIG_SITE={title:"VS Code 扩展开发阶段八：综合实战项目 - 从设计到发布的完整开发流程",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2025-09-20 01:39:15"}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name=generator content="Hexo 7.1.1"></head><body><div id=loading-box><div class=loading-left-bg></div><div class=loading-right-bg></div><div class=spinner-box><div class=configure-border-1><div class=configure-core></div></div><div class=configure-border-2><div class=configure-core></div></div><div class=loading-word>加载中...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load',() => { preloader.endLoading() })

  if (false) {
    document.addEventListener('pjax:send', () => { preloader.initLoading() })
    document.addEventListener('pjax:complete', () => { preloader.endLoading() })
  }
})()</script><div id=sidebar><div id=menu-mask></div><div id=sidebar-menus><div class="avatar-img is-center"><img src=/images/loading.gif data-original=/images/icon.webp onerror='onerror=null,src="/img/friend_404.gif"' alt=avatar></div><div class="sidebar-site-data site-data is-center"><a href=/archives/ ><div class=headline>文章</div><div class=length-num>82</div></a><a href=/tags/ ><div class=headline>标签</div><div class=length-num>174</div></a><a href=/categories/ ><div class=headline>分类</div><div class=length-num>14</div></a></div><hr class=custom-hr><div class=menus_items><div class=menus_item><a class=site-page href=/ ><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class=menus_item><a class=site-page href=/archives/ ><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class=menus_item><a class=site-page href=/tags/ ><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class=menus_item><a class=site-page href=/categories/ ><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class=menus_item><a class=site-page href=/about/ ><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class=post id=body-wrap><header class=post-bg id=page-header style=background-image:url(/images/blog_bg.webp)><nav id=nav><span id=blog-info><a href=/ title=AlunWorker><span class=site-name>AlunWorker</span></a></span><div id=menus><div id=search-button><a class="site-page social-icon search" href=javascript:void(0);><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class=menus_items><div class=menus_item><a class=site-page href=/ ><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class=menus_item><a class=site-page href=/archives/ ><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class=menus_item><a class=site-page href=/tags/ ><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class=menus_item><a class=site-page href=/categories/ ><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class=menus_item><a class=site-page href=/about/ ><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id=toggle-menu><a class=site-page href=javascript:void(0);><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id=post-info><h1 class=post-title>VS Code 扩展开发阶段八：综合实战项目 - 从设计到发布的完整开发流程</h1><div id=post-meta><div class=meta-firstline><span class=post-meta-date><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class=post-meta-label>发表于</span><time class=post-meta-date-created datetime=2025-09-19T16:00:00.000Z title="发表于 2025-09-20 00:00:00">2025-09-20</time><span class=post-meta-separator>|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class=post-meta-label>更新于</span><time class=post-meta-date-updated datetime=2025-09-19T17:39:15.224Z title="更新于 2025-09-20 01:39:15">2025-09-20</time></span><span class=post-meta-categories><span class=post-meta-separator>|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class=post-meta-categories href=/categories/VSCode/ >VSCode</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class=post-meta-categories href=/categories/VSCode/%E6%89%A9%E5%B1%95%E5%BC%80%E5%8F%91/ >扩展开发</a></span></div><div class=meta-secondline><span class=post-meta-separator>|</span><span class=post-meta-wordcount><i class="far fa-file-word fa-fw post-meta-icon"></i><span class=post-meta-label>字数总计:</span><span class=word-count>8.3k</span><span class=post-meta-separator>|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class=post-meta-label>阅读时长:</span><span>43分钟</span></span><span class=post-meta-separator>|</span><span class=post-meta-pv-cv id="" data-flag-title="VS Code 扩展开发阶段八：综合实战项目 - 从设计到发布的完整开发流程"><i class="far fa-eye fa-fw post-meta-icon"></i><span class=post-meta-label>阅读量:</span><span id=busuanzi_value_page_pv><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class=layout id=content-inner><div id=post><article class=post-content id=article-container><blockquote><p>实战出真知！本阶段将通过5个完整的综合项目，带你体验从0到1开发VS Code扩展的全过程。从需求分析、架构设计到编码实现、测试发布，每个项目都会涉及不同的技术栈和应用场景，帮你成为VS Code扩展开发的全栈专家。</p></blockquote><hr><h2 id=🎯-学习目标><a href=#🎯-学习目标 class=headerlink title="🎯 学习目标"></a>🎯 学习目标</h2><p>完成本阶段学习后，你将能够：</p><ul><li>🏗️ <strong>项目架构设计</strong>：独立完成扩展的技术选型和架构设计</li><li>💻 <strong>全栈开发能力</strong>：前端UI + 后端服务 + 数据存储的完整技术栈</li><li>🤖 <strong>AI工具开发</strong>：集成大模型API，开发智能化功能</li><li>📊 <strong>数据可视化</strong>：构建复杂的数据展示和交互界面</li><li>🚀 <strong>DevOps实践</strong>：自动化测试、持续集成、发布流程</li><li>📈 <strong>产品思维</strong>：用户体验设计、功能迭代、市场推广</li></ul><p><strong>预计学习时间：3-4周（每天2-3小时）</strong></p><hr><h2 id=🏗️-项目概览与技术栈><a href=#🏗️-项目概览与技术栈 class=headerlink title="🏗️ 项目概览与技术栈"></a>🏗️ 项目概览与技术栈</h2><h3 id=项目选择策略><a href=#项目选择策略 class=headerlink title=项目选择策略></a>项目选择策略</h3><p>我们将开发5个不同类型的扩展，覆盖主流应用场景：</p><table><thead><tr><th>项目</th><th>类型</th><th>主要技术栈</th><th>难度</th><th>开发周期</th></tr></thead><tbody><tr><td><strong>AI Code Assistant</strong></td><td>AI工具</td><td>TypeScript + OpenAI API + WebView</td><td>⭐⭐⭐⭐</td><td>5-7天</td></tr><tr><td><strong>API Testing Tool</strong></td><td>开发工具</td><td>React + Node.js + SQLite</td><td>⭐⭐⭐</td><td>4-5天</td></tr><tr><td><strong>Data Visualizer</strong></td><td>数据工具</td><td>Vue.js + D3.js + WebSocket</td><td>⭐⭐⭐⭐</td><td>6-8天</td></tr><tr><td><strong>Project Manager</strong></td><td>效率工具</td><td>TypeScript + IndexedDB + Tree View</td><td>⭐⭐⭐</td><td>4-6天</td></tr><tr><td><strong>Code Quality Monitor</strong></td><td>质量工具</td><td>LSP + Language Server + AST</td><td>⭐⭐⭐⭐⭐</td><td>7-10天</td></tr></tbody></table><h3 id=通用技术栈><a href=#通用技术栈 class=headerlink title=通用技术栈></a>通用技术栈</h3><figure class="highlight typescript"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br></pre></td><td class=code><pre><span class=line><span class=comment>// 基础技术栈</span></span><br><span class=line>- <span class="title class_">TypeScript</span> <span class=number>5.0</span>+          <span class=comment>// 类型安全的JavaScript</span></span><br><span class=line>- <span class="variable constant_">VS</span> <span class="title class_">Code</span> <span class="variable constant_">API</span> <span class=number>1.74</span>+        <span class=comment>// VS Code扩展API</span></span><br><span class=line>- <span class="title class_">Node</span>.<span class=property>js</span> <span class=number>18</span>+              <span class=comment>// 运行时环境</span></span><br><span class=line></span><br><span class=line><span class=comment>// 前端技术栈  </span></span><br><span class=line>- <span class="title class_">React</span> <span class=number>18</span> / <span class="title class_">Vue</span> <span class=number>3</span>         <span class=comment>// 现代前端框架</span></span><br><span class=line>- <span class="title class_">WebView</span> <span class="variable constant_">API</span>              <span class=comment>// VS Code内嵌网页</span></span><br><span class=line>- <span class="title class_">CSS3</span> + <span class="title class_">Tailwind</span>          <span class=comment>// 样式方案</span></span><br><span class=line></span><br><span class=line><span class=comment>// 数据存储</span></span><br><span class=line>- <span class="title class_">IndexedDB</span>                <span class=comment>// 浏览器端数据库</span></span><br><span class=line>- <span class="title class_">SQLite</span>                   <span class=comment>// 轻量级关系数据库</span></span><br><span class=line>- <span class="title class_">File</span> <span class="title class_">System</span> <span class="variable constant_">API</span>          <span class=comment>// 文件系统操作</span></span><br><span class=line></span><br><span class=line><span class=comment>// AI集成</span></span><br><span class=line>- <span class="title class_">OpenAI</span> <span class="variable constant_">API</span>               <span class=comment>// GPT模型接口</span></span><br><span class=line>- <span class="title class_">Local</span> <span class="variable constant_">LLM</span>                <span class=comment>// 本地大模型</span></span><br><span class=line>- <span class="title class_">Prompt</span> <span class="title class_">Engineering</span>       <span class=comment>// 提示工程</span></span><br><span class=line></span><br><span class=line><span class=comment>// 工具链</span></span><br><span class=line>- <span class="title class_">Webpack</span>                  <span class=comment>// 模块打包</span></span><br><span class=line>- <span class="title class_">Jest</span> + <span class=meta>@vscode</span>/test     <span class=comment>// 测试框架</span></span><br><span class=line>- <span class="title class_">ESLint</span> + <span class="title class_">Prettier</span>       <span class=comment>// 代码质量</span></span><br><span class=line>- <span class="title class_">GitHub</span> <span class="title class_">Actions</span>          <span class=comment>// CI/CD</span></span><br></pre></td></tr></table></figure><hr><h2 id=🤖-项目一：AI-Code-Assistant（AI代码助手）><a href=#🤖-项目一：AI-Code-Assistant（AI代码助手） class=headerlink title="🤖 项目一：AI Code Assistant（AI代码助手）"></a>🤖 项目一：AI Code Assistant（AI代码助手）</h2><h3 id=项目介绍><a href=#项目介绍 class=headerlink title=项目介绍></a>项目介绍</h3><p>开发一个智能代码助手，集成多种AI能力，帮助开发者提高编码效率。</p><h4 id=核心功能><a href=#核心功能 class=headerlink title=核心功能></a>核心功能</h4><ul><li><strong>代码生成</strong>：根据自然语言描述生成代码</li><li><strong>代码解释</strong>：分析和解释复杂代码逻辑</li><li><strong>代码优化</strong>：提供性能和可读性改进建议</li><li><strong>文档生成</strong>：自动生成函数和类的文档</li><li><strong>单元测试生成</strong>：基于代码自动生成测试用例</li></ul><h3 id=1-1-需求分析与设计><a href=#1-1-需求分析与设计 class=headerlink title="1.1 需求分析与设计"></a>1.1 需求分析与设计</h3><h4 id=用户故事><a href=#用户故事 class=headerlink title=用户故事></a>用户故事</h4><figure class="highlight markdown"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br></pre></td><td class=code><pre><span class=line>作为一个开发者，我希望能够：</span><br><span class=line><span class=bullet>1.</span> 通过自然语言描述快速生成代码片段</span><br><span class=line><span class=bullet>2.</span> 选中复杂代码后获得详细的解释说明</span><br><span class=line><span class=bullet>3.</span> 获得代码优化和重构建议</span><br><span class=line><span class=bullet>4.</span> 自动生成函数和API文档</span><br><span class=line><span class=bullet>5.</span> 快速生成单元测试代码</span><br></pre></td></tr></table></figure><h4 id=架构设计><a href=#架构设计 class=headerlink title=架构设计></a>架构设计</h4><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br></pre></td><td class=code><pre><span class=line>graph TB</span><br><span class=line>    A[VS Code Editor] --&gt; B[Extension Host]</span><br><span class=line>    B --&gt; C[AI Assistant Extension]</span><br><span class=line>    C --&gt; D[Command Handler]</span><br><span class=line>    C --&gt; E[WebView Provider]</span><br><span class=line>    C --&gt; F[AI Service]</span><br><span class=line>    </span><br><span class=line>    D --&gt; G[Code Analysis]</span><br><span class=line>    D --&gt; H[Selection Handler]</span><br><span class=line>    </span><br><span class=line>    E --&gt; I[React UI]</span><br><span class=line>    I --&gt; J[Chat Interface]</span><br><span class=line>    I --&gt; K[Code Preview]</span><br><span class=line>    I --&gt; L[History Panel]</span><br><span class=line>    </span><br><span class=line>    F --&gt; M[OpenAI API]</span><br><span class=line>    F --&gt; N[Local LLM]</span><br><span class=line>    F --&gt; O[Prompt Manager]</span><br><span class=line>    </span><br><span class=line>    G --&gt; P[AST Parser]</span><br><span class=line>    G --&gt; Q[Context Extractor]</span><br></pre></td></tr></table></figure><h3 id=1-2-项目实现><a href=#1-2-项目实现 class=headerlink title="1.2 项目实现"></a>1.2 项目实现</h3><h4 id=扩展清单配置><a href=#扩展清单配置 class=headerlink title=扩展清单配置></a>扩展清单配置</h4><figure class="highlight json"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br><span class=line>90</span><br><span class=line>91</span><br><span class=line>92</span><br><span class=line>93</span><br><span class=line>94</span><br><span class=line>95</span><br><span class=line>96</span><br><span class=line>97</span><br><span class=line>98</span><br><span class=line>99</span><br><span class=line>100</span><br><span class=line>101</span><br><span class=line>102</span><br><span class=line>103</span><br><span class=line>104</span><br><span class=line>105</span><br><span class=line>106</span><br><span class=line>107</span><br><span class=line>108</span><br><span class=line>109</span><br><span class=line>110</span><br><span class=line>111</span><br><span class=line>112</span><br><span class=line>113</span><br><span class=line>114</span><br><span class=line>115</span><br><span class=line>116</span><br><span class=line>117</span><br></pre></td><td class=code><pre><span class=line><span class=punctuation>&#123;</span></span><br><span class=line>  <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;ai-code-assistant&quot;</span><span class=punctuation>,</span></span><br><span class=line>  <span class=attr>&quot;displayName&quot;</span><span class=punctuation>:</span> <span class=string>&quot;AI Code Assistant&quot;</span><span class=punctuation>,</span></span><br><span class=line>  <span class=attr>&quot;description&quot;</span><span class=punctuation>:</span> <span class=string>&quot;Intelligent code generation and analysis powered by AI&quot;</span><span class=punctuation>,</span></span><br><span class=line>  <span class=attr>&quot;version&quot;</span><span class=punctuation>:</span> <span class=string>&quot;1.0.0&quot;</span><span class=punctuation>,</span></span><br><span class=line>  <span class=attr>&quot;engines&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>    <span class=attr>&quot;vscode&quot;</span><span class=punctuation>:</span> <span class=string>&quot;^1.74.0&quot;</span></span><br><span class=line>  <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>  <span class=attr>&quot;categories&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span><span class=string>&quot;Other&quot;</span><span class=punctuation>,</span> <span class=string>&quot;Machine Learning&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>  <span class=attr>&quot;activationEvents&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>    <span class=string>&quot;onCommand:aiAssistant.generateCode&quot;</span><span class=punctuation>,</span></span><br><span class=line>    <span class=string>&quot;onCommand:aiAssistant.explainCode&quot;</span><span class=punctuation>,</span></span><br><span class=line>    <span class=string>&quot;onCommand:aiAssistant.optimizeCode&quot;</span><span class=punctuation>,</span></span><br><span class=line>    <span class=string>&quot;onLanguage:typescript&quot;</span><span class=punctuation>,</span></span><br><span class=line>    <span class=string>&quot;onLanguage:javascript&quot;</span><span class=punctuation>,</span></span><br><span class=line>    <span class=string>&quot;onLanguage:python&quot;</span></span><br><span class=line>  <span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>  <span class=attr>&quot;main&quot;</span><span class=punctuation>:</span> <span class=string>&quot;./dist/extension.js&quot;</span><span class=punctuation>,</span></span><br><span class=line>  <span class=attr>&quot;contributes&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>    <span class=attr>&quot;commands&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>      <span class=punctuation>&#123;</span></span><br><span class=line>        <span class=attr>&quot;command&quot;</span><span class=punctuation>:</span> <span class=string>&quot;aiAssistant.generateCode&quot;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;title&quot;</span><span class=punctuation>:</span> <span class=string>&quot;Generate Code&quot;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;category&quot;</span><span class=punctuation>:</span> <span class=string>&quot;AI Assistant&quot;</span></span><br><span class=line>      <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>      <span class=punctuation>&#123;</span></span><br><span class=line>        <span class=attr>&quot;command&quot;</span><span class=punctuation>:</span> <span class=string>&quot;aiAssistant.explainCode&quot;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;title&quot;</span><span class=punctuation>:</span> <span class=string>&quot;Explain Code&quot;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;category&quot;</span><span class=punctuation>:</span> <span class=string>&quot;AI Assistant&quot;</span></span><br><span class=line>      <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>      <span class=punctuation>&#123;</span></span><br><span class=line>        <span class=attr>&quot;command&quot;</span><span class=punctuation>:</span> <span class=string>&quot;aiAssistant.optimizeCode&quot;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;title&quot;</span><span class=punctuation>:</span> <span class=string>&quot;Optimize Code&quot;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;category&quot;</span><span class=punctuation>:</span> <span class=string>&quot;AI Assistant&quot;</span></span><br><span class=line>      <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>      <span class=punctuation>&#123;</span></span><br><span class=line>        <span class=attr>&quot;command&quot;</span><span class=punctuation>:</span> <span class=string>&quot;aiAssistant.generateTests&quot;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;title&quot;</span><span class=punctuation>:</span> <span class=string>&quot;Generate Tests&quot;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;category&quot;</span><span class=punctuation>:</span> <span class=string>&quot;AI Assistant&quot;</span></span><br><span class=line>      <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>      <span class=punctuation>&#123;</span></span><br><span class=line>        <span class=attr>&quot;command&quot;</span><span class=punctuation>:</span> <span class=string>&quot;aiAssistant.generateDocs&quot;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;title&quot;</span><span class=punctuation>:</span> <span class=string>&quot;Generate Documentation&quot;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;category&quot;</span><span class=punctuation>:</span> <span class=string>&quot;AI Assistant&quot;</span></span><br><span class=line>      <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>      <span class=punctuation>&#123;</span></span><br><span class=line>        <span class=attr>&quot;command&quot;</span><span class=punctuation>:</span> <span class=string>&quot;aiAssistant.openChat&quot;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;title&quot;</span><span class=punctuation>:</span> <span class=string>&quot;Open AI Chat&quot;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;category&quot;</span><span class=punctuation>:</span> <span class=string>&quot;AI Assistant&quot;</span></span><br><span class=line>      <span class=punctuation>&#125;</span></span><br><span class=line>    <span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>    <span class=attr>&quot;menus&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>      <span class=attr>&quot;editor/context&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>        <span class=punctuation>&#123;</span></span><br><span class=line>          <span class=attr>&quot;command&quot;</span><span class=punctuation>:</span> <span class=string>&quot;aiAssistant.explainCode&quot;</span><span class=punctuation>,</span></span><br><span class=line>          <span class=attr>&quot;when&quot;</span><span class=punctuation>:</span> <span class=string>&quot;editorHasSelection&quot;</span><span class=punctuation>,</span></span><br><span class=line>          <span class=attr>&quot;group&quot;</span><span class=punctuation>:</span> <span class=string>&quot;aiAssistant@1&quot;</span></span><br><span class=line>        <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=punctuation>&#123;</span></span><br><span class=line>          <span class=attr>&quot;command&quot;</span><span class=punctuation>:</span> <span class=string>&quot;aiAssistant.optimizeCode&quot;</span><span class=punctuation>,</span></span><br><span class=line>          <span class=attr>&quot;when&quot;</span><span class=punctuation>:</span> <span class=string>&quot;editorHasSelection&quot;</span><span class=punctuation>,</span></span><br><span class=line>          <span class=attr>&quot;group&quot;</span><span class=punctuation>:</span> <span class=string>&quot;aiAssistant@2&quot;</span></span><br><span class=line>        <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=punctuation>&#123;</span></span><br><span class=line>          <span class=attr>&quot;command&quot;</span><span class=punctuation>:</span> <span class=string>&quot;aiAssistant.generateTests&quot;</span><span class=punctuation>,</span></span><br><span class=line>          <span class=attr>&quot;when&quot;</span><span class=punctuation>:</span> <span class=string>&quot;editorHasSelection&quot;</span><span class=punctuation>,</span></span><br><span class=line>          <span class=attr>&quot;group&quot;</span><span class=punctuation>:</span> <span class=string>&quot;aiAssistant@3&quot;</span></span><br><span class=line>        <span class=punctuation>&#125;</span></span><br><span class=line>      <span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>      <span class=attr>&quot;view/title&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>        <span class=punctuation>&#123;</span></span><br><span class=line>          <span class=attr>&quot;command&quot;</span><span class=punctuation>:</span> <span class=string>&quot;aiAssistant.openChat&quot;</span><span class=punctuation>,</span></span><br><span class=line>          <span class=attr>&quot;when&quot;</span><span class=punctuation>:</span> <span class=string>&quot;view == aiAssistantView&quot;</span><span class=punctuation>,</span></span><br><span class=line>          <span class=attr>&quot;group&quot;</span><span class=punctuation>:</span> <span class=string>&quot;navigation&quot;</span></span><br><span class=line>        <span class=punctuation>&#125;</span></span><br><span class=line>      <span class=punctuation>]</span></span><br><span class=line>    <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>    <span class=attr>&quot;views&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>      <span class=attr>&quot;aiAssistant&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>        <span class=punctuation>&#123;</span></span><br><span class=line>          <span class=attr>&quot;id&quot;</span><span class=punctuation>:</span> <span class=string>&quot;aiAssistantView&quot;</span><span class=punctuation>,</span></span><br><span class=line>          <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;AI Assistant&quot;</span><span class=punctuation>,</span></span><br><span class=line>          <span class=attr>&quot;when&quot;</span><span class=punctuation>:</span> <span class=string>&quot;aiAssistant.enabled&quot;</span></span><br><span class=line>        <span class=punctuation>&#125;</span></span><br><span class=line>      <span class=punctuation>]</span></span><br><span class=line>    <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>    <span class=attr>&quot;viewsContainers&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>      <span class=attr>&quot;activitybar&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>        <span class=punctuation>&#123;</span></span><br><span class=line>          <span class=attr>&quot;id&quot;</span><span class=punctuation>:</span> <span class=string>&quot;aiAssistant&quot;</span><span class=punctuation>,</span></span><br><span class=line>          <span class=attr>&quot;title&quot;</span><span class=punctuation>:</span> <span class=string>&quot;AI Assistant&quot;</span><span class=punctuation>,</span></span><br><span class=line>          <span class=attr>&quot;icon&quot;</span><span class=punctuation>:</span> <span class=string>&quot;$(robot)&quot;</span></span><br><span class=line>        <span class=punctuation>&#125;</span></span><br><span class=line>      <span class=punctuation>]</span></span><br><span class=line>    <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>    <span class=attr>&quot;configuration&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>      <span class=attr>&quot;title&quot;</span><span class=punctuation>:</span> <span class=string>&quot;AI Assistant&quot;</span><span class=punctuation>,</span></span><br><span class=line>      <span class=attr>&quot;properties&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>        <span class=attr>&quot;aiAssistant.apiKey&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>          <span class=attr>&quot;type&quot;</span><span class=punctuation>:</span> <span class=string>&quot;string&quot;</span><span class=punctuation>,</span></span><br><span class=line>          <span class=attr>&quot;description&quot;</span><span class=punctuation>:</span> <span class=string>&quot;OpenAI API Key&quot;</span></span><br><span class=line>        <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;aiAssistant.model&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>          <span class=attr>&quot;type&quot;</span><span class=punctuation>:</span> <span class=string>&quot;string&quot;</span><span class=punctuation>,</span></span><br><span class=line>          <span class=attr>&quot;enum&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span><span class=string>&quot;gpt-4&quot;</span><span class=punctuation>,</span> <span class=string>&quot;gpt-3.5-turbo&quot;</span><span class=punctuation>,</span> <span class=string>&quot;claude-3&quot;</span><span class=punctuation>,</span> <span class=string>&quot;local&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>          <span class=attr>&quot;default&quot;</span><span class=punctuation>:</span> <span class=string>&quot;gpt-3.5-turbo&quot;</span><span class=punctuation>,</span></span><br><span class=line>          <span class=attr>&quot;description&quot;</span><span class=punctuation>:</span> <span class=string>&quot;AI Model to use&quot;</span></span><br><span class=line>        <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;aiAssistant.maxTokens&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>          <span class=attr>&quot;type&quot;</span><span class=punctuation>:</span> <span class=string>&quot;number&quot;</span><span class=punctuation>,</span></span><br><span class=line>          <span class=attr>&quot;default&quot;</span><span class=punctuation>:</span> <span class=number>2048</span><span class=punctuation>,</span></span><br><span class=line>          <span class=attr>&quot;description&quot;</span><span class=punctuation>:</span> <span class=string>&quot;Maximum tokens for AI responses&quot;</span></span><br><span class=line>        <span class=punctuation>&#125;</span></span><br><span class=line>      <span class=punctuation>&#125;</span></span><br><span class=line>    <span class=punctuation>&#125;</span></span><br><span class=line>  <span class=punctuation>&#125;</span></span><br><span class=line><span class=punctuation>&#125;</span></span><br></pre></td></tr></table></figure><h4 id=核心扩展逻辑><a href=#核心扩展逻辑 class=headerlink title=核心扩展逻辑></a>核心扩展逻辑</h4><figure class="highlight typescript"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br></pre></td><td class=code><pre><span class=line><span class=comment>// src/extension.ts</span></span><br><span class=line><span class=keyword>import</span> * <span class=keyword>as</span> vscode <span class=keyword>from</span> <span class=string>&#x27;vscode&#x27;</span>;</span><br><span class=line><span class=keyword>import</span> &#123; <span class="title class_">AIService</span> &#125; <span class=keyword>from</span> <span class=string>&#x27;./services/aiService&#x27;</span>;</span><br><span class=line><span class=keyword>import</span> &#123; <span class="title class_">CodeAnalyzer</span> &#125; <span class=keyword>from</span> <span class=string>&#x27;./services/codeAnalyzer&#x27;</span>;</span><br><span class=line><span class=keyword>import</span> &#123; <span class="title class_">ChatWebviewProvider</span> &#125; <span class=keyword>from</span> <span class=string>&#x27;./webview/chatWebviewProvider&#x27;</span>;</span><br><span class=line><span class=keyword>import</span> &#123; <span class="title class_">CommandHandler</span> &#125; <span class=keyword>from</span> <span class=string>&#x27;./commands/commandHandler&#x27;</span>;</span><br><span class=line></span><br><span class=line><span class=keyword>export</span> <span class=keyword>async</span> <span class=keyword>function</span> <span class="title function_">activate</span>(<span class=params>context: vscode.ExtensionContext</span>) &#123;</span><br><span class=line>    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class=string>&#x27;AI Code Assistant is now active!&#x27;</span>);</span><br><span class=line>    </span><br><span class=line>    <span class=comment>// 初始化服务</span></span><br><span class=line>    <span class=keyword>const</span> aiService = <span class=keyword>new</span> <span class="title class_">AIService</span>();</span><br><span class=line>    <span class=keyword>const</span> codeAnalyzer = <span class=keyword>new</span> <span class="title class_">CodeAnalyzer</span>();</span><br><span class=line>    <span class=keyword>const</span> chatProvider = <span class=keyword>new</span> <span class="title class_">ChatWebviewProvider</span>(context.<span class=property>extensionUri</span>, aiService);</span><br><span class=line>    <span class=keyword>const</span> commandHandler = <span class=keyword>new</span> <span class="title class_">CommandHandler</span>(aiService, codeAnalyzer);</span><br><span class=line>    </span><br><span class=line>    <span class=comment>// 注册WebView Provider</span></span><br><span class=line>    context.<span class=property>subscriptions</span>.<span class="title function_">push</span>(</span><br><span class=line>        vscode.<span class=property>window</span>.<span class="title function_">registerWebviewViewProvider</span>(</span><br><span class=line>            <span class=string>&#x27;aiAssistantView&#x27;</span>,</span><br><span class=line>            chatProvider</span><br><span class=line>        )</span><br><span class=line>    );</span><br><span class=line>    </span><br><span class=line>    <span class=comment>// 注册命令</span></span><br><span class=line>    <span class=keyword>const</span> commands = [</span><br><span class=line>        vscode.<span class=property>commands</span>.<span class="title function_">registerCommand</span>(<span class=string>&#x27;aiAssistant.generateCode&#x27;</span>, </span><br><span class=line>            commandHandler.<span class=property>generateCode</span>.<span class="title function_">bind</span>(commandHandler)</span><br><span class=line>        ),</span><br><span class=line>        vscode.<span class=property>commands</span>.<span class="title function_">registerCommand</span>(<span class=string>&#x27;aiAssistant.explainCode&#x27;</span>, </span><br><span class=line>            commandHandler.<span class=property>explainCode</span>.<span class="title function_">bind</span>(commandHandler)</span><br><span class=line>        ),</span><br><span class=line>        vscode.<span class=property>commands</span>.<span class="title function_">registerCommand</span>(<span class=string>&#x27;aiAssistant.optimizeCode&#x27;</span>, </span><br><span class=line>            commandHandler.<span class=property>optimizeCode</span>.<span class="title function_">bind</span>(commandHandler)</span><br><span class=line>        ),</span><br><span class=line>        vscode.<span class=property>commands</span>.<span class="title function_">registerCommand</span>(<span class=string>&#x27;aiAssistant.generateTests&#x27;</span>, </span><br><span class=line>            commandHandler.<span class=property>generateTests</span>.<span class="title function_">bind</span>(commandHandler)</span><br><span class=line>        ),</span><br><span class=line>        vscode.<span class=property>commands</span>.<span class="title function_">registerCommand</span>(<span class=string>&#x27;aiAssistant.generateDocs&#x27;</span>, </span><br><span class=line>            commandHandler.<span class=property>generateDocs</span>.<span class="title function_">bind</span>(commandHandler)</span><br><span class=line>        ),</span><br><span class=line>        vscode.<span class=property>commands</span>.<span class="title function_">registerCommand</span>(<span class=string>&#x27;aiAssistant.openChat&#x27;</span>, </span><br><span class=line>            <span class=function>() =&gt;</span> chatProvider.<span class="title function_">show</span>()</span><br><span class=line>        )</span><br><span class=line>    ];</span><br><span class=line>    </span><br><span class=line>    context.<span class=property>subscriptions</span>.<span class="title function_">push</span>(...commands);</span><br><span class=line>    </span><br><span class=line>    <span class=comment>// 设置上下文变量</span></span><br><span class=line>    vscode.<span class=property>commands</span>.<span class="title function_">executeCommand</span>(<span class=string>&#x27;setContext&#x27;</span>, <span class=string>&#x27;aiAssistant.enabled&#x27;</span>, <span class=literal>true</span>);</span><br><span class=line>    </span><br><span class=line>    <span class=comment>// 监听配置变化</span></span><br><span class=line>    context.<span class=property>subscriptions</span>.<span class="title function_">push</span>(</span><br><span class=line>        vscode.<span class=property>workspace</span>.<span class="title function_">onDidChangeConfiguration</span>(<span class=function><span class=params>event</span> =&gt;</span> &#123;</span><br><span class=line>            <span class=keyword>if</span> (event.<span class="title function_">affectsConfiguration</span>(<span class=string>&#x27;aiAssistant&#x27;</span>)) &#123;</span><br><span class=line>                aiService.<span class="title function_">updateConfiguration</span>();</span><br><span class=line>            &#125;</span><br><span class=line>        &#125;)</span><br><span class=line>    );</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><h4 id=AI服务实现><a href=#AI服务实现 class=headerlink title=AI服务实现></a>AI服务实现</h4><figure class="highlight typescript"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br><span class=line>90</span><br><span class=line>91</span><br><span class=line>92</span><br><span class=line>93</span><br><span class=line>94</span><br><span class=line>95</span><br><span class=line>96</span><br><span class=line>97</span><br><span class=line>98</span><br><span class=line>99</span><br><span class=line>100</span><br><span class=line>101</span><br><span class=line>102</span><br><span class=line>103</span><br><span class=line>104</span><br><span class=line>105</span><br><span class=line>106</span><br><span class=line>107</span><br><span class=line>108</span><br><span class=line>109</span><br><span class=line>110</span><br><span class=line>111</span><br><span class=line>112</span><br><span class=line>113</span><br><span class=line>114</span><br><span class=line>115</span><br><span class=line>116</span><br><span class=line>117</span><br><span class=line>118</span><br><span class=line>119</span><br><span class=line>120</span><br><span class=line>121</span><br><span class=line>122</span><br><span class=line>123</span><br><span class=line>124</span><br><span class=line>125</span><br><span class=line>126</span><br><span class=line>127</span><br><span class=line>128</span><br><span class=line>129</span><br><span class=line>130</span><br><span class=line>131</span><br><span class=line>132</span><br><span class=line>133</span><br><span class=line>134</span><br><span class=line>135</span><br><span class=line>136</span><br><span class=line>137</span><br><span class=line>138</span><br><span class=line>139</span><br><span class=line>140</span><br><span class=line>141</span><br><span class=line>142</span><br><span class=line>143</span><br><span class=line>144</span><br><span class=line>145</span><br><span class=line>146</span><br><span class=line>147</span><br><span class=line>148</span><br><span class=line>149</span><br><span class=line>150</span><br><span class=line>151</span><br><span class=line>152</span><br><span class=line>153</span><br><span class=line>154</span><br><span class=line>155</span><br><span class=line>156</span><br><span class=line>157</span><br><span class=line>158</span><br><span class=line>159</span><br><span class=line>160</span><br><span class=line>161</span><br><span class=line>162</span><br><span class=line>163</span><br><span class=line>164</span><br><span class=line>165</span><br><span class=line>166</span><br><span class=line>167</span><br><span class=line>168</span><br><span class=line>169</span><br><span class=line>170</span><br></pre></td><td class=code><pre><span class=line><span class=comment>// src/services/aiService.ts</span></span><br><span class=line><span class=keyword>import</span> * <span class=keyword>as</span> vscode <span class=keyword>from</span> <span class=string>&#x27;vscode&#x27;</span>;</span><br><span class=line><span class=keyword>import</span> <span class="title class_">OpenAI</span> <span class=keyword>from</span> <span class=string>&#x27;openai&#x27;</span>;</span><br><span class=line></span><br><span class=line><span class=keyword>export</span> <span class=keyword>interface</span> <span class="title class_">AIRequest</span> &#123;</span><br><span class=line>    <span class=attr>prompt</span>: <span class=built_in>string</span>;</span><br><span class=line>    context?: <span class=built_in>string</span>;</span><br><span class=line>    language?: <span class=built_in>string</span>;</span><br><span class=line>    temperature?: <span class=built_in>number</span>;</span><br><span class=line>&#125;</span><br><span class=line></span><br><span class=line><span class=keyword>export</span> <span class=keyword>interface</span> <span class="title class_">AIResponse</span> &#123;</span><br><span class=line>    <span class=attr>content</span>: <span class=built_in>string</span>;</span><br><span class=line>    usage?: &#123;</span><br><span class=line>        <span class=attr>prompt_tokens</span>: <span class=built_in>number</span>;</span><br><span class=line>        <span class=attr>completion_tokens</span>: <span class=built_in>number</span>;</span><br><span class=line>        <span class=attr>total_tokens</span>: <span class=built_in>number</span>;</span><br><span class=line>    &#125;;</span><br><span class=line>&#125;</span><br><span class=line></span><br><span class=line><span class=keyword>export</span> <span class=keyword>class</span> <span class="title class_">AIService</span> &#123;</span><br><span class=line>    <span class=keyword>private</span> <span class=attr>openai</span>: <span class="title class_">OpenAI</span> | <span class=literal>null</span> = <span class=literal>null</span>;</span><br><span class=line>    <span class=keyword>private</span> <span class=attr>config</span>: vscode.<span class=property>WorkspaceConfiguration</span>;</span><br><span class=line>    </span><br><span class=line>    <span class="title function_">constructor</span>(<span class=params></span>) &#123;</span><br><span class=line>        <span class="variable language_">this</span>.<span class="title function_">updateConfiguration</span>();</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class="title function_">updateConfiguration</span>(<span class=params></span>) &#123;</span><br><span class=line>        <span class="variable language_">this</span>.<span class=property>config</span> = vscode.<span class=property>workspace</span>.<span class="title function_">getConfiguration</span>(<span class=string>&#x27;aiAssistant&#x27;</span>);</span><br><span class=line>        <span class=keyword>const</span> apiKey = <span class="variable language_">this</span>.<span class=property>config</span>.<span class=property>get</span>&lt;<span class=built_in>string</span>&gt;(<span class=string>&#x27;apiKey&#x27;</span>);</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>if</span> (apiKey) &#123;</span><br><span class=line>            <span class="variable language_">this</span>.<span class=property>openai</span> = <span class=keyword>new</span> <span class="title class_">OpenAI</span>(&#123;</span><br><span class=line>                <span class=attr>apiKey</span>: apiKey</span><br><span class=line>            &#125;);</span><br><span class=line>        &#125;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>async</span> <span class="title function_">generateCode</span>(<span class=attr>request</span>: <span class="title class_">AIRequest</span>): <span class="title class_">Promise</span>&lt;<span class="title class_">AIResponse</span>&gt; &#123;</span><br><span class=line>        <span class=keyword>if</span> (!<span class="variable language_">this</span>.<span class=property>openai</span>) &#123;</span><br><span class=line>            <span class=keyword>throw</span> <span class=keyword>new</span> <span class="title class_">Error</span>(<span class=string>&#x27;AI service not configured. Please set your API key.&#x27;</span>);</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>const</span> systemPrompt = <span class=string>`You are an expert programmer. Generate clean, efficient, and well-commented code based on the user&#x27;s requirements. </span></span><br><span class=line><span class=string>        </span></span><br><span class=line><span class=string>Language: <span class=subst>$&#123;request.language || <span class=string>&#x27;TypeScript&#x27;</span>&#125;</span></span></span><br><span class=line><span class=string>Context: <span class=subst>$&#123;request.context || <span class=string>&#x27;No additional context&#x27;</span>&#125;</span></span></span><br><span class=line><span class=string></span></span><br><span class=line><span class=string>Please provide only the code without explanations unless specifically requested.`</span>;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>try</span> &#123;</span><br><span class=line>            <span class=keyword>const</span> completion = <span class=keyword>await</span> <span class="variable language_">this</span>.<span class=property>openai</span>.<span class=property>chat</span>.<span class=property>completions</span>.<span class="title function_">create</span>(&#123;</span><br><span class=line>                <span class=attr>model</span>: <span class="variable language_">this</span>.<span class=property>config</span>.<span class=property>get</span>&lt;<span class=built_in>string</span>&gt;(<span class=string>&#x27;model&#x27;</span>) || <span class=string>&#x27;gpt-3.5-turbo&#x27;</span>,</span><br><span class=line>                <span class=attr>messages</span>: [</span><br><span class=line>                    &#123; <span class=attr>role</span>: <span class=string>&#x27;system&#x27;</span>, <span class=attr>content</span>: systemPrompt &#125;,</span><br><span class=line>                    &#123; <span class=attr>role</span>: <span class=string>&#x27;user&#x27;</span>, <span class=attr>content</span>: request.<span class=property>prompt</span> &#125;</span><br><span class=line>                ],</span><br><span class=line>                <span class=attr>max_tokens</span>: <span class="variable language_">this</span>.<span class=property>config</span>.<span class=property>get</span>&lt;<span class=built_in>number</span>&gt;(<span class=string>&#x27;maxTokens&#x27;</span>) || <span class=number>2048</span>,</span><br><span class=line>                <span class=attr>temperature</span>: request.<span class=property>temperature</span> || <span class=number>0.3</span></span><br><span class=line>            &#125;);</span><br><span class=line>            </span><br><span class=line>            <span class=keyword>const</span> response = completion.<span class=property>choices</span>[<span class=number>0</span>]?.<span class=property>message</span>?.<span class=property>content</span> || <span class=string>&#x27;&#x27;</span>;</span><br><span class=line>            </span><br><span class=line>            <span class=keyword>return</span> &#123;</span><br><span class=line>                <span class=attr>content</span>: response,</span><br><span class=line>                <span class=attr>usage</span>: completion.<span class=property>usage</span> ? &#123;</span><br><span class=line>                    <span class=attr>prompt_tokens</span>: completion.<span class=property>usage</span>.<span class=property>prompt_tokens</span>,</span><br><span class=line>                    <span class=attr>completion_tokens</span>: completion.<span class=property>usage</span>.<span class=property>completion_tokens</span>,</span><br><span class=line>                    <span class=attr>total_tokens</span>: completion.<span class=property>usage</span>.<span class=property>total_tokens</span></span><br><span class=line>                &#125; : <span class=literal>undefined</span></span><br><span class=line>            &#125;;</span><br><span class=line>        &#125; <span class=keyword>catch</span> (error) &#123;</span><br><span class=line>            <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class=string>&#x27;AI Service Error:&#x27;</span>, error);</span><br><span class=line>            <span class=keyword>throw</span> <span class=keyword>new</span> <span class="title class_">Error</span>(<span class=string>`AI request failed: <span class=subst>$&#123;error.message&#125;</span>`</span>);</span><br><span class=line>        &#125;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>async</span> <span class="title function_">explainCode</span>(<span class=attr>code</span>: <span class=built_in>string</span>, <span class=attr>language</span>: <span class=built_in>string</span>): <span class="title class_">Promise</span>&lt;<span class="title class_">AIResponse</span>&gt; &#123;</span><br><span class=line>        <span class=keyword>const</span> prompt = <span class=string>`Explain the following <span class=subst>$&#123;language&#125;</span> code in detail. Include:</span></span><br><span class=line><span class=string>1. What the code does</span></span><br><span class=line><span class=string>2. How it works</span></span><br><span class=line><span class=string>3. Any patterns or best practices used</span></span><br><span class=line><span class=string>4. Potential improvements or concerns</span></span><br><span class=line><span class=string></span></span><br><span class=line><span class=string>Code:</span></span><br><span class=line><span class=string>\`\`\`<span class=subst>$&#123;language&#125;</span></span></span><br><span class=line><span class=string><span class=subst>$&#123;code&#125;</span></span></span><br><span class=line><span class=string>\`\`\``</span>;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> <span class="variable language_">this</span>.<span class="title function_">generateCode</span>(&#123;</span><br><span class=line>            prompt,</span><br><span class=line>            language,</span><br><span class=line>            <span class=attr>temperature</span>: <span class=number>0.2</span></span><br><span class=line>        &#125;);</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>async</span> <span class="title function_">optimizeCode</span>(<span class=attr>code</span>: <span class=built_in>string</span>, <span class=attr>language</span>: <span class=built_in>string</span>): <span class="title class_">Promise</span>&lt;<span class="title class_">AIResponse</span>&gt; &#123;</span><br><span class=line>        <span class=keyword>const</span> prompt = <span class=string>`Analyze and optimize the following <span class=subst>$&#123;language&#125;</span> code. Provide:</span></span><br><span class=line><span class=string>1. Optimized version of the code</span></span><br><span class=line><span class=string>2. Explanation of improvements made</span></span><br><span class=line><span class=string>3. Performance benefits</span></span><br><span class=line><span class=string>4. Any trade-offs to consider</span></span><br><span class=line><span class=string></span></span><br><span class=line><span class=string>Original code:</span></span><br><span class=line><span class=string>\`\`\`<span class=subst>$&#123;language&#125;</span></span></span><br><span class=line><span class=string><span class=subst>$&#123;code&#125;</span></span></span><br><span class=line><span class=string>\`\`\``</span>;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> <span class="variable language_">this</span>.<span class="title function_">generateCode</span>(&#123;</span><br><span class=line>            prompt,</span><br><span class=line>            language,</span><br><span class=line>            <span class=attr>temperature</span>: <span class=number>0.1</span></span><br><span class=line>        &#125;);</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>async</span> <span class="title function_">generateTests</span>(<span class=attr>code</span>: <span class=built_in>string</span>, <span class=attr>language</span>: <span class=built_in>string</span>): <span class="title class_">Promise</span>&lt;<span class="title class_">AIResponse</span>&gt; &#123;</span><br><span class=line>        <span class=keyword>const</span> framework = <span class="variable language_">this</span>.<span class="title function_">getTestFramework</span>(language);</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>const</span> prompt = <span class=string>`Generate comprehensive unit tests for the following <span class=subst>$&#123;language&#125;</span> code using <span class=subst>$&#123;framework&#125;</span>. Include:</span></span><br><span class=line><span class=string>1. Test cases for normal operation</span></span><br><span class=line><span class=string>2. Edge cases and error handling</span></span><br><span class=line><span class=string>3. Mock dependencies if needed</span></span><br><span class=line><span class=string>4. Clear test descriptions</span></span><br><span class=line><span class=string></span></span><br><span class=line><span class=string>Code to test:</span></span><br><span class=line><span class=string>\`\`\`<span class=subst>$&#123;language&#125;</span></span></span><br><span class=line><span class=string><span class=subst>$&#123;code&#125;</span></span></span><br><span class=line><span class=string>\`\`\``</span>;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> <span class="variable language_">this</span>.<span class="title function_">generateCode</span>(&#123;</span><br><span class=line>            prompt,</span><br><span class=line>            language,</span><br><span class=line>            <span class=attr>temperature</span>: <span class=number>0.2</span></span><br><span class=line>        &#125;);</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>async</span> <span class="title function_">generateDocumentation</span>(<span class=attr>code</span>: <span class=built_in>string</span>, <span class=attr>language</span>: <span class=built_in>string</span>): <span class="title class_">Promise</span>&lt;<span class="title class_">AIResponse</span>&gt; &#123;</span><br><span class=line>        <span class=keyword>const</span> prompt = <span class=string>`Generate comprehensive documentation for the following <span class=subst>$&#123;language&#125;</span> code. Include:</span></span><br><span class=line><span class=string>1. Function/class description</span></span><br><span class=line><span class=string>2. Parameter descriptions with types</span></span><br><span class=line><span class=string>3. Return value description</span></span><br><span class=line><span class=string>4. Usage examples</span></span><br><span class=line><span class=string>5. Any side effects or important notes</span></span><br><span class=line><span class=string></span></span><br><span class=line><span class=string>Code:</span></span><br><span class=line><span class=string>\`\`\`<span class=subst>$&#123;language&#125;</span></span></span><br><span class=line><span class=string><span class=subst>$&#123;code&#125;</span></span></span><br><span class=line><span class=string>\`\`\``</span>;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> <span class="variable language_">this</span>.<span class="title function_">generateCode</span>(&#123;</span><br><span class=line>            prompt,</span><br><span class=line>            language,</span><br><span class=line>            <span class=attr>temperature</span>: <span class=number>0.1</span></span><br><span class=line>        &#125;);</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">getTestFramework</span>(<span class=attr>language</span>: <span class=built_in>string</span>): <span class=built_in>string</span> &#123;</span><br><span class=line>        <span class=keyword>const</span> <span class=attr>frameworks</span>: <span class="title class_">Record</span>&lt;<span class=built_in>string</span>, <span class=built_in>string</span>&gt; = &#123;</span><br><span class=line>            <span class=string>&#x27;typescript&#x27;</span>: <span class=string>&#x27;Jest&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;javascript&#x27;</span>: <span class=string>&#x27;Jest&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;python&#x27;</span>: <span class=string>&#x27;pytest&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;java&#x27;</span>: <span class=string>&#x27;JUnit&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;csharp&#x27;</span>: <span class=string>&#x27;MSTest&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;go&#x27;</span>: <span class=string>&#x27;Go testing package&#x27;</span></span><br><span class=line>        &#125;;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> frameworks[language] || <span class=string>&#x27;appropriate testing framework&#x27;</span>;</span><br><span class=line>    &#125;</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><h4 id=代码分析服务><a href=#代码分析服务 class=headerlink title=代码分析服务></a>代码分析服务</h4><figure class="highlight typescript"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br><span class=line>90</span><br><span class=line>91</span><br><span class=line>92</span><br><span class=line>93</span><br><span class=line>94</span><br><span class=line>95</span><br><span class=line>96</span><br><span class=line>97</span><br><span class=line>98</span><br><span class=line>99</span><br><span class=line>100</span><br><span class=line>101</span><br><span class=line>102</span><br><span class=line>103</span><br><span class=line>104</span><br><span class=line>105</span><br><span class=line>106</span><br><span class=line>107</span><br><span class=line>108</span><br><span class=line>109</span><br><span class=line>110</span><br><span class=line>111</span><br><span class=line>112</span><br><span class=line>113</span><br><span class=line>114</span><br><span class=line>115</span><br><span class=line>116</span><br><span class=line>117</span><br><span class=line>118</span><br><span class=line>119</span><br><span class=line>120</span><br><span class=line>121</span><br><span class=line>122</span><br><span class=line>123</span><br><span class=line>124</span><br><span class=line>125</span><br><span class=line>126</span><br><span class=line>127</span><br><span class=line>128</span><br><span class=line>129</span><br><span class=line>130</span><br><span class=line>131</span><br><span class=line>132</span><br><span class=line>133</span><br><span class=line>134</span><br><span class=line>135</span><br><span class=line>136</span><br><span class=line>137</span><br><span class=line>138</span><br><span class=line>139</span><br><span class=line>140</span><br><span class=line>141</span><br><span class=line>142</span><br><span class=line>143</span><br><span class=line>144</span><br><span class=line>145</span><br><span class=line>146</span><br><span class=line>147</span><br><span class=line>148</span><br><span class=line>149</span><br><span class=line>150</span><br><span class=line>151</span><br><span class=line>152</span><br><span class=line>153</span><br><span class=line>154</span><br><span class=line>155</span><br><span class=line>156</span><br></pre></td><td class=code><pre><span class=line><span class=comment>// src/services/codeAnalyzer.ts</span></span><br><span class=line><span class=keyword>import</span> * <span class=keyword>as</span> vscode <span class=keyword>from</span> <span class=string>&#x27;vscode&#x27;</span>;</span><br><span class=line><span class=keyword>import</span> * <span class=keyword>as</span> ts <span class=keyword>from</span> <span class=string>&#x27;typescript&#x27;</span>;</span><br><span class=line></span><br><span class=line><span class=keyword>export</span> <span class=keyword>interface</span> <span class="title class_">CodeContext</span> &#123;</span><br><span class=line>    <span class=attr>selectedText</span>: <span class=built_in>string</span>;</span><br><span class=line>    <span class=attr>fileName</span>: <span class=built_in>string</span>;</span><br><span class=line>    <span class=attr>language</span>: <span class=built_in>string</span>;</span><br><span class=line>    <span class=attr>lineNumber</span>: <span class=built_in>number</span>;</span><br><span class=line>    functionContext?: <span class=built_in>string</span>;</span><br><span class=line>    classContext?: <span class=built_in>string</span>;</span><br><span class=line>    imports?: <span class=built_in>string</span>[];</span><br><span class=line>&#125;</span><br><span class=line></span><br><span class=line><span class=keyword>export</span> <span class=keyword>class</span> <span class="title class_">CodeAnalyzer</span> &#123;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>async</span> <span class="title function_">getCodeContext</span>(): <span class="title class_">Promise</span>&lt;<span class="title class_">CodeContext</span> | <span class=literal>null</span>&gt; &#123;</span><br><span class=line>        <span class=keyword>const</span> editor = vscode.<span class=property>window</span>.<span class=property>activeTextEditor</span>;</span><br><span class=line>        <span class=keyword>if</span> (!editor) &#123;</span><br><span class=line>            <span class=keyword>return</span> <span class=literal>null</span>;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>const</span> <span class="variable language_">document</span> = editor.<span class=property>document</span>;</span><br><span class=line>        <span class=keyword>const</span> selection = editor.<span class=property>selection</span>;</span><br><span class=line>        <span class=keyword>const</span> selectedText = <span class="variable language_">document</span>.<span class="title function_">getText</span>(selection);</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>if</span> (!selectedText) &#123;</span><br><span class=line>            vscode.<span class=property>window</span>.<span class="title function_">showWarningMessage</span>(<span class=string>&#x27;请选择要分析的代码&#x27;</span>);</span><br><span class=line>            <span class=keyword>return</span> <span class=literal>null</span>;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>const</span> <span class=attr>context</span>: <span class="title class_">CodeContext</span> = &#123;</span><br><span class=line>            selectedText,</span><br><span class=line>            <span class=attr>fileName</span>: <span class="variable language_">document</span>.<span class=property>fileName</span>,</span><br><span class=line>            <span class=attr>language</span>: <span class="variable language_">document</span>.<span class=property>languageId</span>,</span><br><span class=line>            <span class=attr>lineNumber</span>: selection.<span class=property>start</span>.<span class=property>line</span> + <span class=number>1</span></span><br><span class=line>        &#125;;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 为TypeScript/JavaScript提供更详细的上下文</span></span><br><span class=line>        <span class=keyword>if</span> (<span class="variable language_">document</span>.<span class=property>languageId</span> === <span class=string>&#x27;typescript&#x27;</span> || <span class="variable language_">document</span>.<span class=property>languageId</span> === <span class=string>&#x27;javascript&#x27;</span>) &#123;</span><br><span class=line>            <span class="variable language_">this</span>.<span class="title function_">enhanceTypeScriptContext</span>(context, <span class="variable language_">document</span>, selection);</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> context;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">enhanceTypeScriptContext</span>(<span class=params></span></span><br><span class=line><span class=params>        context: CodeContext, </span></span><br><span class=line><span class=params>        <span class="variable language_">document</span>: vscode.TextDocument, </span></span><br><span class=line><span class=params>        selection: vscode.Selection</span></span><br><span class=line><span class=params>    </span>) &#123;</span><br><span class=line>        <span class=keyword>try</span> &#123;</span><br><span class=line>            <span class=keyword>const</span> sourceFile = ts.<span class="title function_">createSourceFile</span>(</span><br><span class=line>                <span class="variable language_">document</span>.<span class=property>fileName</span>,</span><br><span class=line>                <span class="variable language_">document</span>.<span class="title function_">getText</span>(),</span><br><span class=line>                ts.<span class=property>ScriptTarget</span>.<span class=property>Latest</span>,</span><br><span class=line>                <span class=literal>true</span></span><br><span class=line>            );</span><br><span class=line>            </span><br><span class=line>            <span class=keyword>const</span> position = <span class="variable language_">document</span>.<span class="title function_">offsetAt</span>(selection.<span class=property>start</span>);</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// 查找包含选择文本的函数</span></span><br><span class=line>            <span class=keyword>const</span> functionNode = <span class="variable language_">this</span>.<span class="title function_">findContainingFunction</span>(sourceFile, position);</span><br><span class=line>            <span class=keyword>if</span> (functionNode) &#123;</span><br><span class=line>                context.<span class=property>functionContext</span> = <span class="variable language_">document</span>.<span class="title function_">getText</span>(</span><br><span class=line>                    <span class=keyword>new</span> vscode.<span class="title class_">Range</span>(</span><br><span class=line>                        <span class="variable language_">document</span>.<span class="title function_">positionAt</span>(functionNode.<span class="title function_">getStart</span>()),</span><br><span class=line>                        <span class="variable language_">document</span>.<span class="title function_">positionAt</span>(functionNode.<span class="title function_">getEnd</span>())</span><br><span class=line>                    )</span><br><span class=line>                );</span><br><span class=line>            &#125;</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// 查找包含选择文本的类</span></span><br><span class=line>            <span class=keyword>const</span> classNode = <span class="variable language_">this</span>.<span class="title function_">findContainingClass</span>(sourceFile, position);</span><br><span class=line>            <span class=keyword>if</span> (classNode) &#123;</span><br><span class=line>                context.<span class=property>classContext</span> = <span class="variable language_">document</span>.<span class="title function_">getText</span>(</span><br><span class=line>                    <span class=keyword>new</span> vscode.<span class="title class_">Range</span>(</span><br><span class=line>                        <span class="variable language_">document</span>.<span class="title function_">positionAt</span>(classNode.<span class="title function_">getStart</span>()),</span><br><span class=line>                        <span class="variable language_">document</span>.<span class="title function_">positionAt</span>(classNode.<span class="title function_">getEnd</span>())</span><br><span class=line>                    )</span><br><span class=line>                );</span><br><span class=line>            &#125;</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// 提取导入语句</span></span><br><span class=line>            context.<span class=property>imports</span> = <span class="variable language_">this</span>.<span class="title function_">extractImports</span>(sourceFile);</span><br><span class=line>            </span><br><span class=line>        &#125; <span class=keyword>catch</span> (error) &#123;</span><br><span class=line>            <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class=string>&#x27;TypeScript analysis error:&#x27;</span>, error);</span><br><span class=line>        &#125;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">findContainingFunction</span>(<span class=attr>node</span>: ts.<span class=property>Node</span>, <span class=attr>position</span>: <span class=built_in>number</span>): ts.<span class=property>FunctionLikeDeclaration</span> | <span class=literal>null</span> &#123;</span><br><span class=line>        <span class=keyword>if</span> (ts.<span class="title function_">isFunctionLike</span>(node) &amp;&amp; </span><br><span class=line>            position &gt;= node.<span class="title function_">getStart</span>() &amp;&amp; </span><br><span class=line>            position &lt;= node.<span class="title function_">getEnd</span>()) &#123;</span><br><span class=line>            <span class=keyword>return</span> node;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>for</span> (<span class=keyword>const</span> child <span class=keyword>of</span> node.<span class="title function_">getChildren</span>()) &#123;</span><br><span class=line>            <span class=keyword>const</span> result = <span class="variable language_">this</span>.<span class="title function_">findContainingFunction</span>(child, position);</span><br><span class=line>            <span class=keyword>if</span> (result) &#123;</span><br><span class=line>                <span class=keyword>return</span> result;</span><br><span class=line>            &#125;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> <span class=literal>null</span>;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">findContainingClass</span>(<span class=attr>node</span>: ts.<span class=property>Node</span>, <span class=attr>position</span>: <span class=built_in>number</span>): ts.<span class=property>ClassDeclaration</span> | <span class=literal>null</span> &#123;</span><br><span class=line>        <span class=keyword>if</span> (ts.<span class="title function_">isClassDeclaration</span>(node) &amp;&amp; </span><br><span class=line>            position &gt;= node.<span class="title function_">getStart</span>() &amp;&amp; </span><br><span class=line>            position &lt;= node.<span class="title function_">getEnd</span>()) &#123;</span><br><span class=line>            <span class=keyword>return</span> node;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>for</span> (<span class=keyword>const</span> child <span class=keyword>of</span> node.<span class="title function_">getChildren</span>()) &#123;</span><br><span class=line>            <span class=keyword>const</span> result = <span class="variable language_">this</span>.<span class="title function_">findContainingClass</span>(child, position);</span><br><span class=line>            <span class=keyword>if</span> (result) &#123;</span><br><span class=line>                <span class=keyword>return</span> result;</span><br><span class=line>            &#125;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> <span class=literal>null</span>;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">extractImports</span>(<span class=attr>sourceFile</span>: ts.<span class=property>SourceFile</span>): <span class=built_in>string</span>[] &#123;</span><br><span class=line>        <span class=keyword>const</span> <span class=attr>imports</span>: <span class=built_in>string</span>[] = [];</span><br><span class=line>        </span><br><span class=line>        ts.<span class="title function_">forEachChild</span>(sourceFile, <span class=function><span class=params>node</span> =&gt;</span> &#123;</span><br><span class=line>            <span class=keyword>if</span> (ts.<span class="title function_">isImportDeclaration</span>(node)) &#123;</span><br><span class=line>                imports.<span class="title function_">push</span>(node.<span class="title function_">getFullText</span>().<span class="title function_">trim</span>());</span><br><span class=line>            &#125;</span><br><span class=line>        &#125;);</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> imports;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class="title function_">detectLanguageFramework</span>(<span class=attr>document</span>: vscode.<span class=property>TextDocument</span>): <span class=built_in>string</span> &#123;</span><br><span class=line>        <span class=keyword>const</span> content = <span class="variable language_">document</span>.<span class="title function_">getText</span>();</span><br><span class=line>        <span class=keyword>const</span> <span class=attr>frameworks</span>: <span class="title class_">Record</span>&lt;<span class=built_in>string</span>, <span class="title class_">RegExp</span>[]&gt; = &#123;</span><br><span class=line>            <span class=string>&#x27;React&#x27;</span>: [<span class=regexp>/import.*react/i</span>, <span class=regexp>/jsx/i</span>, <span class=regexp>/useState|useEffect/i</span>],</span><br><span class=line>            <span class=string>&#x27;Vue&#x27;</span>: [<span class=regexp>/import.*vue/i</span>, <span class=regexp>/&lt;template&gt;/i</span>, <span class=regexp>/defineComponent/i</span>],</span><br><span class=line>            <span class=string>&#x27;Angular&#x27;</span>: [<span class=regexp>/import.*@angular/i</span>, <span class=regexp>/@Component/i</span>, <span class=regexp>/@Injectable/i</span>],</span><br><span class=line>            <span class=string>&#x27;Express&#x27;</span>: [<span class=regexp>/import.*express/i</span>, <span class=regexp>/app\.get|app\.post/i</span>],</span><br><span class=line>            <span class=string>&#x27;NestJS&#x27;</span>: [<span class=regexp>/import.*@nestjs/i</span>, <span class=regexp>/@Controller|@Injectable/i</span>]</span><br><span class=line>        &#125;;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>for</span> (<span class=keyword>const</span> [framework, patterns] <span class=keyword>of</span> <span class="title class_">Object</span>.<span class="title function_">entries</span>(frameworks)) &#123;</span><br><span class=line>            <span class=keyword>if</span> (patterns.<span class="title function_">some</span>(<span class=function><span class=params>pattern</span> =&gt;</span> pattern.<span class="title function_">test</span>(content))) &#123;</span><br><span class=line>                <span class=keyword>return</span> framework;</span><br><span class=line>            &#125;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> <span class=string>&#x27;Unknown&#x27;</span>;</span><br><span class=line>    &#125;</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><h4 id=命令处理器><a href=#命令处理器 class=headerlink title=命令处理器></a>命令处理器</h4><figure class="highlight typescript"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br><span class=line>90</span><br><span class=line>91</span><br><span class=line>92</span><br><span class=line>93</span><br><span class=line>94</span><br><span class=line>95</span><br><span class=line>96</span><br><span class=line>97</span><br><span class=line>98</span><br><span class=line>99</span><br><span class=line>100</span><br><span class=line>101</span><br><span class=line>102</span><br><span class=line>103</span><br><span class=line>104</span><br><span class=line>105</span><br><span class=line>106</span><br><span class=line>107</span><br><span class=line>108</span><br><span class=line>109</span><br><span class=line>110</span><br><span class=line>111</span><br><span class=line>112</span><br><span class=line>113</span><br><span class=line>114</span><br><span class=line>115</span><br><span class=line>116</span><br><span class=line>117</span><br><span class=line>118</span><br><span class=line>119</span><br><span class=line>120</span><br><span class=line>121</span><br><span class=line>122</span><br><span class=line>123</span><br><span class=line>124</span><br><span class=line>125</span><br><span class=line>126</span><br><span class=line>127</span><br><span class=line>128</span><br><span class=line>129</span><br><span class=line>130</span><br><span class=line>131</span><br><span class=line>132</span><br><span class=line>133</span><br><span class=line>134</span><br><span class=line>135</span><br><span class=line>136</span><br><span class=line>137</span><br><span class=line>138</span><br><span class=line>139</span><br><span class=line>140</span><br><span class=line>141</span><br><span class=line>142</span><br><span class=line>143</span><br><span class=line>144</span><br><span class=line>145</span><br><span class=line>146</span><br><span class=line>147</span><br><span class=line>148</span><br><span class=line>149</span><br><span class=line>150</span><br><span class=line>151</span><br><span class=line>152</span><br><span class=line>153</span><br><span class=line>154</span><br><span class=line>155</span><br><span class=line>156</span><br><span class=line>157</span><br><span class=line>158</span><br><span class=line>159</span><br><span class=line>160</span><br><span class=line>161</span><br><span class=line>162</span><br><span class=line>163</span><br><span class=line>164</span><br><span class=line>165</span><br><span class=line>166</span><br><span class=line>167</span><br><span class=line>168</span><br><span class=line>169</span><br><span class=line>170</span><br><span class=line>171</span><br><span class=line>172</span><br><span class=line>173</span><br><span class=line>174</span><br><span class=line>175</span><br><span class=line>176</span><br><span class=line>177</span><br><span class=line>178</span><br><span class=line>179</span><br><span class=line>180</span><br><span class=line>181</span><br><span class=line>182</span><br><span class=line>183</span><br><span class=line>184</span><br><span class=line>185</span><br><span class=line>186</span><br><span class=line>187</span><br><span class=line>188</span><br><span class=line>189</span><br><span class=line>190</span><br><span class=line>191</span><br><span class=line>192</span><br><span class=line>193</span><br><span class=line>194</span><br><span class=line>195</span><br><span class=line>196</span><br><span class=line>197</span><br><span class=line>198</span><br><span class=line>199</span><br><span class=line>200</span><br><span class=line>201</span><br><span class=line>202</span><br><span class=line>203</span><br><span class=line>204</span><br><span class=line>205</span><br><span class=line>206</span><br><span class=line>207</span><br><span class=line>208</span><br><span class=line>209</span><br><span class=line>210</span><br><span class=line>211</span><br><span class=line>212</span><br><span class=line>213</span><br><span class=line>214</span><br><span class=line>215</span><br><span class=line>216</span><br><span class=line>217</span><br><span class=line>218</span><br><span class=line>219</span><br><span class=line>220</span><br><span class=line>221</span><br><span class=line>222</span><br><span class=line>223</span><br><span class=line>224</span><br><span class=line>225</span><br><span class=line>226</span><br><span class=line>227</span><br><span class=line>228</span><br><span class=line>229</span><br><span class=line>230</span><br><span class=line>231</span><br><span class=line>232</span><br><span class=line>233</span><br><span class=line>234</span><br><span class=line>235</span><br><span class=line>236</span><br><span class=line>237</span><br><span class=line>238</span><br><span class=line>239</span><br><span class=line>240</span><br><span class=line>241</span><br><span class=line>242</span><br><span class=line>243</span><br><span class=line>244</span><br><span class=line>245</span><br><span class=line>246</span><br><span class=line>247</span><br><span class=line>248</span><br><span class=line>249</span><br><span class=line>250</span><br><span class=line>251</span><br><span class=line>252</span><br><span class=line>253</span><br><span class=line>254</span><br><span class=line>255</span><br><span class=line>256</span><br><span class=line>257</span><br><span class=line>258</span><br><span class=line>259</span><br><span class=line>260</span><br><span class=line>261</span><br><span class=line>262</span><br><span class=line>263</span><br><span class=line>264</span><br><span class=line>265</span><br><span class=line>266</span><br><span class=line>267</span><br><span class=line>268</span><br><span class=line>269</span><br><span class=line>270</span><br><span class=line>271</span><br><span class=line>272</span><br><span class=line>273</span><br><span class=line>274</span><br><span class=line>275</span><br><span class=line>276</span><br><span class=line>277</span><br><span class=line>278</span><br><span class=line>279</span><br><span class=line>280</span><br><span class=line>281</span><br><span class=line>282</span><br><span class=line>283</span><br><span class=line>284</span><br><span class=line>285</span><br><span class=line>286</span><br><span class=line>287</span><br><span class=line>288</span><br><span class=line>289</span><br><span class=line>290</span><br><span class=line>291</span><br><span class=line>292</span><br><span class=line>293</span><br><span class=line>294</span><br><span class=line>295</span><br><span class=line>296</span><br><span class=line>297</span><br><span class=line>298</span><br><span class=line>299</span><br><span class=line>300</span><br><span class=line>301</span><br><span class=line>302</span><br><span class=line>303</span><br><span class=line>304</span><br><span class=line>305</span><br><span class=line>306</span><br><span class=line>307</span><br><span class=line>308</span><br><span class=line>309</span><br><span class=line>310</span><br><span class=line>311</span><br><span class=line>312</span><br><span class=line>313</span><br><span class=line>314</span><br></pre></td><td class=code><pre><span class=line><span class=comment>// src/commands/commandHandler.ts</span></span><br><span class=line><span class=keyword>import</span> * <span class=keyword>as</span> vscode <span class=keyword>from</span> <span class=string>&#x27;vscode&#x27;</span>;</span><br><span class=line><span class=keyword>import</span> &#123; <span class="title class_">AIService</span> &#125; <span class=keyword>from</span> <span class=string>&#x27;../services/aiService&#x27;</span>;</span><br><span class=line><span class=keyword>import</span> &#123; <span class="title class_">CodeAnalyzer</span> &#125; <span class=keyword>from</span> <span class=string>&#x27;../services/codeAnalyzer&#x27;</span>;</span><br><span class=line></span><br><span class=line><span class=keyword>export</span> <span class=keyword>class</span> <span class="title class_">CommandHandler</span> &#123;</span><br><span class=line>    <span class="title function_">constructor</span>(<span class=params></span></span><br><span class=line><span class=params>        <span class=keyword>private</span> aiService: AIService,</span></span><br><span class=line><span class=params>        <span class=keyword>private</span> codeAnalyzer: CodeAnalyzer</span></span><br><span class=line><span class=params>    </span>) &#123;&#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>async</span> <span class="title function_">generateCode</span>(<span class=params></span>) &#123;</span><br><span class=line>        <span class=keyword>const</span> prompt = <span class=keyword>await</span> vscode.<span class=property>window</span>.<span class="title function_">showInputBox</span>(&#123;</span><br><span class=line>            <span class=attr>prompt</span>: <span class=string>&#x27;描述你想要生成的代码功能&#x27;</span>,</span><br><span class=line>            <span class=attr>placeHolder</span>: <span class=string>&#x27;例如：创建一个用户注册的API接口&#x27;</span>,</span><br><span class=line>            <span class=attr>value</span>: <span class=string>&#x27;&#x27;</span></span><br><span class=line>        &#125;);</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>if</span> (!prompt) &#123;</span><br><span class=line>            <span class=keyword>return</span>;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>const</span> editor = vscode.<span class=property>window</span>.<span class=property>activeTextEditor</span>;</span><br><span class=line>        <span class=keyword>const</span> language = editor?.<span class=property>document</span>.<span class=property>languageId</span> || <span class=string>&#x27;typescript&#x27;</span>;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 显示进度</span></span><br><span class=line>        <span class=keyword>await</span> vscode.<span class=property>window</span>.<span class="title function_">withProgress</span>(&#123;</span><br><span class=line>            <span class=attr>location</span>: vscode.<span class=property>ProgressLocation</span>.<span class=property>Notification</span>,</span><br><span class=line>            <span class=attr>title</span>: <span class=string>&quot;AI正在生成代码...&quot;</span>,</span><br><span class=line>            <span class=attr>cancellable</span>: <span class=literal>false</span></span><br><span class=line>        &#125;, <span class=keyword>async</span> (progress) =&gt; &#123;</span><br><span class=line>            <span class=keyword>try</span> &#123;</span><br><span class=line>                progress.<span class="title function_">report</span>(&#123; <span class=attr>increment</span>: <span class=number>30</span>, <span class=attr>message</span>: <span class=string>&quot;分析需求中...&quot;</span> &#125;);</span><br><span class=line>                </span><br><span class=line>                <span class=keyword>const</span> response = <span class=keyword>await</span> <span class="variable language_">this</span>.<span class=property>aiService</span>.<span class="title function_">generateCode</span>(&#123;</span><br><span class=line>                    prompt,</span><br><span class=line>                    language,</span><br><span class=line>                    <span class=attr>context</span>: <span class=keyword>await</span> <span class="variable language_">this</span>.<span class="title function_">getProjectContext</span>()</span><br><span class=line>                &#125;);</span><br><span class=line>                </span><br><span class=line>                progress.<span class="title function_">report</span>(&#123; <span class=attr>increment</span>: <span class=number>70</span>, <span class=attr>message</span>: <span class=string>&quot;生成代码中...&quot;</span> &#125;);</span><br><span class=line>                </span><br><span class=line>                <span class=keyword>await</span> <span class="variable language_">this</span>.<span class="title function_">insertGeneratedCode</span>(response.<span class=property>content</span>);</span><br><span class=line>                </span><br><span class=line>                <span class=comment>// 显示token使用情况</span></span><br><span class=line>                <span class=keyword>if</span> (response.<span class=property>usage</span>) &#123;</span><br><span class=line>                    vscode.<span class=property>window</span>.<span class="title function_">showInformationMessage</span>(</span><br><span class=line>                        <span class=string>`代码已生成！Token使用: <span class=subst>$&#123;response.usage.total_tokens&#125;</span>`</span></span><br><span class=line>                    );</span><br><span class=line>                &#125;</span><br><span class=line>                </span><br><span class=line>            &#125; <span class=keyword>catch</span> (error) &#123;</span><br><span class=line>                vscode.<span class=property>window</span>.<span class="title function_">showErrorMessage</span>(<span class=string>`代码生成失败: <span class=subst>$&#123;error.message&#125;</span>`</span>);</span><br><span class=line>            &#125;</span><br><span class=line>        &#125;);</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>async</span> <span class="title function_">explainCode</span>(<span class=params></span>) &#123;</span><br><span class=line>        <span class=keyword>const</span> context = <span class=keyword>await</span> <span class="variable language_">this</span>.<span class=property>codeAnalyzer</span>.<span class="title function_">getCodeContext</span>();</span><br><span class=line>        <span class=keyword>if</span> (!context) &#123;</span><br><span class=line>            <span class=keyword>return</span>;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>await</span> vscode.<span class=property>window</span>.<span class="title function_">withProgress</span>(&#123;</span><br><span class=line>            <span class=attr>location</span>: vscode.<span class=property>ProgressLocation</span>.<span class=property>Notification</span>,</span><br><span class=line>            <span class=attr>title</span>: <span class=string>&quot;AI正在分析代码...&quot;</span>,</span><br><span class=line>            <span class=attr>cancellable</span>: <span class=literal>false</span></span><br><span class=line>        &#125;, <span class=keyword>async</span> () =&gt; &#123;</span><br><span class=line>            <span class=keyword>try</span> &#123;</span><br><span class=line>                <span class=keyword>const</span> response = <span class=keyword>await</span> <span class="variable language_">this</span>.<span class=property>aiService</span>.<span class="title function_">explainCode</span>(</span><br><span class=line>                    context.<span class=property>selectedText</span>,</span><br><span class=line>                    context.<span class=property>language</span></span><br><span class=line>                );</span><br><span class=line>                </span><br><span class=line>                <span class=comment>// 在新的编辑器标签页中显示解释</span></span><br><span class=line>                <span class=keyword>const</span> <span class="variable language_">document</span> = <span class=keyword>await</span> vscode.<span class=property>workspace</span>.<span class="title function_">openTextDocument</span>(&#123;</span><br><span class=line>                    <span class=attr>content</span>: <span class="variable language_">this</span>.<span class="title function_">formatExplanation</span>(response.<span class=property>content</span>, context),</span><br><span class=line>                    <span class=attr>language</span>: <span class=string>&#x27;markdown&#x27;</span></span><br><span class=line>                &#125;);</span><br><span class=line>                </span><br><span class=line>                <span class=keyword>await</span> vscode.<span class=property>window</span>.<span class="title function_">showTextDocument</span>(<span class="variable language_">document</span>);</span><br><span class=line>                </span><br><span class=line>            &#125; <span class=keyword>catch</span> (error) &#123;</span><br><span class=line>                vscode.<span class=property>window</span>.<span class="title function_">showErrorMessage</span>(<span class=string>`代码解释失败: <span class=subst>$&#123;error.message&#125;</span>`</span>);</span><br><span class=line>            &#125;</span><br><span class=line>        &#125;);</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>async</span> <span class="title function_">optimizeCode</span>(<span class=params></span>) &#123;</span><br><span class=line>        <span class=keyword>const</span> context = <span class=keyword>await</span> <span class="variable language_">this</span>.<span class=property>codeAnalyzer</span>.<span class="title function_">getCodeContext</span>();</span><br><span class=line>        <span class=keyword>if</span> (!context) &#123;</span><br><span class=line>            <span class=keyword>return</span>;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>await</span> vscode.<span class=property>window</span>.<span class="title function_">withProgress</span>(&#123;</span><br><span class=line>            <span class=attr>location</span>: vscode.<span class=property>ProgressLocation</span>.<span class=property>Notification</span>,</span><br><span class=line>            <span class=attr>title</span>: <span class=string>&quot;AI正在优化代码...&quot;</span>,</span><br><span class=line>            <span class=attr>cancellable</span>: <span class=literal>false</span></span><br><span class=line>        &#125;, <span class=keyword>async</span> () =&gt; &#123;</span><br><span class=line>            <span class=keyword>try</span> &#123;</span><br><span class=line>                <span class=keyword>const</span> response = <span class=keyword>await</span> <span class="variable language_">this</span>.<span class=property>aiService</span>.<span class="title function_">optimizeCode</span>(</span><br><span class=line>                    context.<span class=property>selectedText</span>,</span><br><span class=line>                    context.<span class=property>language</span></span><br><span class=line>                );</span><br><span class=line>                </span><br><span class=line>                <span class=comment>// 显示优化建议和对比</span></span><br><span class=line>                <span class=keyword>await</span> <span class="variable language_">this</span>.<span class="title function_">showOptimizationResult</span>(context, response.<span class=property>content</span>);</span><br><span class=line>                </span><br><span class=line>            &#125; <span class=keyword>catch</span> (error) &#123;</span><br><span class=line>                vscode.<span class=property>window</span>.<span class="title function_">showErrorMessage</span>(<span class=string>`代码优化失败: <span class=subst>$&#123;error.message&#125;</span>`</span>);</span><br><span class=line>            &#125;</span><br><span class=line>        &#125;);</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>async</span> <span class="title function_">generateTests</span>(<span class=params></span>) &#123;</span><br><span class=line>        <span class=keyword>const</span> context = <span class=keyword>await</span> <span class="variable language_">this</span>.<span class=property>codeAnalyzer</span>.<span class="title function_">getCodeContext</span>();</span><br><span class=line>        <span class=keyword>if</span> (!context) &#123;</span><br><span class=line>            <span class=keyword>return</span>;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>await</span> vscode.<span class=property>window</span>.<span class="title function_">withProgress</span>(&#123;</span><br><span class=line>            <span class=attr>location</span>: vscode.<span class=property>ProgressLocation</span>.<span class=property>Notification</span>,</span><br><span class=line>            <span class=attr>title</span>: <span class=string>&quot;AI正在生成测试...&quot;</span>,</span><br><span class=line>            <span class=attr>cancellable</span>: <span class=literal>false</span></span><br><span class=line>        &#125;, <span class=keyword>async</span> () =&gt; &#123;</span><br><span class=line>            <span class=keyword>try</span> &#123;</span><br><span class=line>                <span class=keyword>const</span> response = <span class=keyword>await</span> <span class="variable language_">this</span>.<span class=property>aiService</span>.<span class="title function_">generateTests</span>(</span><br><span class=line>                    context.<span class=property>selectedText</span>,</span><br><span class=line>                    context.<span class=property>language</span></span><br><span class=line>                );</span><br><span class=line>                </span><br><span class=line>                <span class=comment>// 创建测试文件</span></span><br><span class=line>                <span class=keyword>await</span> <span class="variable language_">this</span>.<span class="title function_">createTestFile</span>(context, response.<span class=property>content</span>);</span><br><span class=line>                </span><br><span class=line>            &#125; <span class=keyword>catch</span> (error) &#123;</span><br><span class=line>                vscode.<span class=property>window</span>.<span class="title function_">showErrorMessage</span>(<span class=string>`测试生成失败: <span class=subst>$&#123;error.message&#125;</span>`</span>);</span><br><span class=line>            &#125;</span><br><span class=line>        &#125;);</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>async</span> <span class="title function_">generateDocs</span>(<span class=params></span>) &#123;</span><br><span class=line>        <span class=keyword>const</span> context = <span class=keyword>await</span> <span class="variable language_">this</span>.<span class=property>codeAnalyzer</span>.<span class="title function_">getCodeContext</span>();</span><br><span class=line>        <span class=keyword>if</span> (!context) &#123;</span><br><span class=line>            <span class=keyword>return</span>;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>await</span> vscode.<span class=property>window</span>.<span class="title function_">withProgress</span>(&#123;</span><br><span class=line>            <span class=attr>location</span>: vscode.<span class=property>ProgressLocation</span>.<span class=property>Notification</span>,</span><br><span class=line>            <span class=attr>title</span>: <span class=string>&quot;AI正在生成文档...&quot;</span>,</span><br><span class=line>            <span class=attr>cancellable</span>: <span class=literal>false</span></span><br><span class=line>        &#125;, <span class=keyword>async</span> () =&gt; &#123;</span><br><span class=line>            <span class=keyword>try</span> &#123;</span><br><span class=line>                <span class=keyword>const</span> response = <span class=keyword>await</span> <span class="variable language_">this</span>.<span class=property>aiService</span>.<span class="title function_">generateDocumentation</span>(</span><br><span class=line>                    context.<span class=property>selectedText</span>,</span><br><span class=line>                    context.<span class=property>language</span></span><br><span class=line>                );</span><br><span class=line>                </span><br><span class=line>                <span class=comment>// 在当前位置插入文档注释</span></span><br><span class=line>                <span class=keyword>await</span> <span class="variable language_">this</span>.<span class="title function_">insertDocumentation</span>(context, response.<span class=property>content</span>);</span><br><span class=line>                </span><br><span class=line>            &#125; <span class=keyword>catch</span> (error) &#123;</span><br><span class=line>                vscode.<span class=property>window</span>.<span class="title function_">showErrorMessage</span>(<span class=string>`文档生成失败: <span class=subst>$&#123;error.message&#125;</span>`</span>);</span><br><span class=line>            &#125;</span><br><span class=line>        &#125;);</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class=keyword>async</span> <span class="title function_">getProjectContext</span>(): <span class="title class_">Promise</span>&lt;<span class=built_in>string</span>&gt; &#123;</span><br><span class=line>        <span class=keyword>const</span> workspaceFolder = vscode.<span class=property>workspace</span>.<span class=property>workspaceFolders</span>?.[<span class=number>0</span>];</span><br><span class=line>        <span class=keyword>if</span> (!workspaceFolder) &#123;</span><br><span class=line>            <span class=keyword>return</span> <span class=string>&#x27;&#x27;</span>;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 读取package.json获取项目信息</span></span><br><span class=line>        <span class=keyword>try</span> &#123;</span><br><span class=line>            <span class=keyword>const</span> packageJsonUri = vscode.<span class=property>Uri</span>.<span class="title function_">joinPath</span>(workspaceFolder.<span class=property>uri</span>, <span class=string>&#x27;package.json&#x27;</span>);</span><br><span class=line>            <span class=keyword>const</span> packageJsonDoc = <span class=keyword>await</span> vscode.<span class=property>workspace</span>.<span class="title function_">openTextDocument</span>(packageJsonUri);</span><br><span class=line>            <span class=keyword>const</span> packageJson = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(packageJsonDoc.<span class="title function_">getText</span>());</span><br><span class=line>            </span><br><span class=line>            <span class=keyword>return</span> <span class=string>`项目: <span class=subst>$&#123;packageJson.name&#125;</span>, 描述: <span class=subst>$&#123;packageJson.description&#125;</span>, 依赖: <span class=subst>$&#123;<span class=built_in>Object</span>.keys(packageJson.dependencies || &#123;&#125;).join(<span class=string>&#x27;, &#x27;</span>)&#125;</span>`</span>;</span><br><span class=line>        &#125; <span class=keyword>catch</span> &#123;</span><br><span class=line>            <span class=keyword>return</span> <span class=string>`工作区: <span class=subst>$&#123;workspaceFolder.name&#125;</span>`</span>;</span><br><span class=line>        &#125;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class=keyword>async</span> <span class="title function_">insertGeneratedCode</span>(<span class=params>code: <span class=built_in>string</span></span>) &#123;</span><br><span class=line>        <span class=keyword>const</span> editor = vscode.<span class=property>window</span>.<span class=property>activeTextEditor</span>;</span><br><span class=line>        <span class=keyword>if</span> (!editor) &#123;</span><br><span class=line>            <span class=keyword>return</span>;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 清理生成的代码（移除markdown标记）</span></span><br><span class=line>        <span class=keyword>const</span> cleanCode = <span class="variable language_">this</span>.<span class="title function_">cleanGeneratedCode</span>(code);</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>await</span> editor.<span class="title function_">edit</span>(<span class=function><span class=params>editBuilder</span> =&gt;</span> &#123;</span><br><span class=line>            editBuilder.<span class="title function_">insert</span>(editor.<span class=property>selection</span>.<span class=property>active</span>, cleanCode);</span><br><span class=line>        &#125;);</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 自动格式化</span></span><br><span class=line>        <span class=keyword>await</span> vscode.<span class=property>commands</span>.<span class="title function_">executeCommand</span>(<span class=string>&#x27;editor.action.formatDocument&#x27;</span>);</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">cleanGeneratedCode</span>(<span class=attr>code</span>: <span class=built_in>string</span>): <span class=built_in>string</span> &#123;</span><br><span class=line>        <span class=comment>// 移除markdown代码块标记</span></span><br><span class=line>        <span class=keyword>return</span> code</span><br><span class=line>            .<span class="title function_">replace</span>(<span class=regexp>/^```[\w]*\n/</span>, <span class=string>&#x27;&#x27;</span>)</span><br><span class=line>            .<span class="title function_">replace</span>(<span class=regexp>/\n```$/</span>, <span class=string>&#x27;&#x27;</span>)</span><br><span class=line>            .<span class="title function_">trim</span>();</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">formatExplanation</span>(<span class=attr>explanation</span>: <span class=built_in>string</span>, <span class=attr>context</span>: <span class=built_in>any</span>): <span class=built_in>string</span> &#123;</span><br><span class=line>        <span class=keyword>return</span> <span class=string>`# 代码解释</span></span><br><span class=line><span class=string></span></span><br><span class=line><span class=string>## 分析的代码</span></span><br><span class=line><span class=string>\`\`\`<span class=subst>$&#123;context.language&#125;</span></span></span><br><span class=line><span class=string><span class=subst>$&#123;context.selectedText&#125;</span></span></span><br><span class=line><span class=string>\`\`\`</span></span><br><span class=line><span class=string></span></span><br><span class=line><span class=string>## 文件信息</span></span><br><span class=line><span class=string>- **文件**: <span class=subst>$&#123;context.fileName&#125;</span></span></span><br><span class=line><span class=string>- **语言**: <span class=subst>$&#123;context.language&#125;</span></span></span><br><span class=line><span class=string>- **行号**: <span class=subst>$&#123;context.lineNumber&#125;</span></span></span><br><span class=line><span class=string></span></span><br><span class=line><span class=string>## 详细解释</span></span><br><span class=line><span class=string></span></span><br><span class=line><span class=string><span class=subst>$&#123;explanation&#125;</span></span></span><br><span class=line><span class=string></span></span><br><span class=line><span class=string>---</span></span><br><span class=line><span class=string>*由 AI Code Assistant 生成于 <span class=subst>$&#123;<span class=keyword>new</span> <span class=built_in>Date</span>().toLocaleString()&#125;</span>*</span></span><br><span class=line><span class=string>`</span>;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class=keyword>async</span> <span class="title function_">showOptimizationResult</span>(<span class=params>context: <span class=built_in>any</span>, optimization: <span class=built_in>string</span></span>) &#123;</span><br><span class=line>        <span class=keyword>const</span> <span class="variable language_">document</span> = <span class=keyword>await</span> vscode.<span class=property>workspace</span>.<span class="title function_">openTextDocument</span>(&#123;</span><br><span class=line>            <span class=attr>content</span>: <span class=string>`# 代码优化建议</span></span><br><span class=line><span class=string></span></span><br><span class=line><span class=string>## 原始代码</span></span><br><span class=line><span class=string>\`\`\`<span class=subst>$&#123;context.language&#125;</span></span></span><br><span class=line><span class=string><span class=subst>$&#123;context.selectedText&#125;</span></span></span><br><span class=line><span class=string>\`\`\`</span></span><br><span class=line><span class=string></span></span><br><span class=line><span class=string>## 优化建议</span></span><br><span class=line><span class=string></span></span><br><span class=line><span class=string><span class=subst>$&#123;optimization&#125;</span></span></span><br><span class=line><span class=string></span></span><br><span class=line><span class=string>---</span></span><br><span class=line><span class=string>*由 AI Code Assistant 生成于 <span class=subst>$&#123;<span class=keyword>new</span> <span class=built_in>Date</span>().toLocaleString()&#125;</span>*</span></span><br><span class=line><span class=string>`</span>,</span><br><span class=line>            <span class=attr>language</span>: <span class=string>&#x27;markdown&#x27;</span></span><br><span class=line>        &#125;);</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>await</span> vscode.<span class=property>window</span>.<span class="title function_">showTextDocument</span>(<span class="variable language_">document</span>);</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class=keyword>async</span> <span class="title function_">createTestFile</span>(<span class=params>context: <span class=built_in>any</span>, testCode: <span class=built_in>string</span></span>) &#123;</span><br><span class=line>        <span class=keyword>const</span> editor = vscode.<span class=property>window</span>.<span class=property>activeTextEditor</span>;</span><br><span class=line>        <span class=keyword>if</span> (!editor) &#123;</span><br><span class=line>            <span class=keyword>return</span>;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 生成测试文件名</span></span><br><span class=line>        <span class=keyword>const</span> originalPath = editor.<span class=property>document</span>.<span class=property>uri</span>.<span class=property>fsPath</span>;</span><br><span class=line>        <span class=keyword>const</span> testPath = originalPath.<span class="title function_">replace</span>(<span class=regexp>/\.(ts|js)$/</span>, <span class=string>&#x27;.test.$1&#x27;</span>);</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>try</span> &#123;</span><br><span class=line>            <span class=keyword>const</span> testUri = vscode.<span class=property>Uri</span>.<span class="title function_">file</span>(testPath);</span><br><span class=line>            <span class=keyword>const</span> testContent = <span class=string>`// 由 AI Code Assistant 自动生成的测试文件</span></span><br><span class=line><span class=string>// 生成时间: <span class=subst>$&#123;<span class=keyword>new</span> <span class=built_in>Date</span>().toLocaleString()&#125;</span></span></span><br><span class=line><span class=string></span></span><br><span class=line><span class=string><span class=subst>$&#123;<span class="variable language_">this</span>.cleanGeneratedCode(testCode)&#125;</span></span></span><br><span class=line><span class=string>`</span>;</span><br><span class=line>            </span><br><span class=line>            <span class=keyword>await</span> vscode.<span class=property>workspace</span>.<span class=property>fs</span>.<span class="title function_">writeFile</span>(testUri, <span class="title class_">Buffer</span>.<span class="title function_">from</span>(testContent, <span class=string>&#x27;utf8&#x27;</span>));</span><br><span class=line>            <span class=keyword>const</span> testDocument = <span class=keyword>await</span> vscode.<span class=property>workspace</span>.<span class="title function_">openTextDocument</span>(testUri);</span><br><span class=line>            <span class=keyword>await</span> vscode.<span class=property>window</span>.<span class="title function_">showTextDocument</span>(testDocument);</span><br><span class=line>            </span><br><span class=line>            vscode.<span class=property>window</span>.<span class="title function_">showInformationMessage</span>(<span class=string>`测试文件已创建: <span class=subst>$&#123;testPath&#125;</span>`</span>);</span><br><span class=line>        &#125; <span class=keyword>catch</span> (error) &#123;</span><br><span class=line>            vscode.<span class=property>window</span>.<span class="title function_">showErrorMessage</span>(<span class=string>`创建测试文件失败: <span class=subst>$&#123;error.message&#125;</span>`</span>);</span><br><span class=line>        &#125;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class=keyword>async</span> <span class="title function_">insertDocumentation</span>(<span class=params>context: <span class=built_in>any</span>, documentation: <span class=built_in>string</span></span>) &#123;</span><br><span class=line>        <span class=keyword>const</span> editor = vscode.<span class=property>window</span>.<span class=property>activeTextEditor</span>;</span><br><span class=line>        <span class=keyword>if</span> (!editor) &#123;</span><br><span class=line>            <span class=keyword>return</span>;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 找到选择文本的开始位置，在其前面插入文档注释</span></span><br><span class=line>        <span class=keyword>const</span> startLine = editor.<span class=property>selection</span>.<span class=property>start</span>.<span class=property>line</span>;</span><br><span class=line>        <span class=keyword>const</span> insertPosition = <span class=keyword>new</span> vscode.<span class="title class_">Position</span>(startLine, <span class=number>0</span>);</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>const</span> docComment = <span class="variable language_">this</span>.<span class="title function_">formatDocComment</span>(documentation, context.<span class=property>language</span>);</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>await</span> editor.<span class="title function_">edit</span>(<span class=function><span class=params>editBuilder</span> =&gt;</span> &#123;</span><br><span class=line>            editBuilder.<span class="title function_">insert</span>(insertPosition, docComment + <span class=string>&#x27;\n&#x27;</span>);</span><br><span class=line>        &#125;);</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">formatDocComment</span>(<span class=attr>documentation</span>: <span class=built_in>string</span>, <span class=attr>language</span>: <span class=built_in>string</span>): <span class=built_in>string</span> &#123;</span><br><span class=line>        <span class=comment>// 清理和格式化文档注释</span></span><br><span class=line>        <span class=keyword>const</span> cleanDoc = <span class="variable language_">this</span>.<span class="title function_">cleanGeneratedCode</span>(documentation);</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>if</span> (language === <span class=string>&#x27;typescript&#x27;</span> || language === <span class=string>&#x27;javascript&#x27;</span>) &#123;</span><br><span class=line>            <span class=comment>// JSDoc格式</span></span><br><span class=line>            <span class=keyword>return</span> <span class=string>`/**\n<span class=subst>$&#123;cleanDoc.split(<span class=string>&#x27;\n&#x27;</span>).map(line =&gt; <span class=string>` * <span class=subst>$&#123;line&#125;</span>`</span>).join(<span class=string>&#x27;\n&#x27;</span>)&#125;</span>\n */`</span>;</span><br><span class=line>        &#125; <span class=keyword>else</span> <span class=keyword>if</span> (language === <span class=string>&#x27;python&#x27;</span>) &#123;</span><br><span class=line>            <span class=comment>// Python docstring格式</span></span><br><span class=line>            <span class=keyword>return</span> <span class=string>`&quot;&quot;&quot;\n<span class=subst>$&#123;cleanDoc&#125;</span>\n&quot;&quot;&quot;`</span>;</span><br><span class=line>        &#125; <span class=keyword>else</span> &#123;</span><br><span class=line>            <span class=comment>// 通用注释格式</span></span><br><span class=line>            <span class=keyword>return</span> cleanDoc.<span class="title function_">split</span>(<span class=string>&#x27;\n&#x27;</span>).<span class="title function_">map</span>(<span class=function><span class=params>line</span> =&gt;</span> <span class=string>`// <span class=subst>$&#123;line&#125;</span>`</span>).<span class="title function_">join</span>(<span class=string>&#x27;\n&#x27;</span>);</span><br><span class=line>        &#125;</span><br><span class=line>    &#125;</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><h4 id=WebView聊天界面><a href=#WebView聊天界面 class=headerlink title=WebView聊天界面></a>WebView聊天界面</h4><figure class="highlight typescript"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br><span class=line>90</span><br><span class=line>91</span><br><span class=line>92</span><br><span class=line>93</span><br><span class=line>94</span><br><span class=line>95</span><br><span class=line>96</span><br><span class=line>97</span><br><span class=line>98</span><br><span class=line>99</span><br><span class=line>100</span><br><span class=line>101</span><br><span class=line>102</span><br><span class=line>103</span><br><span class=line>104</span><br><span class=line>105</span><br><span class=line>106</span><br><span class=line>107</span><br><span class=line>108</span><br><span class=line>109</span><br><span class=line>110</span><br><span class=line>111</span><br><span class=line>112</span><br><span class=line>113</span><br><span class=line>114</span><br><span class=line>115</span><br><span class=line>116</span><br><span class=line>117</span><br><span class=line>118</span><br><span class=line>119</span><br><span class=line>120</span><br><span class=line>121</span><br><span class=line>122</span><br><span class=line>123</span><br><span class=line>124</span><br><span class=line>125</span><br><span class=line>126</span><br><span class=line>127</span><br><span class=line>128</span><br><span class=line>129</span><br><span class=line>130</span><br><span class=line>131</span><br><span class=line>132</span><br><span class=line>133</span><br><span class=line>134</span><br><span class=line>135</span><br><span class=line>136</span><br><span class=line>137</span><br><span class=line>138</span><br><span class=line>139</span><br><span class=line>140</span><br><span class=line>141</span><br><span class=line>142</span><br><span class=line>143</span><br><span class=line>144</span><br><span class=line>145</span><br><span class=line>146</span><br><span class=line>147</span><br><span class=line>148</span><br><span class=line>149</span><br><span class=line>150</span><br><span class=line>151</span><br><span class=line>152</span><br><span class=line>153</span><br><span class=line>154</span><br><span class=line>155</span><br><span class=line>156</span><br><span class=line>157</span><br><span class=line>158</span><br><span class=line>159</span><br><span class=line>160</span><br><span class=line>161</span><br><span class=line>162</span><br><span class=line>163</span><br><span class=line>164</span><br><span class=line>165</span><br><span class=line>166</span><br><span class=line>167</span><br><span class=line>168</span><br><span class=line>169</span><br><span class=line>170</span><br><span class=line>171</span><br><span class=line>172</span><br><span class=line>173</span><br><span class=line>174</span><br><span class=line>175</span><br><span class=line>176</span><br><span class=line>177</span><br><span class=line>178</span><br><span class=line>179</span><br><span class=line>180</span><br><span class=line>181</span><br><span class=line>182</span><br><span class=line>183</span><br><span class=line>184</span><br><span class=line>185</span><br><span class=line>186</span><br><span class=line>187</span><br><span class=line>188</span><br><span class=line>189</span><br><span class=line>190</span><br><span class=line>191</span><br><span class=line>192</span><br><span class=line>193</span><br><span class=line>194</span><br><span class=line>195</span><br><span class=line>196</span><br><span class=line>197</span><br><span class=line>198</span><br><span class=line>199</span><br><span class=line>200</span><br><span class=line>201</span><br><span class=line>202</span><br><span class=line>203</span><br><span class=line>204</span><br><span class=line>205</span><br><span class=line>206</span><br><span class=line>207</span><br><span class=line>208</span><br><span class=line>209</span><br><span class=line>210</span><br><span class=line>211</span><br><span class=line>212</span><br><span class=line>213</span><br><span class=line>214</span><br><span class=line>215</span><br><span class=line>216</span><br><span class=line>217</span><br><span class=line>218</span><br><span class=line>219</span><br><span class=line>220</span><br><span class=line>221</span><br><span class=line>222</span><br><span class=line>223</span><br><span class=line>224</span><br><span class=line>225</span><br><span class=line>226</span><br><span class=line>227</span><br><span class=line>228</span><br><span class=line>229</span><br><span class=line>230</span><br><span class=line>231</span><br><span class=line>232</span><br><span class=line>233</span><br><span class=line>234</span><br><span class=line>235</span><br><span class=line>236</span><br><span class=line>237</span><br><span class=line>238</span><br><span class=line>239</span><br><span class=line>240</span><br><span class=line>241</span><br><span class=line>242</span><br><span class=line>243</span><br><span class=line>244</span><br><span class=line>245</span><br><span class=line>246</span><br></pre></td><td class=code><pre><span class=line><span class=comment>// src/webview/chatWebviewProvider.ts</span></span><br><span class=line><span class=keyword>import</span> * <span class=keyword>as</span> vscode <span class=keyword>from</span> <span class=string>&#x27;vscode&#x27;</span>;</span><br><span class=line><span class=keyword>import</span> &#123; <span class="title class_">AIService</span> &#125; <span class=keyword>from</span> <span class=string>&#x27;../services/aiService&#x27;</span>;</span><br><span class=line></span><br><span class=line><span class=keyword>export</span> <span class=keyword>class</span> <span class="title class_">ChatWebviewProvider</span> <span class=keyword>implements</span> vscode.<span class=property>WebviewViewProvider</span> &#123;</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>static</span> <span class=keyword>readonly</span> viewType = <span class=string>&#x27;aiAssistantView&#x27;</span>;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> _view?: vscode.<span class=property>WebviewView</span>;</span><br><span class=line>    </span><br><span class=line>    <span class="title function_">constructor</span>(<span class=params></span></span><br><span class=line><span class=params>        <span class=keyword>private</span> <span class=keyword>readonly</span> _extensionUri: vscode.Uri,</span></span><br><span class=line><span class=params>        <span class=keyword>private</span> <span class=keyword>readonly</span> _aiService: AIService</span></span><br><span class=line><span class=params>    </span>) &#123;&#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>public</span> <span class="title function_">resolveWebviewView</span>(<span class=params></span></span><br><span class=line><span class=params>        webviewView: vscode.WebviewView,</span></span><br><span class=line><span class=params>        context: vscode.WebviewViewResolveContext,</span></span><br><span class=line><span class=params>        _token: vscode.CancellationToken,</span></span><br><span class=line><span class=params>    </span>) &#123;</span><br><span class=line>        <span class="variable language_">this</span>.<span class=property>_view</span> = webviewView;</span><br><span class=line>        </span><br><span class=line>        webviewView.<span class=property>webview</span>.<span class=property>options</span> = &#123;</span><br><span class=line>            <span class=attr>enableScripts</span>: <span class=literal>true</span>,</span><br><span class=line>            <span class=attr>localResourceRoots</span>: [<span class="variable language_">this</span>.<span class=property>_extensionUri</span>]</span><br><span class=line>        &#125;;</span><br><span class=line>        </span><br><span class=line>        webviewView.<span class=property>webview</span>.<span class=property>html</span> = <span class="variable language_">this</span>.<span class="title function_">_getHtmlForWebview</span>(webviewView.<span class=property>webview</span>);</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 处理来自WebView的消息</span></span><br><span class=line>        webviewView.<span class=property>webview</span>.<span class="title function_">onDidReceiveMessage</span>(<span class=keyword>async</span> (data) =&gt; &#123;</span><br><span class=line>            <span class=keyword>switch</span> (data.<span class=property>type</span>) &#123;</span><br><span class=line>                <span class=keyword>case</span> <span class=string>&#x27;sendMessage&#x27;</span>:</span><br><span class=line>                    <span class=keyword>await</span> <span class="variable language_">this</span>.<span class="title function_">handleUserMessage</span>(data.<span class=property>message</span>);</span><br><span class=line>                    <span class=keyword>break</span>;</span><br><span class=line>                <span class=keyword>case</span> <span class=string>&#x27;clearChat&#x27;</span>:</span><br><span class=line>                    <span class="variable language_">this</span>.<span class="title function_">clearChat</span>();</span><br><span class=line>                    <span class=keyword>break</span>;</span><br><span class=line>                <span class=keyword>case</span> <span class=string>&#x27;insertCode&#x27;</span>:</span><br><span class=line>                    <span class=keyword>await</span> <span class="variable language_">this</span>.<span class="title function_">insertCodeToEditor</span>(data.<span class=property>code</span>);</span><br><span class=line>                    <span class=keyword>break</span>;</span><br><span class=line>            &#125;</span><br><span class=line>        &#125;);</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>public</span> <span class="title function_">show</span>(<span class=params></span>) &#123;</span><br><span class=line>        <span class=keyword>if</span> (<span class="variable language_">this</span>.<span class=property>_view</span>) &#123;</span><br><span class=line>            <span class="variable language_">this</span>.<span class=property>_view</span>.<span class=property>show</span>?.(<span class=literal>true</span>);</span><br><span class=line>        &#125;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class=keyword>async</span> <span class="title function_">handleUserMessage</span>(<span class=params>message: <span class=built_in>string</span></span>) &#123;</span><br><span class=line>        <span class=keyword>if</span> (!<span class="variable language_">this</span>.<span class=property>_view</span>) &#123;</span><br><span class=line>            <span class=keyword>return</span>;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 显示用户消息</span></span><br><span class=line>        <span class="variable language_">this</span>.<span class=property>_view</span>.<span class=property>webview</span>.<span class="title function_">postMessage</span>(&#123;</span><br><span class=line>            <span class=attr>type</span>: <span class=string>&#x27;addMessage&#x27;</span>,</span><br><span class=line>            <span class=attr>message</span>: &#123;</span><br><span class=line>                <span class=attr>role</span>: <span class=string>&#x27;user&#x27;</span>,</span><br><span class=line>                <span class=attr>content</span>: message,</span><br><span class=line>                <span class=attr>timestamp</span>: <span class=keyword>new</span> <span class="title class_">Date</span>().<span class="title function_">toISOString</span>()</span><br><span class=line>            &#125;</span><br><span class=line>        &#125;);</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 显示加载状态</span></span><br><span class=line>        <span class="variable language_">this</span>.<span class=property>_view</span>.<span class=property>webview</span>.<span class="title function_">postMessage</span>(&#123;</span><br><span class=line>            <span class=attr>type</span>: <span class=string>&#x27;setLoading&#x27;</span>,</span><br><span class=line>            <span class=attr>loading</span>: <span class=literal>true</span></span><br><span class=line>        &#125;);</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>try</span> &#123;</span><br><span class=line>            <span class=comment>// 获取当前编辑器上下文</span></span><br><span class=line>            <span class=keyword>const</span> context = <span class=keyword>await</span> <span class="variable language_">this</span>.<span class="title function_">getCurrentContext</span>();</span><br><span class=line>            </span><br><span class=line>            <span class=keyword>const</span> response = <span class=keyword>await</span> <span class="variable language_">this</span>.<span class=property>_aiService</span>.<span class="title function_">generateCode</span>(&#123;</span><br><span class=line>                <span class=attr>prompt</span>: message,</span><br><span class=line>                <span class=attr>context</span>: context,</span><br><span class=line>                <span class=attr>language</span>: <span class="variable language_">this</span>.<span class="title function_">getCurrentLanguage</span>()</span><br><span class=line>            &#125;);</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// 显示AI回复</span></span><br><span class=line>            <span class="variable language_">this</span>.<span class=property>_view</span>.<span class=property>webview</span>.<span class="title function_">postMessage</span>(&#123;</span><br><span class=line>                <span class=attr>type</span>: <span class=string>&#x27;addMessage&#x27;</span>,</span><br><span class=line>                <span class=attr>message</span>: &#123;</span><br><span class=line>                    <span class=attr>role</span>: <span class=string>&#x27;assistant&#x27;</span>,</span><br><span class=line>                    <span class=attr>content</span>: response.<span class=property>content</span>,</span><br><span class=line>                    <span class=attr>timestamp</span>: <span class=keyword>new</span> <span class="title class_">Date</span>().<span class="title function_">toISOString</span>(),</span><br><span class=line>                    <span class=attr>usage</span>: response.<span class=property>usage</span></span><br><span class=line>                &#125;</span><br><span class=line>            &#125;);</span><br><span class=line>            </span><br><span class=line>        &#125; <span class=keyword>catch</span> (error) &#123;</span><br><span class=line>            <span class="variable language_">this</span>.<span class=property>_view</span>.<span class=property>webview</span>.<span class="title function_">postMessage</span>(&#123;</span><br><span class=line>                <span class=attr>type</span>: <span class=string>&#x27;addMessage&#x27;</span>,</span><br><span class=line>                <span class=attr>message</span>: &#123;</span><br><span class=line>                    <span class=attr>role</span>: <span class=string>&#x27;error&#x27;</span>,</span><br><span class=line>                    <span class=attr>content</span>: <span class=string>`Error: <span class=subst>$&#123;error.message&#125;</span>`</span>,</span><br><span class=line>                    <span class=attr>timestamp</span>: <span class=keyword>new</span> <span class="title class_">Date</span>().<span class="title function_">toISOString</span>()</span><br><span class=line>                &#125;</span><br><span class=line>            &#125;);</span><br><span class=line>        &#125; <span class=keyword>finally</span> &#123;</span><br><span class=line>            <span class="variable language_">this</span>.<span class=property>_view</span>.<span class=property>webview</span>.<span class="title function_">postMessage</span>(&#123;</span><br><span class=line>                <span class=attr>type</span>: <span class=string>&#x27;setLoading&#x27;</span>,</span><br><span class=line>                <span class=attr>loading</span>: <span class=literal>false</span></span><br><span class=line>            &#125;);</span><br><span class=line>        &#125;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">clearChat</span>(<span class=params></span>) &#123;</span><br><span class=line>        <span class=keyword>if</span> (<span class="variable language_">this</span>.<span class=property>_view</span>) &#123;</span><br><span class=line>            <span class="variable language_">this</span>.<span class=property>_view</span>.<span class=property>webview</span>.<span class="title function_">postMessage</span>(&#123;</span><br><span class=line>                <span class=attr>type</span>: <span class=string>&#x27;clearMessages&#x27;</span></span><br><span class=line>            &#125;);</span><br><span class=line>        &#125;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class=keyword>async</span> <span class="title function_">insertCodeToEditor</span>(<span class=params>code: <span class=built_in>string</span></span>) &#123;</span><br><span class=line>        <span class=keyword>const</span> editor = vscode.<span class=property>window</span>.<span class=property>activeTextEditor</span>;</span><br><span class=line>        <span class=keyword>if</span> (!editor) &#123;</span><br><span class=line>            vscode.<span class=property>window</span>.<span class="title function_">showWarningMessage</span>(<span class=string>&#x27;请先打开一个文件&#x27;</span>);</span><br><span class=line>            <span class=keyword>return</span>;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>await</span> editor.<span class="title function_">edit</span>(<span class=function><span class=params>editBuilder</span> =&gt;</span> &#123;</span><br><span class=line>            editBuilder.<span class="title function_">insert</span>(editor.<span class=property>selection</span>.<span class=property>active</span>, code);</span><br><span class=line>        &#125;);</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 自动格式化</span></span><br><span class=line>        <span class=keyword>await</span> vscode.<span class=property>commands</span>.<span class="title function_">executeCommand</span>(<span class=string>&#x27;editor.action.formatDocument&#x27;</span>);</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class=keyword>async</span> <span class="title function_">getCurrentContext</span>(): <span class="title class_">Promise</span>&lt;<span class=built_in>string</span>&gt; &#123;</span><br><span class=line>        <span class=keyword>const</span> editor = vscode.<span class=property>window</span>.<span class=property>activeTextEditor</span>;</span><br><span class=line>        <span class=keyword>if</span> (!editor) &#123;</span><br><span class=line>            <span class=keyword>return</span> <span class=string>&#x27;&#x27;</span>;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>const</span> <span class="variable language_">document</span> = editor.<span class=property>document</span>;</span><br><span class=line>        <span class=keyword>const</span> selection = editor.<span class=property>selection</span>;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>if</span> (!selection.<span class=property>isEmpty</span>) &#123;</span><br><span class=line>            <span class=keyword>return</span> <span class=string>`当前选中的代码:\n<span class=subst>$&#123;<span class="variable language_">document</span>.getText(selection)&#125;</span>`</span>;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 获取当前函数上下文</span></span><br><span class=line>        <span class=keyword>const</span> currentLine = <span class="variable language_">document</span>.<span class="title function_">lineAt</span>(selection.<span class=property>active</span>.<span class=property>line</span>);</span><br><span class=line>        <span class=keyword>const</span> functionContext = <span class="variable language_">this</span>.<span class="title function_">findFunctionContext</span>(<span class="variable language_">document</span>, selection.<span class=property>active</span>.<span class=property>line</span>);</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> functionContext || <span class=string>`当前行: <span class=subst>$&#123;currentLine.text&#125;</span>`</span>;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">findFunctionContext</span>(<span class=attr>document</span>: vscode.<span class=property>TextDocument</span>, <span class=attr>lineNumber</span>: <span class=built_in>number</span>): <span class=built_in>string</span> &#123;</span><br><span class=line>        <span class=comment>// 简单的函数查找逻辑</span></span><br><span class=line>        <span class=keyword>for</span> (<span class=keyword>let</span> i = lineNumber; i &gt;= <span class=number>0</span>; i--) &#123;</span><br><span class=line>            <span class=keyword>const</span> line = <span class="variable language_">document</span>.<span class="title function_">lineAt</span>(i).<span class=property>text</span>;</span><br><span class=line>            <span class=keyword>if</span> (line.<span class="title function_">match</span>(<span class=regexp>/function\s+\w+|const\s+\w+\s*=.*=&gt;|class\s+\w+/</span>)) &#123;</span><br><span class=line>                <span class=keyword>return</span> line.<span class="title function_">trim</span>();</span><br><span class=line>            &#125;</span><br><span class=line>        &#125;</span><br><span class=line>        <span class=keyword>return</span> <span class=string>&#x27;&#x27;</span>;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">getCurrentLanguage</span>(): <span class=built_in>string</span> &#123;</span><br><span class=line>        <span class=keyword>const</span> editor = vscode.<span class=property>window</span>.<span class=property>activeTextEditor</span>;</span><br><span class=line>        <span class=keyword>return</span> editor?.<span class=property>document</span>.<span class=property>languageId</span> || <span class=string>&#x27;typescript&#x27;</span>;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">_getHtmlForWebview</span>(<span class=params>webview: vscode.Webview</span>) &#123;</span><br><span class=line>        <span class=keyword>const</span> styleResetUri = webview.<span class="title function_">asWebviewUri</span>(</span><br><span class=line>            vscode.<span class=property>Uri</span>.<span class="title function_">joinPath</span>(<span class="variable language_">this</span>.<span class=property>_extensionUri</span>, <span class=string>&#x27;media&#x27;</span>, <span class=string>&#x27;reset.css&#x27;</span>)</span><br><span class=line>        );</span><br><span class=line>        <span class=keyword>const</span> styleVSCodeUri = webview.<span class="title function_">asWebviewUri</span>(</span><br><span class=line>            vscode.<span class=property>Uri</span>.<span class="title function_">joinPath</span>(<span class="variable language_">this</span>.<span class=property>_extensionUri</span>, <span class=string>&#x27;media&#x27;</span>, <span class=string>&#x27;vscode.css&#x27;</span>)</span><br><span class=line>        );</span><br><span class=line>        <span class=keyword>const</span> styleMainUri = webview.<span class="title function_">asWebviewUri</span>(</span><br><span class=line>            vscode.<span class=property>Uri</span>.<span class="title function_">joinPath</span>(<span class="variable language_">this</span>.<span class=property>_extensionUri</span>, <span class=string>&#x27;media&#x27;</span>, <span class=string>&#x27;main.css&#x27;</span>)</span><br><span class=line>        );</span><br><span class=line>        <span class=keyword>const</span> scriptUri = webview.<span class="title function_">asWebviewUri</span>(</span><br><span class=line>            vscode.<span class=property>Uri</span>.<span class="title function_">joinPath</span>(<span class="variable language_">this</span>.<span class=property>_extensionUri</span>, <span class=string>&#x27;media&#x27;</span>, <span class=string>&#x27;main.js&#x27;</span>)</span><br><span class=line>        );</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>const</span> nonce = <span class="title function_">getNonce</span>();</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> <span class=string>`&lt;!DOCTYPE html&gt;</span></span><br><span class=line><span class=string>&lt;html lang=&quot;en&quot;&gt;</span></span><br><span class=line><span class=string>&lt;head&gt;</span></span><br><span class=line><span class=string>    &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span><br><span class=line><span class=string>    &lt;meta http-equiv=&quot;Content-Security-Policy&quot; content=&quot;default-src &#x27;none&#x27;; style-src <span class=subst>$&#123;webview.cspSource&#125;</span> &#x27;unsafe-inline&#x27;; script-src &#x27;nonce-<span class=subst>$&#123;nonce&#125;</span>&#x27;; font-src <span class=subst>$&#123;webview.cspSource&#125;</span>;&quot;&gt;</span></span><br><span class=line><span class=string>    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span></span><br><span class=line><span class=string>    &lt;link href=&quot;<span class=subst>$&#123;styleResetUri&#125;</span>&quot; rel=&quot;stylesheet&quot;&gt;</span></span><br><span class=line><span class=string>    &lt;link href=&quot;<span class=subst>$&#123;styleVSCodeUri&#125;</span>&quot; rel=&quot;stylesheet&quot;&gt;</span></span><br><span class=line><span class=string>    &lt;link href=&quot;<span class=subst>$&#123;styleMainUri&#125;</span>&quot; rel=&quot;stylesheet&quot;&gt;</span></span><br><span class=line><span class=string>    &lt;title&gt;AI Assistant&lt;/title&gt;</span></span><br><span class=line><span class=string>&lt;/head&gt;</span></span><br><span class=line><span class=string>&lt;body&gt;</span></span><br><span class=line><span class=string>    &lt;div class=&quot;container&quot;&gt;</span></span><br><span class=line><span class=string>        &lt;div class=&quot;header&quot;&gt;</span></span><br><span class=line><span class=string>            &lt;h2&gt;AI Code Assistant&lt;/h2&gt;</span></span><br><span class=line><span class=string>            &lt;button id=&quot;clearBtn&quot; class=&quot;btn-secondary&quot;&gt;清空对话&lt;/button&gt;</span></span><br><span class=line><span class=string>        &lt;/div&gt;</span></span><br><span class=line><span class=string>        </span></span><br><span class=line><span class=string>        &lt;div id=&quot;chatContainer&quot; class=&quot;chat-container&quot;&gt;</span></span><br><span class=line><span class=string>            &lt;div class=&quot;welcome-message&quot;&gt;</span></span><br><span class=line><span class=string>                &lt;h3&gt;👋 欢迎使用AI代码助手&lt;/h3&gt;</span></span><br><span class=line><span class=string>                &lt;p&gt;我可以帮助你：&lt;/p&gt;</span></span><br><span class=line><span class=string>                &lt;ul&gt;</span></span><br><span class=line><span class=string>                    &lt;li&gt;生成代码片段&lt;/li&gt;</span></span><br><span class=line><span class=string>                    &lt;li&gt;解释复杂代码&lt;/li&gt;</span></span><br><span class=line><span class=string>                    &lt;li&gt;优化代码性能&lt;/li&gt;</span></span><br><span class=line><span class=string>                    &lt;li&gt;生成单元测试&lt;/li&gt;</span></span><br><span class=line><span class=string>                    &lt;li&gt;编写技术文档&lt;/li&gt;</span></span><br><span class=line><span class=string>                &lt;/ul&gt;</span></span><br><span class=line><span class=string>            &lt;/div&gt;</span></span><br><span class=line><span class=string>        &lt;/div&gt;</span></span><br><span class=line><span class=string>        </span></span><br><span class=line><span class=string>        &lt;div class=&quot;input-container&quot;&gt;</span></span><br><span class=line><span class=string>            &lt;div class=&quot;input-wrapper&quot;&gt;</span></span><br><span class=line><span class=string>                &lt;textarea </span></span><br><span class=line><span class=string>                    id=&quot;messageInput&quot; </span></span><br><span class=line><span class=string>                    placeholder=&quot;输入你的问题或需求...&quot; </span></span><br><span class=line><span class=string>                    rows=&quot;3&quot;</span></span><br><span class=line><span class=string>                &gt;&lt;/textarea&gt;</span></span><br><span class=line><span class=string>                &lt;button id=&quot;sendBtn&quot; class=&quot;btn-primary&quot;&gt;发送&lt;/button&gt;</span></span><br><span class=line><span class=string>            &lt;/div&gt;</span></span><br><span class=line><span class=string>            &lt;div id=&quot;loadingIndicator&quot; class=&quot;loading&quot; style=&quot;display: none;&quot;&gt;</span></span><br><span class=line><span class=string>                &lt;div class=&quot;spinner&quot;&gt;&lt;/div&gt;</span></span><br><span class=line><span class=string>                &lt;span&gt;AI思考中...&lt;/span&gt;</span></span><br><span class=line><span class=string>            &lt;/div&gt;</span></span><br><span class=line><span class=string>        &lt;/div&gt;</span></span><br><span class=line><span class=string>    &lt;/div&gt;</span></span><br><span class=line><span class=string>    </span></span><br><span class=line><span class=string>    &lt;script nonce=&quot;<span class=subst>$&#123;nonce&#125;</span>&quot; src=&quot;<span class=subst>$&#123;scriptUri&#125;</span>&quot;&gt;&lt;/script&gt;</span></span><br><span class=line><span class=string>&lt;/body&gt;</span></span><br><span class=line><span class=string>&lt;/html&gt;`</span>;</span><br><span class=line>    &#125;</span><br><span class=line>&#125;</span><br><span class=line></span><br><span class=line><span class=keyword>function</span> <span class="title function_">getNonce</span>(<span class=params></span>) &#123;</span><br><span class=line>    <span class=keyword>let</span> text = <span class=string>&#x27;&#x27;</span>;</span><br><span class=line>    <span class=keyword>const</span> possible = <span class=string>&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789&#x27;</span>;</span><br><span class=line>    <span class=keyword>for</span> (<span class=keyword>let</span> i = <span class=number>0</span>; i &lt; <span class=number>32</span>; i++) &#123;</span><br><span class=line>        text += possible.<span class="title function_">charAt</span>(<span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * possible.<span class=property>length</span>));</span><br><span class=line>    &#125;</span><br><span class=line>    <span class=keyword>return</span> text;</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><h4 id=WebView前端脚本><a href=#WebView前端脚本 class=headerlink title=WebView前端脚本></a>WebView前端脚本</h4><figure class="highlight javascript"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br><span class=line>90</span><br><span class=line>91</span><br><span class=line>92</span><br><span class=line>93</span><br><span class=line>94</span><br><span class=line>95</span><br><span class=line>96</span><br><span class=line>97</span><br><span class=line>98</span><br><span class=line>99</span><br><span class=line>100</span><br><span class=line>101</span><br><span class=line>102</span><br><span class=line>103</span><br><span class=line>104</span><br><span class=line>105</span><br><span class=line>106</span><br><span class=line>107</span><br><span class=line>108</span><br><span class=line>109</span><br><span class=line>110</span><br><span class=line>111</span><br><span class=line>112</span><br><span class=line>113</span><br><span class=line>114</span><br><span class=line>115</span><br><span class=line>116</span><br><span class=line>117</span><br><span class=line>118</span><br><span class=line>119</span><br><span class=line>120</span><br><span class=line>121</span><br><span class=line>122</span><br><span class=line>123</span><br><span class=line>124</span><br><span class=line>125</span><br><span class=line>126</span><br><span class=line>127</span><br><span class=line>128</span><br><span class=line>129</span><br><span class=line>130</span><br><span class=line>131</span><br><span class=line>132</span><br><span class=line>133</span><br><span class=line>134</span><br><span class=line>135</span><br><span class=line>136</span><br><span class=line>137</span><br><span class=line>138</span><br><span class=line>139</span><br><span class=line>140</span><br><span class=line>141</span><br><span class=line>142</span><br><span class=line>143</span><br><span class=line>144</span><br><span class=line>145</span><br><span class=line>146</span><br><span class=line>147</span><br><span class=line>148</span><br><span class=line>149</span><br><span class=line>150</span><br><span class=line>151</span><br><span class=line>152</span><br><span class=line>153</span><br><span class=line>154</span><br><span class=line>155</span><br><span class=line>156</span><br><span class=line>157</span><br><span class=line>158</span><br><span class=line>159</span><br><span class=line>160</span><br><span class=line>161</span><br><span class=line>162</span><br></pre></td><td class=code><pre><span class=line><span class=comment>// media/main.js</span></span><br><span class=line>(<span class=keyword>function</span>(<span class=params></span>) &#123;</span><br><span class=line>    <span class=keyword>const</span> vscode = <span class="title function_">acquireVsCodeApi</span>();</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>const</span> chatContainer = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class=string>&#x27;chatContainer&#x27;</span>);</span><br><span class=line>    <span class=keyword>const</span> messageInput = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class=string>&#x27;messageInput&#x27;</span>);</span><br><span class=line>    <span class=keyword>const</span> sendBtn = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class=string>&#x27;sendBtn&#x27;</span>);</span><br><span class=line>    <span class=keyword>const</span> clearBtn = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class=string>&#x27;clearBtn&#x27;</span>);</span><br><span class=line>    <span class=keyword>const</span> loadingIndicator = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class=string>&#x27;loadingIndicator&#x27;</span>);</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>let</span> messageHistory = [];</span><br><span class=line>    </span><br><span class=line>    <span class=comment>// 发送消息</span></span><br><span class=line>    <span class=keyword>function</span> <span class="title function_">sendMessage</span>(<span class=params></span>) &#123;</span><br><span class=line>        <span class=keyword>const</span> message = messageInput.<span class=property>value</span>.<span class="title function_">trim</span>();</span><br><span class=line>        <span class=keyword>if</span> (!message) <span class=keyword>return</span>;</span><br><span class=line>        </span><br><span class=line>        messageInput.<span class=property>value</span> = <span class=string>&#x27;&#x27;</span>;</span><br><span class=line>        vscode.<span class="title function_">postMessage</span>(&#123;</span><br><span class=line>            <span class=attr>type</span>: <span class=string>&#x27;sendMessage&#x27;</span>,</span><br><span class=line>            <span class=attr>message</span>: message</span><br><span class=line>        &#125;);</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=comment>// 事件监听</span></span><br><span class=line>    sendBtn.<span class="title function_">addEventListener</span>(<span class=string>&#x27;click&#x27;</span>, sendMessage);</span><br><span class=line>    clearBtn.<span class="title function_">addEventListener</span>(<span class=string>&#x27;click&#x27;</span>, <span class=function>() =&gt;</span> &#123;</span><br><span class=line>        vscode.<span class="title function_">postMessage</span>(&#123; <span class=attr>type</span>: <span class=string>&#x27;clearChat&#x27;</span> &#125;);</span><br><span class=line>    &#125;);</span><br><span class=line>    </span><br><span class=line>    messageInput.<span class="title function_">addEventListener</span>(<span class=string>&#x27;keydown&#x27;</span>, <span class=function>(<span class=params>e</span>) =&gt;</span> &#123;</span><br><span class=line>        <span class=keyword>if</span> (e.<span class=property>key</span> === <span class=string>&#x27;Enter&#x27;</span> &amp;&amp; !e.<span class=property>shiftKey</span>) &#123;</span><br><span class=line>            e.<span class="title function_">preventDefault</span>();</span><br><span class=line>            <span class="title function_">sendMessage</span>();</span><br><span class=line>        &#125;</span><br><span class=line>    &#125;);</span><br><span class=line>    </span><br><span class=line>    <span class=comment>// 接收来自扩展的消息</span></span><br><span class=line>    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class=string>&#x27;message&#x27;</span>, <span class=function><span class=params>event</span> =&gt;</span> &#123;</span><br><span class=line>        <span class=keyword>const</span> message = event.<span class=property>data</span>;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>switch</span> (message.<span class=property>type</span>) &#123;</span><br><span class=line>            <span class=keyword>case</span> <span class=string>&#x27;addMessage&#x27;</span>:</span><br><span class=line>                <span class="title function_">addMessageToChat</span>(message.<span class=property>message</span>);</span><br><span class=line>                <span class=keyword>break</span>;</span><br><span class=line>            <span class=keyword>case</span> <span class=string>&#x27;setLoading&#x27;</span>:</span><br><span class=line>                <span class="title function_">setLoading</span>(message.<span class=property>loading</span>);</span><br><span class=line>                <span class=keyword>break</span>;</span><br><span class=line>            <span class=keyword>case</span> <span class=string>&#x27;clearMessages&#x27;</span>:</span><br><span class=line>                <span class="title function_">clearMessages</span>();</span><br><span class=line>                <span class=keyword>break</span>;</span><br><span class=line>        &#125;</span><br><span class=line>    &#125;);</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>function</span> <span class="title function_">addMessageToChat</span>(<span class=params>message</span>) &#123;</span><br><span class=line>        <span class=keyword>const</span> messageElement = <span class="title function_">createMessageElement</span>(message);</span><br><span class=line>        chatContainer.<span class="title function_">appendChild</span>(messageElement);</span><br><span class=line>        chatContainer.<span class=property>scrollTop</span> = chatContainer.<span class=property>scrollHeight</span>;</span><br><span class=line>        </span><br><span class=line>        messageHistory.<span class="title function_">push</span>(message);</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>function</span> <span class="title function_">createMessageElement</span>(<span class=params>message</span>) &#123;</span><br><span class=line>        <span class=keyword>const</span> messageDiv = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class=string>&#x27;div&#x27;</span>);</span><br><span class=line>        messageDiv.<span class=property>className</span> = <span class=string>`message <span class=subst>$&#123;message.role&#125;</span>`</span>;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>const</span> header = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class=string>&#x27;div&#x27;</span>);</span><br><span class=line>        header.<span class=property>className</span> = <span class=string>&#x27;message-header&#x27;</span>;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>const</span> role = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class=string>&#x27;span&#x27;</span>);</span><br><span class=line>        role.<span class=property>className</span> = <span class=string>&#x27;role&#x27;</span>;</span><br><span class=line>        role.<span class=property>textContent</span> = message.<span class=property>role</span> === <span class=string>&#x27;user&#x27;</span> ? <span class=string>&#x27;你&#x27;</span> : </span><br><span class=line>                          message.<span class=property>role</span> === <span class=string>&#x27;assistant&#x27;</span> ? <span class=string>&#x27;AI助手&#x27;</span> : <span class=string>&#x27;错误&#x27;</span>;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>const</span> timestamp = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class=string>&#x27;span&#x27;</span>);</span><br><span class=line>        timestamp.<span class=property>className</span> = <span class=string>&#x27;timestamp&#x27;</span>;</span><br><span class=line>        timestamp.<span class=property>textContent</span> = <span class=keyword>new</span> <span class="title class_">Date</span>(message.<span class=property>timestamp</span>).<span class="title function_">toLocaleTimeString</span>();</span><br><span class=line>        </span><br><span class=line>        header.<span class="title function_">appendChild</span>(role);</span><br><span class=line>        header.<span class="title function_">appendChild</span>(timestamp);</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>const</span> content = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class=string>&#x27;div&#x27;</span>);</span><br><span class=line>        content.<span class=property>className</span> = <span class=string>&#x27;message-content&#x27;</span>;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>if</span> (message.<span class=property>role</span> === <span class=string>&#x27;assistant&#x27;</span> &amp;&amp; <span class="title function_">isCodeContent</span>(message.<span class=property>content</span>)) &#123;</span><br><span class=line>            content.<span class=property>innerHTML</span> = <span class="title function_">formatCodeContent</span>(message.<span class=property>content</span>);</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// 添加插入代码按钮</span></span><br><span class=line>            <span class=keyword>const</span> codeBlocks = content.<span class="title function_">querySelectorAll</span>(<span class=string>&#x27;pre code&#x27;</span>);</span><br><span class=line>            codeBlocks.<span class="title function_">forEach</span>(<span class=function><span class=params>codeBlock</span> =&gt;</span> &#123;</span><br><span class=line>                <span class=keyword>const</span> insertBtn = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class=string>&#x27;button&#x27;</span>);</span><br><span class=line>                insertBtn.<span class=property>className</span> = <span class=string>&#x27;insert-code-btn&#x27;</span>;</span><br><span class=line>                insertBtn.<span class=property>textContent</span> = <span class=string>&#x27;插入代码&#x27;</span>;</span><br><span class=line>                insertBtn.<span class=property>onclick</span> = <span class=function>() =&gt;</span> &#123;</span><br><span class=line>                    vscode.<span class="title function_">postMessage</span>(&#123;</span><br><span class=line>                        <span class=attr>type</span>: <span class=string>&#x27;insertCode&#x27;</span>,</span><br><span class=line>                        <span class=attr>code</span>: codeBlock.<span class=property>textContent</span></span><br><span class=line>                    &#125;);</span><br><span class=line>                &#125;;</span><br><span class=line>                </span><br><span class=line>                <span class=keyword>const</span> pre = codeBlock.<span class=property>parentElement</span>;</span><br><span class=line>                pre.<span class="title function_">appendChild</span>(insertBtn);</span><br><span class=line>            &#125;);</span><br><span class=line>        &#125; <span class=keyword>else</span> &#123;</span><br><span class=line>            content.<span class=property>innerHTML</span> = <span class="title function_">formatMarkdown</span>(message.<span class=property>content</span>);</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        messageDiv.<span class="title function_">appendChild</span>(header);</span><br><span class=line>        messageDiv.<span class="title function_">appendChild</span>(content);</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 添加使用统计</span></span><br><span class=line>        <span class=keyword>if</span> (message.<span class=property>usage</span>) &#123;</span><br><span class=line>            <span class=keyword>const</span> usageDiv = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class=string>&#x27;div&#x27;</span>);</span><br><span class=line>            usageDiv.<span class=property>className</span> = <span class=string>&#x27;usage-info&#x27;</span>;</span><br><span class=line>            usageDiv.<span class=property>textContent</span> = <span class=string>`Token使用: <span class=subst>$&#123;message.usage.total_tokens&#125;</span>`</span>;</span><br><span class=line>            messageDiv.<span class="title function_">appendChild</span>(usageDiv);</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> messageDiv;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>function</span> <span class="title function_">isCodeContent</span>(<span class=params>content</span>) &#123;</span><br><span class=line>        <span class=keyword>return</span> content.<span class="title function_">includes</span>(<span class=string>&#x27;```&#x27;</span>) || content.<span class="title function_">includes</span>(<span class=string>&#x27;function &#x27;</span>) || content.<span class="title function_">includes</span>(<span class=string>&#x27;class &#x27;</span>);</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>function</span> <span class="title function_">formatCodeContent</span>(<span class=params>content</span>) &#123;</span><br><span class=line>        <span class=comment>// 简单的markdown代码块格式化</span></span><br><span class=line>        <span class=keyword>return</span> content</span><br><span class=line>            .<span class="title function_">replace</span>(<span class=regexp>/```(\w+)?\n([\s\S]*?)```/g</span>, <span class=function>(<span class=params>match, lang, code</span>) =&gt;</span> &#123;</span><br><span class=line>                <span class=keyword>return</span> <span class=string>`&lt;pre&gt;&lt;code class=&quot;language-<span class=subst>$&#123;lang || <span class=string>&#x27;text&#x27;</span>&#125;</span>&quot;&gt;<span class=subst>$&#123;escapeHtml(code.trim())&#125;</span>&lt;/code&gt;&lt;/pre&gt;`</span>;</span><br><span class=line>            &#125;)</span><br><span class=line>            .<span class="title function_">replace</span>(<span class=regexp>/`([^`]+)`/g</span>, <span class=string>&#x27;&lt;code&gt;$1&lt;/code&gt;&#x27;</span>)</span><br><span class=line>            .<span class="title function_">replace</span>(<span class=regexp>/\n/g</span>, <span class=string>&#x27;&lt;br&gt;&#x27;</span>);</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>function</span> <span class="title function_">formatMarkdown</span>(<span class=params>content</span>) &#123;</span><br><span class=line>        <span class=keyword>return</span> content</span><br><span class=line>            .<span class="title function_">replace</span>(<span class=regexp>/\*\*(.*?)\*\*/g</span>, <span class=string>&#x27;&lt;strong&gt;$1&lt;/strong&gt;&#x27;</span>)</span><br><span class=line>            .<span class="title function_">replace</span>(<span class=regexp>/\*(.*?)\*/g</span>, <span class=string>&#x27;&lt;em&gt;$1&lt;/em&gt;&#x27;</span>)</span><br><span class=line>            .<span class="title function_">replace</span>(<span class=regexp>/\n/g</span>, <span class=string>&#x27;&lt;br&gt;&#x27;</span>);</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>function</span> <span class="title function_">escapeHtml</span>(<span class=params>text</span>) &#123;</span><br><span class=line>        <span class=keyword>const</span> div = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class=string>&#x27;div&#x27;</span>);</span><br><span class=line>        div.<span class=property>textContent</span> = text;</span><br><span class=line>        <span class=keyword>return</span> div.<span class=property>innerHTML</span>;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>function</span> <span class="title function_">setLoading</span>(<span class=params>loading</span>) &#123;</span><br><span class=line>        loadingIndicator.<span class=property>style</span>.<span class=property>display</span> = loading ? <span class=string>&#x27;flex&#x27;</span> : <span class=string>&#x27;none&#x27;</span>;</span><br><span class=line>        sendBtn.<span class=property>disabled</span> = loading;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>function</span> <span class="title function_">clearMessages</span>(<span class=params></span>) &#123;</span><br><span class=line>        <span class=keyword>const</span> welcomeMessage = chatContainer.<span class="title function_">querySelector</span>(<span class=string>&#x27;.welcome-message&#x27;</span>);</span><br><span class=line>        chatContainer.<span class=property>innerHTML</span> = <span class=string>&#x27;&#x27;</span>;</span><br><span class=line>        <span class=keyword>if</span> (welcomeMessage) &#123;</span><br><span class=line>            chatContainer.<span class="title function_">appendChild</span>(welcomeMessage.<span class="title function_">cloneNode</span>(<span class=literal>true</span>));</span><br><span class=line>        &#125;</span><br><span class=line>        messageHistory = [];</span><br><span class=line>    &#125;</span><br><span class=line>&#125;)();</span><br></pre></td></tr></table></figure><h3 id=1-3-测试和优化><a href=#1-3-测试和优化 class=headerlink title="1.3 测试和优化"></a>1.3 测试和优化</h3><h4 id=单元测试><a href=#单元测试 class=headerlink title=单元测试></a>单元测试</h4><figure class="highlight typescript"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br></pre></td><td class=code><pre><span class=line><span class=comment>// src/test/suite/aiService.test.ts</span></span><br><span class=line><span class=keyword>import</span> * <span class=keyword>as</span> assert <span class=keyword>from</span> <span class=string>&#x27;assert&#x27;</span>;</span><br><span class=line><span class=keyword>import</span> &#123; <span class="title class_">AIService</span> &#125; <span class=keyword>from</span> <span class=string>&#x27;../../services/aiService&#x27;</span>;</span><br><span class=line></span><br><span class=line><span class="title function_">suite</span>(<span class=string>&#x27;AI Service Tests&#x27;</span>, <span class=function>() =&gt;</span> &#123;</span><br><span class=line>    <span class=keyword>let</span> <span class=attr>aiService</span>: <span class="title class_">AIService</span>;</span><br><span class=line>    </span><br><span class=line>    <span class="title function_">setup</span>(<span class=function>() =&gt;</span> &#123;</span><br><span class=line>        aiService = <span class=keyword>new</span> <span class="title class_">AIService</span>();</span><br><span class=line>    &#125;);</span><br><span class=line>    </span><br><span class=line>    <span class="title function_">test</span>(<span class=string>&#x27;should handle code generation request&#x27;</span>, <span class=keyword>async</span> () =&gt; &#123;</span><br><span class=line>        <span class=keyword>const</span> request = &#123;</span><br><span class=line>            <span class=attr>prompt</span>: <span class=string>&#x27;Create a simple hello world function&#x27;</span>,</span><br><span class=line>            <span class=attr>language</span>: <span class=string>&#x27;typescript&#x27;</span></span><br><span class=line>        &#125;;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// Mock的实现，实际测试中需要使用真实的API或Mock</span></span><br><span class=line>        <span class=comment>// const response = await aiService.generateCode(request);</span></span><br><span class=line>        <span class=comment>// assert.ok(response.content.length &gt; 0);</span></span><br><span class=line>    &#125;);</span><br><span class=line>    </span><br><span class=line>    <span class="title function_">test</span>(<span class=string>&#x27;should extract code context correctly&#x27;</span>, <span class=keyword>async</span> () =&gt; &#123;</span><br><span class=line>        <span class=comment>// 测试代码上下文提取</span></span><br><span class=line>        assert.<span class="title function_">ok</span>(<span class=literal>true</span>); <span class=comment>// 占位符测试</span></span><br><span class=line>    &#125;);</span><br><span class=line>&#125;);</span><br></pre></td></tr></table></figure><h3 id=1-4-发布准备><a href=#1-4-发布准备 class=headerlink title="1.4 发布准备"></a>1.4 发布准备</h3><h4 id=构建脚本><a href=#构建脚本 class=headerlink title=构建脚本></a>构建脚本</h4><figure class="highlight json"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br></pre></td><td class=code><pre><span class=line><span class=punctuation>&#123;</span></span><br><span class=line>  <span class=attr>&quot;scripts&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>    <span class=attr>&quot;vscode:prepublish&quot;</span><span class=punctuation>:</span> <span class=string>&quot;npm run package&quot;</span><span class=punctuation>,</span></span><br><span class=line>    <span class=attr>&quot;compile&quot;</span><span class=punctuation>:</span> <span class=string>&quot;webpack&quot;</span><span class=punctuation>,</span></span><br><span class=line>    <span class=attr>&quot;watch&quot;</span><span class=punctuation>:</span> <span class=string>&quot;webpack --watch&quot;</span><span class=punctuation>,</span></span><br><span class=line>    <span class=attr>&quot;package&quot;</span><span class=punctuation>:</span> <span class=string>&quot;webpack --mode production --devtool hidden-source-map&quot;</span><span class=punctuation>,</span></span><br><span class=line>    <span class=attr>&quot;test&quot;</span><span class=punctuation>:</span> <span class=string>&quot;node ./out/test/runTest.js&quot;</span></span><br><span class=line>  <span class=punctuation>&#125;</span></span><br><span class=line><span class=punctuation>&#125;</span></span><br></pre></td></tr></table></figure><hr><h2 id=🛠️-项目二：API-Testing-Tool（API测试工具）><a href=#🛠️-项目二：API-Testing-Tool（API测试工具） class=headerlink title="🛠️ 项目二：API Testing Tool（API测试工具）"></a>🛠️ 项目二：API Testing Tool（API测试工具）</h2><h3 id=项目介绍-1><a href=#项目介绍-1 class=headerlink title=项目介绍></a>项目介绍</h3><p>开发一个类似Postman的API测试工具，但专门为VS Code集成优化。</p><h4 id=核心功能-1><a href=#核心功能-1 class=headerlink title=核心功能></a>核心功能</h4><ul><li><strong>HTTP请求构建</strong>：支持GET、POST、PUT、DELETE等方法</li><li><strong>环境变量管理</strong>：多环境配置切换</li><li><strong>请求历史</strong>：自动保存和管理请求记录</li><li><strong>响应分析</strong>：JSON格式化、响应时间统计</li><li><strong>批量测试</strong>：支持测试集合和自动化测试</li></ul><h3 id=2-1-技术架构><a href=#2-1-技术架构 class=headerlink title="2.1 技术架构"></a>2.1 技术架构</h3><figure class="highlight typescript"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br></pre></td><td class=code><pre><span class=line><span class=comment>// 项目结构</span></span><br><span class=line>src/</span><br><span class=line>├── extension.<span class=property>ts</span>              <span class=comment>// 扩展入口</span></span><br><span class=line>├── providers/</span><br><span class=line>│   ├── apiTreeProvider.<span class=property>ts</span>    <span class=comment>// API列表树视图</span></span><br><span class=line>│   ├── requestWebview.<span class=property>ts</span>     <span class=comment>// 请求构建界面</span></span><br><span class=line>│   └── historyProvider.<span class=property>ts</span>    <span class=comment>// 历史记录提供者</span></span><br><span class=line>├── services/</span><br><span class=line>│   ├── httpClient.<span class=property>ts</span>         <span class=comment>// HTTP请求服务</span></span><br><span class=line>│   ├── environmentService.<span class=property>ts</span> <span class=comment>// 环境变量服务</span></span><br><span class=line>│   └── storageService.<span class=property>ts</span>     <span class=comment>// 数据存储服务</span></span><br><span class=line>├── models/</span><br><span class=line>│   ├── request.<span class=property>ts</span>            <span class=comment>// 请求数据模型</span></span><br><span class=line>│   ├── response.<span class=property>ts</span>           <span class=comment>// 响应数据模型</span></span><br><span class=line>│   └── environment.<span class=property>ts</span>        <span class=comment>// 环境配置模型</span></span><br><span class=line>└── webview/                  <span class=comment>// React前端</span></span><br><span class=line>    ├── components/</span><br><span class=line>    ├── services/</span><br><span class=line>    └── <span class="title class_">App</span>.<span class=property>tsx</span></span><br></pre></td></tr></table></figure><h3 id=2-2-核心实现><a href=#2-2-核心实现 class=headerlink title="2.2 核心实现"></a>2.2 核心实现</h3><h4 id=HTTP客户端服务><a href=#HTTP客户端服务 class=headerlink title=HTTP客户端服务></a>HTTP客户端服务</h4><figure class="highlight typescript"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br></pre></td><td class=code><pre><span class=line><span class=comment>// src/services/httpClient.ts</span></span><br><span class=line><span class=keyword>import</span> axios, &#123; <span class="title class_">AxiosResponse</span>, <span class="title class_">AxiosRequestConfig</span> &#125; <span class=keyword>from</span> <span class=string>&#x27;axios&#x27;</span>;</span><br><span class=line><span class=keyword>import</span> &#123; <span class="title class_">ApiRequest</span>, <span class="title class_">ApiResponse</span> &#125; <span class=keyword>from</span> <span class=string>&#x27;../models/request&#x27;</span>;</span><br><span class=line></span><br><span class=line><span class=keyword>export</span> <span class=keyword>class</span> <span class="title class_">HttpClientService</span> &#123;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>async</span> <span class="title function_">sendRequest</span>(<span class=attr>request</span>: <span class="title class_">ApiRequest</span>): <span class="title class_">Promise</span>&lt;<span class="title class_">ApiResponse</span>&gt; &#123;</span><br><span class=line>        <span class=keyword>const</span> startTime = <span class="title class_">Date</span>.<span class="title function_">now</span>();</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>try</span> &#123;</span><br><span class=line>            <span class=keyword>const</span> <span class=attr>config</span>: <span class="title class_">AxiosRequestConfig</span> = &#123;</span><br><span class=line>                <span class=attr>method</span>: request.<span class=property>method</span>,</span><br><span class=line>                <span class=attr>url</span>: request.<span class=property>url</span>,</span><br><span class=line>                <span class=attr>headers</span>: request.<span class=property>headers</span>,</span><br><span class=line>                <span class=attr>data</span>: request.<span class=property>body</span>,</span><br><span class=line>                <span class=attr>timeout</span>: request.<span class=property>timeout</span> || <span class=number>30000</span></span><br><span class=line>            &#125;;</span><br><span class=line>            </span><br><span class=line>            <span class=keyword>const</span> <span class=attr>response</span>: <span class="title class_">AxiosResponse</span> = <span class=keyword>await</span> <span class="title function_">axios</span>(config);</span><br><span class=line>            <span class=keyword>const</span> endTime = <span class="title class_">Date</span>.<span class="title function_">now</span>();</span><br><span class=line>            </span><br><span class=line>            <span class=keyword>return</span> &#123;</span><br><span class=line>                <span class=attr>id</span>: <span class="variable language_">this</span>.<span class="title function_">generateId</span>(),</span><br><span class=line>                <span class=attr>request</span>: request,</span><br><span class=line>                <span class=attr>status</span>: response.<span class=property>status</span>,</span><br><span class=line>                <span class=attr>statusText</span>: response.<span class=property>statusText</span>,</span><br><span class=line>                <span class=attr>headers</span>: response.<span class=property>headers</span>,</span><br><span class=line>                <span class=attr>data</span>: response.<span class=property>data</span>,</span><br><span class=line>                <span class=attr>responseTime</span>: endTime - startTime,</span><br><span class=line>                <span class=attr>timestamp</span>: <span class=keyword>new</span> <span class="title class_">Date</span>().<span class="title function_">toISOString</span>()</span><br><span class=line>            &#125;;</span><br><span class=line>            </span><br><span class=line>        &#125; <span class=keyword>catch</span> (error) &#123;</span><br><span class=line>            <span class=keyword>const</span> endTime = <span class="title class_">Date</span>.<span class="title function_">now</span>();</span><br><span class=line>            </span><br><span class=line>            <span class=keyword>if</span> (axios.<span class="title function_">isAxiosError</span>(error)) &#123;</span><br><span class=line>                <span class=keyword>return</span> &#123;</span><br><span class=line>                    <span class=attr>id</span>: <span class="variable language_">this</span>.<span class="title function_">generateId</span>(),</span><br><span class=line>                    <span class=attr>request</span>: request,</span><br><span class=line>                    <span class=attr>status</span>: error.<span class=property>response</span>?.<span class=property>status</span> || <span class=number>0</span>,</span><br><span class=line>                    <span class=attr>statusText</span>: error.<span class=property>response</span>?.<span class=property>statusText</span> || <span class=string>&#x27;Network Error&#x27;</span>,</span><br><span class=line>                    <span class=attr>headers</span>: error.<span class=property>response</span>?.<span class=property>headers</span> || &#123;&#125;,</span><br><span class=line>                    <span class=attr>data</span>: error.<span class=property>response</span>?.<span class=property>data</span> || error.<span class=property>message</span>,</span><br><span class=line>                    <span class=attr>responseTime</span>: endTime - startTime,</span><br><span class=line>                    <span class=attr>timestamp</span>: <span class=keyword>new</span> <span class="title class_">Date</span>().<span class="title function_">toISOString</span>(),</span><br><span class=line>                    <span class=attr>error</span>: error.<span class=property>message</span></span><br><span class=line>                &#125;;</span><br><span class=line>            &#125;</span><br><span class=line>            </span><br><span class=line>            <span class=keyword>throw</span> error;</span><br><span class=line>        &#125;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">generateId</span>(): <span class=built_in>string</span> &#123;</span><br><span class=line>        <span class=keyword>return</span> <span class="title class_">Date</span>.<span class="title function_">now</span>().<span class="title function_">toString</span>(<span class=number>36</span>) + <span class="title class_">Math</span>.<span class="title function_">random</span>().<span class="title function_">toString</span>(<span class=number>36</span>).<span class="title function_">substr</span>(<span class=number>2</span>);</span><br><span class=line>    &#125;</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><hr><h2 id=📊-项目三：Data-Visualizer（数据可视化工具）><a href=#📊-项目三：Data-Visualizer（数据可视化工具） class=headerlink title="📊 项目三：Data Visualizer（数据可视化工具）"></a>📊 项目三：Data Visualizer（数据可视化工具）</h2><h3 id=项目介绍-2><a href=#项目介绍-2 class=headerlink title=项目介绍></a>项目介绍</h3><p>创建一个强大的数据可视化扩展，支持多种数据源和图表类型。</p><h4 id=核心功能-2><a href=#核心功能-2 class=headerlink title=核心功能></a>核心功能</h4><ul><li><strong>多数据源支持</strong>：JSON、CSV、数据库连接</li><li><strong>丰富图表类型</strong>：柱状图、线图、饼图、散点图、热力图</li><li><strong>实时数据</strong>：WebSocket数据流支持</li><li><strong>交互式图表</strong>：缩放、筛选、钻取</li><li><strong>导出功能</strong>：PNG、SVG、PDF格式导出</li></ul><h3 id=3-1-技术实现><a href=#3-1-技术实现 class=headerlink title="3.1 技术实现"></a>3.1 技术实现</h3><h4 id=数据处理服务><a href=#数据处理服务 class=headerlink title=数据处理服务></a>数据处理服务</h4><figure class="highlight typescript"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br></pre></td><td class=code><pre><span class=line><span class=comment>// src/services/dataProcessor.ts</span></span><br><span class=line><span class=keyword>import</span> * <span class=keyword>as</span> d3 <span class=keyword>from</span> <span class=string>&#x27;d3&#x27;</span>;</span><br><span class=line></span><br><span class=line><span class=keyword>export</span> <span class=keyword>interface</span> <span class="title class_">DataPoint</span> &#123;</span><br><span class=line>    <span class=attr>x</span>: <span class=built_in>any</span>;</span><br><span class=line>    <span class=attr>y</span>: <span class=built_in>any</span>;</span><br><span class=line>    category?: <span class=built_in>string</span>;</span><br><span class=line>    [<span class=attr>key</span>: <span class=built_in>string</span>]: <span class=built_in>any</span>;</span><br><span class=line>&#125;</span><br><span class=line></span><br><span class=line><span class=keyword>export</span> <span class=keyword>class</span> <span class="title class_">DataProcessor</span> &#123;</span><br><span class=line>    </span><br><span class=line>    <span class="title function_">processCSV</span>(<span class=attr>csvContent</span>: <span class=built_in>string</span>): <span class="title class_">DataPoint</span>[] &#123;</span><br><span class=line>        <span class=keyword>const</span> data = d3.<span class="title function_">csvParse</span>(csvContent);</span><br><span class=line>        <span class=keyword>return</span> data.<span class="title function_">map</span>(<span class=function><span class=params>row</span> =&gt;</span> (&#123;</span><br><span class=line>            ...row,</span><br><span class=line>            <span class=attr>x</span>: row[<span class="title class_">Object</span>.<span class="title function_">keys</span>(row)[<span class=number>0</span>]],</span><br><span class=line>            <span class=attr>y</span>: +row[<span class="title class_">Object</span>.<span class="title function_">keys</span>(row)[<span class=number>1</span>]] || row[<span class="title class_">Object</span>.<span class="title function_">keys</span>(row)[<span class=number>1</span>]]</span><br><span class=line>        &#125;));</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class="title function_">processJSON</span>(<span class=attr>jsonContent</span>: <span class=built_in>string</span>): <span class="title class_">DataPoint</span>[] &#123;</span><br><span class=line>        <span class=keyword>const</span> data = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(jsonContent);</span><br><span class=line>        <span class=keyword>if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(data)) &#123;</span><br><span class=line>            <span class=keyword>return</span> data;</span><br><span class=line>        &#125;</span><br><span class=line>        <span class=keyword>return</span> [data];</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class="title function_">aggregateData</span>(<span class=attr>data</span>: <span class="title class_">DataPoint</span>[], <span class=attr>groupBy</span>: <span class=built_in>string</span>, <span class=attr>aggregateBy</span>: <span class=built_in>string</span>, <span class=attr>aggregateFunction</span>: <span class=string>&#x27;sum&#x27;</span> | <span class=string>&#x27;avg&#x27;</span> | <span class=string>&#x27;count&#x27;</span> | <span class=string>&#x27;max&#x27;</span> | <span class=string>&#x27;min&#x27;</span>): <span class="title class_">DataPoint</span>[] &#123;</span><br><span class=line>        <span class=keyword>const</span> grouped = d3.<span class="title function_">group</span>(data, <span class=function><span class=params>d</span> =&gt;</span> d[groupBy]);</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> <span class="title class_">Array</span>.<span class="title function_">from</span>(grouped, <span class=function>(<span class=params>[key, values]</span>) =&gt;</span> &#123;</span><br><span class=line>            <span class=keyword>let</span> <span class=attr>aggregatedValue</span>: <span class=built_in>number</span>;</span><br><span class=line>            </span><br><span class=line>            <span class=keyword>switch</span> (aggregateFunction) &#123;</span><br><span class=line>                <span class=keyword>case</span> <span class=string>&#x27;sum&#x27;</span>:</span><br><span class=line>                    aggregatedValue = d3.<span class="title function_">sum</span>(values, <span class=function><span class=params>d</span> =&gt;</span> +d[aggregateBy]);</span><br><span class=line>                    <span class=keyword>break</span>;</span><br><span class=line>                <span class=keyword>case</span> <span class=string>&#x27;avg&#x27;</span>:</span><br><span class=line>                    aggregatedValue = d3.<span class="title function_">mean</span>(values, <span class=function><span class=params>d</span> =&gt;</span> +d[aggregateBy]) || <span class=number>0</span>;</span><br><span class=line>                    <span class=keyword>break</span>;</span><br><span class=line>                <span class=keyword>case</span> <span class=string>&#x27;count&#x27;</span>:</span><br><span class=line>                    aggregatedValue = values.<span class=property>length</span>;</span><br><span class=line>                    <span class=keyword>break</span>;</span><br><span class=line>                <span class=keyword>case</span> <span class=string>&#x27;max&#x27;</span>:</span><br><span class=line>                    aggregatedValue = d3.<span class="title function_">max</span>(values, <span class=function><span class=params>d</span> =&gt;</span> +d[aggregateBy]) || <span class=number>0</span>;</span><br><span class=line>                    <span class=keyword>break</span>;</span><br><span class=line>                <span class=keyword>case</span> <span class=string>&#x27;min&#x27;</span>:</span><br><span class=line>                    aggregatedValue = d3.<span class="title function_">min</span>(values, <span class=function><span class=params>d</span> =&gt;</span> +d[aggregateBy]) || <span class=number>0</span>;</span><br><span class=line>                    <span class=keyword>break</span>;</span><br><span class=line>            &#125;</span><br><span class=line>            </span><br><span class=line>            <span class=keyword>return</span> &#123;</span><br><span class=line>                <span class=attr>x</span>: key,</span><br><span class=line>                <span class=attr>y</span>: aggregatedValue,</span><br><span class=line>                <span class=attr>category</span>: key,</span><br><span class=line>                <span class=attr>count</span>: values.<span class=property>length</span></span><br><span class=line>            &#125;;</span><br><span class=line>        &#125;);</span><br><span class=line>    &#125;</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><hr><h2 id=📋-项目四：Project-Manager（项目管理工具）><a href=#📋-项目四：Project-Manager（项目管理工具） class=headerlink title="📋 项目四：Project Manager（项目管理工具）"></a>📋 项目四：Project Manager（项目管理工具）</h2><h3 id=项目介绍-3><a href=#项目介绍-3 class=headerlink title=项目介绍></a>项目介绍</h3><p>开发一个轻量级的项目管理扩展，帮助开发者组织任务和跟踪进度。</p><h4 id=核心功能-3><a href=#核心功能-3 class=headerlink title=核心功能></a>核心功能</h4><ul><li><strong>任务管理</strong>：创建、编辑、删除任务</li><li><strong>进度跟踪</strong>：可视化进度条和状态</li><li><strong>时间跟踪</strong>：工作时间记录和统计</li><li><strong>团队协作</strong>：任务分配和评论</li><li><strong>报告生成</strong>：项目进度报告</li></ul><hr><h2 id=🔍-项目五：Code-Quality-Monitor（代码质量监控）><a href=#🔍-项目五：Code-Quality-Monitor（代码质量监控） class=headerlink title="🔍 项目五：Code Quality Monitor（代码质量监控）"></a>🔍 项目五：Code Quality Monitor（代码质量监控）</h2><h3 id=项目介绍-4><a href=#项目介绍-4 class=headerlink title=项目介绍></a>项目介绍</h3><p>构建一个代码质量监控工具，集成多种代码分析工具，提供全面的代码质量洞察。</p><h4 id=核心功能-4><a href=#核心功能-4 class=headerlink title=核心功能></a>核心功能</h4><ul><li><strong>静态代码分析</strong>：ESLint、SonarJS集成</li><li><strong>代码复杂度</strong>：圈复杂度、认知复杂度计算</li><li><strong>技术债务</strong>：代码异味检测和修复建议</li><li><strong>测试覆盖率</strong>：覆盖率可视化和趋势分析</li><li><strong>质量趋势</strong>：历史质量数据跟踪</li></ul><h3 id=5-1-Language-Server实现><a href=#5-1-Language-Server实现 class=headerlink title="5.1 Language Server实现"></a>5.1 Language Server实现</h3><figure class="highlight typescript"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br><span class=line>90</span><br><span class=line>91</span><br><span class=line>92</span><br><span class=line>93</span><br><span class=line>94</span><br><span class=line>95</span><br><span class=line>96</span><br><span class=line>97</span><br><span class=line>98</span><br><span class=line>99</span><br><span class=line>100</span><br><span class=line>101</span><br><span class=line>102</span><br><span class=line>103</span><br><span class=line>104</span><br><span class=line>105</span><br><span class=line>106</span><br><span class=line>107</span><br><span class=line>108</span><br><span class=line>109</span><br><span class=line>110</span><br><span class=line>111</span><br><span class=line>112</span><br><span class=line>113</span><br><span class=line>114</span><br><span class=line>115</span><br><span class=line>116</span><br><span class=line>117</span><br><span class=line>118</span><br><span class=line>119</span><br><span class=line>120</span><br><span class=line>121</span><br><span class=line>122</span><br><span class=line>123</span><br><span class=line>124</span><br><span class=line>125</span><br><span class=line>126</span><br><span class=line>127</span><br><span class=line>128</span><br><span class=line>129</span><br><span class=line>130</span><br><span class=line>131</span><br><span class=line>132</span><br><span class=line>133</span><br><span class=line>134</span><br><span class=line>135</span><br><span class=line>136</span><br><span class=line>137</span><br><span class=line>138</span><br><span class=line>139</span><br><span class=line>140</span><br><span class=line>141</span><br><span class=line>142</span><br><span class=line>143</span><br><span class=line>144</span><br><span class=line>145</span><br><span class=line>146</span><br><span class=line>147</span><br><span class=line>148</span><br><span class=line>149</span><br><span class=line>150</span><br><span class=line>151</span><br><span class=line>152</span><br><span class=line>153</span><br><span class=line>154</span><br><span class=line>155</span><br><span class=line>156</span><br><span class=line>157</span><br><span class=line>158</span><br><span class=line>159</span><br><span class=line>160</span><br><span class=line>161</span><br><span class=line>162</span><br><span class=line>163</span><br><span class=line>164</span><br><span class=line>165</span><br><span class=line>166</span><br><span class=line>167</span><br><span class=line>168</span><br><span class=line>169</span><br><span class=line>170</span><br><span class=line>171</span><br><span class=line>172</span><br><span class=line>173</span><br><span class=line>174</span><br><span class=line>175</span><br><span class=line>176</span><br><span class=line>177</span><br><span class=line>178</span><br><span class=line>179</span><br><span class=line>180</span><br><span class=line>181</span><br><span class=line>182</span><br><span class=line>183</span><br><span class=line>184</span><br><span class=line>185</span><br><span class=line>186</span><br><span class=line>187</span><br><span class=line>188</span><br><span class=line>189</span><br><span class=line>190</span><br><span class=line>191</span><br><span class=line>192</span><br><span class=line>193</span><br><span class=line>194</span><br><span class=line>195</span><br><span class=line>196</span><br><span class=line>197</span><br><span class=line>198</span><br></pre></td><td class=code><pre><span class=line><span class=comment>// src/server/qualityServer.ts</span></span><br><span class=line><span class=keyword>import</span> &#123;</span><br><span class=line>    createConnection,</span><br><span class=line>    <span class="title class_">TextDocuments</span>,</span><br><span class=line>    <span class="title class_">ProposedFeatures</span>,</span><br><span class=line>    <span class="title class_">InitializeParams</span>,</span><br><span class=line>    <span class="title class_">DidChangeConfigurationNotification</span>,</span><br><span class=line>    <span class="title class_">CompletionItem</span>,</span><br><span class=line>    <span class="title class_">CompletionItemKind</span>,</span><br><span class=line>    <span class="title class_">TextDocumentPositionParams</span>,</span><br><span class=line>    <span class="title class_">TextDocumentSyncKind</span>,</span><br><span class=line>    <span class="title class_">InitializeResult</span>,</span><br><span class=line>    <span class="title class_">DocumentDiagnosticReportKind</span>,</span><br><span class=line>    <span class=keyword>type</span> <span class="title class_">DocumentDiagnosticReport</span></span><br><span class=line>&#125; <span class=keyword>from</span> <span class=string>&#x27;vscode-languageserver/node&#x27;</span>;</span><br><span class=line></span><br><span class=line><span class=keyword>import</span> &#123; <span class="title class_">TextDocument</span> &#125; <span class=keyword>from</span> <span class=string>&#x27;vscode-languageserver-textdocument&#x27;</span>;</span><br><span class=line></span><br><span class=line><span class=comment>// 创建连接</span></span><br><span class=line><span class=keyword>const</span> connection = <span class="title function_">createConnection</span>(<span class="title class_">ProposedFeatures</span>.<span class=property>all</span>);</span><br><span class=line></span><br><span class=line><span class=comment>// 创建文档管理器</span></span><br><span class=line><span class=keyword>const</span> <span class=attr>documents</span>: <span class="title class_">TextDocuments</span>&lt;<span class="title class_">TextDocument</span>&gt; = <span class=keyword>new</span> <span class="title class_">TextDocuments</span>(<span class="title class_">TextDocument</span>);</span><br><span class=line></span><br><span class=line><span class=keyword>let</span> hasConfigurationCapability = <span class=literal>false</span>;</span><br><span class=line><span class=keyword>let</span> hasWorkspaceFolderCapability = <span class=literal>false</span>;</span><br><span class=line><span class=keyword>let</span> hasDiagnosticRelatedInformationCapability = <span class=literal>false</span>;</span><br><span class=line></span><br><span class=line>connection.<span class="title function_">onInitialize</span>(<span class=function>(<span class=params>params: InitializeParams</span>) =&gt;</span> &#123;</span><br><span class=line>    <span class=keyword>const</span> capabilities = params.<span class=property>capabilities</span>;</span><br><span class=line></span><br><span class=line>    hasConfigurationCapability = !!(</span><br><span class=line>        capabilities.<span class=property>workspace</span> &amp;&amp; !!capabilities.<span class=property>workspace</span>.<span class=property>configuration</span></span><br><span class=line>    );</span><br><span class=line>    hasWorkspaceFolderCapability = !!(</span><br><span class=line>        capabilities.<span class=property>workspace</span> &amp;&amp; !!capabilities.<span class=property>workspace</span>.<span class=property>workspaceFolders</span></span><br><span class=line>    );</span><br><span class=line>    hasDiagnosticRelatedInformationCapability = !!(</span><br><span class=line>        capabilities.<span class=property>textDocument</span> &amp;&amp;</span><br><span class=line>        capabilities.<span class=property>textDocument</span>.<span class=property>publishDiagnostics</span> &amp;&amp;</span><br><span class=line>        capabilities.<span class=property>textDocument</span>.<span class=property>publishDiagnostics</span>.<span class=property>relatedInformation</span></span><br><span class=line>    );</span><br><span class=line></span><br><span class=line>    <span class=keyword>const</span> <span class=attr>result</span>: <span class="title class_">InitializeResult</span> = &#123;</span><br><span class=line>        <span class=attr>capabilities</span>: &#123;</span><br><span class=line>            <span class=attr>textDocumentSync</span>: <span class="title class_">TextDocumentSyncKind</span>.<span class=property>Incremental</span>,</span><br><span class=line>            <span class=attr>completionProvider</span>: &#123;</span><br><span class=line>                <span class=attr>resolveProvider</span>: <span class=literal>true</span></span><br><span class=line>            &#125;,</span><br><span class=line>            <span class=attr>diagnosticProvider</span>: &#123;</span><br><span class=line>                <span class=attr>interFileDependencies</span>: <span class=literal>false</span>,</span><br><span class=line>                <span class=attr>workspaceDiagnostics</span>: <span class=literal>false</span></span><br><span class=line>            &#125;</span><br><span class=line>        &#125;</span><br><span class=line>    &#125;;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>if</span> (hasWorkspaceFolderCapability) &#123;</span><br><span class=line>        result.<span class=property>capabilities</span>.<span class=property>workspace</span> = &#123;</span><br><span class=line>            <span class=attr>workspaceFolders</span>: &#123;</span><br><span class=line>                <span class=attr>supported</span>: <span class=literal>true</span></span><br><span class=line>            &#125;</span><br><span class=line>        &#125;;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>return</span> result;</span><br><span class=line>&#125;);</span><br><span class=line></span><br><span class=line>connection.<span class="title function_">onInitialized</span>(<span class=function>() =&gt;</span> &#123;</span><br><span class=line>    <span class=keyword>if</span> (hasConfigurationCapability) &#123;</span><br><span class=line>        connection.<span class=property>client</span>.<span class="title function_">register</span>(<span class="title class_">DidChangeConfigurationNotification</span>.<span class=property>type</span>, <span class=literal>undefined</span>);</span><br><span class=line>    &#125;</span><br><span class=line>    <span class=keyword>if</span> (hasWorkspaceFolderCapability) &#123;</span><br><span class=line>        connection.<span class=property>workspace</span>.<span class="title function_">onDidChangeWorkspaceFolders</span>(<span class=function><span class=params>_event</span> =&gt;</span> &#123;</span><br><span class=line>            connection.<span class=property>console</span>.<span class="title function_">log</span>(<span class=string>&#x27;Workspace folder change event received.&#x27;</span>);</span><br><span class=line>        &#125;);</span><br><span class=line>    &#125;</span><br><span class=line>&#125;);</span><br><span class=line></span><br><span class=line><span class=comment>// 代码质量分析</span></span><br><span class=line><span class=keyword>async</span> <span class=keyword>function</span> <span class="title function_">analyzeCodeQuality</span>(<span class=params><span class="variable language_">document</span>: TextDocument</span>): <span class="title class_">Promise</span>&lt;<span class="title class_">DocumentDiagnosticReport</span>&gt; &#123;</span><br><span class=line>    <span class=keyword>const</span> text = <span class="variable language_">document</span>.<span class="title function_">getText</span>();</span><br><span class=line>    <span class=keyword>const</span> diagnostics = [];</span><br><span class=line>    </span><br><span class=line>    <span class=comment>// 简单的复杂度分析</span></span><br><span class=line>    <span class=keyword>const</span> complexity = <span class="title function_">calculateCyclomaticComplexity</span>(text);</span><br><span class=line>    <span class=keyword>if</span> (complexity &gt; <span class=number>10</span>) &#123;</span><br><span class=line>        diagnostics.<span class="title function_">push</span>(&#123;</span><br><span class=line>            <span class=attr>severity</span>: <span class=number>2</span>, <span class=comment>// Warning</span></span><br><span class=line>            <span class=attr>range</span>: &#123;</span><br><span class=line>                <span class=attr>start</span>: &#123; <span class=attr>line</span>: <span class=number>0</span>, <span class=attr>character</span>: <span class=number>0</span> &#125;,</span><br><span class=line>                <span class=attr>end</span>: &#123; <span class=attr>line</span>: <span class=number>0</span>, <span class=attr>character</span>: <span class=number>10</span> &#125;</span><br><span class=line>            &#125;,</span><br><span class=line>            <span class=attr>message</span>: <span class=string>`High cyclomatic complexity: <span class=subst>$&#123;complexity&#125;</span>. Consider refactoring.`</span>,</span><br><span class=line>            <span class=attr>source</span>: <span class=string>&#x27;code-quality-monitor&#x27;</span></span><br><span class=line>        &#125;);</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=comment>// 检查长函数</span></span><br><span class=line>    <span class=keyword>const</span> longFunctions = <span class="title function_">findLongFunctions</span>(text);</span><br><span class=line>    longFunctions.<span class="title function_">forEach</span>(<span class=function><span class=params>func</span> =&gt;</span> &#123;</span><br><span class=line>        diagnostics.<span class="title function_">push</span>(&#123;</span><br><span class=line>            <span class=attr>severity</span>: <span class=number>2</span>, <span class=comment>// Warning</span></span><br><span class=line>            <span class=attr>range</span>: func.<span class=property>range</span>,</span><br><span class=line>            <span class=attr>message</span>: <span class=string>`Function is too long (<span class=subst>$&#123;func.lines&#125;</span> lines). Consider breaking it down.`</span>,</span><br><span class=line>            <span class=attr>source</span>: <span class=string>&#x27;code-quality-monitor&#x27;</span></span><br><span class=line>        &#125;);</span><br><span class=line>    &#125;);</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>return</span> &#123;</span><br><span class=line>        <span class=attr>kind</span>: <span class="title class_">DocumentDiagnosticReportKind</span>.<span class=property>Full</span>,</span><br><span class=line>        <span class=attr>items</span>: diagnostics</span><br><span class=line>    &#125;;</span><br><span class=line>&#125;</span><br><span class=line></span><br><span class=line><span class=keyword>function</span> <span class="title function_">calculateCyclomaticComplexity</span>(<span class=params>code: <span class=built_in>string</span></span>): <span class=built_in>number</span> &#123;</span><br><span class=line>    <span class=comment>// 简化的圈复杂度计算</span></span><br><span class=line>    <span class=keyword>const</span> complexityKeywords = [</span><br><span class=line>        <span class=string>&#x27;if&#x27;</span>, <span class=string>&#x27;else if&#x27;</span>, <span class=string>&#x27;while&#x27;</span>, <span class=string>&#x27;for&#x27;</span>, <span class=string>&#x27;case&#x27;</span>, <span class=string>&#x27;catch&#x27;</span>, <span class=string>&#x27;&amp;&amp;&#x27;</span>, <span class=string>&#x27;||&#x27;</span>, <span class=string>&#x27;?&#x27;</span></span><br><span class=line>    ];</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>let</span> complexity = <span class=number>1</span>; <span class=comment>// 基础复杂度</span></span><br><span class=line>    </span><br><span class=line>    complexityKeywords.<span class="title function_">forEach</span>(<span class=function><span class=params>keyword</span> =&gt;</span> &#123;</span><br><span class=line>        <span class=keyword>const</span> regex = <span class=keyword>new</span> <span class="title class_">RegExp</span>(<span class=string>`\\b<span class=subst>$&#123;keyword&#125;</span>\\b`</span>, <span class=string>&#x27;g&#x27;</span>);</span><br><span class=line>        <span class=keyword>const</span> matches = code.<span class="title function_">match</span>(regex);</span><br><span class=line>        <span class=keyword>if</span> (matches) &#123;</span><br><span class=line>            complexity += matches.<span class=property>length</span>;</span><br><span class=line>        &#125;</span><br><span class=line>    &#125;);</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>return</span> complexity;</span><br><span class=line>&#125;</span><br><span class=line></span><br><span class=line><span class=keyword>function</span> <span class="title function_">findLongFunctions</span>(<span class=params>code: <span class=built_in>string</span></span>): <span class="title class_">Array</span>&lt;&#123;<span class=attr>range</span>: <span class=built_in>any</span>, <span class=attr>lines</span>: <span class=built_in>number</span>&#125;&gt; &#123;</span><br><span class=line>    <span class=keyword>const</span> functions = [];</span><br><span class=line>    <span class=keyword>const</span> lines = code.<span class="title function_">split</span>(<span class=string>&#x27;\n&#x27;</span>);</span><br><span class=line>    <span class=keyword>let</span> inFunction = <span class=literal>false</span>;</span><br><span class=line>    <span class=keyword>let</span> functionStart = <span class=number>0</span>;</span><br><span class=line>    <span class=keyword>let</span> braceCount = <span class=number>0</span>;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>for</span> (<span class=keyword>let</span> i = <span class=number>0</span>; i &lt; lines.<span class=property>length</span>; i++) &#123;</span><br><span class=line>        <span class=keyword>const</span> line = lines[i];</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>if</span> (line.<span class="title function_">includes</span>(<span class=string>&#x27;function &#x27;</span>) || line.<span class="title function_">includes</span>(<span class=string>&#x27;=&gt;&#x27;</span>) || line.<span class="title function_">includes</span>(<span class=string>&#x27;class &#x27;</span>)) &#123;</span><br><span class=line>            <span class=keyword>if</span> (!inFunction) &#123;</span><br><span class=line>                inFunction = <span class=literal>true</span>;</span><br><span class=line>                functionStart = i;</span><br><span class=line>                braceCount = <span class=number>0</span>;</span><br><span class=line>            &#125;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>if</span> (inFunction) &#123;</span><br><span class=line>            braceCount += (line.<span class="title function_">match</span>(<span class=regexp>/&#123;/g</span>) || []).<span class=property>length</span>;</span><br><span class=line>            braceCount -= (line.<span class="title function_">match</span>(<span class=regexp>/&#125;/g</span>) || []).<span class=property>length</span>;</span><br><span class=line>            </span><br><span class=line>            <span class=keyword>if</span> (braceCount === <span class=number>0</span> &amp;&amp; i &gt; functionStart) &#123;</span><br><span class=line>                <span class=keyword>const</span> functionLength = i - functionStart + <span class=number>1</span>;</span><br><span class=line>                <span class=keyword>if</span> (functionLength &gt; <span class=number>50</span>) &#123; <span class=comment>// 超过50行认为是长函数</span></span><br><span class=line>                    functions.<span class="title function_">push</span>(&#123;</span><br><span class=line>                        <span class=attr>range</span>: &#123;</span><br><span class=line>                            <span class=attr>start</span>: &#123; <span class=attr>line</span>: functionStart, <span class=attr>character</span>: <span class=number>0</span> &#125;,</span><br><span class=line>                            <span class=attr>end</span>: &#123; <span class=attr>line</span>: i, <span class=attr>character</span>: line.<span class=property>length</span> &#125;</span><br><span class=line>                        &#125;,</span><br><span class=line>                        <span class=attr>lines</span>: functionLength</span><br><span class=line>                    &#125;);</span><br><span class=line>                &#125;</span><br><span class=line>                inFunction = <span class=literal>false</span>;</span><br><span class=line>            &#125;</span><br><span class=line>        &#125;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>return</span> functions;</span><br><span class=line>&#125;</span><br><span class=line></span><br><span class=line><span class=comment>// 文档诊断</span></span><br><span class=line>connection.<span class=property>languages</span>.<span class="title function_">onDocumentDiagnostic</span>(<span class=keyword>async</span> (params) =&gt; &#123;</span><br><span class=line>    <span class=keyword>const</span> <span class="variable language_">document</span> = documents.<span class="title function_">get</span>(params.<span class=property>textDocument</span>.<span class=property>uri</span>);</span><br><span class=line>    <span class=keyword>if</span> (<span class="variable language_">document</span> !== <span class=literal>undefined</span>) &#123;</span><br><span class=line>        <span class=keyword>return</span> <span class="title function_">analyzeCodeQuality</span>(<span class="variable language_">document</span>);</span><br><span class=line>    &#125; <span class=keyword>else</span> &#123;</span><br><span class=line>        <span class=keyword>return</span> &#123;</span><br><span class=line>            <span class=attr>kind</span>: <span class="title class_">DocumentDiagnosticReportKind</span>.<span class=property>Full</span>,</span><br><span class=line>            <span class=attr>items</span>: []</span><br><span class=line>        &#125;;</span><br><span class=line>    &#125;</span><br><span class=line>&#125;);</span><br><span class=line></span><br><span class=line><span class=comment>// 监听文档变化</span></span><br><span class=line>documents.<span class="title function_">onDidChangeContent</span>(<span class=function><span class=params>change</span> =&gt;</span> &#123;</span><br><span class=line>    <span class=comment>// 文档内容变化时重新分析</span></span><br><span class=line>    <span class="title function_">analyzeCodeQuality</span>(change.<span class=property>document</span>);</span><br><span class=line>&#125;);</span><br><span class=line></span><br><span class=line><span class=comment>// 启动文档管理器监听</span></span><br><span class=line>documents.<span class="title function_">listen</span>(connection);</span><br><span class=line></span><br><span class=line><span class=comment>// 启动连接</span></span><br><span class=line>connection.<span class="title function_">listen</span>();</span><br></pre></td></tr></table></figure><hr><h2 id=🚀-第四部分：部署和推广><a href=#🚀-第四部分：部署和推广 class=headerlink title="🚀 第四部分：部署和推广"></a>🚀 第四部分：部署和推广</h2><h3 id=4-1-CI-CD流程><a href=#4-1-CI-CD流程 class=headerlink title="4.1 CI&#x2F;CD流程"></a>4.1 CI&#x2F;CD流程</h3><figure class="highlight yaml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br></pre></td><td class=code><pre><span class=line><span class=comment># .github/workflows/release.yml</span></span><br><span class=line><span class=attr>name:</span> <span class=string>Release</span> <span class=string>Extension</span></span><br><span class=line></span><br><span class=line><span class=attr>on:</span></span><br><span class=line>  <span class=attr>push:</span></span><br><span class=line>    <span class=attr>tags:</span></span><br><span class=line>      <span class=bullet>-</span> <span class=string>&#x27;v*&#x27;</span></span><br><span class=line></span><br><span class=line><span class=attr>jobs:</span></span><br><span class=line>  <span class=attr>build-and-release:</span></span><br><span class=line>    <span class=attr>runs-on:</span> <span class=string>ubuntu-latest</span></span><br><span class=line>    </span><br><span class=line>    <span class=attr>steps:</span></span><br><span class=line>    <span class=bullet>-</span> <span class=attr>uses:</span> <span class=string>actions/checkout@v3</span></span><br><span class=line>    </span><br><span class=line>    <span class=bullet>-</span> <span class=attr>name:</span> <span class=string>Setup</span> <span class=string>Node.js</span></span><br><span class=line>      <span class=attr>uses:</span> <span class=string>actions/setup-node@v3</span></span><br><span class=line>      <span class=attr>with:</span></span><br><span class=line>        <span class=attr>node-version:</span> <span class=string>&#x27;18&#x27;</span></span><br><span class=line>        <span class=attr>cache:</span> <span class=string>&#x27;npm&#x27;</span></span><br><span class=line>    </span><br><span class=line>    <span class=bullet>-</span> <span class=attr>name:</span> <span class=string>Install</span> <span class=string>dependencies</span></span><br><span class=line>      <span class=attr>run:</span> <span class=string>|</span></span><br><span class=line><span class=string>        npm ci</span></span><br><span class=line><span class=string>        cd webview &amp;&amp; npm ci</span></span><br><span class=line><span class=string></span>    </span><br><span class=line>    <span class=bullet>-</span> <span class=attr>name:</span> <span class=string>Run</span> <span class=string>tests</span></span><br><span class=line>      <span class=attr>run:</span> <span class=string>npm</span> <span class=string>test</span></span><br><span class=line>    </span><br><span class=line>    <span class=bullet>-</span> <span class=attr>name:</span> <span class=string>Build</span> <span class=string>extension</span></span><br><span class=line>      <span class=attr>run:</span> <span class=string>npm</span> <span class=string>run</span> <span class=string>package</span></span><br><span class=line>    </span><br><span class=line>    <span class=bullet>-</span> <span class=attr>name:</span> <span class=string>Package</span> <span class=string>extension</span></span><br><span class=line>      <span class=attr>run:</span> <span class=string>npx</span> <span class=string>vsce</span> <span class=string>package</span></span><br><span class=line>    </span><br><span class=line>    <span class=bullet>-</span> <span class=attr>name:</span> <span class=string>Publish</span> <span class=string>to</span> <span class=string>marketplace</span></span><br><span class=line>      <span class=attr>run:</span> <span class=string>npx</span> <span class=string>vsce</span> <span class=string>publish</span></span><br><span class=line>      <span class=attr>env:</span></span><br><span class=line>        <span class=attr>VSCE_PAT:</span> <span class=string>$&#123;&#123;</span> <span class=string>secrets.VSCE_PAT</span> <span class=string>&#125;&#125;</span></span><br><span class=line>    </span><br><span class=line>    <span class=bullet>-</span> <span class=attr>name:</span> <span class=string>Create</span> <span class=string>GitHub</span> <span class=string>release</span></span><br><span class=line>      <span class=attr>uses:</span> <span class=string>actions/create-release@v1</span></span><br><span class=line>      <span class=attr>env:</span></span><br><span class=line>        <span class=attr>GITHUB_TOKEN:</span> <span class=string>$&#123;&#123;</span> <span class=string>secrets.GITHUB_TOKEN</span> <span class=string>&#125;&#125;</span></span><br><span class=line>      <span class=attr>with:</span></span><br><span class=line>        <span class=attr>tag_name:</span> <span class=string>$&#123;&#123;</span> <span class=string>github.ref</span> <span class=string>&#125;&#125;</span></span><br><span class=line>        <span class=attr>release_name:</span> <span class=string>Release</span> <span class=string>$&#123;&#123;</span> <span class=string>github.ref</span> <span class=string>&#125;&#125;</span></span><br><span class=line>        <span class=attr>draft:</span> <span class=literal>false</span></span><br><span class=line>        <span class=attr>prerelease:</span> <span class=literal>false</span></span><br></pre></td></tr></table></figure><h3 id=4-2-用户反馈和迭代><a href=#4-2-用户反馈和迭代 class=headerlink title="4.2 用户反馈和迭代"></a>4.2 用户反馈和迭代</h3><h4 id=遥测数据收集><a href=#遥测数据收集 class=headerlink title=遥测数据收集></a>遥测数据收集</h4><figure class="highlight typescript"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br></pre></td><td class=code><pre><span class=line><span class=comment>// src/telemetry/telemetryService.ts</span></span><br><span class=line><span class=keyword>export</span> <span class=keyword>class</span> <span class="title class_">TelemetryService</span> &#123;</span><br><span class=line>    </span><br><span class=line>    <span class="title function_">trackFeatureUsage</span>(<span class=params>feature: <span class=built_in>string</span>, properties?: Record&lt;<span class=built_in>string</span>, <span class=built_in>any</span>&gt;</span>) &#123;</span><br><span class=line>        <span class=comment>// 收集功能使用数据</span></span><br><span class=line>        <span class=keyword>const</span> data = &#123;</span><br><span class=line>            feature,</span><br><span class=line>            <span class=attr>timestamp</span>: <span class=keyword>new</span> <span class="title class_">Date</span>().<span class="title function_">toISOString</span>(),</span><br><span class=line>            <span class=attr>version</span>: <span class="variable language_">this</span>.<span class="title function_">getExtensionVersion</span>(),</span><br><span class=line>            ...properties</span><br><span class=line>        &#125;;</span><br><span class=line>        </span><br><span class=line>        <span class="variable language_">this</span>.<span class="title function_">sendTelemetry</span>(<span class=string>&#x27;feature_usage&#x27;</span>, data);</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class="title function_">trackError</span>(<span class=params>error: <span class=built_in>Error</span>, context?: <span class=built_in>string</span></span>) &#123;</span><br><span class=line>        <span class=comment>// 收集错误信息</span></span><br><span class=line>        <span class=keyword>const</span> data = &#123;</span><br><span class=line>            <span class=attr>error</span>: error.<span class=property>message</span>,</span><br><span class=line>            <span class=attr>stack</span>: error.<span class=property>stack</span>,</span><br><span class=line>            context,</span><br><span class=line>            <span class=attr>timestamp</span>: <span class=keyword>new</span> <span class="title class_">Date</span>().<span class="title function_">toISOString</span>(),</span><br><span class=line>            <span class=attr>version</span>: <span class="variable language_">this</span>.<span class="title function_">getExtensionVersion</span>()</span><br><span class=line>        &#125;;</span><br><span class=line>        </span><br><span class=line>        <span class="variable language_">this</span>.<span class="title function_">sendTelemetry</span>(<span class=string>&#x27;error&#x27;</span>, data);</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class="title function_">trackPerformance</span>(<span class=params>operation: <span class=built_in>string</span>, duration: <span class=built_in>number</span></span>) &#123;</span><br><span class=line>        <span class=comment>// 收集性能数据</span></span><br><span class=line>        <span class=keyword>const</span> data = &#123;</span><br><span class=line>            operation,</span><br><span class=line>            duration,</span><br><span class=line>            <span class=attr>timestamp</span>: <span class=keyword>new</span> <span class="title class_">Date</span>().<span class="title function_">toISOString</span>(),</span><br><span class=line>            <span class=attr>version</span>: <span class="variable language_">this</span>.<span class="title function_">getExtensionVersion</span>()</span><br><span class=line>        &#125;;</span><br><span class=line>        </span><br><span class=line>        <span class="variable language_">this</span>.<span class="title function_">sendTelemetry</span>(<span class=string>&#x27;performance&#x27;</span>, data);</span><br><span class=line>    &#125;</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><hr><h2 id=📚-本阶段总结><a href=#📚-本阶段总结 class=headerlink title="📚 本阶段总结"></a>📚 本阶段总结</h2><p>通过这5个完整的实战项目，你已经掌握了：</p><p>✅ <strong>AI集成开发</strong>：OpenAI API集成、智能代码生成、自然语言处理<br>✅ <strong>全栈开发能力</strong>：前后端分离架构、数据库操作、API设计<br>✅ <strong>数据可视化</strong>：D3.js图表库、实时数据处理、交互式界面<br>✅ <strong>Language Server</strong>：LSP协议实现、代码分析、诊断服务<br>✅ <strong>DevOps实践</strong>：自动化测试、持续集成、发布流程<br>✅ <strong>产品思维</strong>：用户体验设计、需求分析、市场定位</p><h3 id=核心技能回顾><a href=#核心技能回顾 class=headerlink title=核心技能回顾></a>核心技能回顾</h3><ul><li><strong>架构设计</strong>：微服务架构、事件驱动、插件化设计</li><li><strong>技术栈整合</strong>：TypeScript + React&#x2F;Vue + Node.js + AI</li><li><strong>性能优化</strong>：代码分割、懒加载、缓存策略</li><li><strong>用户体验</strong>：响应式设计、无障碍访问、国际化</li><li><strong>质量保证</strong>：单元测试、集成测试、代码质量</li></ul><hr><h2 id=🎓-毕业项目挑战><a href=#🎓-毕业项目挑战 class=headerlink title="🎓 毕业项目挑战"></a>🎓 毕业项目挑战</h2><h3 id=挑战任务><a href=#挑战任务 class=headerlink title=挑战任务></a>挑战任务</h3><p>选择以下任一方向，完成一个创新性的VS Code扩展：</p><ol><li><strong>AI驱动的重构助手</strong>：智能识别代码问题并提供重构建议</li><li><strong>实时协作编程平台</strong>：类似Live Share的协作功能增强</li><li><strong>智能项目脚手架</strong>：基于项目类型自动生成最佳实践模板</li><li><strong>代码安全扫描器</strong>：集成多种安全扫描工具的统一界面</li><li><strong>开发者效率仪表板</strong>：个人编程习惯分析和效率提升建议</li></ol><h3 id=评估标准><a href=#评估标准 class=headerlink title=评估标准></a>评估标准</h3><ul><li><strong>创新性</strong>：解决实际问题的独特方案</li><li><strong>技术深度</strong>：复杂技术的正确应用</li><li><strong>用户体验</strong>：直观易用的界面设计</li><li><strong>代码质量</strong>：良好的架构和代码规范</li><li><strong>完整性</strong>：从需求到发布的完整流程</li></ul><hr><p><strong>相关资源</strong></p><ul><li><a target=_blank rel=noopener href=https://code.visualstudio.com/api/extension-guides/ai>AI扩展开发最佳实践</a></li><li><a target=_blank rel=noopener href=https://code.visualstudio.com/api/extension-guides/webview>WebView开发指南</a></li><li><a target=_blank rel=noopener href=https://microsoft.github.io/language-server-protocol/ >Language Server协议</a></li><li><a target=_blank rel=noopener href=https://code.visualstudio.com/api/working-with-extensions/publishing-extension>扩展市场发布指南</a></li></ul><p>恭喜你完成了VS Code扩展开发的完整学习旅程！现在你已经具备了独立开发专业级扩展的所有技能。继续创新，构建改变开发者工作方式的优秀工具吧！</p></article><div class=post-copyright><div class=post-copyright__author><span class=post-copyright-meta><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class=post-copyright-info><a href=https://alunworker.com>AlunWorker</a></span></div><div class=post-copyright__type><span class=post-copyright-meta><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class=post-copyright-info><a href=https://alunworker.com/vscode/extension/08-practical-projects/ >https://alunworker.com/vscode/extension/08-practical-projects/</a></span></div><div class=post-copyright__notice><span class=post-copyright-meta><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class=post-copyright-info>本博客所有文章除特别声明外，均采用 <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank>CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href=https://alunworker.com target=_blank>AlunWorker</a>！</span></div></div><div class=tag_share><div class=post-meta__tag-list><a class=post-meta__tags href=/tags/VSCode/ >VSCode</a><a class=post-meta__tags href=/tags/%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/ >插件开发</a><a class=post-meta__tags href=/tags/AI%E9%9B%86%E6%88%90/ >AI集成</a><a class=post-meta__tags href=/tags/%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/ >实战项目</a><a class=post-meta__tags href=/tags/%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86/ >项目管理</a><a class=post-meta__tags href=/tags/%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/ >全栈开发</a></div><div class=post_share><div class=social-share data-image=/images/icon.webp data-sites=facebook,twitter,wechat,weibo,qq></div><link rel=stylesheet href=https://lib.baomitu.com/social-share.js/1.0.16/css/share.min.css media=print onload='this.media="all"'><script src=https://lib.baomitu.com/social-share.js/1.0.16/js/social-share.min.js defer></script></div></div><nav class=pagination-post id=pagination><div class="prev-post pull-left"><a href=/vscode/extension/04-ux-design/ title="VS Code 扩展开发阶段四：用户体验设计 - UX原则与交互模式"><div class=cover style=background:var(--default-bg-color)></div><div class=pagination-info><div class=label>上一篇</div><div class=prev_info>VS Code 扩展开发阶段四：用户体验设计 - UX原则与交互模式</div></div></a></div><div class="next-post pull-right"><a href=/dots/basic/learning-plan/ title="Unity DOTS 学习路径：从基础到实战"><div class=cover style=background:var(--default-bg-color)></div><div class=pagination-info><div class=label>下一篇</div><div class=next_info>Unity DOTS 学习路径：从基础到实战</div></div></a></div></nav><div class=relatedPosts><div class=headline><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class=relatedPosts-list><div><a href=/vscode/extension/03-advanced-guides/ title="VS Code 扩展开发阶段三：扩展指南专题 - AI集成、WebView与自定义编辑器"><div class=cover style=background:var(--default-bg-color)></div><div class="content is-center"><div class=date><i class="far fa-calendar-alt fa-fw"></i> 2025-09-20</div><div class=title>VS Code 扩展开发阶段三：扩展指南专题 - AI集成、WebView与自定义编辑器</div></div></a></div><div><a href=/vscode/extension/01-foundation/ title="VS Code 扩展开发阶段一：基础入门 - 环境搭建与核心概念"><div class=cover style=background:var(--default-bg-color)></div><div class="content is-center"><div class=date><i class="far fa-calendar-alt fa-fw"></i> 2025-09-20</div><div class=title>VS Code 扩展开发阶段一：基础入门 - 环境搭建与核心概念</div></div></a></div><div><a href=/vscode/extension/02-core-capabilities/ title="VS Code 扩展开发阶段二：核心能力开发 - 主题、工作台与编辑器功能"><div class=cover style=background:var(--default-bg-color)></div><div class="content is-center"><div class=date><i class="far fa-calendar-alt fa-fw"></i> 2025-09-20</div><div class=title>VS Code 扩展开发阶段二：核心能力开发 - 主题、工作台与编辑器功能</div></div></a></div><div><a href=/vscode/extension/06-advanced-topics/ title="VS Code 扩展开发阶段六：高级主题 - 调试器、任务系统与SCM集成"><div class=cover style=background:var(--default-bg-color)></div><div class="content is-center"><div class=date><i class="far fa-calendar-alt fa-fw"></i> 2025-09-20</div><div class=title>VS Code 扩展开发阶段六：高级主题 - 调试器、任务系统与SCM集成</div></div></a></div><div><a href=/vscode/extension/07-testing-publishing/ title="VS Code 扩展开发阶段七：测试与发布 - 质量保证与市场发布"><div class=cover style=background:var(--default-bg-color)></div><div class="content is-center"><div class=date><i class="far fa-calendar-alt fa-fw"></i> 2025-09-20</div><div class=title>VS Code 扩展开发阶段七：测试与发布 - 质量保证与市场发布</div></div></a></div><div><a href=/vscode/extension/learning-roadmap/ title="VS Code 扩展开发完整学习大纲：基于官方API文档"><div class=cover style=background:var(--default-bg-color)></div><div class="content is-center"><div class=date><i class="far fa-calendar-alt fa-fw"></i> 2025-09-20</div><div class=title>VS Code 扩展开发完整学习大纲：基于官方API文档</div></div></a></div></div></div></div><div class=aside-content id=aside-content><div class="card-widget card-info"><div class=is-center><div class=avatar-img><img src=/images/loading.gif data-original=/images/icon.webp onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt=avatar></div><div class=author-info__name>AlunWorker</div><div class=author-info__description>越努力越幸运!</div></div><div class="card-info-data site-data is-center"><a href=/archives/ ><div class=headline>文章</div><div class=length-num>82</div></a><a href=/tags/ ><div class=headline>标签</div><div class=length-num>174</div></a><a href=/categories/ ><div class=headline>分类</div><div class=length-num>14</div></a></div><a id=card-info-btn target=_blank rel=noopener href=https://github.com/xxxxxx><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class=sticky_layout><div class=card-widget id=card-toc><div class=item-headline><i class="fas fa-stream"></i><span>目录</span><span class=toc-percentage></span></div><div class=toc-content><ol class=toc><li class="toc-item toc-level-2"><a class=toc-link href=#%F0%9F%8E%AF-%E5%AD%A6%E4%B9%A0%E7%9B%AE%E6%A0%87><span class=toc-number>1.</span> <span class=toc-text>🎯 学习目标</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%F0%9F%8F%97%EF%B8%8F-%E9%A1%B9%E7%9B%AE%E6%A6%82%E8%A7%88%E4%B8%8E%E6%8A%80%E6%9C%AF%E6%A0%88><span class=toc-number>2.</span> <span class=toc-text>🏗️ 项目概览与技术栈</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E9%A1%B9%E7%9B%AE%E9%80%89%E6%8B%A9%E7%AD%96%E7%95%A5><span class=toc-number>2.1.</span> <span class=toc-text>项目选择策略</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E9%80%9A%E7%94%A8%E6%8A%80%E6%9C%AF%E6%A0%88><span class=toc-number>2.2.</span> <span class=toc-text>通用技术栈</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%F0%9F%A4%96-%E9%A1%B9%E7%9B%AE%E4%B8%80%EF%BC%9AAI-Code-Assistant%EF%BC%88AI%E4%BB%A3%E7%A0%81%E5%8A%A9%E6%89%8B%EF%BC%89><span class=toc-number>3.</span> <span class=toc-text>🤖 项目一：AI Code Assistant（AI代码助手）</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D><span class=toc-number>3.1.</span> <span class=toc-text>项目介绍</span></a><ol class=toc-child><li class="toc-item toc-level-4"><a class=toc-link href=#%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD><span class=toc-number>3.1.1.</span> <span class=toc-text>核心功能</span></a></li></ol></li><li class="toc-item toc-level-3"><a class=toc-link href=#1-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E4%B8%8E%E8%AE%BE%E8%AE%A1><span class=toc-number>3.2.</span> <span class=toc-text>1.1 需求分析与设计</span></a><ol class=toc-child><li class="toc-item toc-level-4"><a class=toc-link href=#%E7%94%A8%E6%88%B7%E6%95%85%E4%BA%8B><span class=toc-number>3.2.1.</span> <span class=toc-text>用户故事</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1><span class=toc-number>3.2.2.</span> <span class=toc-text>架构设计</span></a></li></ol></li><li class="toc-item toc-level-3"><a class=toc-link href=#1-2-%E9%A1%B9%E7%9B%AE%E5%AE%9E%E7%8E%B0><span class=toc-number>3.3.</span> <span class=toc-text>1.2 项目实现</span></a><ol class=toc-child><li class="toc-item toc-level-4"><a class=toc-link href=#%E6%89%A9%E5%B1%95%E6%B8%85%E5%8D%95%E9%85%8D%E7%BD%AE><span class=toc-number>3.3.1.</span> <span class=toc-text>扩展清单配置</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#%E6%A0%B8%E5%BF%83%E6%89%A9%E5%B1%95%E9%80%BB%E8%BE%91><span class=toc-number>3.3.2.</span> <span class=toc-text>核心扩展逻辑</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#AI%E6%9C%8D%E5%8A%A1%E5%AE%9E%E7%8E%B0><span class=toc-number>3.3.3.</span> <span class=toc-text>AI服务实现</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E6%9C%8D%E5%8A%A1><span class=toc-number>3.3.4.</span> <span class=toc-text>代码分析服务</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#%E5%91%BD%E4%BB%A4%E5%A4%84%E7%90%86%E5%99%A8><span class=toc-number>3.3.5.</span> <span class=toc-text>命令处理器</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#WebView%E8%81%8A%E5%A4%A9%E7%95%8C%E9%9D%A2><span class=toc-number>3.3.6.</span> <span class=toc-text>WebView聊天界面</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#WebView%E5%89%8D%E7%AB%AF%E8%84%9A%E6%9C%AC><span class=toc-number>3.3.7.</span> <span class=toc-text>WebView前端脚本</span></a></li></ol></li><li class="toc-item toc-level-3"><a class=toc-link href=#1-3-%E6%B5%8B%E8%AF%95%E5%92%8C%E4%BC%98%E5%8C%96><span class=toc-number>3.4.</span> <span class=toc-text>1.3 测试和优化</span></a><ol class=toc-child><li class="toc-item toc-level-4"><a class=toc-link href=#%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95><span class=toc-number>3.4.1.</span> <span class=toc-text>单元测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class=toc-link href=#1-4-%E5%8F%91%E5%B8%83%E5%87%86%E5%A4%87><span class=toc-number>3.5.</span> <span class=toc-text>1.4 发布准备</span></a><ol class=toc-child><li class="toc-item toc-level-4"><a class=toc-link href=#%E6%9E%84%E5%BB%BA%E8%84%9A%E6%9C%AC><span class=toc-number>3.5.1.</span> <span class=toc-text>构建脚本</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%F0%9F%9B%A0%EF%B8%8F-%E9%A1%B9%E7%9B%AE%E4%BA%8C%EF%BC%9AAPI-Testing-Tool%EF%BC%88API%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7%EF%BC%89><span class=toc-number>4.</span> <span class=toc-text>🛠️ 项目二：API Testing Tool（API测试工具）</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D-1><span class=toc-number>4.1.</span> <span class=toc-text>项目介绍</span></a><ol class=toc-child><li class="toc-item toc-level-4"><a class=toc-link href=#%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD-1><span class=toc-number>4.1.1.</span> <span class=toc-text>核心功能</span></a></li></ol></li><li class="toc-item toc-level-3"><a class=toc-link href=#2-1-%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%84><span class=toc-number>4.2.</span> <span class=toc-text>2.1 技术架构</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#2-2-%E6%A0%B8%E5%BF%83%E5%AE%9E%E7%8E%B0><span class=toc-number>4.3.</span> <span class=toc-text>2.2 核心实现</span></a><ol class=toc-child><li class="toc-item toc-level-4"><a class=toc-link href=#HTTP%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%9C%8D%E5%8A%A1><span class=toc-number>4.3.1.</span> <span class=toc-text>HTTP客户端服务</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%F0%9F%93%8A-%E9%A1%B9%E7%9B%AE%E4%B8%89%EF%BC%9AData-Visualizer%EF%BC%88%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E5%B7%A5%E5%85%B7%EF%BC%89><span class=toc-number>5.</span> <span class=toc-text>📊 项目三：Data Visualizer（数据可视化工具）</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D-2><span class=toc-number>5.1.</span> <span class=toc-text>项目介绍</span></a><ol class=toc-child><li class="toc-item toc-level-4"><a class=toc-link href=#%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD-2><span class=toc-number>5.1.1.</span> <span class=toc-text>核心功能</span></a></li></ol></li><li class="toc-item toc-level-3"><a class=toc-link href=#3-1-%E6%8A%80%E6%9C%AF%E5%AE%9E%E7%8E%B0><span class=toc-number>5.2.</span> <span class=toc-text>3.1 技术实现</span></a><ol class=toc-child><li class="toc-item toc-level-4"><a class=toc-link href=#%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%9C%8D%E5%8A%A1><span class=toc-number>5.2.1.</span> <span class=toc-text>数据处理服务</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%F0%9F%93%8B-%E9%A1%B9%E7%9B%AE%E5%9B%9B%EF%BC%9AProject-Manager%EF%BC%88%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7%EF%BC%89><span class=toc-number>6.</span> <span class=toc-text>📋 项目四：Project Manager（项目管理工具）</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D-3><span class=toc-number>6.1.</span> <span class=toc-text>项目介绍</span></a><ol class=toc-child><li class="toc-item toc-level-4"><a class=toc-link href=#%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD-3><span class=toc-number>6.1.1.</span> <span class=toc-text>核心功能</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%F0%9F%94%8D-%E9%A1%B9%E7%9B%AE%E4%BA%94%EF%BC%9ACode-Quality-Monitor%EF%BC%88%E4%BB%A3%E7%A0%81%E8%B4%A8%E9%87%8F%E7%9B%91%E6%8E%A7%EF%BC%89><span class=toc-number>7.</span> <span class=toc-text>🔍 项目五：Code Quality Monitor（代码质量监控）</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D-4><span class=toc-number>7.1.</span> <span class=toc-text>项目介绍</span></a><ol class=toc-child><li class="toc-item toc-level-4"><a class=toc-link href=#%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD-4><span class=toc-number>7.1.1.</span> <span class=toc-text>核心功能</span></a></li></ol></li><li class="toc-item toc-level-3"><a class=toc-link href=#5-1-Language-Server%E5%AE%9E%E7%8E%B0><span class=toc-number>7.2.</span> <span class=toc-text>5.1 Language Server实现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%F0%9F%9A%80-%E7%AC%AC%E5%9B%9B%E9%83%A8%E5%88%86%EF%BC%9A%E9%83%A8%E7%BD%B2%E5%92%8C%E6%8E%A8%E5%B9%BF><span class=toc-number>8.</span> <span class=toc-text>🚀 第四部分：部署和推广</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#4-1-CI-CD%E6%B5%81%E7%A8%8B><span class=toc-number>8.1.</span> <span class=toc-text>4.1 CI&#x2F;CD流程</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#4-2-%E7%94%A8%E6%88%B7%E5%8F%8D%E9%A6%88%E5%92%8C%E8%BF%AD%E4%BB%A3><span class=toc-number>8.2.</span> <span class=toc-text>4.2 用户反馈和迭代</span></a><ol class=toc-child><li class="toc-item toc-level-4"><a class=toc-link href=#%E9%81%A5%E6%B5%8B%E6%95%B0%E6%8D%AE%E6%94%B6%E9%9B%86><span class=toc-number>8.2.1.</span> <span class=toc-text>遥测数据收集</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%F0%9F%93%9A-%E6%9C%AC%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93><span class=toc-number>9.</span> <span class=toc-text>📚 本阶段总结</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%A0%B8%E5%BF%83%E6%8A%80%E8%83%BD%E5%9B%9E%E9%A1%BE><span class=toc-number>9.1.</span> <span class=toc-text>核心技能回顾</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%F0%9F%8E%93-%E6%AF%95%E4%B8%9A%E9%A1%B9%E7%9B%AE%E6%8C%91%E6%88%98><span class=toc-number>10.</span> <span class=toc-text>🎓 毕业项目挑战</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%8C%91%E6%88%98%E4%BB%BB%E5%8A%A1><span class=toc-number>10.1.</span> <span class=toc-text>挑战任务</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E8%AF%84%E4%BC%B0%E6%A0%87%E5%87%86><span class=toc-number>10.2.</span> <span class=toc-text>评估标准</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class=item-headline><i class="fas fa-history"></i><span>最新文章</span></div><div class=aside-list><div class="aside-list-item no-cover"><div class=content><a class=title href=/vscode/extension/01-foundation/ title="VS Code 扩展开发阶段一：基础入门 - 环境搭建与核心概念">VS Code 扩展开发阶段一：基础入门 - 环境搭建与核心概念</a><time datetime=2025-09-19T16:00:00.000Z title="发表于 2025-09-20 00:00:00">2025-09-20</time></div></div><div class="aside-list-item no-cover"><div class=content><a class=title href=/vscode/extension/02-core-capabilities/ title="VS Code 扩展开发阶段二：核心能力开发 - 主题、工作台与编辑器功能">VS Code 扩展开发阶段二：核心能力开发 - 主题、工作台与编辑器功能</a><time datetime=2025-09-19T16:00:00.000Z title="发表于 2025-09-20 00:00:00">2025-09-20</time></div></div><div class="aside-list-item no-cover"><div class=content><a class=title href=/vscode/extension/03-advanced-guides/ title="VS Code 扩展开发阶段三：扩展指南专题 - AI集成、WebView与自定义编辑器">VS Code 扩展开发阶段三：扩展指南专题 - AI集成、WebView与自定义编辑器</a><time datetime=2025-09-19T16:00:00.000Z title="发表于 2025-09-20 00:00:00">2025-09-20</time></div></div><div class="aside-list-item no-cover"><div class=content><a class=title href=/vscode/extension/06-advanced-topics/ title="VS Code 扩展开发阶段六：高级主题 - 调试器、任务系统与SCM集成">VS Code 扩展开发阶段六：高级主题 - 调试器、任务系统与SCM集成</a><time datetime=2025-09-19T16:00:00.000Z title="发表于 2025-09-20 00:00:00">2025-09-20</time></div></div><div class="aside-list-item no-cover"><div class=content><a class=title href=/vscode/extension/07-testing-publishing/ title="VS Code 扩展开发阶段七：测试与发布 - 质量保证与市场发布">VS Code 扩展开发阶段七：测试与发布 - 质量保证与市场发布</a><time datetime=2025-09-19T16:00:00.000Z title="发表于 2025-09-20 00:00:00">2025-09-20</time></div></div></div></div></div></div></main><footer id=footer style=background:#000><div id=footer-wrap><div class=copyright>&copy;2020 - 2025 By AlunWorker</div><div class=framework-info><span>框架 </span><a target=_blank rel=noopener href=https://hexo.io>Hexo</a><span class=footer-separator>|</span><span>主题 </span><a target=_blank rel=noopener href=https://github.com/jerryc127/hexo-theme-butterfly>Butterfly</a></div></div></footer></div><div id=rightside><div id=rightside-config-hide><button id=readmode type=button title=阅读模式><i class="fas fa-book-open"></i></button><button id=darkmode type=button title=浅色和深色模式转换><i class="fas fa-adjust"></i></button><button id=hide-aside-btn type=button title=单栏和双栏切换><i class="fas fa-arrows-alt-h"></i></button></div><div id=rightside-config-show><button id=rightside-config type=button title=设置><i class="fas fa-cog fa-spin"></i></button><button class=close id=mobile-toc-button type=button title=目录><i class="fas fa-list-ul"></i></button><button id=go-up type=button title=回到顶部><span class=scroll-percent></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src=/ ></script><div class=js-pjax></div><script async data-pjax src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><div id=local-search><div class=search-dialog><nav class=search-nav><span class=search-dialog-title>搜索</span><span id=loading-status></span><button class=search-close-button><i class="fas fa-times"></i></button></nav><div class=is-center id=loading-database><i class="fas fa-spinner fa-pulse"></i><span> 数据库加载中</span></div><div class=search-wrap><div id=local-search-input><div class=local-search-box><input class=local-search-box--input placeholder=搜索文章 type=text></div></div><hr><div id=local-search-results></div><div id=local-search-stats-wrap></div></div></div><div id=search-mask></div><script src="/js/search/local-search.js?v=4.13.0"></script></div></div><style>[bg-lazy]{background-image:none!important;background-color:#eee!important}</style><script>window.imageLazyLoadSetting={isSPA:!1,preloadRatio:1,processImages:null}</script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})})</script><script>!function(r){r.imageLazyLoadSetting.processImages=t;var e=r.imageLazyLoadSetting.isSPA,n=r.imageLazyLoadSetting.preloadRatio||1,c=a();function a(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(){e&&(c=a());for(var t,o=0;o<c.length;o++)0<=(t=(t=c[o]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(r.innerHeight*n||document.documentElement.clientHeight*n)&&function(){var t,e,n,a,i=c[o];e=function(){c=c.filter(function(t){return i!==t}),r.imageLazyLoadSetting.onImageLoaded&&r.imageLazyLoadSetting.onImageLoaded(i)},(t=i).hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),e()):(n=new Image,a=t.getAttribute("data-original"),n.onload=function(){t.src=a,t.removeAttribute("data-original"),e()},t.src!==a&&(n.src=a))}()}function i(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",i),r.addEventListener("resize",i),r.addEventListener("orientationchange",i)}(this)</script></body></html>