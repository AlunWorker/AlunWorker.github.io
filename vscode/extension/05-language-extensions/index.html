<!doctype html><html lang=zh-CN data-theme=dark><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><title>VS Code æ‰©å±•å¼€å‘é˜¶æ®µäº”ï¼šè¯­è¨€æ‰©å±•å¼€å‘ - è¯­æ³•é«˜äº®ã€æ™ºèƒ½æ„ŸçŸ¥ä¸LSP | AlunWorker</title><meta name=author content=AlunWorker><meta name=copyright content=AlunWorker><meta name=format-detection content="telephone=no"><meta name=theme-color content=#0d0d0d><meta name=description content="VS Codeæ‰©å±•å¼€å‘ç¬¬äº”é˜¶æ®µï¼šæ·±å…¥è¯­è¨€æ‰©å±•å¼€å‘æŠ€æœ¯ï¼ŒåŒ…æ‹¬è¯­æ³•é«˜äº®ã€ä»£ç è¡¥å…¨ã€Language Server Protocolå®ç°å’Œæ™ºèƒ½ç¼–ç¨‹åŠŸèƒ½"><meta property=og:type content=article><meta property=og:title content="VS Code æ‰©å±•å¼€å‘é˜¶æ®µäº”ï¼šè¯­è¨€æ‰©å±•å¼€å‘ - è¯­æ³•é«˜äº®ã€æ™ºèƒ½æ„ŸçŸ¥ä¸LSP"><meta property=og:url content=https://alunworker.com/vscode/extension/05-language-extensions/index.html><meta property=og:site_name content=AlunWorker><meta property=og:description content="VS Codeæ‰©å±•å¼€å‘ç¬¬äº”é˜¶æ®µï¼šæ·±å…¥è¯­è¨€æ‰©å±•å¼€å‘æŠ€æœ¯ï¼ŒåŒ…æ‹¬è¯­æ³•é«˜äº®ã€ä»£ç è¡¥å…¨ã€Language Server Protocolå®ç°å’Œæ™ºèƒ½ç¼–ç¨‹åŠŸèƒ½"><meta property=og:locale content=zh_CN><meta property=og:image content=https://alunworker.com/images/icon.webp><meta property=article:published_time content=2025-09-19T16:00:00.000Z><meta property=article:modified_time content=2025-09-20T11:01:46.983Z><meta property=article:author content=AlunWorker><meta property=article:tag content=VSCode><meta property=article:tag content=æ’ä»¶å¼€å‘><meta property=article:tag content=è¯­è¨€æ‰©å±•><meta property=article:tag content="Language Server"><meta property=article:tag content=è¯­æ³•é«˜äº®><meta property=article:tag content=æ™ºèƒ½æ„ŸçŸ¥><meta name=twitter:card content=summary><meta name=twitter:image content=https://alunworker.com/images/icon.webp><link rel="shortcut icon" href=/images/favicon.webp><link rel=canonical href=https://alunworker.com/vscode/extension/05-language-extensions/index.html><link rel=preconnect><link rel=preconnect href=//busuanzi.ibruce.info><link rel=stylesheet href="/css/index.css?v=4.13.0"><link rel=stylesheet href=https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/6.0.0/css/all.min.css><link rel=stylesheet href=/ media=print onload='this.media="all"'><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}","hits_stats":"å…±æ‰¾åˆ° ${hits} ç¯‡æ–‡ç« "}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: '/',
    buttonText: 'åŠ è½½æ›´å¤š'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id=config-diff>var GLOBAL_CONFIG_SITE={title:"VS Code æ‰©å±•å¼€å‘é˜¶æ®µäº”ï¼šè¯­è¨€æ‰©å±•å¼€å‘ - è¯­æ³•é«˜äº®ã€æ™ºèƒ½æ„ŸçŸ¥ä¸LSP",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2025-09-20 19:01:46"}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name=generator content="Hexo 7.1.1"></head><body><div id=loading-box><div class=loading-left-bg></div><div class=loading-right-bg></div><div class=spinner-box><div class=configure-border-1><div class=configure-core></div></div><div class=configure-border-2><div class=configure-core></div></div><div class=loading-word>åŠ è½½ä¸­...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load',() => { preloader.endLoading() })

  if (false) {
    document.addEventListener('pjax:send', () => { preloader.initLoading() })
    document.addEventListener('pjax:complete', () => { preloader.endLoading() })
  }
})()</script><div id=sidebar><div id=menu-mask></div><div id=sidebar-menus><div class="avatar-img is-center"><img src=/images/loading.gif data-original=/images/icon.webp onerror='onerror=null,src="/img/friend_404.gif"' alt=avatar></div><div class="sidebar-site-data site-data is-center"><a href=/archives/ ><div class=headline>æ–‡ç« </div><div class=length-num>82</div></a><a href=/tags/ ><div class=headline>æ ‡ç­¾</div><div class=length-num>174</div></a><a href=/categories/ ><div class=headline>åˆ†ç±»</div><div class=length-num>14</div></a></div><hr class=custom-hr><div class=menus_items><div class=menus_item><a class=site-page href=/ ><i class="fa-fw fas fa-home"></i><span> ä¸»é¡µ</span></a></div><div class=menus_item><a class=site-page href=/archives/ ><i class="fa-fw fas fa-archive"></i><span> æ—¶é—´è½´</span></a></div><div class=menus_item><a class=site-page href=/tags/ ><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class=menus_item><a class=site-page href=/categories/ ><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class=menus_item><a class=site-page href=/about/ ><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></div></div></div></div><div class=post id=body-wrap><header class=post-bg id=page-header style=background-image:url(/images/blog_bg.webp)><nav id=nav><span id=blog-info><a href=/ title=AlunWorker><span class=site-name>AlunWorker</span></a></span><div id=menus><div id=search-button><a class="site-page social-icon search" href=javascript:void(0);><i class="fas fa-search fa-fw"></i><span> æœç´¢</span></a></div><div class=menus_items><div class=menus_item><a class=site-page href=/ ><i class="fa-fw fas fa-home"></i><span> ä¸»é¡µ</span></a></div><div class=menus_item><a class=site-page href=/archives/ ><i class="fa-fw fas fa-archive"></i><span> æ—¶é—´è½´</span></a></div><div class=menus_item><a class=site-page href=/tags/ ><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class=menus_item><a class=site-page href=/categories/ ><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class=menus_item><a class=site-page href=/about/ ><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></div></div><div id=toggle-menu><a class=site-page href=javascript:void(0);><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id=post-info><h1 class=post-title>VS Code æ‰©å±•å¼€å‘é˜¶æ®µäº”ï¼šè¯­è¨€æ‰©å±•å¼€å‘ - è¯­æ³•é«˜äº®ã€æ™ºèƒ½æ„ŸçŸ¥ä¸LSP</h1><div id=post-meta><div class=meta-firstline><span class=post-meta-date><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class=post-meta-label>å‘è¡¨äº</span><time class=post-meta-date-created datetime=2025-09-19T16:00:00.000Z title="å‘è¡¨äº 2025-09-20 00:00:00">2025-09-20</time><span class=post-meta-separator>|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class=post-meta-label>æ›´æ–°äº</span><time class=post-meta-date-updated datetime=2025-09-20T11:01:46.983Z title="æ›´æ–°äº 2025-09-20 19:01:46">2025-09-20</time></span><span class=post-meta-categories><span class=post-meta-separator>|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class=post-meta-categories href=/categories/VSCode/ >VSCode</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class=post-meta-categories href=/categories/VSCode/%E6%89%A9%E5%B1%95%E5%BC%80%E5%8F%91/ >æ‰©å±•å¼€å‘</a></span></div><div class=meta-secondline><span class=post-meta-separator>|</span><span class=post-meta-wordcount><i class="far fa-file-word fa-fw post-meta-icon"></i><span class=post-meta-label>å­—æ•°æ€»è®¡:</span><span class=word-count>9.6k</span><span class=post-meta-separator>|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class=post-meta-label>é˜…è¯»æ—¶é•¿:</span><span>52åˆ†é’Ÿ</span></span><span class=post-meta-separator>|</span><span class=post-meta-pv-cv id="" data-flag-title="VS Code æ‰©å±•å¼€å‘é˜¶æ®µäº”ï¼šè¯­è¨€æ‰©å±•å¼€å‘ - è¯­æ³•é«˜äº®ã€æ™ºèƒ½æ„ŸçŸ¥ä¸LSP"><i class="far fa-eye fa-fw post-meta-icon"></i><span class=post-meta-label>é˜…è¯»é‡:</span><span id=busuanzi_value_page_pv><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class=layout id=content-inner><div id=post><article class=post-content id=article-container><blockquote><p>è¯­è¨€æ‰©å±•æ˜¯VS Codeç”Ÿæ€ç³»ç»Ÿçš„æ ¸å¿ƒï¼Œä¸ºä¸åŒç¼–ç¨‹è¯­è¨€æä¾›æ™ºèƒ½ç¼–è¾‘æ”¯æŒã€‚æœ¬é˜¶æ®µå°†æ·±å…¥æ¢è®¨å¦‚ä½•å¼€å‘å®Œæ•´çš„è¯­è¨€æ”¯æŒæ‰©å±•ï¼Œä»åŸºç¡€çš„è¯­æ³•é«˜äº®åˆ°é«˜çº§çš„Language Server Protocolå®ç°ï¼Œå¸®ä½ æ„å»ºä¸“ä¸šçº§çš„ç¼–ç¨‹è¯­è¨€å·¥å…·ã€‚</p></blockquote><hr><h2 id=ğŸ¯-å­¦ä¹ ç›®æ ‡><a href=#ğŸ¯-å­¦ä¹ ç›®æ ‡ class=headerlink title="ğŸ¯ å­¦ä¹ ç›®æ ‡"></a>ğŸ¯ å­¦ä¹ ç›®æ ‡</h2><p>å®Œæˆæœ¬é˜¶æ®µå­¦ä¹ åï¼Œä½ å°†èƒ½å¤Ÿï¼š</p><ul><li>ğŸ“ <strong>è¯­æ³•é«˜äº®å¼€å‘</strong>ï¼šTextMateè¯­æ³•ã€è¯­ä¹‰é«˜äº®ã€åµŒå…¥è¯­è¨€æ”¯æŒ</li><li>ğŸ§© <strong>ä»£ç ç‰‡æ®µç³»ç»Ÿ</strong>ï¼šåŠ¨æ€ç‰‡æ®µã€æ¡ä»¶ç‰‡æ®µã€æ™ºèƒ½è§¦å‘</li><li>âš™ï¸ <strong>è¯­è¨€åŸºç¡€é…ç½®</strong>ï¼šæ–‡ä»¶å…³è”ã€æ³¨é‡Šæ ·å¼ã€æ‹¬å·åŒ¹é…</li><li>ğŸ” <strong>æ™ºèƒ½æ„ŸçŸ¥åŠŸèƒ½</strong>ï¼šä»£ç è¡¥å…¨ã€å‚æ•°æç¤ºã€æ‚¬åœä¿¡æ¯ã€é”™è¯¯è¯Šæ–­</li><li>ğŸŒ <strong>Language Server Protocol</strong>ï¼šæ¶æ„è®¾è®¡ã€å®¢æˆ·ç«¯&#x2F;æœåŠ¡å™¨å¼€å‘</li><li>ğŸ› ï¸ <strong>ä»£ç æ“ä½œ</strong>ï¼šæ ¼å¼åŒ–ã€é‡æ„ã€å¿«é€Ÿä¿®å¤ã€ä»£ç å¯¼èˆª</li></ul><p><strong>é¢„è®¡å­¦ä¹ æ—¶é—´ï¼š2-3å‘¨ï¼ˆæ¯å¤©1-2å°æ—¶ï¼‰</strong></p><hr><h2 id=ğŸ“-ç¬¬ä¸€éƒ¨åˆ†ï¼šè¯­æ³•é«˜äº®ä¸åŸºç¡€é…ç½®><a href=#ğŸ“-ç¬¬ä¸€éƒ¨åˆ†ï¼šè¯­æ³•é«˜äº®ä¸åŸºç¡€é…ç½® class=headerlink title="ğŸ“ ç¬¬ä¸€éƒ¨åˆ†ï¼šè¯­æ³•é«˜äº®ä¸åŸºç¡€é…ç½®"></a>ğŸ“ ç¬¬ä¸€éƒ¨åˆ†ï¼šè¯­æ³•é«˜äº®ä¸åŸºç¡€é…ç½®</h2><h3 id=1-1-TextMateè¯­æ³•å¼€å‘><a href=#1-1-TextMateè¯­æ³•å¼€å‘ class=headerlink title="1.1 TextMateè¯­æ³•å¼€å‘"></a>1.1 TextMateè¯­æ³•å¼€å‘</h3><h4 id=è¯­æ³•æ–‡ä»¶ç»“æ„><a href=#è¯­æ³•æ–‡ä»¶ç»“æ„ class=headerlink title=è¯­æ³•æ–‡ä»¶ç»“æ„></a>è¯­æ³•æ–‡ä»¶ç»“æ„</h4><figure class="highlight json"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br><span class=line>90</span><br><span class=line>91</span><br><span class=line>92</span><br><span class=line>93</span><br><span class=line>94</span><br><span class=line>95</span><br><span class=line>96</span><br><span class=line>97</span><br><span class=line>98</span><br><span class=line>99</span><br><span class=line>100</span><br><span class=line>101</span><br><span class=line>102</span><br><span class=line>103</span><br><span class=line>104</span><br><span class=line>105</span><br><span class=line>106</span><br><span class=line>107</span><br><span class=line>108</span><br><span class=line>109</span><br><span class=line>110</span><br><span class=line>111</span><br><span class=line>112</span><br><span class=line>113</span><br><span class=line>114</span><br><span class=line>115</span><br><span class=line>116</span><br><span class=line>117</span><br><span class=line>118</span><br><span class=line>119</span><br><span class=line>120</span><br><span class=line>121</span><br><span class=line>122</span><br><span class=line>123</span><br><span class=line>124</span><br><span class=line>125</span><br><span class=line>126</span><br><span class=line>127</span><br><span class=line>128</span><br><span class=line>129</span><br><span class=line>130</span><br><span class=line>131</span><br><span class=line>132</span><br><span class=line>133</span><br><span class=line>134</span><br><span class=line>135</span><br><span class=line>136</span><br><span class=line>137</span><br><span class=line>138</span><br><span class=line>139</span><br><span class=line>140</span><br><span class=line>141</span><br><span class=line>142</span><br><span class=line>143</span><br><span class=line>144</span><br><span class=line>145</span><br><span class=line>146</span><br><span class=line>147</span><br><span class=line>148</span><br><span class=line>149</span><br><span class=line>150</span><br><span class=line>151</span><br><span class=line>152</span><br><span class=line>153</span><br><span class=line>154</span><br><span class=line>155</span><br><span class=line>156</span><br><span class=line>157</span><br><span class=line>158</span><br><span class=line>159</span><br><span class=line>160</span><br><span class=line>161</span><br><span class=line>162</span><br><span class=line>163</span><br><span class=line>164</span><br><span class=line>165</span><br><span class=line>166</span><br><span class=line>167</span><br><span class=line>168</span><br><span class=line>169</span><br><span class=line>170</span><br><span class=line>171</span><br><span class=line>172</span><br><span class=line>173</span><br><span class=line>174</span><br><span class=line>175</span><br><span class=line>176</span><br><span class=line>177</span><br><span class=line>178</span><br><span class=line>179</span><br><span class=line>180</span><br><span class=line>181</span><br><span class=line>182</span><br><span class=line>183</span><br><span class=line>184</span><br><span class=line>185</span><br><span class=line>186</span><br><span class=line>187</span><br><span class=line>188</span><br><span class=line>189</span><br><span class=line>190</span><br><span class=line>191</span><br><span class=line>192</span><br><span class=line>193</span><br><span class=line>194</span><br><span class=line>195</span><br><span class=line>196</span><br><span class=line>197</span><br><span class=line>198</span><br><span class=line>199</span><br><span class=line>200</span><br><span class=line>201</span><br><span class=line>202</span><br><span class=line>203</span><br><span class=line>204</span><br><span class=line>205</span><br><span class=line>206</span><br><span class=line>207</span><br><span class=line>208</span><br><span class=line>209</span><br><span class=line>210</span><br><span class=line>211</span><br><span class=line>212</span><br><span class=line>213</span><br></pre></td><td class=code><pre><span class=line><span class=comment>// syntaxes/mylang.tmLanguage.json</span></span><br><span class=line><span class=punctuation>&#123;</span></span><br><span class=line>    <span class=attr>&quot;$schema&quot;</span><span class=punctuation>:</span> <span class=string>&quot;https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json&quot;</span><span class=punctuation>,</span></span><br><span class=line>    <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;MyLang&quot;</span><span class=punctuation>,</span></span><br><span class=line>    <span class=attr>&quot;scopeName&quot;</span><span class=punctuation>:</span> <span class=string>&quot;source.mylang&quot;</span><span class=punctuation>,</span></span><br><span class=line>    <span class=attr>&quot;fileTypes&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span><span class=string>&quot;ml&quot;</span><span class=punctuation>,</span> <span class=string>&quot;mylang&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>    <span class=attr>&quot;patterns&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>        <span class=punctuation>&#123;</span></span><br><span class=line>            <span class=attr>&quot;include&quot;</span><span class=punctuation>:</span> <span class=string>&quot;#comments&quot;</span></span><br><span class=line>        <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=punctuation>&#123;</span></span><br><span class=line>            <span class=attr>&quot;include&quot;</span><span class=punctuation>:</span> <span class=string>&quot;#keywords&quot;</span></span><br><span class=line>        <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=punctuation>&#123;</span></span><br><span class=line>            <span class=attr>&quot;include&quot;</span><span class=punctuation>:</span> <span class=string>&quot;#strings&quot;</span></span><br><span class=line>        <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=punctuation>&#123;</span></span><br><span class=line>            <span class=attr>&quot;include&quot;</span><span class=punctuation>:</span> <span class=string>&quot;#numbers&quot;</span></span><br><span class=line>        <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=punctuation>&#123;</span></span><br><span class=line>            <span class=attr>&quot;include&quot;</span><span class=punctuation>:</span> <span class=string>&quot;#functions&quot;</span></span><br><span class=line>        <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=punctuation>&#123;</span></span><br><span class=line>            <span class=attr>&quot;include&quot;</span><span class=punctuation>:</span> <span class=string>&quot;#operators&quot;</span></span><br><span class=line>        <span class=punctuation>&#125;</span></span><br><span class=line>    <span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>    <span class=attr>&quot;repository&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>        <span class=attr>&quot;comments&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>            <span class=attr>&quot;patterns&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>                <span class=punctuation>&#123;</span></span><br><span class=line>                    <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;comment.line.double-slash.mylang&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;begin&quot;</span><span class=punctuation>:</span> <span class=string>&quot;//&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;end&quot;</span><span class=punctuation>:</span> <span class=string>&quot;$&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;captures&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>                        <span class=attr>&quot;0&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>                            <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;punctuation.definition.comment.mylang&quot;</span></span><br><span class=line>                        <span class=punctuation>&#125;</span></span><br><span class=line>                    <span class=punctuation>&#125;</span></span><br><span class=line>                <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>                <span class=punctuation>&#123;</span></span><br><span class=line>                    <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;comment.block.mylang&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;begin&quot;</span><span class=punctuation>:</span> <span class=string>&quot;/\\*&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;end&quot;</span><span class=punctuation>:</span> <span class=string>&quot;\\*/&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;captures&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>                        <span class=attr>&quot;0&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>                            <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;punctuation.definition.comment.mylang&quot;</span></span><br><span class=line>                        <span class=punctuation>&#125;</span></span><br><span class=line>                    <span class=punctuation>&#125;</span></span><br><span class=line>                <span class=punctuation>&#125;</span></span><br><span class=line>            <span class=punctuation>]</span></span><br><span class=line>        <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;keywords&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>            <span class=attr>&quot;patterns&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>                <span class=punctuation>&#123;</span></span><br><span class=line>                    <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;keyword.control.mylang&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;match&quot;</span><span class=punctuation>:</span> <span class=string>&quot;\\b(if|else|while|for|return|break|continue)\\b&quot;</span></span><br><span class=line>                <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>                <span class=punctuation>&#123;</span></span><br><span class=line>                    <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;keyword.other.mylang&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;match&quot;</span><span class=punctuation>:</span> <span class=string>&quot;\\b(var|let|const|function|class|interface)\\b&quot;</span></span><br><span class=line>                <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>                <span class=punctuation>&#123;</span></span><br><span class=line>                    <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;storage.type.mylang&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;match&quot;</span><span class=punctuation>:</span> <span class=string>&quot;\\b(int|string|bool|float|void)\\b&quot;</span></span><br><span class=line>                <span class=punctuation>&#125;</span></span><br><span class=line>            <span class=punctuation>]</span></span><br><span class=line>        <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;strings&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>            <span class=attr>&quot;patterns&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>                <span class=punctuation>&#123;</span></span><br><span class=line>                    <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;string.quoted.double.mylang&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;begin&quot;</span><span class=punctuation>:</span> <span class=string>&quot;\&quot;&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;end&quot;</span><span class=punctuation>:</span> <span class=string>&quot;\&quot;&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;patterns&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>                        <span class=punctuation>&#123;</span></span><br><span class=line>                            <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;constant.character.escape.mylang&quot;</span><span class=punctuation>,</span></span><br><span class=line>                            <span class=attr>&quot;match&quot;</span><span class=punctuation>:</span> <span class=string>&quot;\\\\.&quot;</span></span><br><span class=line>                        <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>                        <span class=punctuation>&#123;</span></span><br><span class=line>                            <span class=attr>&quot;include&quot;</span><span class=punctuation>:</span> <span class=string>&quot;#string-interpolation&quot;</span></span><br><span class=line>                        <span class=punctuation>&#125;</span></span><br><span class=line>                    <span class=punctuation>]</span></span><br><span class=line>                <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>                <span class=punctuation>&#123;</span></span><br><span class=line>                    <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;string.quoted.single.mylang&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;begin&quot;</span><span class=punctuation>:</span> <span class=string>&quot;&#x27;&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;end&quot;</span><span class=punctuation>:</span> <span class=string>&quot;&#x27;&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;patterns&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>                        <span class=punctuation>&#123;</span></span><br><span class=line>                            <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;constant.character.escape.mylang&quot;</span><span class=punctuation>,</span></span><br><span class=line>                            <span class=attr>&quot;match&quot;</span><span class=punctuation>:</span> <span class=string>&quot;\\\\.&quot;</span></span><br><span class=line>                        <span class=punctuation>&#125;</span></span><br><span class=line>                    <span class=punctuation>]</span></span><br><span class=line>                <span class=punctuation>&#125;</span></span><br><span class=line>            <span class=punctuation>]</span></span><br><span class=line>        <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;string-interpolation&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>            <span class=attr>&quot;patterns&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>                <span class=punctuation>&#123;</span></span><br><span class=line>                    <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;meta.interpolation.mylang&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;begin&quot;</span><span class=punctuation>:</span> <span class=string>&quot;\\$\\&#123;&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;end&quot;</span><span class=punctuation>:</span> <span class=string>&quot;\\&#125;&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;patterns&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>                        <span class=punctuation>&#123;</span></span><br><span class=line>                            <span class=attr>&quot;include&quot;</span><span class=punctuation>:</span> <span class=string>&quot;$self&quot;</span></span><br><span class=line>                        <span class=punctuation>&#125;</span></span><br><span class=line>                    <span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;beginCaptures&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>                        <span class=attr>&quot;0&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>                            <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;punctuation.definition.interpolation.begin.mylang&quot;</span></span><br><span class=line>                        <span class=punctuation>&#125;</span></span><br><span class=line>                    <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;endCaptures&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>                        <span class=attr>&quot;0&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>                            <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;punctuation.definition.interpolation.end.mylang&quot;</span></span><br><span class=line>                        <span class=punctuation>&#125;</span></span><br><span class=line>                    <span class=punctuation>&#125;</span></span><br><span class=line>                <span class=punctuation>&#125;</span></span><br><span class=line>            <span class=punctuation>]</span></span><br><span class=line>        <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;numbers&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>            <span class=attr>&quot;patterns&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>                <span class=punctuation>&#123;</span></span><br><span class=line>                    <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;constant.numeric.float.mylang&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;match&quot;</span><span class=punctuation>:</span> <span class=string>&quot;\\b\\d+\\.\\d+([eE][+-]?\\d+)?\\b&quot;</span></span><br><span class=line>                <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>                <span class=punctuation>&#123;</span></span><br><span class=line>                    <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;constant.numeric.integer.mylang&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;match&quot;</span><span class=punctuation>:</span> <span class=string>&quot;\\b\\d+\\b&quot;</span></span><br><span class=line>                <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>                <span class=punctuation>&#123;</span></span><br><span class=line>                    <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;constant.numeric.hex.mylang&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;match&quot;</span><span class=punctuation>:</span> <span class=string>&quot;\\b0[xX][0-9a-fA-F]+\\b&quot;</span></span><br><span class=line>                <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>                <span class=punctuation>&#123;</span></span><br><span class=line>                    <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;constant.numeric.binary.mylang&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;match&quot;</span><span class=punctuation>:</span> <span class=string>&quot;\\b0[bB][01]+\\b&quot;</span></span><br><span class=line>                <span class=punctuation>&#125;</span></span><br><span class=line>            <span class=punctuation>]</span></span><br><span class=line>        <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;functions&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>            <span class=attr>&quot;patterns&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>                <span class=punctuation>&#123;</span></span><br><span class=line>                    <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;meta.function.declaration.mylang&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;begin&quot;</span><span class=punctuation>:</span> <span class=string>&quot;\\b(function)\\s+(\\w+)\\s*\\(&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;end&quot;</span><span class=punctuation>:</span> <span class=string>&quot;\\)&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;beginCaptures&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>                        <span class=attr>&quot;1&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>                            <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;keyword.other.mylang&quot;</span></span><br><span class=line>                        <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>                        <span class=attr>&quot;2&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>                            <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;entity.name.function.mylang&quot;</span></span><br><span class=line>                        <span class=punctuation>&#125;</span></span><br><span class=line>                    <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;patterns&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>                        <span class=punctuation>&#123;</span></span><br><span class=line>                            <span class=attr>&quot;include&quot;</span><span class=punctuation>:</span> <span class=string>&quot;#function-parameters&quot;</span></span><br><span class=line>                        <span class=punctuation>&#125;</span></span><br><span class=line>                    <span class=punctuation>]</span></span><br><span class=line>                <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>                <span class=punctuation>&#123;</span></span><br><span class=line>                    <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;meta.function.call.mylang&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;begin&quot;</span><span class=punctuation>:</span> <span class=string>&quot;\\b(\\w+)\\s*\\(&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;end&quot;</span><span class=punctuation>:</span> <span class=string>&quot;\\)&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;beginCaptures&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>                        <span class=attr>&quot;1&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>                            <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;entity.name.function.mylang&quot;</span></span><br><span class=line>                        <span class=punctuation>&#125;</span></span><br><span class=line>                    <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;patterns&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>                        <span class=punctuation>&#123;</span></span><br><span class=line>                            <span class=attr>&quot;include&quot;</span><span class=punctuation>:</span> <span class=string>&quot;$self&quot;</span></span><br><span class=line>                        <span class=punctuation>&#125;</span></span><br><span class=line>                    <span class=punctuation>]</span></span><br><span class=line>                <span class=punctuation>&#125;</span></span><br><span class=line>            <span class=punctuation>]</span></span><br><span class=line>        <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;function-parameters&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>            <span class=attr>&quot;patterns&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>                <span class=punctuation>&#123;</span></span><br><span class=line>                    <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;variable.parameter.mylang&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;match&quot;</span><span class=punctuation>:</span> <span class=string>&quot;\\b\\w+\\b&quot;</span></span><br><span class=line>                <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>                <span class=punctuation>&#123;</span></span><br><span class=line>                    <span class=attr>&quot;include&quot;</span><span class=punctuation>:</span> <span class=string>&quot;#strings&quot;</span></span><br><span class=line>                <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>                <span class=punctuation>&#123;</span></span><br><span class=line>                    <span class=attr>&quot;include&quot;</span><span class=punctuation>:</span> <span class=string>&quot;#numbers&quot;</span></span><br><span class=line>                <span class=punctuation>&#125;</span></span><br><span class=line>            <span class=punctuation>]</span></span><br><span class=line>        <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;operators&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>            <span class=attr>&quot;patterns&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>                <span class=punctuation>&#123;</span></span><br><span class=line>                    <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;keyword.operator.arithmetic.mylang&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;match&quot;</span><span class=punctuation>:</span> <span class=string>&quot;[+\\-*/%]&quot;</span></span><br><span class=line>                <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>                <span class=punctuation>&#123;</span></span><br><span class=line>                    <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;keyword.operator.comparison.mylang&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;match&quot;</span><span class=punctuation>:</span> <span class=string>&quot;(==|!=|&lt;=|&gt;=|&lt;|&gt;)&quot;</span></span><br><span class=line>                <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>                <span class=punctuation>&#123;</span></span><br><span class=line>                    <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;keyword.operator.logical.mylang&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;match&quot;</span><span class=punctuation>:</span> <span class=string>&quot;(&amp;&amp;|\\|\\||!)&quot;</span></span><br><span class=line>                <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>                <span class=punctuation>&#123;</span></span><br><span class=line>                    <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;keyword.operator.assignment.mylang&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;match&quot;</span><span class=punctuation>:</span> <span class=string>&quot;(=|\\+=|-=|\\*=|/=)&quot;</span></span><br><span class=line>                <span class=punctuation>&#125;</span></span><br><span class=line>            <span class=punctuation>]</span></span><br><span class=line>        <span class=punctuation>&#125;</span></span><br><span class=line>    <span class=punctuation>&#125;</span></span><br><span class=line><span class=punctuation>&#125;</span></span><br></pre></td></tr></table></figure><h4 id=è¯­è¨€é…ç½®æ–‡ä»¶><a href=#è¯­è¨€é…ç½®æ–‡ä»¶ class=headerlink title=è¯­è¨€é…ç½®æ–‡ä»¶></a>è¯­è¨€é…ç½®æ–‡ä»¶</h4><figure class="highlight json"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br></pre></td><td class=code><pre><span class=line><span class=comment>// language-configuration.json</span></span><br><span class=line><span class=punctuation>&#123;</span></span><br><span class=line>    <span class=attr>&quot;comments&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>        <span class=attr>&quot;lineComment&quot;</span><span class=punctuation>:</span> <span class=string>&quot;//&quot;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;blockComment&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span> <span class=string>&quot;/*&quot;</span><span class=punctuation>,</span> <span class=string>&quot;*/&quot;</span> <span class=punctuation>]</span></span><br><span class=line>    <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>    <span class=attr>&quot;brackets&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>        <span class=punctuation>[</span><span class=string>&quot;&#123;&quot;</span><span class=punctuation>,</span> <span class=string>&quot;&#125;&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=punctuation>[</span><span class=string>&quot;[&quot;</span><span class=punctuation>,</span> <span class=string>&quot;]&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=punctuation>[</span><span class=string>&quot;(&quot;</span><span class=punctuation>,</span> <span class=string>&quot;)&quot;</span><span class=punctuation>]</span></span><br><span class=line>    <span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>    <span class=attr>&quot;autoClosingPairs&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>        <span class=punctuation>[</span><span class=string>&quot;&#123;&quot;</span><span class=punctuation>,</span> <span class=string>&quot;&#125;&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=punctuation>[</span><span class=string>&quot;[&quot;</span><span class=punctuation>,</span> <span class=string>&quot;]&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=punctuation>[</span><span class=string>&quot;(&quot;</span><span class=punctuation>,</span> <span class=string>&quot;)&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=punctuation>[</span><span class=string>&quot;\&quot;&quot;</span><span class=punctuation>,</span> <span class=string>&quot;\&quot;&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=punctuation>[</span><span class=string>&quot;&#x27;&quot;</span><span class=punctuation>,</span> <span class=string>&quot;&#x27;&quot;</span><span class=punctuation>]</span></span><br><span class=line>    <span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>    <span class=attr>&quot;surroundingPairs&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>        <span class=punctuation>[</span><span class=string>&quot;&#123;&quot;</span><span class=punctuation>,</span> <span class=string>&quot;&#125;&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=punctuation>[</span><span class=string>&quot;[&quot;</span><span class=punctuation>,</span> <span class=string>&quot;]&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=punctuation>[</span><span class=string>&quot;(&quot;</span><span class=punctuation>,</span> <span class=string>&quot;)&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=punctuation>[</span><span class=string>&quot;\&quot;&quot;</span><span class=punctuation>,</span> <span class=string>&quot;\&quot;&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=punctuation>[</span><span class=string>&quot;&#x27;&quot;</span><span class=punctuation>,</span> <span class=string>&quot;&#x27;&quot;</span><span class=punctuation>]</span></span><br><span class=line>    <span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>    <span class=attr>&quot;folding&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>        <span class=attr>&quot;markers&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>            <span class=attr>&quot;start&quot;</span><span class=punctuation>:</span> <span class=string>&quot;^\\s*//\\s*#?region\\b&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=attr>&quot;end&quot;</span><span class=punctuation>:</span> <span class=string>&quot;^\\s*//\\s*#?endregion\\b&quot;</span></span><br><span class=line>        <span class=punctuation>&#125;</span></span><br><span class=line>    <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>    <span class=attr>&quot;wordPattern&quot;</span><span class=punctuation>:</span> <span class=string>&quot;\\b[a-zA-Z_][a-zA-Z0-9_]*\\b&quot;</span><span class=punctuation>,</span></span><br><span class=line>    <span class=attr>&quot;indentationRules&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>        <span class=attr>&quot;increaseIndentPattern&quot;</span><span class=punctuation>:</span> <span class=string>&quot;^((?!\\/\\*).)*(\\&#123;[^&#125;\&quot;&#x27;`]*|\\([^)\&quot;&#x27;`]*|\\[[^\\]\&quot;&#x27;`]*)$&quot;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;decreaseIndentPattern&quot;</span><span class=punctuation>:</span> <span class=string>&quot;^((?!.*?\\/\\*).*\\*/)?\\s*[\\&#125;\\]].*$&quot;</span></span><br><span class=line>    <span class=punctuation>&#125;</span></span><br><span class=line><span class=punctuation>&#125;</span></span><br></pre></td></tr></table></figure><h3 id=1-2-è¯­ä¹‰é«˜äº®å®ç°><a href=#1-2-è¯­ä¹‰é«˜äº®å®ç° class=headerlink title="1.2 è¯­ä¹‰é«˜äº®å®ç°"></a>1.2 è¯­ä¹‰é«˜äº®å®ç°</h3><figure class="highlight typescript"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br><span class=line>90</span><br><span class=line>91</span><br><span class=line>92</span><br><span class=line>93</span><br><span class=line>94</span><br><span class=line>95</span><br><span class=line>96</span><br><span class=line>97</span><br><span class=line>98</span><br><span class=line>99</span><br><span class=line>100</span><br><span class=line>101</span><br><span class=line>102</span><br><span class=line>103</span><br><span class=line>104</span><br><span class=line>105</span><br><span class=line>106</span><br><span class=line>107</span><br><span class=line>108</span><br><span class=line>109</span><br><span class=line>110</span><br><span class=line>111</span><br><span class=line>112</span><br><span class=line>113</span><br><span class=line>114</span><br><span class=line>115</span><br><span class=line>116</span><br><span class=line>117</span><br><span class=line>118</span><br><span class=line>119</span><br><span class=line>120</span><br></pre></td><td class=code><pre><span class=line><span class=comment>// src/semanticTokensProvider.ts</span></span><br><span class=line><span class=keyword>import</span> * <span class=keyword>as</span> vscode <span class=keyword>from</span> <span class=string>&#x27;vscode&#x27;</span>;</span><br><span class=line></span><br><span class=line><span class=keyword>export</span> <span class=keyword>class</span> <span class="title class_">MyLangSemanticTokensProvider</span> <span class=keyword>implements</span> vscode.<span class=property>DocumentSemanticTokensProvider</span> &#123;</span><br><span class=line>    </span><br><span class=line>    <span class=comment>// å®šä¹‰è¯­ä¹‰tokenç±»å‹å’Œä¿®é¥°ç¬¦</span></span><br><span class=line>    <span class=keyword>private</span> <span class=keyword>readonly</span> <span class=attr>legend</span>: vscode.<span class=property>SemanticTokensLegend</span> = <span class=keyword>new</span> vscode.<span class="title class_">SemanticTokensLegend</span>(</span><br><span class=line>        [</span><br><span class=line>            <span class=string>&#x27;namespace&#x27;</span>, <span class=string>&#x27;type&#x27;</span>, <span class=string>&#x27;class&#x27;</span>, <span class=string>&#x27;enum&#x27;</span>, <span class=string>&#x27;interface&#x27;</span>, <span class=string>&#x27;struct&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;typeParameter&#x27;</span>, <span class=string>&#x27;parameter&#x27;</span>, <span class=string>&#x27;variable&#x27;</span>, <span class=string>&#x27;property&#x27;</span>, <span class=string>&#x27;enumMember&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;event&#x27;</span>, <span class=string>&#x27;function&#x27;</span>, <span class=string>&#x27;method&#x27;</span>, <span class=string>&#x27;macro&#x27;</span>, <span class=string>&#x27;keyword&#x27;</span>, <span class=string>&#x27;modifier&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;comment&#x27;</span>, <span class=string>&#x27;string&#x27;</span>, <span class=string>&#x27;number&#x27;</span>, <span class=string>&#x27;regexp&#x27;</span>, <span class=string>&#x27;operator&#x27;</span></span><br><span class=line>        ],</span><br><span class=line>        [</span><br><span class=line>            <span class=string>&#x27;declaration&#x27;</span>, <span class=string>&#x27;definition&#x27;</span>, <span class=string>&#x27;readonly&#x27;</span>, <span class=string>&#x27;static&#x27;</span>, <span class=string>&#x27;deprecated&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;abstract&#x27;</span>, <span class=string>&#x27;async&#x27;</span>, <span class=string>&#x27;modification&#x27;</span>, <span class=string>&#x27;documentation&#x27;</span>, <span class=string>&#x27;defaultLibrary&#x27;</span></span><br><span class=line>        ]</span><br><span class=line>    );</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>async</span> <span class="title function_">provideDocumentSemanticTokens</span>(</span><br><span class=line>        <span class=attr>document</span>: vscode.<span class=property>TextDocument</span>,</span><br><span class=line>        <span class=attr>token</span>: vscode.<span class=property>CancellationToken</span></span><br><span class=line>    ): <span class="title class_">Promise</span>&lt;vscode.<span class=property>SemanticTokens</span>&gt; &#123;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>const</span> tokensBuilder = <span class=keyword>new</span> vscode.<span class="title class_">SemanticTokensBuilder</span>(<span class="variable language_">this</span>.<span class=property>legend</span>);</span><br><span class=line>        <span class=keyword>const</span> text = <span class="variable language_">document</span>.<span class="title function_">getText</span>();</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// è§£ææ–‡æ¡£å¹¶ç”Ÿæˆè¯­ä¹‰tokens</span></span><br><span class=line>        <span class=keyword>await</span> <span class="variable language_">this</span>.<span class="title function_">parseDocument</span>(<span class="variable language_">document</span>, tokensBuilder);</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> tokensBuilder.<span class="title function_">build</span>();</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class=keyword>async</span> <span class="title function_">parseDocument</span>(</span><br><span class=line>        <span class=attr>document</span>: vscode.<span class=property>TextDocument</span>,</span><br><span class=line>        <span class=attr>builder</span>: vscode.<span class=property>SemanticTokensBuilder</span></span><br><span class=line>    ): <span class="title class_">Promise</span>&lt;<span class=built_in>void</span>&gt; &#123;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>const</span> text = <span class="variable language_">document</span>.<span class="title function_">getText</span>();</span><br><span class=line>        <span class=keyword>const</span> lines = text.<span class="title function_">split</span>(<span class=string>&#x27;\n&#x27;</span>);</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>for</span> (<span class=keyword>let</span> lineIndex = <span class=number>0</span>; lineIndex &lt; lines.<span class=property>length</span>; lineIndex++) &#123;</span><br><span class=line>            <span class=keyword>const</span> line = lines[lineIndex];</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// è§£æå‡½æ•°å®šä¹‰</span></span><br><span class=line>            <span class=keyword>const</span> functionMatch = <span class=regexp>/function\s+(\w+)\s*\(/g</span>;</span><br><span class=line>            <span class=keyword>let</span> match;</span><br><span class=line>            <span class=keyword>while</span> ((match = functionMatch.<span class="title function_">exec</span>(line)) !== <span class=literal>null</span>) &#123;</span><br><span class=line>                <span class=keyword>const</span> startPos = match.<span class=property>index</span> + match[<span class=number>0</span>].<span class="title function_">indexOf</span>(match[<span class=number>1</span>]);</span><br><span class=line>                builder.<span class="title function_">push</span>(</span><br><span class=line>                    <span class=keyword>new</span> vscode.<span class="title class_">Range</span>(lineIndex, startPos, lineIndex, startPos + match[<span class=number>1</span>].<span class=property>length</span>),</span><br><span class=line>                    <span class=string>&#x27;function&#x27;</span>,</span><br><span class=line>                    [<span class=string>&#x27;declaration&#x27;</span>]</span><br><span class=line>                );</span><br><span class=line>            &#125;</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// è§£æå˜é‡å£°æ˜</span></span><br><span class=line>            <span class=keyword>const</span> variableMatch = <span class=regexp>/(var|let|const)\s+(\w+)/g</span>;</span><br><span class=line>            <span class=keyword>while</span> ((match = variableMatch.<span class="title function_">exec</span>(line)) !== <span class=literal>null</span>) &#123;</span><br><span class=line>                <span class=keyword>const</span> startPos = match.<span class=property>index</span> + match[<span class=number>0</span>].<span class="title function_">indexOf</span>(match[<span class=number>2</span>]);</span><br><span class=line>                builder.<span class="title function_">push</span>(</span><br><span class=line>                    <span class=keyword>new</span> vscode.<span class="title class_">Range</span>(lineIndex, startPos, lineIndex, startPos + match[<span class=number>2</span>].<span class=property>length</span>),</span><br><span class=line>                    <span class=string>&#x27;variable&#x27;</span>,</span><br><span class=line>                    [<span class=string>&#x27;declaration&#x27;</span>]</span><br><span class=line>                );</span><br><span class=line>            &#125;</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// è§£æç±»å‹å£°æ˜</span></span><br><span class=line>            <span class=keyword>const</span> typeMatch = <span class=regexp>/(class|interface|enum)\s+(\w+)/g</span>;</span><br><span class=line>            <span class=keyword>while</span> ((match = typeMatch.<span class="title function_">exec</span>(line)) !== <span class=literal>null</span>) &#123;</span><br><span class=line>                <span class=keyword>const</span> startPos = match.<span class=property>index</span> + match[<span class=number>0</span>].<span class="title function_">indexOf</span>(match[<span class=number>2</span>]);</span><br><span class=line>                <span class=keyword>const</span> tokenType = match[<span class=number>1</span>] === <span class=string>&#x27;class&#x27;</span> ? <span class=string>&#x27;class&#x27;</span> : </span><br><span class=line>                                match[<span class=number>1</span>] === <span class=string>&#x27;interface&#x27;</span> ? <span class=string>&#x27;interface&#x27;</span> : <span class=string>&#x27;enum&#x27;</span>;</span><br><span class=line>                builder.<span class="title function_">push</span>(</span><br><span class=line>                    <span class=keyword>new</span> vscode.<span class="title class_">Range</span>(lineIndex, startPos, lineIndex, startPos + match[<span class=number>2</span>].<span class=property>length</span>),</span><br><span class=line>                    tokenType,</span><br><span class=line>                    [<span class=string>&#x27;declaration&#x27;</span>]</span><br><span class=line>                );</span><br><span class=line>            &#125;</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// è§£æå­—ç¬¦ä¸²å­—é¢é‡ä¸­çš„å˜é‡æ’å€¼</span></span><br><span class=line>            <span class=keyword>const</span> interpolationMatch = <span class=regexp>/\$\&#123;(\w+)\&#125;/g</span>;</span><br><span class=line>            <span class=keyword>while</span> ((match = interpolationMatch.<span class="title function_">exec</span>(line)) !== <span class=literal>null</span>) &#123;</span><br><span class=line>                <span class=keyword>const</span> startPos = match.<span class=property>index</span> + <span class=number>2</span>; <span class=comment>// è·³è¿‡ $&#123;</span></span><br><span class=line>                builder.<span class="title function_">push</span>(</span><br><span class=line>                    <span class=keyword>new</span> vscode.<span class="title class_">Range</span>(lineIndex, startPos, lineIndex, startPos + match[<span class=number>1</span>].<span class=property>length</span>),</span><br><span class=line>                    <span class=string>&#x27;variable&#x27;</span>,</span><br><span class=line>                    [<span class=string>&#x27;readonly&#x27;</span>]</span><br><span class=line>                );</span><br><span class=line>            &#125;</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// è§£ææ³¨é‡Šä¸­çš„TODOã€FIXMEç­‰</span></span><br><span class=line>            <span class=keyword>const</span> commentTodoMatch = <span class=regexp>/\/\/.*?(TODO|FIXME|NOTE|HACK):/g</span>;</span><br><span class=line>            <span class=keyword>while</span> ((match = commentTodoMatch.<span class="title function_">exec</span>(line)) !== <span class=literal>null</span>) &#123;</span><br><span class=line>                <span class=keyword>const</span> startPos = match.<span class=property>index</span> + match[<span class=number>0</span>].<span class="title function_">indexOf</span>(match[<span class=number>1</span>]);</span><br><span class=line>                builder.<span class="title function_">push</span>(</span><br><span class=line>                    <span class=keyword>new</span> vscode.<span class="title class_">Range</span>(lineIndex, startPos, lineIndex, startPos + match[<span class=number>1</span>].<span class=property>length</span>),</span><br><span class=line>                    <span class=string>&#x27;keyword&#x27;</span>,</span><br><span class=line>                    [<span class=string>&#x27;documentation&#x27;</span>]</span><br><span class=line>                );</span><br><span class=line>            &#125;</span><br><span class=line>        &#125;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=comment>// å¢é‡æ›´æ–°æ”¯æŒ</span></span><br><span class=line>    <span class=keyword>async</span> <span class="title function_">provideDocumentSemanticTokensEdits</span>(</span><br><span class=line>        <span class=attr>document</span>: vscode.<span class=property>TextDocument</span>,</span><br><span class=line>        <span class=attr>previousResultId</span>: <span class=built_in>string</span>,</span><br><span class=line>        <span class=attr>token</span>: vscode.<span class=property>CancellationToken</span></span><br><span class=line>    ): <span class="title class_">Promise</span>&lt;vscode.<span class=property>SemanticTokens</span> | vscode.<span class=property>SemanticTokensEdits</span>&gt; &#123;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// å¯¹äºç®€å•æƒ…å†µï¼Œç›´æ¥è¿”å›æ–°çš„tokens</span></span><br><span class=line>        <span class=comment>// å¤æ‚çš„å¢é‡æ›´æ–°éœ€è¦å®ç°å·®å¼‚æ£€æµ‹</span></span><br><span class=line>        <span class=keyword>return</span> <span class="variable language_">this</span>.<span class="title function_">provideDocumentSemanticTokens</span>(<span class="variable language_">document</span>, token);</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class="title function_">getLegend</span>(): vscode.<span class=property>SemanticTokensLegend</span> &#123;</span><br><span class=line>        <span class=keyword>return</span> <span class="variable language_">this</span>.<span class=property>legend</span>;</span><br><span class=line>    &#125;</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><h3 id=1-3-ä»£ç ç‰‡æ®µç³»ç»Ÿ><a href=#1-3-ä»£ç ç‰‡æ®µç³»ç»Ÿ class=headerlink title="1.3 ä»£ç ç‰‡æ®µç³»ç»Ÿ"></a>1.3 ä»£ç ç‰‡æ®µç³»ç»Ÿ</h3><figure class="highlight json"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br><span class=line>90</span><br><span class=line>91</span><br><span class=line>92</span><br><span class=line>93</span><br><span class=line>94</span><br><span class=line>95</span><br><span class=line>96</span><br><span class=line>97</span><br><span class=line>98</span><br><span class=line>99</span><br><span class=line>100</span><br><span class=line>101</span><br><span class=line>102</span><br><span class=line>103</span><br><span class=line>104</span><br><span class=line>105</span><br><span class=line>106</span><br><span class=line>107</span><br><span class=line>108</span><br><span class=line>109</span><br><span class=line>110</span><br><span class=line>111</span><br><span class=line>112</span><br><span class=line>113</span><br><span class=line>114</span><br><span class=line>115</span><br><span class=line>116</span><br><span class=line>117</span><br><span class=line>118</span><br><span class=line>119</span><br><span class=line>120</span><br><span class=line>121</span><br><span class=line>122</span><br><span class=line>123</span><br><span class=line>124</span><br><span class=line>125</span><br><span class=line>126</span><br><span class=line>127</span><br><span class=line>128</span><br><span class=line>129</span><br><span class=line>130</span><br><span class=line>131</span><br><span class=line>132</span><br><span class=line>133</span><br><span class=line>134</span><br><span class=line>135</span><br><span class=line>136</span><br><span class=line>137</span><br><span class=line>138</span><br><span class=line>139</span><br><span class=line>140</span><br><span class=line>141</span><br><span class=line>142</span><br><span class=line>143</span><br><span class=line>144</span><br><span class=line>145</span><br><span class=line>146</span><br><span class=line>147</span><br><span class=line>148</span><br><span class=line>149</span><br><span class=line>150</span><br><span class=line>151</span><br><span class=line>152</span><br><span class=line>153</span><br><span class=line>154</span><br><span class=line>155</span><br><span class=line>156</span><br><span class=line>157</span><br><span class=line>158</span><br><span class=line>159</span><br><span class=line>160</span><br><span class=line>161</span><br><span class=line>162</span><br><span class=line>163</span><br><span class=line>164</span><br><span class=line>165</span><br><span class=line>166</span><br><span class=line>167</span><br><span class=line>168</span><br><span class=line>169</span><br><span class=line>170</span><br><span class=line>171</span><br><span class=line>172</span><br><span class=line>173</span><br><span class=line>174</span><br><span class=line>175</span><br></pre></td><td class=code><pre><span class=line><span class=comment>// snippets/mylang.code-snippets</span></span><br><span class=line><span class=punctuation>&#123;</span></span><br><span class=line>    <span class=attr>&quot;Function Declaration&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>        <span class=attr>&quot;prefix&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span><span class=string>&quot;func&quot;</span><span class=punctuation>,</span> <span class=string>&quot;function&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;body&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>            <span class=string>&quot;function $&#123;1:functionName&#125;($&#123;2:parameters&#125;) &#123;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;\t$&#123;3:// function body&#125;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;\treturn $&#123;4:undefined&#125;;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;&#125;&quot;</span></span><br><span class=line>        <span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;description&quot;</span><span class=punctuation>:</span> <span class=string>&quot;åˆ›å»ºå‡½æ•°å£°æ˜&quot;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;scope&quot;</span><span class=punctuation>:</span> <span class=string>&quot;source.mylang&quot;</span></span><br><span class=line>    <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>    </span><br><span class=line>    <span class=attr>&quot;Class Declaration&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>        <span class=attr>&quot;prefix&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span><span class=string>&quot;class&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;body&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>            <span class=string>&quot;class $&#123;1:ClassName&#125; &#123;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;\tconstructor($&#123;2:parameters&#125;) &#123;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;\t\t$&#123;3:// constructor body&#125;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;\t&#125;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;\t$&#123;4:methodName&#125;() &#123;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;\t\t$&#123;5:// method body&#125;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;\t&#125;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;&#125;&quot;</span></span><br><span class=line>        <span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;description&quot;</span><span class=punctuation>:</span> <span class=string>&quot;åˆ›å»ºç±»å£°æ˜&quot;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;scope&quot;</span><span class=punctuation>:</span> <span class=string>&quot;source.mylang&quot;</span></span><br><span class=line>    <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>    </span><br><span class=line>    <span class=attr>&quot;If Statement&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>        <span class=attr>&quot;prefix&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span><span class=string>&quot;if&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;body&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>            <span class=string>&quot;if ($&#123;1:condition&#125;) &#123;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;\t$&#123;2:// if body&#125;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;&#125;&quot;</span></span><br><span class=line>        <span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;description&quot;</span><span class=punctuation>:</span> <span class=string>&quot;åˆ›å»ºifè¯­å¥&quot;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;scope&quot;</span><span class=punctuation>:</span> <span class=string>&quot;source.mylang&quot;</span></span><br><span class=line>    <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>    </span><br><span class=line>    <span class=attr>&quot;If-Else Statement&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>        <span class=attr>&quot;prefix&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span><span class=string>&quot;ifelse&quot;</span><span class=punctuation>,</span> <span class=string>&quot;ife&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;body&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>            <span class=string>&quot;if ($&#123;1:condition&#125;) &#123;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;\t$&#123;2:// if body&#125;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;&#125; else &#123;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;\t$&#123;3:// else body&#125;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;&#125;&quot;</span></span><br><span class=line>        <span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;description&quot;</span><span class=punctuation>:</span> <span class=string>&quot;åˆ›å»ºif-elseè¯­å¥&quot;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;scope&quot;</span><span class=punctuation>:</span> <span class=string>&quot;source.mylang&quot;</span></span><br><span class=line>    <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>    </span><br><span class=line>    <span class=attr>&quot;For Loop&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>        <span class=attr>&quot;prefix&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span><span class=string>&quot;for&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;body&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>            <span class=string>&quot;for (let $&#123;1:i&#125; = 0; $&#123;1:i&#125; &lt; $&#123;2:length&#125;; $&#123;1:i&#125;++) &#123;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;\t$&#123;3:// loop body&#125;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;&#125;&quot;</span></span><br><span class=line>        <span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;description&quot;</span><span class=punctuation>:</span> <span class=string>&quot;åˆ›å»ºforå¾ªç¯&quot;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;scope&quot;</span><span class=punctuation>:</span> <span class=string>&quot;source.mylang&quot;</span></span><br><span class=line>    <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>    </span><br><span class=line>    <span class=attr>&quot;While Loop&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>        <span class=attr>&quot;prefix&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span><span class=string>&quot;while&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;body&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>            <span class=string>&quot;while ($&#123;1:condition&#125;) &#123;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;\t$&#123;2:// loop body&#125;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;&#125;&quot;</span></span><br><span class=line>        <span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;description&quot;</span><span class=punctuation>:</span> <span class=string>&quot;åˆ›å»ºwhileå¾ªç¯&quot;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;scope&quot;</span><span class=punctuation>:</span> <span class=string>&quot;source.mylang&quot;</span></span><br><span class=line>    <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>    </span><br><span class=line>    <span class=attr>&quot;Try-Catch&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>        <span class=attr>&quot;prefix&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span><span class=string>&quot;try&quot;</span><span class=punctuation>,</span> <span class=string>&quot;tryc&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;body&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>            <span class=string>&quot;try &#123;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;\t$&#123;1:// try body&#125;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;&#125; catch ($&#123;2:error&#125;) &#123;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;\t$&#123;3:// catch body&#125;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;&#125;&quot;</span></span><br><span class=line>        <span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;description&quot;</span><span class=punctuation>:</span> <span class=string>&quot;åˆ›å»ºtry-catchè¯­å¥&quot;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;scope&quot;</span><span class=punctuation>:</span> <span class=string>&quot;source.mylang&quot;</span></span><br><span class=line>    <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>    </span><br><span class=line>    <span class=attr>&quot;Variable Declaration&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>        <span class=attr>&quot;prefix&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span><span class=string>&quot;var&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;body&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>            <span class=string>&quot;$&#123;1|var,let,const|&#125; $&#123;2:variableName&#125; = $&#123;3:value&#125;;&quot;</span></span><br><span class=line>        <span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;description&quot;</span><span class=punctuation>:</span> <span class=string>&quot;åˆ›å»ºå˜é‡å£°æ˜&quot;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;scope&quot;</span><span class=punctuation>:</span> <span class=string>&quot;source.mylang&quot;</span></span><br><span class=line>    <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>    </span><br><span class=line>    <span class=attr>&quot;Console Log&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>        <span class=attr>&quot;prefix&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span><span class=string>&quot;log&quot;</span><span class=punctuation>,</span> <span class=string>&quot;console&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;body&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>            <span class=string>&quot;console.log($&#123;1:message&#125;);&quot;</span></span><br><span class=line>        <span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;description&quot;</span><span class=punctuation>:</span> <span class=string>&quot;åˆ›å»ºconsole.logè¯­å¥&quot;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;scope&quot;</span><span class=punctuation>:</span> <span class=string>&quot;source.mylang&quot;</span></span><br><span class=line>    <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>    </span><br><span class=line>    <span class=attr>&quot;Import Statement&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>        <span class=attr>&quot;prefix&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span><span class=string>&quot;import&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;body&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>            <span class=string>&quot;import &#123; $&#123;2:exports&#125; &#125; from &#x27;$&#123;1:module&#125;&#x27;;&quot;</span></span><br><span class=line>        <span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;description&quot;</span><span class=punctuation>:</span> <span class=string>&quot;åˆ›å»ºimportè¯­å¥&quot;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;scope&quot;</span><span class=punctuation>:</span> <span class=string>&quot;source.mylang&quot;</span></span><br><span class=line>    <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>    </span><br><span class=line>    <span class=attr>&quot;Export Statement&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>        <span class=attr>&quot;prefix&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span><span class=string>&quot;export&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;body&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>            <span class=string>&quot;export $&#123;1|default,|&#125; $&#123;2:exportName&#125;;&quot;</span></span><br><span class=line>        <span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;description&quot;</span><span class=punctuation>:</span> <span class=string>&quot;åˆ›å»ºexportè¯­å¥&quot;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;scope&quot;</span><span class=punctuation>:</span> <span class=string>&quot;source.mylang&quot;</span></span><br><span class=line>    <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>    </span><br><span class=line>    <span class=attr>&quot;Arrow Function&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>        <span class=attr>&quot;prefix&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span><span class=string>&quot;arrow&quot;</span><span class=punctuation>,</span> <span class=string>&quot;=&gt;&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;body&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>            <span class=string>&quot;const $&#123;1:functionName&#125; = ($&#123;2:parameters&#125;) =&gt; &#123;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;\t$&#123;3:// function body&#125;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;\treturn $&#123;4:undefined&#125;;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;&#125;;&quot;</span></span><br><span class=line>        <span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;description&quot;</span><span class=punctuation>:</span> <span class=string>&quot;åˆ›å»ºç®­å¤´å‡½æ•°&quot;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;scope&quot;</span><span class=punctuation>:</span> <span class=string>&quot;source.mylang&quot;</span></span><br><span class=line>    <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>    </span><br><span class=line>    <span class=attr>&quot;Async Function&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>        <span class=attr>&quot;prefix&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span><span class=string>&quot;async&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;body&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>            <span class=string>&quot;async function $&#123;1:functionName&#125;($&#123;2:parameters&#125;) &#123;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;\t$&#123;3:// async function body&#125;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;\treturn $&#123;4:undefined&#125;;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;&#125;&quot;</span></span><br><span class=line>        <span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;description&quot;</span><span class=punctuation>:</span> <span class=string>&quot;åˆ›å»ºå¼‚æ­¥å‡½æ•°&quot;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;scope&quot;</span><span class=punctuation>:</span> <span class=string>&quot;source.mylang&quot;</span></span><br><span class=line>    <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>    </span><br><span class=line>    <span class=attr>&quot;Interface Declaration&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>        <span class=attr>&quot;prefix&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span><span class=string>&quot;interface&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;body&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>            <span class=string>&quot;interface $&#123;1:InterfaceName&#125; &#123;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;\t$&#123;2:propertyName&#125;: $&#123;3:type&#125;;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;\t$&#123;4:methodName&#125;($&#123;5:parameters&#125;): $&#123;6:returnType&#125;;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;&#125;&quot;</span></span><br><span class=line>        <span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;description&quot;</span><span class=punctuation>:</span> <span class=string>&quot;åˆ›å»ºæ¥å£å£°æ˜&quot;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;scope&quot;</span><span class=punctuation>:</span> <span class=string>&quot;source.mylang&quot;</span></span><br><span class=line>    <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>    </span><br><span class=line>    <span class=attr>&quot;Enum Declaration&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>        <span class=attr>&quot;prefix&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span><span class=string>&quot;enum&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;body&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>            <span class=string>&quot;enum $&#123;1:EnumName&#125; &#123;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;\t$&#123;2:VALUE1&#125;,&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;\t$&#123;3:VALUE2&#125;,&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;\t$&#123;4:VALUE3&#125;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;&#125;&quot;</span></span><br><span class=line>        <span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;description&quot;</span><span class=punctuation>:</span> <span class=string>&quot;åˆ›å»ºæšä¸¾å£°æ˜&quot;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;scope&quot;</span><span class=punctuation>:</span> <span class=string>&quot;source.mylang&quot;</span></span><br><span class=line>    <span class=punctuation>&#125;</span></span><br><span class=line><span class=punctuation>&#125;</span></span><br></pre></td></tr></table></figure><hr><h2 id=ğŸ”-ç¬¬äºŒéƒ¨åˆ†ï¼šæ™ºèƒ½æ„ŸçŸ¥åŠŸèƒ½><a href=#ğŸ”-ç¬¬äºŒéƒ¨åˆ†ï¼šæ™ºèƒ½æ„ŸçŸ¥åŠŸèƒ½ class=headerlink title="ğŸ” ç¬¬äºŒéƒ¨åˆ†ï¼šæ™ºèƒ½æ„ŸçŸ¥åŠŸèƒ½"></a>ğŸ” ç¬¬äºŒéƒ¨åˆ†ï¼šæ™ºèƒ½æ„ŸçŸ¥åŠŸèƒ½</h2><h3 id=2-1-ä»£ç è¡¥å…¨æä¾›è€…><a href=#2-1-ä»£ç è¡¥å…¨æä¾›è€… class=headerlink title="2.1 ä»£ç è¡¥å…¨æä¾›è€…"></a>2.1 ä»£ç è¡¥å…¨æä¾›è€…</h3><figure class="highlight typescript"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br><span class=line>90</span><br><span class=line>91</span><br><span class=line>92</span><br><span class=line>93</span><br><span class=line>94</span><br><span class=line>95</span><br><span class=line>96</span><br><span class=line>97</span><br><span class=line>98</span><br><span class=line>99</span><br><span class=line>100</span><br><span class=line>101</span><br><span class=line>102</span><br><span class=line>103</span><br><span class=line>104</span><br><span class=line>105</span><br><span class=line>106</span><br><span class=line>107</span><br><span class=line>108</span><br><span class=line>109</span><br><span class=line>110</span><br><span class=line>111</span><br><span class=line>112</span><br><span class=line>113</span><br><span class=line>114</span><br><span class=line>115</span><br><span class=line>116</span><br><span class=line>117</span><br><span class=line>118</span><br><span class=line>119</span><br><span class=line>120</span><br><span class=line>121</span><br><span class=line>122</span><br><span class=line>123</span><br><span class=line>124</span><br><span class=line>125</span><br><span class=line>126</span><br><span class=line>127</span><br><span class=line>128</span><br><span class=line>129</span><br><span class=line>130</span><br><span class=line>131</span><br><span class=line>132</span><br><span class=line>133</span><br><span class=line>134</span><br><span class=line>135</span><br><span class=line>136</span><br><span class=line>137</span><br><span class=line>138</span><br><span class=line>139</span><br><span class=line>140</span><br><span class=line>141</span><br><span class=line>142</span><br><span class=line>143</span><br><span class=line>144</span><br><span class=line>145</span><br><span class=line>146</span><br><span class=line>147</span><br><span class=line>148</span><br><span class=line>149</span><br><span class=line>150</span><br><span class=line>151</span><br><span class=line>152</span><br><span class=line>153</span><br><span class=line>154</span><br><span class=line>155</span><br><span class=line>156</span><br><span class=line>157</span><br><span class=line>158</span><br><span class=line>159</span><br><span class=line>160</span><br><span class=line>161</span><br><span class=line>162</span><br><span class=line>163</span><br><span class=line>164</span><br><span class=line>165</span><br><span class=line>166</span><br><span class=line>167</span><br><span class=line>168</span><br><span class=line>169</span><br><span class=line>170</span><br><span class=line>171</span><br><span class=line>172</span><br><span class=line>173</span><br><span class=line>174</span><br><span class=line>175</span><br><span class=line>176</span><br><span class=line>177</span><br><span class=line>178</span><br><span class=line>179</span><br><span class=line>180</span><br><span class=line>181</span><br><span class=line>182</span><br><span class=line>183</span><br><span class=line>184</span><br><span class=line>185</span><br><span class=line>186</span><br><span class=line>187</span><br><span class=line>188</span><br><span class=line>189</span><br><span class=line>190</span><br><span class=line>191</span><br><span class=line>192</span><br><span class=line>193</span><br><span class=line>194</span><br><span class=line>195</span><br><span class=line>196</span><br><span class=line>197</span><br><span class=line>198</span><br><span class=line>199</span><br><span class=line>200</span><br><span class=line>201</span><br><span class=line>202</span><br><span class=line>203</span><br><span class=line>204</span><br><span class=line>205</span><br><span class=line>206</span><br><span class=line>207</span><br><span class=line>208</span><br><span class=line>209</span><br><span class=line>210</span><br><span class=line>211</span><br><span class=line>212</span><br><span class=line>213</span><br><span class=line>214</span><br><span class=line>215</span><br><span class=line>216</span><br><span class=line>217</span><br><span class=line>218</span><br><span class=line>219</span><br><span class=line>220</span><br><span class=line>221</span><br><span class=line>222</span><br><span class=line>223</span><br><span class=line>224</span><br><span class=line>225</span><br><span class=line>226</span><br><span class=line>227</span><br><span class=line>228</span><br><span class=line>229</span><br><span class=line>230</span><br><span class=line>231</span><br><span class=line>232</span><br><span class=line>233</span><br><span class=line>234</span><br><span class=line>235</span><br><span class=line>236</span><br><span class=line>237</span><br><span class=line>238</span><br><span class=line>239</span><br><span class=line>240</span><br><span class=line>241</span><br></pre></td><td class=code><pre><span class=line><span class=comment>// src/completionProvider.ts</span></span><br><span class=line><span class=keyword>import</span> * <span class=keyword>as</span> vscode <span class=keyword>from</span> <span class=string>&#x27;vscode&#x27;</span>;</span><br><span class=line></span><br><span class=line><span class=keyword>export</span> <span class=keyword>class</span> <span class="title class_">MyLangCompletionProvider</span> <span class=keyword>implements</span> vscode.<span class=property>CompletionItemProvider</span> &#123;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> keywords = [</span><br><span class=line>        <span class=string>&#x27;function&#x27;</span>, <span class=string>&#x27;var&#x27;</span>, <span class=string>&#x27;let&#x27;</span>, <span class=string>&#x27;const&#x27;</span>, <span class=string>&#x27;if&#x27;</span>, <span class=string>&#x27;else&#x27;</span>, <span class=string>&#x27;while&#x27;</span>, <span class=string>&#x27;for&#x27;</span>,</span><br><span class=line>        <span class=string>&#x27;return&#x27;</span>, <span class=string>&#x27;break&#x27;</span>, <span class=string>&#x27;continue&#x27;</span>, <span class=string>&#x27;class&#x27;</span>, <span class=string>&#x27;interface&#x27;</span>, <span class=string>&#x27;enum&#x27;</span>,</span><br><span class=line>        <span class=string>&#x27;import&#x27;</span>, <span class=string>&#x27;export&#x27;</span>, <span class=string>&#x27;async&#x27;</span>, <span class=string>&#x27;await&#x27;</span>, <span class=string>&#x27;try&#x27;</span>, <span class=string>&#x27;catch&#x27;</span>, <span class=string>&#x27;finally&#x27;</span></span><br><span class=line>    ];</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> builtinTypes = [</span><br><span class=line>        <span class=string>&#x27;string&#x27;</span>, <span class=string>&#x27;number&#x27;</span>, <span class=string>&#x27;boolean&#x27;</span>, <span class=string>&#x27;object&#x27;</span>, <span class=string>&#x27;array&#x27;</span>, <span class=string>&#x27;void&#x27;</span>, <span class=string>&#x27;any&#x27;</span></span><br><span class=line>    ];</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>async</span> <span class="title function_">provideCompletionItems</span>(</span><br><span class=line>        <span class=attr>document</span>: vscode.<span class=property>TextDocument</span>,</span><br><span class=line>        <span class=attr>position</span>: vscode.<span class=property>Position</span>,</span><br><span class=line>        <span class=attr>token</span>: vscode.<span class=property>CancellationToken</span>,</span><br><span class=line>        <span class=attr>context</span>: vscode.<span class=property>CompletionContext</span></span><br><span class=line>    ): <span class="title class_">Promise</span>&lt;vscode.<span class=property>CompletionItem</span>[]&gt; &#123;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>const</span> lineText = <span class="variable language_">document</span>.<span class="title function_">lineAt</span>(position).<span class=property>text</span>;</span><br><span class=line>        <span class=keyword>const</span> wordRange = <span class="variable language_">document</span>.<span class="title function_">getWordRangeAtPosition</span>(position);</span><br><span class=line>        <span class=keyword>const</span> currentWord = wordRange ? <span class="variable language_">document</span>.<span class="title function_">getText</span>(wordRange) : <span class=string>&#x27;&#x27;</span>;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>const</span> <span class=attr>completions</span>: vscode.<span class=property>CompletionItem</span>[] = [];</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// æ ¹æ®ä¸Šä¸‹æ–‡æä¾›ä¸åŒçš„è¡¥å…¨</span></span><br><span class=line>        <span class=keyword>if</span> (<span class="variable language_">this</span>.<span class="title function_">isInStringContext</span>(lineText, position.<span class=property>character</span>)) &#123;</span><br><span class=line>            <span class=comment>// å­—ç¬¦ä¸²å†…çš„è¡¥å…¨</span></span><br><span class=line>            completions.<span class="title function_">push</span>(...<span class="variable language_">this</span>.<span class="title function_">getStringCompletions</span>());</span><br><span class=line>        &#125; <span class=keyword>else</span> <span class=keyword>if</span> (<span class="variable language_">this</span>.<span class="title function_">isInCommentContext</span>(lineText, position.<span class=property>character</span>)) &#123;</span><br><span class=line>            <span class=comment>// æ³¨é‡Šå†…çš„è¡¥å…¨</span></span><br><span class=line>            completions.<span class="title function_">push</span>(...<span class="variable language_">this</span>.<span class="title function_">getCommentCompletions</span>());</span><br><span class=line>        &#125; <span class=keyword>else</span> &#123;</span><br><span class=line>            <span class=comment>// æ™®é€šä»£ç è¡¥å…¨</span></span><br><span class=line>            completions.<span class="title function_">push</span>(</span><br><span class=line>                ...<span class="variable language_">this</span>.<span class="title function_">getKeywordCompletions</span>(),</span><br><span class=line>                ...<span class="variable language_">this</span>.<span class="title function_">getTypeCompletions</span>(),</span><br><span class=line>                ...<span class="variable language_">this</span>.<span class="title function_">getFunctionCompletions</span>(<span class="variable language_">document</span>, position),</span><br><span class=line>                ...<span class="variable language_">this</span>.<span class="title function_">getVariableCompletions</span>(<span class="variable language_">document</span>, position),</span><br><span class=line>                ...<span class="variable language_">this</span>.<span class="title function_">getSnippetCompletions</span>()</span><br><span class=line>            );</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> completions.<span class="title function_">filter</span>(<span class=function><span class=params>item</span> =&gt;</span> </span><br><span class=line>            !currentWord || item.<span class=property>label</span>.<span class="title function_">toString</span>().<span class="title function_">toLowerCase</span>().<span class="title function_">includes</span>(currentWord.<span class="title function_">toLowerCase</span>())</span><br><span class=line>        );</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">getKeywordCompletions</span>(): vscode.<span class=property>CompletionItem</span>[] &#123;</span><br><span class=line>        <span class=keyword>return</span> <span class="variable language_">this</span>.<span class=property>keywords</span>.<span class="title function_">map</span>(<span class=function><span class=params>keyword</span> =&gt;</span> &#123;</span><br><span class=line>            <span class=keyword>const</span> item = <span class=keyword>new</span> vscode.<span class="title class_">CompletionItem</span>(keyword, vscode.<span class=property>CompletionItemKind</span>.<span class=property>Keyword</span>);</span><br><span class=line>            item.<span class=property>detail</span> = <span class=string>`å…³é”®å­— <span class=subst>$&#123;keyword&#125;</span>`</span>;</span><br><span class=line>            item.<span class=property>documentation</span> = <span class=keyword>new</span> vscode.<span class="title class_">MarkdownString</span>(<span class=string>`MyLangå…³é”®å­— \`<span class=subst>$&#123;keyword&#125;</span>\``</span>);</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// ä¸ºæŸäº›å…³é”®å­—æ·»åŠ ä»£ç ç‰‡æ®µ</span></span><br><span class=line>            <span class=keyword>switch</span> (keyword) &#123;</span><br><span class=line>                <span class=keyword>case</span> <span class=string>&#x27;function&#x27;</span>:</span><br><span class=line>                    item.<span class=property>insertText</span> = <span class=keyword>new</span> vscode.<span class="title class_">SnippetString</span>(<span class=string>&#x27;function $&#123;1:name&#125;($&#123;2:params&#125;) &#123;\n\t$0\n&#125;&#x27;</span>);</span><br><span class=line>                    <span class=keyword>break</span>;</span><br><span class=line>                <span class=keyword>case</span> <span class=string>&#x27;if&#x27;</span>:</span><br><span class=line>                    item.<span class=property>insertText</span> = <span class=keyword>new</span> vscode.<span class="title class_">SnippetString</span>(<span class=string>&#x27;if ($&#123;1:condition&#125;) &#123;\n\t$0\n&#125;&#x27;</span>);</span><br><span class=line>                    <span class=keyword>break</span>;</span><br><span class=line>                <span class=keyword>case</span> <span class=string>&#x27;for&#x27;</span>:</span><br><span class=line>                    item.<span class=property>insertText</span> = <span class=keyword>new</span> vscode.<span class="title class_">SnippetString</span>(<span class=string>&#x27;for (let $&#123;1:i&#125; = 0; $&#123;1:i&#125; &lt; $&#123;2:length&#125;; $&#123;1:i&#125;++) &#123;\n\t$0\n&#125;&#x27;</span>);</span><br><span class=line>                    <span class=keyword>break</span>;</span><br><span class=line>                <span class=keyword>case</span> <span class=string>&#x27;class&#x27;</span>:</span><br><span class=line>                    item.<span class=property>insertText</span> = <span class=keyword>new</span> vscode.<span class="title class_">SnippetString</span>(<span class=string>&#x27;class $&#123;1:ClassName&#125; &#123;\n\tconstructor($&#123;2:params&#125;) &#123;\n\t\t$0\n\t&#125;\n&#125;&#x27;</span>);</span><br><span class=line>                    <span class=keyword>break</span>;</span><br><span class=line>            &#125;</span><br><span class=line>            </span><br><span class=line>            <span class=keyword>return</span> item;</span><br><span class=line>        &#125;);</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">getTypeCompletions</span>(): vscode.<span class=property>CompletionItem</span>[] &#123;</span><br><span class=line>        <span class=keyword>return</span> <span class="variable language_">this</span>.<span class=property>builtinTypes</span>.<span class="title function_">map</span>(<span class=function><span class=params>type</span> =&gt;</span> &#123;</span><br><span class=line>            <span class=keyword>const</span> item = <span class=keyword>new</span> vscode.<span class="title class_">CompletionItem</span>(<span class=keyword>type</span>, vscode.<span class=property>CompletionItemKind</span>.<span class=property>TypeParameter</span>);</span><br><span class=line>            item.<span class=property>detail</span> = <span class=string>`å†…ç½®ç±»å‹ <span class=subst>$&#123;<span class=keyword>type</span>&#125;</span>`</span>;</span><br><span class=line>            item.<span class=property>documentation</span> = <span class=keyword>new</span> vscode.<span class="title class_">MarkdownString</span>(<span class=string>`MyLangå†…ç½®ç±»å‹ \`<span class=subst>$&#123;<span class=keyword>type</span>&#125;</span>\``</span>);</span><br><span class=line>            <span class=keyword>return</span> item;</span><br><span class=line>        &#125;);</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">getFunctionCompletions</span>(</span><br><span class=line>        <span class=attr>document</span>: vscode.<span class=property>TextDocument</span>,</span><br><span class=line>        <span class=attr>position</span>: vscode.<span class=property>Position</span></span><br><span class=line>    ): vscode.<span class=property>CompletionItem</span>[] &#123;</span><br><span class=line>        <span class=keyword>const</span> <span class=attr>functions</span>: vscode.<span class=property>CompletionItem</span>[] = [];</span><br><span class=line>        <span class=keyword>const</span> text = <span class="variable language_">document</span>.<span class="title function_">getText</span>();</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// è§£ææ–‡æ¡£ä¸­çš„å‡½æ•°å®šä¹‰</span></span><br><span class=line>        <span class=keyword>const</span> functionRegex = <span class=regexp>/function\s+(\w+)\s*\(([^)]*)\)/g</span>;</span><br><span class=line>        <span class=keyword>let</span> match;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>while</span> ((match = functionRegex.<span class="title function_">exec</span>(text)) !== <span class=literal>null</span>) &#123;</span><br><span class=line>            <span class=keyword>const</span> [, functionName, params] = match;</span><br><span class=line>            </span><br><span class=line>            <span class=keyword>const</span> item = <span class=keyword>new</span> vscode.<span class="title class_">CompletionItem</span>(functionName, vscode.<span class=property>CompletionItemKind</span>.<span class=property>Function</span>);</span><br><span class=line>            item.<span class=property>detail</span> = <span class=string>`function <span class=subst>$&#123;functionName&#125;</span>(<span class=subst>$&#123;params&#125;</span>)`</span>;</span><br><span class=line>            item.<span class=property>documentation</span> = <span class=keyword>new</span> vscode.<span class="title class_">MarkdownString</span>(<span class=string>`ç”¨æˆ·å®šä¹‰çš„å‡½æ•°\n\n\`\`\`mylang\nfunction <span class=subst>$&#123;functionName&#125;</span>(<span class=subst>$&#123;params&#125;</span>)\n\`\`\``</span>);</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// æ·»åŠ å‚æ•°æç¤º</span></span><br><span class=line>            <span class=keyword>const</span> paramList = params.<span class="title function_">split</span>(<span class=string>&#x27;,&#x27;</span>).<span class="title function_">map</span>(<span class=function>(<span class=params>p, i</span>) =&gt;</span> <span class=string>`\$&#123;<span class=subst>$&#123;i + <span class=number>1</span>&#125;</span>:<span class=subst>$&#123;p.trim()&#125;</span>&#125;`</span>).<span class="title function_">join</span>(<span class=string>&#x27;, &#x27;</span>);</span><br><span class=line>            item.<span class=property>insertText</span> = <span class=keyword>new</span> vscode.<span class="title class_">SnippetString</span>(<span class=string>`<span class=subst>$&#123;functionName&#125;</span>(<span class=subst>$&#123;paramList&#125;</span>)`</span>);</span><br><span class=line>            </span><br><span class=line>            functions.<span class="title function_">push</span>(item);</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// æ·»åŠ å†…ç½®å‡½æ•°</span></span><br><span class=line>        <span class=keyword>const</span> builtinFunctions = [</span><br><span class=line>            &#123;</span><br><span class=line>                <span class=attr>name</span>: <span class=string>&#x27;console.log&#x27;</span>,</span><br><span class=line>                <span class=attr>params</span>: <span class=string>&#x27;message&#x27;</span>,</span><br><span class=line>                <span class=attr>description</span>: <span class=string>&#x27;åœ¨æ§åˆ¶å°è¾“å‡ºæ¶ˆæ¯&#x27;</span></span><br><span class=line>            &#125;,</span><br><span class=line>            &#123;</span><br><span class=line>                <span class=attr>name</span>: <span class=string>&#x27;Math.abs&#x27;</span>,</span><br><span class=line>                <span class=attr>params</span>: <span class=string>&#x27;x&#x27;</span>,</span><br><span class=line>                <span class=attr>description</span>: <span class=string>&#x27;è¿”å›æ•°å­—çš„ç»å¯¹å€¼&#x27;</span></span><br><span class=line>            &#125;,</span><br><span class=line>            &#123;</span><br><span class=line>                <span class=attr>name</span>: <span class=string>&#x27;String.prototype.charAt&#x27;</span>,</span><br><span class=line>                <span class=attr>params</span>: <span class=string>&#x27;index&#x27;</span>,</span><br><span class=line>                <span class=attr>description</span>: <span class=string>&#x27;è¿”å›æŒ‡å®šä½ç½®çš„å­—ç¬¦&#x27;</span></span><br><span class=line>            &#125;</span><br><span class=line>        ];</span><br><span class=line>        </span><br><span class=line>        builtinFunctions.<span class="title function_">forEach</span>(<span class=function><span class=params>func</span> =&gt;</span> &#123;</span><br><span class=line>            <span class=keyword>const</span> item = <span class=keyword>new</span> vscode.<span class="title class_">CompletionItem</span>(func.<span class=property>name</span>, vscode.<span class=property>CompletionItemKind</span>.<span class=property>Function</span>);</span><br><span class=line>            item.<span class=property>detail</span> = <span class=string>`<span class=subst>$&#123;func.name&#125;</span>(<span class=subst>$&#123;func.params&#125;</span>)`</span>;</span><br><span class=line>            item.<span class=property>documentation</span> = <span class=keyword>new</span> vscode.<span class="title class_">MarkdownString</span>(func.<span class=property>description</span>);</span><br><span class=line>            item.<span class=property>insertText</span> = <span class=keyword>new</span> vscode.<span class="title class_">SnippetString</span>(<span class=string>`<span class=subst>$&#123;func.name&#125;</span>(\$&#123;1:<span class=subst>$&#123;func.params&#125;</span>&#125;)`</span>);</span><br><span class=line>            functions.<span class="title function_">push</span>(item);</span><br><span class=line>        &#125;);</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> functions;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">getVariableCompletions</span>(</span><br><span class=line>        <span class=attr>document</span>: vscode.<span class=property>TextDocument</span>,</span><br><span class=line>        <span class=attr>position</span>: vscode.<span class=property>Position</span></span><br><span class=line>    ): vscode.<span class=property>CompletionItem</span>[] &#123;</span><br><span class=line>        <span class=keyword>const</span> <span class=attr>variables</span>: vscode.<span class=property>CompletionItem</span>[] = [];</span><br><span class=line>        <span class=keyword>const</span> text = <span class="variable language_">document</span>.<span class="title function_">getText</span>(<span class=keyword>new</span> vscode.<span class="title class_">Range</span>(<span class=keyword>new</span> vscode.<span class="title class_">Position</span>(<span class=number>0</span>, <span class=number>0</span>), position));</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// è§£æå˜é‡å£°æ˜</span></span><br><span class=line>        <span class=keyword>const</span> variableRegex = <span class=regexp>/(var|let|const)\s+(\w+)/g</span>;</span><br><span class=line>        <span class=keyword>let</span> match;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>while</span> ((match = variableRegex.<span class="title function_">exec</span>(text)) !== <span class=literal>null</span>) &#123;</span><br><span class=line>            <span class=keyword>const</span> [, <span class=keyword>type</span>, variableName] = match;</span><br><span class=line>            </span><br><span class=line>            <span class=keyword>const</span> item = <span class=keyword>new</span> vscode.<span class="title class_">CompletionItem</span>(variableName, vscode.<span class=property>CompletionItemKind</span>.<span class=property>Variable</span>);</span><br><span class=line>            item.<span class=property>detail</span> = <span class=string>`<span class=subst>$&#123;<span class=keyword>type</span>&#125;</span> <span class=subst>$&#123;variableName&#125;</span>`</span>;</span><br><span class=line>            item.<span class=property>documentation</span> = <span class=keyword>new</span> vscode.<span class="title class_">MarkdownString</span>(<span class=string>`å˜é‡å£°æ˜ï¼š\`<span class=subst>$&#123;<span class=keyword>type</span>&#125;</span> <span class=subst>$&#123;variableName&#125;</span>\``</span>);</span><br><span class=line>            </span><br><span class=line>            variables.<span class="title function_">push</span>(item);</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> variables;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">getSnippetCompletions</span>(): vscode.<span class=property>CompletionItem</span>[] &#123;</span><br><span class=line>        <span class=keyword>const</span> snippets = [</span><br><span class=line>            &#123;</span><br><span class=line>                <span class=attr>label</span>: <span class=string>&#x27;log&#x27;</span>,</span><br><span class=line>                <span class=attr>detail</span>: <span class=string>&#x27;console.logè¯­å¥&#x27;</span>,</span><br><span class=line>                <span class=attr>snippet</span>: <span class=string>&#x27;console.log($&#123;1:message&#125;);&#x27;</span></span><br><span class=line>            &#125;,</span><br><span class=line>            &#123;</span><br><span class=line>                <span class=attr>label</span>: <span class=string>&#x27;func&#x27;</span>,</span><br><span class=line>                <span class=attr>detail</span>: <span class=string>&#x27;å‡½æ•°å£°æ˜&#x27;</span>,</span><br><span class=line>                <span class=attr>snippet</span>: <span class=string>&#x27;function $&#123;1:name&#125;($&#123;2:params&#125;) &#123;\n\t$&#123;3:// body&#125;\n\treturn $&#123;4:undefined&#125;;\n&#125;&#x27;</span></span><br><span class=line>            &#125;,</span><br><span class=line>            &#123;</span><br><span class=line>                <span class=attr>label</span>: <span class=string>&#x27;tryc&#x27;</span>,</span><br><span class=line>                <span class=attr>detail</span>: <span class=string>&#x27;try-catchè¯­å¥&#x27;</span>,</span><br><span class=line>                <span class=attr>snippet</span>: <span class=string>&#x27;try &#123;\n\t$&#123;1:// try body&#125;\n&#125; catch ($&#123;2:error&#125;) &#123;\n\t$&#123;3:// catch body&#125;\n&#125;&#x27;</span></span><br><span class=line>            &#125;</span><br><span class=line>        ];</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> snippets.<span class="title function_">map</span>(<span class=function><span class=params>snippet</span> =&gt;</span> &#123;</span><br><span class=line>            <span class=keyword>const</span> item = <span class=keyword>new</span> vscode.<span class="title class_">CompletionItem</span>(snippet.<span class=property>label</span>, vscode.<span class=property>CompletionItemKind</span>.<span class=property>Snippet</span>);</span><br><span class=line>            item.<span class=property>detail</span> = snippet.<span class=property>detail</span>;</span><br><span class=line>            item.<span class=property>insertText</span> = <span class=keyword>new</span> vscode.<span class="title class_">SnippetString</span>(snippet.<span class=property>snippet</span>);</span><br><span class=line>            item.<span class=property>documentation</span> = <span class=keyword>new</span> vscode.<span class="title class_">MarkdownString</span>(<span class=string>`ä»£ç ç‰‡æ®µï¼š<span class=subst>$&#123;snippet.detail&#125;</span>`</span>);</span><br><span class=line>            <span class=keyword>return</span> item;</span><br><span class=line>        &#125;);</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">getStringCompletions</span>(): vscode.<span class=property>CompletionItem</span>[] &#123;</span><br><span class=line>        <span class=comment>// å­—ç¬¦ä¸²å†…çš„ç‰¹æ®Šè¡¥å…¨ï¼ˆå¦‚æ¨¡æ¿å­—ç¬¦ä¸²å˜é‡ï¼‰</span></span><br><span class=line>        <span class=keyword>return</span> [</span><br><span class=line>            <span class=keyword>new</span> vscode.<span class="title class_">CompletionItem</span>(<span class=string>&#x27;$&#123;variable&#125;&#x27;</span>, vscode.<span class=property>CompletionItemKind</span>.<span class=property>Text</span>)</span><br><span class=line>        ];</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">getCommentCompletions</span>(): vscode.<span class=property>CompletionItem</span>[] &#123;</span><br><span class=line>        <span class=comment>// æ³¨é‡Šå†…çš„è¡¥å…¨ï¼ˆå¦‚TODOã€FIXMEï¼‰</span></span><br><span class=line>        <span class=keyword>const</span> commentKeywords = [<span class=string>&#x27;TODO&#x27;</span>, <span class=string>&#x27;FIXME&#x27;</span>, <span class=string>&#x27;NOTE&#x27;</span>, <span class=string>&#x27;HACK&#x27;</span>, <span class=string>&#x27;XXX&#x27;</span>];</span><br><span class=line>        <span class=keyword>return</span> commentKeywords.<span class="title function_">map</span>(<span class=function><span class=params>keyword</span> =&gt;</span> &#123;</span><br><span class=line>            <span class=keyword>const</span> item = <span class=keyword>new</span> vscode.<span class="title class_">CompletionItem</span>(keyword, vscode.<span class=property>CompletionItemKind</span>.<span class=property>Keyword</span>);</span><br><span class=line>            item.<span class=property>detail</span> = <span class=string>`æ³¨é‡Šå…³é”®å­— <span class=subst>$&#123;keyword&#125;</span>`</span>;</span><br><span class=line>            <span class=keyword>return</span> item;</span><br><span class=line>        &#125;);</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">isInStringContext</span>(<span class=attr>lineText</span>: <span class=built_in>string</span>, <span class=attr>position</span>: <span class=built_in>number</span>): <span class=built_in>boolean</span> &#123;</span><br><span class=line>        <span class=keyword>const</span> beforeCursor = lineText.<span class="title function_">substring</span>(<span class=number>0</span>, position);</span><br><span class=line>        <span class=keyword>const</span> quoteCount = (beforeCursor.<span class="title function_">match</span>(<span class=regexp>/&quot;/g</span>) || []).<span class=property>length</span>;</span><br><span class=line>        <span class=keyword>return</span> quoteCount % <span class=number>2</span> === <span class=number>1</span>;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">isInCommentContext</span>(<span class=attr>lineText</span>: <span class=built_in>string</span>, <span class=attr>position</span>: <span class=built_in>number</span>): <span class=built_in>boolean</span> &#123;</span><br><span class=line>        <span class=keyword>const</span> beforeCursor = lineText.<span class="title function_">substring</span>(<span class=number>0</span>, position);</span><br><span class=line>        <span class=keyword>return</span> beforeCursor.<span class="title function_">includes</span>(<span class=string>&#x27;//&#x27;</span>) || beforeCursor.<span class="title function_">includes</span>(<span class=string>&#x27;/*&#x27;</span>);</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class="title function_">resolveCompletionItem</span>(</span><br><span class=line>        <span class=attr>item</span>: vscode.<span class=property>CompletionItem</span>,</span><br><span class=line>        <span class=attr>token</span>: vscode.<span class=property>CancellationToken</span></span><br><span class=line>    ): vscode.<span class=property>ProviderResult</span>&lt;vscode.<span class=property>CompletionItem</span>&gt; &#123;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// ä¸ºè¡¥å…¨é¡¹æ·»åŠ æ›´è¯¦ç»†çš„ä¿¡æ¯</span></span><br><span class=line>        <span class=keyword>if</span> (item.<span class=property>kind</span> === vscode.<span class=property>CompletionItemKind</span>.<span class=property>Function</span>) &#123;</span><br><span class=line>            item.<span class=property>documentation</span> = <span class=keyword>new</span> vscode.<span class="title class_">MarkdownString</span>(</span><br><span class=line>                <span class=string>`å‡½æ•°ï¼š<span class=subst>$&#123;item.label&#125;</span>\n\n`</span> +</span><br><span class=line>                <span class=string>`**è¯¦ç»†ä¿¡æ¯ï¼š**\n`</span> +</span><br><span class=line>                <span class=string>`- å‚æ•°ï¼š<span class=subst>$&#123;item.detail&#125;</span>\n`</span> +</span><br><span class=line>                <span class=string>`- è¿”å›å€¼ï¼šæ ¹æ®å®ç°è€Œå®š\n\n`</span> +</span><br><span class=line>                <span class=string>`**ç¤ºä¾‹ï¼š**\n`</span> +</span><br><span class=line>                <span class=string>`\`\`\`mylang\n<span class=subst>$&#123;item.label&#125;</span>(å‚æ•°)\n\`\`\``</span></span><br><span class=line>            );</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> item;</span><br><span class=line>    &#125;</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><h3 id=2-2-æ‚¬åœä¿¡æ¯æä¾›è€…><a href=#2-2-æ‚¬åœä¿¡æ¯æä¾›è€… class=headerlink title="2.2 æ‚¬åœä¿¡æ¯æä¾›è€…"></a>2.2 æ‚¬åœä¿¡æ¯æä¾›è€…</h3><figure class="highlight typescript"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br><span class=line>90</span><br><span class=line>91</span><br><span class=line>92</span><br><span class=line>93</span><br><span class=line>94</span><br><span class=line>95</span><br><span class=line>96</span><br><span class=line>97</span><br><span class=line>98</span><br><span class=line>99</span><br><span class=line>100</span><br><span class=line>101</span><br><span class=line>102</span><br><span class=line>103</span><br><span class=line>104</span><br><span class=line>105</span><br><span class=line>106</span><br><span class=line>107</span><br><span class=line>108</span><br><span class=line>109</span><br><span class=line>110</span><br><span class=line>111</span><br><span class=line>112</span><br><span class=line>113</span><br><span class=line>114</span><br><span class=line>115</span><br><span class=line>116</span><br><span class=line>117</span><br><span class=line>118</span><br><span class=line>119</span><br><span class=line>120</span><br><span class=line>121</span><br><span class=line>122</span><br><span class=line>123</span><br><span class=line>124</span><br><span class=line>125</span><br><span class=line>126</span><br><span class=line>127</span><br><span class=line>128</span><br><span class=line>129</span><br><span class=line>130</span><br><span class=line>131</span><br><span class=line>132</span><br><span class=line>133</span><br><span class=line>134</span><br><span class=line>135</span><br><span class=line>136</span><br><span class=line>137</span><br><span class=line>138</span><br><span class=line>139</span><br><span class=line>140</span><br><span class=line>141</span><br><span class=line>142</span><br><span class=line>143</span><br><span class=line>144</span><br><span class=line>145</span><br><span class=line>146</span><br><span class=line>147</span><br><span class=line>148</span><br><span class=line>149</span><br><span class=line>150</span><br><span class=line>151</span><br><span class=line>152</span><br><span class=line>153</span><br><span class=line>154</span><br><span class=line>155</span><br><span class=line>156</span><br><span class=line>157</span><br><span class=line>158</span><br><span class=line>159</span><br><span class=line>160</span><br><span class=line>161</span><br><span class=line>162</span><br><span class=line>163</span><br><span class=line>164</span><br><span class=line>165</span><br><span class=line>166</span><br><span class=line>167</span><br><span class=line>168</span><br><span class=line>169</span><br><span class=line>170</span><br><span class=line>171</span><br><span class=line>172</span><br><span class=line>173</span><br><span class=line>174</span><br><span class=line>175</span><br><span class=line>176</span><br><span class=line>177</span><br><span class=line>178</span><br><span class=line>179</span><br><span class=line>180</span><br><span class=line>181</span><br><span class=line>182</span><br><span class=line>183</span><br><span class=line>184</span><br><span class=line>185</span><br><span class=line>186</span><br><span class=line>187</span><br><span class=line>188</span><br><span class=line>189</span><br><span class=line>190</span><br><span class=line>191</span><br><span class=line>192</span><br><span class=line>193</span><br><span class=line>194</span><br><span class=line>195</span><br><span class=line>196</span><br><span class=line>197</span><br><span class=line>198</span><br><span class=line>199</span><br><span class=line>200</span><br><span class=line>201</span><br><span class=line>202</span><br><span class=line>203</span><br><span class=line>204</span><br><span class=line>205</span><br><span class=line>206</span><br><span class=line>207</span><br><span class=line>208</span><br><span class=line>209</span><br><span class=line>210</span><br><span class=line>211</span><br><span class=line>212</span><br><span class=line>213</span><br><span class=line>214</span><br><span class=line>215</span><br><span class=line>216</span><br><span class=line>217</span><br><span class=line>218</span><br><span class=line>219</span><br><span class=line>220</span><br><span class=line>221</span><br><span class=line>222</span><br><span class=line>223</span><br><span class=line>224</span><br><span class=line>225</span><br><span class=line>226</span><br><span class=line>227</span><br><span class=line>228</span><br><span class=line>229</span><br><span class=line>230</span><br><span class=line>231</span><br><span class=line>232</span><br><span class=line>233</span><br><span class=line>234</span><br><span class=line>235</span><br><span class=line>236</span><br><span class=line>237</span><br><span class=line>238</span><br><span class=line>239</span><br><span class=line>240</span><br><span class=line>241</span><br><span class=line>242</span><br><span class=line>243</span><br><span class=line>244</span><br><span class=line>245</span><br><span class=line>246</span><br><span class=line>247</span><br><span class=line>248</span><br><span class=line>249</span><br><span class=line>250</span><br><span class=line>251</span><br><span class=line>252</span><br><span class=line>253</span><br><span class=line>254</span><br><span class=line>255</span><br><span class=line>256</span><br><span class=line>257</span><br><span class=line>258</span><br><span class=line>259</span><br><span class=line>260</span><br><span class=line>261</span><br><span class=line>262</span><br><span class=line>263</span><br><span class=line>264</span><br><span class=line>265</span><br><span class=line>266</span><br><span class=line>267</span><br><span class=line>268</span><br><span class=line>269</span><br><span class=line>270</span><br><span class=line>271</span><br><span class=line>272</span><br><span class=line>273</span><br><span class=line>274</span><br><span class=line>275</span><br><span class=line>276</span><br><span class=line>277</span><br><span class=line>278</span><br><span class=line>279</span><br><span class=line>280</span><br><span class=line>281</span><br><span class=line>282</span><br><span class=line>283</span><br><span class=line>284</span><br><span class=line>285</span><br><span class=line>286</span><br><span class=line>287</span><br><span class=line>288</span><br><span class=line>289</span><br><span class=line>290</span><br><span class=line>291</span><br><span class=line>292</span><br><span class=line>293</span><br><span class=line>294</span><br><span class=line>295</span><br><span class=line>296</span><br><span class=line>297</span><br><span class=line>298</span><br><span class=line>299</span><br><span class=line>300</span><br><span class=line>301</span><br><span class=line>302</span><br><span class=line>303</span><br><span class=line>304</span><br><span class=line>305</span><br><span class=line>306</span><br><span class=line>307</span><br><span class=line>308</span><br><span class=line>309</span><br><span class=line>310</span><br><span class=line>311</span><br><span class=line>312</span><br><span class=line>313</span><br><span class=line>314</span><br><span class=line>315</span><br><span class=line>316</span><br><span class=line>317</span><br><span class=line>318</span><br><span class=line>319</span><br><span class=line>320</span><br><span class=line>321</span><br><span class=line>322</span><br><span class=line>323</span><br><span class=line>324</span><br><span class=line>325</span><br><span class=line>326</span><br><span class=line>327</span><br><span class=line>328</span><br><span class=line>329</span><br><span class=line>330</span><br><span class=line>331</span><br><span class=line>332</span><br><span class=line>333</span><br><span class=line>334</span><br><span class=line>335</span><br><span class=line>336</span><br><span class=line>337</span><br><span class=line>338</span><br><span class=line>339</span><br><span class=line>340</span><br><span class=line>341</span><br><span class=line>342</span><br><span class=line>343</span><br><span class=line>344</span><br><span class=line>345</span><br><span class=line>346</span><br><span class=line>347</span><br><span class=line>348</span><br><span class=line>349</span><br><span class=line>350</span><br><span class=line>351</span><br><span class=line>352</span><br><span class=line>353</span><br><span class=line>354</span><br><span class=line>355</span><br></pre></td><td class=code><pre><span class=line><span class=comment>// src/hoverProvider.ts</span></span><br><span class=line><span class=keyword>import</span> * <span class=keyword>as</span> vscode <span class=keyword>from</span> <span class=string>&#x27;vscode&#x27;</span>;</span><br><span class=line></span><br><span class=line><span class=keyword>export</span> <span class=keyword>class</span> <span class="title class_">MyLangHoverProvider</span> <span class=keyword>implements</span> vscode.<span class=property>HoverProvider</span> &#123;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>async</span> <span class="title function_">provideHover</span>(</span><br><span class=line>        <span class=attr>document</span>: vscode.<span class=property>TextDocument</span>,</span><br><span class=line>        <span class=attr>position</span>: vscode.<span class=property>Position</span>,</span><br><span class=line>        <span class=attr>token</span>: vscode.<span class=property>CancellationToken</span></span><br><span class=line>    ): <span class="title class_">Promise</span>&lt;vscode.<span class=property>Hover</span> | <span class=literal>undefined</span>&gt; &#123;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>const</span> wordRange = <span class="variable language_">document</span>.<span class="title function_">getWordRangeAtPosition</span>(position);</span><br><span class=line>        <span class=keyword>if</span> (!wordRange) &#123;</span><br><span class=line>            <span class=keyword>return</span> <span class=literal>undefined</span>;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>const</span> word = <span class="variable language_">document</span>.<span class="title function_">getText</span>(wordRange);</span><br><span class=line>        <span class=keyword>const</span> line = <span class="variable language_">document</span>.<span class="title function_">lineAt</span>(position.<span class=property>line</span>).<span class=property>text</span>;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// è·å–æ‚¬åœä¿¡æ¯</span></span><br><span class=line>        <span class=keyword>const</span> hoverInfo = <span class=keyword>await</span> <span class="variable language_">this</span>.<span class="title function_">getHoverInfo</span>(<span class="variable language_">document</span>, word, position, line);</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>if</span> (hoverInfo) &#123;</span><br><span class=line>            <span class=keyword>return</span> <span class=keyword>new</span> vscode.<span class="title class_">Hover</span>(hoverInfo, wordRange);</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> <span class=literal>undefined</span>;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class=keyword>async</span> <span class="title function_">getHoverInfo</span>(</span><br><span class=line>        <span class=attr>document</span>: vscode.<span class=property>TextDocument</span>,</span><br><span class=line>        <span class=attr>word</span>: <span class=built_in>string</span>,</span><br><span class=line>        <span class=attr>position</span>: vscode.<span class=property>Position</span>,</span><br><span class=line>        <span class=attr>line</span>: <span class=built_in>string</span></span><br><span class=line>    ): <span class="title class_">Promise</span>&lt;vscode.<span class=property>MarkdownString</span> | <span class=literal>undefined</span>&gt; &#123;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// æ£€æŸ¥æ˜¯å¦æ˜¯å…³é”®å­—</span></span><br><span class=line>        <span class=keyword>if</span> (<span class="variable language_">this</span>.<span class="title function_">isKeyword</span>(word)) &#123;</span><br><span class=line>            <span class=keyword>return</span> <span class="variable language_">this</span>.<span class="title function_">getKeywordHover</span>(word);</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// æ£€æŸ¥æ˜¯å¦æ˜¯å‡½æ•°è°ƒç”¨</span></span><br><span class=line>        <span class=keyword>if</span> (<span class="variable language_">this</span>.<span class="title function_">isFunctionCall</span>(line, word)) &#123;</span><br><span class=line>            <span class=keyword>return</span> <span class="variable language_">this</span>.<span class="title function_">getFunctionHover</span>(<span class="variable language_">document</span>, word);</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// æ£€æŸ¥æ˜¯å¦æ˜¯å˜é‡</span></span><br><span class=line>        <span class=keyword>if</span> (<span class="variable language_">this</span>.<span class="title function_">isVariable</span>(<span class="variable language_">document</span>, word, position)) &#123;</span><br><span class=line>            <span class=keyword>return</span> <span class="variable language_">this</span>.<span class="title function_">getVariableHover</span>(<span class="variable language_">document</span>, word, position);</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// æ£€æŸ¥æ˜¯å¦æ˜¯ç±»å‹</span></span><br><span class=line>        <span class=keyword>if</span> (<span class="variable language_">this</span>.<span class="title function_">isType</span>(word)) &#123;</span><br><span class=line>            <span class=keyword>return</span> <span class="variable language_">this</span>.<span class="title function_">getTypeHover</span>(word);</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// æ£€æŸ¥æ˜¯å¦æ˜¯å†…ç½®å‡½æ•°æˆ–å¯¹è±¡</span></span><br><span class=line>        <span class=keyword>if</span> (<span class="variable language_">this</span>.<span class="title function_">isBuiltinFunction</span>(word)) &#123;</span><br><span class=line>            <span class=keyword>return</span> <span class="variable language_">this</span>.<span class="title function_">getBuiltinFunctionHover</span>(word);</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> <span class=literal>undefined</span>;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">isKeyword</span>(<span class=attr>word</span>: <span class=built_in>string</span>): <span class=built_in>boolean</span> &#123;</span><br><span class=line>        <span class=keyword>const</span> keywords = [</span><br><span class=line>            <span class=string>&#x27;function&#x27;</span>, <span class=string>&#x27;var&#x27;</span>, <span class=string>&#x27;let&#x27;</span>, <span class=string>&#x27;const&#x27;</span>, <span class=string>&#x27;if&#x27;</span>, <span class=string>&#x27;else&#x27;</span>, <span class=string>&#x27;while&#x27;</span>, <span class=string>&#x27;for&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;return&#x27;</span>, <span class=string>&#x27;break&#x27;</span>, <span class=string>&#x27;continue&#x27;</span>, <span class=string>&#x27;class&#x27;</span>, <span class=string>&#x27;interface&#x27;</span>, <span class=string>&#x27;enum&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;import&#x27;</span>, <span class=string>&#x27;export&#x27;</span>, <span class=string>&#x27;async&#x27;</span>, <span class=string>&#x27;await&#x27;</span>, <span class=string>&#x27;try&#x27;</span>, <span class=string>&#x27;catch&#x27;</span>, <span class=string>&#x27;finally&#x27;</span></span><br><span class=line>        ];</span><br><span class=line>        <span class=keyword>return</span> keywords.<span class="title function_">includes</span>(word);</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">getKeywordHover</span>(<span class=attr>keyword</span>: <span class=built_in>string</span>): vscode.<span class=property>MarkdownString</span> &#123;</span><br><span class=line>        <span class=keyword>const</span> <span class=attr>descriptions</span>: <span class="title class_">Record</span>&lt;<span class=built_in>string</span>, <span class=built_in>string</span>&gt; = &#123;</span><br><span class=line>            <span class=string>&#x27;function&#x27;</span>: <span class=string>&#x27;ç”¨äºå£°æ˜å‡½æ•°çš„å…³é”®å­—&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;var&#x27;</span>: <span class=string>&#x27;å£°æ˜å˜é‡ï¼ˆå‡½æ•°ä½œç”¨åŸŸï¼‰&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;let&#x27;</span>: <span class=string>&#x27;å£°æ˜å˜é‡ï¼ˆå—ä½œç”¨åŸŸï¼‰&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;const&#x27;</span>: <span class=string>&#x27;å£°æ˜å¸¸é‡ï¼ˆå—ä½œç”¨åŸŸï¼‰&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;if&#x27;</span>: <span class=string>&#x27;æ¡ä»¶è¯­å¥&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;else&#x27;</span>: <span class=string>&#x27;æ¡ä»¶è¯­å¥çš„å¦åˆ™åˆ†æ”¯&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;while&#x27;</span>: <span class=string>&#x27;å¾ªç¯è¯­å¥&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;for&#x27;</span>: <span class=string>&#x27;å¾ªç¯è¯­å¥&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;return&#x27;</span>: <span class=string>&#x27;å‡½æ•°è¿”å›è¯­å¥&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;break&#x27;</span>: <span class=string>&#x27;è·³å‡ºå¾ªç¯æˆ–switchè¯­å¥&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;continue&#x27;</span>: <span class=string>&#x27;è·³è¿‡å½“å‰å¾ªç¯è¿­ä»£&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;class&#x27;</span>: <span class=string>&#x27;å£°æ˜ç±»&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;interface&#x27;</span>: <span class=string>&#x27;å£°æ˜æ¥å£&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;enum&#x27;</span>: <span class=string>&#x27;å£°æ˜æšä¸¾&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;import&#x27;</span>: <span class=string>&#x27;å¯¼å…¥æ¨¡å—&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;export&#x27;</span>: <span class=string>&#x27;å¯¼å‡ºæ¨¡å—æˆå‘˜&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;async&#x27;</span>: <span class=string>&#x27;å£°æ˜å¼‚æ­¥å‡½æ•°&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;await&#x27;</span>: <span class=string>&#x27;ç­‰å¾…å¼‚æ­¥æ“ä½œå®Œæˆ&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;try&#x27;</span>: <span class=string>&#x27;å¼‚å¸¸å¤„ç†è¯­å¥&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;catch&#x27;</span>: <span class=string>&#x27;æ•è·å¼‚å¸¸&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;finally&#x27;</span>: <span class=string>&#x27;å¼‚å¸¸å¤„ç†çš„æœ€ç»ˆæ‰§è¡Œå—&#x27;</span></span><br><span class=line>        &#125;;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>const</span> description = descriptions[keyword] || <span class=string>&#x27;å…³é”®å­—&#x27;</span>;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>const</span> markdown = <span class=keyword>new</span> vscode.<span class="title class_">MarkdownString</span>();</span><br><span class=line>        markdown.<span class="title function_">appendCodeblock</span>(<span class=string>`<span class=subst>$&#123;keyword&#125;</span>`</span>, <span class=string>&#x27;mylang&#x27;</span>);</span><br><span class=line>        markdown.<span class="title function_">appendMarkdown</span>(<span class=string>`**å…³é”®å­—ï¼š** <span class=subst>$&#123;keyword&#125;</span>\n\n`</span>);</span><br><span class=line>        markdown.<span class="title function_">appendMarkdown</span>(<span class=string>`**æè¿°ï¼š** <span class=subst>$&#123;description&#125;</span>\n\n`</span>);</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// æ·»åŠ ä½¿ç”¨ç¤ºä¾‹</span></span><br><span class=line>        <span class=keyword>const</span> <span class=attr>examples</span>: <span class="title class_">Record</span>&lt;<span class=built_in>string</span>, <span class=built_in>string</span>&gt; = &#123;</span><br><span class=line>            <span class=string>&#x27;function&#x27;</span>: <span class=string>&#x27;function myFunction(param1, param2) &#123;\n    return param1 + param2;\n&#125;&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;if&#x27;</span>: <span class=string>&#x27;if (condition) &#123;\n    // æ‰§è¡Œä»£ç \n&#125;&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;for&#x27;</span>: <span class=string>&#x27;for (let i = 0; i &lt; 10; i++) &#123;\n    // å¾ªç¯ä½“\n&#125;&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;class&#x27;</span>: <span class=string>&#x27;class MyClass &#123;\n    constructor() &#123;\n        // æ„é€ å‡½æ•°\n    &#125;\n&#125;&#x27;</span></span><br><span class=line>        &#125;;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>if</span> (examples[keyword]) &#123;</span><br><span class=line>            markdown.<span class="title function_">appendMarkdown</span>(<span class=string>`**ç¤ºä¾‹ï¼š**\n`</span>);</span><br><span class=line>            markdown.<span class="title function_">appendCodeblock</span>(examples[keyword], <span class=string>&#x27;mylang&#x27;</span>);</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> markdown;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">isFunctionCall</span>(<span class=attr>line</span>: <span class=built_in>string</span>, <span class=attr>word</span>: <span class=built_in>string</span>): <span class=built_in>boolean</span> &#123;</span><br><span class=line>        <span class=keyword>const</span> functionCallPattern = <span class=keyword>new</span> <span class="title class_">RegExp</span>(<span class=string>`\\b<span class=subst>$&#123;word&#125;</span>\\s*\\(`</span>);</span><br><span class=line>        <span class=keyword>return</span> functionCallPattern.<span class="title function_">test</span>(line);</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">getFunctionHover</span>(<span class=attr>document</span>: vscode.<span class=property>TextDocument</span>, <span class=attr>functionName</span>: <span class=built_in>string</span>): vscode.<span class=property>MarkdownString</span> &#123;</span><br><span class=line>        <span class=keyword>const</span> text = <span class="variable language_">document</span>.<span class="title function_">getText</span>();</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// æŸ¥æ‰¾å‡½æ•°å®šä¹‰</span></span><br><span class=line>        <span class=keyword>const</span> functionDefPattern = <span class=keyword>new</span> <span class="title class_">RegExp</span>(<span class=string>`function\\s+<span class=subst>$&#123;functionName&#125;</span>\\s*\\(([^)]*)\\)\\s*\\&#123;`</span>, <span class=string>&#x27;g&#x27;</span>);</span><br><span class=line>        <span class=keyword>const</span> match = functionDefPattern.<span class="title function_">exec</span>(text);</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>const</span> markdown = <span class=keyword>new</span> vscode.<span class="title class_">MarkdownString</span>();</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>if</span> (match) &#123;</span><br><span class=line>            <span class=keyword>const</span> params = match[<span class=number>1</span>];</span><br><span class=line>            markdown.<span class="title function_">appendCodeblock</span>(<span class=string>`function <span class=subst>$&#123;functionName&#125;</span>(<span class=subst>$&#123;params&#125;</span>)`</span>, <span class=string>&#x27;mylang&#x27;</span>);</span><br><span class=line>            markdown.<span class="title function_">appendMarkdown</span>(<span class=string>`**å‡½æ•°ï¼š** <span class=subst>$&#123;functionName&#125;</span>\n\n`</span>);</span><br><span class=line>            markdown.<span class="title function_">appendMarkdown</span>(<span class=string>`**å‚æ•°ï¼š** <span class=subst>$&#123;params || <span class=string>&#x27;æ— &#x27;</span>&#125;</span>\n\n`</span>);</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// å°è¯•æå–å‡½æ•°æ³¨é‡Š</span></span><br><span class=line>            <span class=keyword>const</span> functionComment = <span class="variable language_">this</span>.<span class="title function_">extractFunctionComment</span>(text, match.<span class=property>index</span>);</span><br><span class=line>            <span class=keyword>if</span> (functionComment) &#123;</span><br><span class=line>                markdown.<span class="title function_">appendMarkdown</span>(<span class=string>`**æè¿°ï¼š** <span class=subst>$&#123;functionComment&#125;</span>\n\n`</span>);</span><br><span class=line>            &#125;</span><br><span class=line>        &#125; <span class=keyword>else</span> &#123;</span><br><span class=line>            <span class=comment>// æ£€æŸ¥æ˜¯å¦æ˜¯å†…ç½®å‡½æ•°</span></span><br><span class=line>            <span class=keyword>const</span> builtinInfo = <span class="variable language_">this</span>.<span class="title function_">getBuiltinFunctionInfo</span>(functionName);</span><br><span class=line>            <span class=keyword>if</span> (builtinInfo) &#123;</span><br><span class=line>                markdown.<span class="title function_">appendCodeblock</span>(<span class=string>`<span class=subst>$&#123;functionName&#125;</span>(<span class=subst>$&#123;builtinInfo.params&#125;</span>)`</span>, <span class=string>&#x27;mylang&#x27;</span>);</span><br><span class=line>                markdown.<span class="title function_">appendMarkdown</span>(<span class=string>`**å†…ç½®å‡½æ•°ï¼š** <span class=subst>$&#123;functionName&#125;</span>\n\n`</span>);</span><br><span class=line>                markdown.<span class="title function_">appendMarkdown</span>(<span class=string>`**æè¿°ï¼š** <span class=subst>$&#123;builtinInfo.description&#125;</span>\n\n`</span>);</span><br><span class=line>                markdown.<span class="title function_">appendMarkdown</span>(<span class=string>`**è¿”å›å€¼ï¼š** <span class=subst>$&#123;builtinInfo.returnType&#125;</span>\n\n`</span>);</span><br><span class=line>            &#125; <span class=keyword>else</span> &#123;</span><br><span class=line>                markdown.<span class="title function_">appendCodeblock</span>(functionName, <span class=string>&#x27;mylang&#x27;</span>);</span><br><span class=line>                markdown.<span class="title function_">appendMarkdown</span>(<span class=string>`**å‡½æ•°ï¼š** <span class=subst>$&#123;functionName&#125;</span>\n\n`</span>);</span><br><span class=line>                markdown.<span class="title function_">appendMarkdown</span>(<span class=string>`*æœªæ‰¾åˆ°å‡½æ•°å®šä¹‰*`</span>);</span><br><span class=line>            &#125;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> markdown;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">isVariable</span>(<span class=attr>document</span>: vscode.<span class=property>TextDocument</span>, <span class=attr>word</span>: <span class=built_in>string</span>, <span class=attr>position</span>: vscode.<span class=property>Position</span>): <span class=built_in>boolean</span> &#123;</span><br><span class=line>        <span class=keyword>const</span> text = <span class="variable language_">document</span>.<span class="title function_">getText</span>(<span class=keyword>new</span> vscode.<span class="title class_">Range</span>(<span class=keyword>new</span> vscode.<span class="title class_">Position</span>(<span class=number>0</span>, <span class=number>0</span>), position));</span><br><span class=line>        <span class=keyword>const</span> variablePattern = <span class=keyword>new</span> <span class="title class_">RegExp</span>(<span class=string>`\\b(var|let|const)\\s+<span class=subst>$&#123;word&#125;</span>\\b`</span>);</span><br><span class=line>        <span class=keyword>return</span> variablePattern.<span class="title function_">test</span>(text);</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">getVariableHover</span>(</span><br><span class=line>        <span class=attr>document</span>: vscode.<span class=property>TextDocument</span>,</span><br><span class=line>        <span class=attr>variableName</span>: <span class=built_in>string</span>,</span><br><span class=line>        <span class=attr>position</span>: vscode.<span class=property>Position</span></span><br><span class=line>    ): vscode.<span class=property>MarkdownString</span> &#123;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>const</span> text = <span class="variable language_">document</span>.<span class="title function_">getText</span>(<span class=keyword>new</span> vscode.<span class="title class_">Range</span>(<span class=keyword>new</span> vscode.<span class="title class_">Position</span>(<span class=number>0</span>, <span class=number>0</span>), position));</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// æŸ¥æ‰¾å˜é‡å£°æ˜</span></span><br><span class=line>        <span class=keyword>const</span> variablePattern = <span class=keyword>new</span> <span class="title class_">RegExp</span>(<span class=string>`\\b(var|let|const)\\s+<span class=subst>$&#123;variableName&#125;</span>(\\s*=\\s*([^;\\n]+))?`</span>, <span class=string>&#x27;g&#x27;</span>);</span><br><span class=line>        <span class=keyword>const</span> matches = <span class="title class_">Array</span>.<span class="title function_">from</span>(text.<span class="title function_">matchAll</span>(variablePattern));</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>const</span> markdown = <span class=keyword>new</span> vscode.<span class="title class_">MarkdownString</span>();</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>if</span> (matches.<span class=property>length</span> &gt; <span class=number>0</span>) &#123;</span><br><span class=line>            <span class=keyword>const</span> lastMatch = matches[matches.<span class=property>length</span> - <span class=number>1</span>];</span><br><span class=line>            <span class=keyword>const</span> [, declarationType, , initialValue] = lastMatch;</span><br><span class=line>            </span><br><span class=line>            markdown.<span class="title function_">appendCodeblock</span>(<span class=string>`<span class=subst>$&#123;declarationType&#125;</span> <span class=subst>$&#123;variableName&#125;</span><span class=subst>$&#123;initialValue ? <span class=string>` = <span class=subst>$&#123;initialValue&#125;</span>`</span> : <span class=string>&#x27;&#x27;</span>&#125;</span>`</span>, <span class=string>&#x27;mylang&#x27;</span>);</span><br><span class=line>            markdown.<span class="title function_">appendMarkdown</span>(<span class=string>`**å˜é‡ï¼š** <span class=subst>$&#123;variableName&#125;</span>\n\n`</span>);</span><br><span class=line>            markdown.<span class="title function_">appendMarkdown</span>(<span class=string>`**ç±»å‹ï¼š** <span class=subst>$&#123;declarationType&#125;</span>\n\n`</span>);</span><br><span class=line>            </span><br><span class=line>            <span class=keyword>if</span> (initialValue) &#123;</span><br><span class=line>                markdown.<span class="title function_">appendMarkdown</span>(<span class=string>`**åˆå§‹å€¼ï¼š** <span class=subst>$&#123;initialValue.trim()&#125;</span>\n\n`</span>);</span><br><span class=line>                </span><br><span class=line>                <span class=comment>// å°è¯•æ¨æ–­ç±»å‹</span></span><br><span class=line>                <span class=keyword>const</span> inferredType = <span class="variable language_">this</span>.<span class="title function_">inferType</span>(initialValue.<span class="title function_">trim</span>());</span><br><span class=line>                <span class=keyword>if</span> (inferredType) &#123;</span><br><span class=line>                    markdown.<span class="title function_">appendMarkdown</span>(<span class=string>`**æ¨æ–­ç±»å‹ï¼š** <span class=subst>$&#123;inferredType&#125;</span>\n\n`</span>);</span><br><span class=line>                &#125;</span><br><span class=line>            &#125;</span><br><span class=line>        &#125; <span class=keyword>else</span> &#123;</span><br><span class=line>            markdown.<span class="title function_">appendCodeblock</span>(variableName, <span class=string>&#x27;mylang&#x27;</span>);</span><br><span class=line>            markdown.<span class="title function_">appendMarkdown</span>(<span class=string>`**å˜é‡ï¼š** <span class=subst>$&#123;variableName&#125;</span>\n\n`</span>);</span><br><span class=line>            markdown.<span class="title function_">appendMarkdown</span>(<span class=string>`*æœªæ‰¾åˆ°å˜é‡å£°æ˜*`</span>);</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> markdown;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">isType</span>(<span class=attr>word</span>: <span class=built_in>string</span>): <span class=built_in>boolean</span> &#123;</span><br><span class=line>        <span class=keyword>const</span> types = [<span class=string>&#x27;string&#x27;</span>, <span class=string>&#x27;number&#x27;</span>, <span class=string>&#x27;boolean&#x27;</span>, <span class=string>&#x27;object&#x27;</span>, <span class=string>&#x27;array&#x27;</span>, <span class=string>&#x27;void&#x27;</span>, <span class=string>&#x27;any&#x27;</span>];</span><br><span class=line>        <span class=keyword>return</span> types.<span class="title function_">includes</span>(word);</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">getTypeHover</span>(<span class=attr>typeName</span>: <span class=built_in>string</span>): vscode.<span class=property>MarkdownString</span> &#123;</span><br><span class=line>        <span class=keyword>const</span> <span class=attr>typeDescriptions</span>: <span class="title class_">Record</span>&lt;<span class=built_in>string</span>, <span class=built_in>string</span>&gt; = &#123;</span><br><span class=line>            <span class=string>&#x27;string&#x27;</span>: <span class=string>&#x27;å­—ç¬¦ä¸²ç±»å‹ - è¡¨ç¤ºæ–‡æœ¬æ•°æ®&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;number&#x27;</span>: <span class=string>&#x27;æ•°å­—ç±»å‹ - è¡¨ç¤ºæ•´æ•°æˆ–æµ®ç‚¹æ•°&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;boolean&#x27;</span>: <span class=string>&#x27;å¸ƒå°”ç±»å‹ - è¡¨ç¤ºtrueæˆ–false&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;object&#x27;</span>: <span class=string>&#x27;å¯¹è±¡ç±»å‹ - è¡¨ç¤ºå¤åˆæ•°æ®ç»“æ„&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;array&#x27;</span>: <span class=string>&#x27;æ•°ç»„ç±»å‹ - è¡¨ç¤ºæœ‰åºçš„å…ƒç´ é›†åˆ&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;void&#x27;</span>: <span class=string>&#x27;voidç±»å‹ - è¡¨ç¤ºæ— è¿”å›å€¼&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;any&#x27;</span>: <span class=string>&#x27;anyç±»å‹ - è¡¨ç¤ºä»»æ„ç±»å‹&#x27;</span></span><br><span class=line>        &#125;;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>const</span> markdown = <span class=keyword>new</span> vscode.<span class="title class_">MarkdownString</span>();</span><br><span class=line>        markdown.<span class="title function_">appendCodeblock</span>(typeName, <span class=string>&#x27;mylang&#x27;</span>);</span><br><span class=line>        markdown.<span class="title function_">appendMarkdown</span>(<span class=string>`**ç±»å‹ï¼š** <span class=subst>$&#123;typeName&#125;</span>\n\n`</span>);</span><br><span class=line>        markdown.<span class="title function_">appendMarkdown</span>(<span class=string>`**æè¿°ï¼š** <span class=subst>$&#123;typeDescriptions[typeName]&#125;</span>\n\n`</span>);</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> markdown;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">isBuiltinFunction</span>(<span class=attr>word</span>: <span class=built_in>string</span>): <span class=built_in>boolean</span> &#123;</span><br><span class=line>        <span class=keyword>const</span> builtinFunctions = [<span class=string>&#x27;console&#x27;</span>, <span class=string>&#x27;Math&#x27;</span>, <span class=string>&#x27;String&#x27;</span>, <span class=string>&#x27;Array&#x27;</span>, <span class=string>&#x27;Object&#x27;</span>, <span class=string>&#x27;Date&#x27;</span>];</span><br><span class=line>        <span class=keyword>return</span> builtinFunctions.<span class="title function_">some</span>(<span class=function><span class=params>builtin</span> =&gt;</span> word.<span class="title function_">startsWith</span>(builtin));</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">getBuiltinFunctionHover</span>(<span class=attr>word</span>: <span class=built_in>string</span>): vscode.<span class=property>MarkdownString</span> &#123;</span><br><span class=line>        <span class=keyword>const</span> builtinInfo = <span class="variable language_">this</span>.<span class="title function_">getBuiltinFunctionInfo</span>(word);</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>const</span> markdown = <span class=keyword>new</span> vscode.<span class="title class_">MarkdownString</span>();</span><br><span class=line>        markdown.<span class="title function_">appendCodeblock</span>(word, <span class=string>&#x27;mylang&#x27;</span>);</span><br><span class=line>        markdown.<span class="title function_">appendMarkdown</span>(<span class=string>`**å†…ç½®å¯¹è±¡/æ–¹æ³•ï¼š** <span class=subst>$&#123;word&#125;</span>\n\n`</span>);</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>if</span> (builtinInfo) &#123;</span><br><span class=line>            markdown.<span class="title function_">appendMarkdown</span>(<span class=string>`**æè¿°ï¼š** <span class=subst>$&#123;builtinInfo.description&#125;</span>\n\n`</span>);</span><br><span class=line>            <span class=keyword>if</span> (builtinInfo.<span class=property>params</span>) &#123;</span><br><span class=line>                markdown.<span class="title function_">appendMarkdown</span>(<span class=string>`**å‚æ•°ï¼š** <span class=subst>$&#123;builtinInfo.params&#125;</span>\n\n`</span>);</span><br><span class=line>            &#125;</span><br><span class=line>            <span class=keyword>if</span> (builtinInfo.<span class=property>returnType</span>) &#123;</span><br><span class=line>                markdown.<span class="title function_">appendMarkdown</span>(<span class=string>`**è¿”å›å€¼ï¼š** <span class=subst>$&#123;builtinInfo.returnType&#125;</span>\n\n`</span>);</span><br><span class=line>            &#125;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> markdown;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">getBuiltinFunctionInfo</span>(<span class=attr>name</span>: <span class=built_in>string</span>): &#123;</span><br><span class=line>        <span class=attr>description</span>: <span class=built_in>string</span>;</span><br><span class=line>        params?: <span class=built_in>string</span>;</span><br><span class=line>        returnType?: <span class=built_in>string</span>;</span><br><span class=line>    &#125; | <span class=literal>undefined</span> &#123;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>const</span> <span class=attr>builtins</span>: <span class="title class_">Record</span>&lt;<span class=built_in>string</span>, <span class=built_in>any</span>&gt; = &#123;</span><br><span class=line>            <span class=string>&#x27;console.log&#x27;</span>: &#123;</span><br><span class=line>                <span class=attr>description</span>: <span class=string>&#x27;åœ¨æ§åˆ¶å°è¾“å‡ºä¿¡æ¯&#x27;</span>,</span><br><span class=line>                <span class=attr>params</span>: <span class=string>&#x27;message: any&#x27;</span>,</span><br><span class=line>                <span class=attr>returnType</span>: <span class=string>&#x27;void&#x27;</span></span><br><span class=line>            &#125;,</span><br><span class=line>            <span class=string>&#x27;Math.abs&#x27;</span>: &#123;</span><br><span class=line>                <span class=attr>description</span>: <span class=string>&#x27;è¿”å›æ•°å­—çš„ç»å¯¹å€¼&#x27;</span>,</span><br><span class=line>                <span class=attr>params</span>: <span class=string>&#x27;x: number&#x27;</span>,</span><br><span class=line>                <span class=attr>returnType</span>: <span class=string>&#x27;number&#x27;</span></span><br><span class=line>            &#125;,</span><br><span class=line>            <span class=string>&#x27;Math.max&#x27;</span>: &#123;</span><br><span class=line>                <span class=attr>description</span>: <span class=string>&#x27;è¿”å›æœ€å¤§å€¼&#x27;</span>,</span><br><span class=line>                <span class=attr>params</span>: <span class=string>&#x27;...values: number[]&#x27;</span>,</span><br><span class=line>                <span class=attr>returnType</span>: <span class=string>&#x27;number&#x27;</span></span><br><span class=line>            &#125;,</span><br><span class=line>            <span class=string>&#x27;String.prototype.charAt&#x27;</span>: &#123;</span><br><span class=line>                <span class=attr>description</span>: <span class=string>&#x27;è¿”å›æŒ‡å®šä½ç½®çš„å­—ç¬¦&#x27;</span>,</span><br><span class=line>                <span class=attr>params</span>: <span class=string>&#x27;index: number&#x27;</span>,</span><br><span class=line>                <span class=attr>returnType</span>: <span class=string>&#x27;string&#x27;</span></span><br><span class=line>            &#125;,</span><br><span class=line>            <span class=string>&#x27;Array.prototype.push&#x27;</span>: &#123;</span><br><span class=line>                <span class=attr>description</span>: <span class=string>&#x27;å‘æ•°ç»„æœ«å°¾æ·»åŠ å…ƒç´ &#x27;</span>,</span><br><span class=line>                <span class=attr>params</span>: <span class=string>&#x27;...items: any[]&#x27;</span>,</span><br><span class=line>                <span class=attr>returnType</span>: <span class=string>&#x27;number&#x27;</span></span><br><span class=line>            &#125;</span><br><span class=line>        &#125;;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> builtins[name];</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">extractFunctionComment</span>(<span class=attr>text</span>: <span class=built_in>string</span>, <span class=attr>functionIndex</span>: <span class=built_in>number</span>): <span class=built_in>string</span> | <span class=literal>undefined</span> &#123;</span><br><span class=line>        <span class=comment>// å‘å‰æŸ¥æ‰¾æ³¨é‡Š</span></span><br><span class=line>        <span class=keyword>const</span> beforeFunction = text.<span class="title function_">substring</span>(<span class=number>0</span>, functionIndex);</span><br><span class=line>        <span class=keyword>const</span> lines = beforeFunction.<span class="title function_">split</span>(<span class=string>&#x27;\n&#x27;</span>);</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// ä»å‡½æ•°å®šä¹‰è¡Œå¾€å‰æŸ¥æ‰¾æ³¨é‡Š</span></span><br><span class=line>        <span class=keyword>for</span> (<span class=keyword>let</span> i = lines.<span class=property>length</span> - <span class=number>1</span>; i &gt;= <span class=number>0</span>; i--) &#123;</span><br><span class=line>            <span class=keyword>const</span> line = lines[i].<span class="title function_">trim</span>();</span><br><span class=line>            </span><br><span class=line>            <span class=keyword>if</span> (line.<span class="title function_">startsWith</span>(<span class=string>&#x27;//&#x27;</span>)) &#123;</span><br><span class=line>                <span class=keyword>return</span> line.<span class="title function_">substring</span>(<span class=number>2</span>).<span class="title function_">trim</span>();</span><br><span class=line>            &#125; <span class=keyword>else</span> <span class=keyword>if</span> (line.<span class="title function_">includes</span>(<span class=string>&#x27;/*&#x27;</span>) &amp;&amp; line.<span class="title function_">includes</span>(<span class=string>&#x27;*/&#x27;</span>)) &#123;</span><br><span class=line>                <span class=keyword>const</span> commentMatch = line.<span class="title function_">match</span>(<span class=regexp>/\/\*(.*?)\*\//</span>);</span><br><span class=line>                <span class=keyword>if</span> (commentMatch) &#123;</span><br><span class=line>                    <span class=keyword>return</span> commentMatch[<span class=number>1</span>].<span class="title function_">trim</span>();</span><br><span class=line>                &#125;</span><br><span class=line>            &#125; <span class=keyword>else</span> <span class=keyword>if</span> (line &amp;&amp; !line.<span class="title function_">startsWith</span>(<span class=string>&#x27;//&#x27;</span>) &amp;&amp; !line.<span class="title function_">includes</span>(<span class=string>&#x27;/*&#x27;</span>)) &#123;</span><br><span class=line>                <span class=comment>// å¦‚æœé‡åˆ°éæ³¨é‡Šçš„éç©ºè¡Œï¼Œåœæ­¢æŸ¥æ‰¾</span></span><br><span class=line>                <span class=keyword>break</span>;</span><br><span class=line>            &#125;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> <span class=literal>undefined</span>;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">inferType</span>(<span class=attr>value</span>: <span class=built_in>string</span>): <span class=built_in>string</span> | <span class=literal>undefined</span> &#123;</span><br><span class=line>        value = value.<span class="title function_">trim</span>();</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>if</span> (value.<span class="title function_">startsWith</span>(<span class=string>&#x27;&quot;&#x27;</span>) &amp;&amp; value.<span class="title function_">endsWith</span>(<span class=string>&#x27;&quot;&#x27;</span>)) &#123;</span><br><span class=line>            <span class=keyword>return</span> <span class=string>&#x27;string&#x27;</span>;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>if</span> (value.<span class="title function_">startsWith</span>(<span class=string>&quot;&#x27;&quot;</span>) &amp;&amp; value.<span class="title function_">endsWith</span>(<span class=string>&quot;&#x27;&quot;</span>)) &#123;</span><br><span class=line>            <span class=keyword>return</span> <span class=string>&#x27;string&#x27;</span>;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>if</span> (<span class=regexp>/^\d+$/</span>.<span class="title function_">test</span>(value)) &#123;</span><br><span class=line>            <span class=keyword>return</span> <span class=string>&#x27;number&#x27;</span>;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>if</span> (<span class=regexp>/^\d+\.\d+$/</span>.<span class="title function_">test</span>(value)) &#123;</span><br><span class=line>            <span class=keyword>return</span> <span class=string>&#x27;number&#x27;</span>;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>if</span> (value === <span class=string>&#x27;true&#x27;</span> || value === <span class=string>&#x27;false&#x27;</span>) &#123;</span><br><span class=line>            <span class=keyword>return</span> <span class=string>&#x27;boolean&#x27;</span>;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>if</span> (value.<span class="title function_">startsWith</span>(<span class=string>&#x27;[&#x27;</span>) &amp;&amp; value.<span class="title function_">endsWith</span>(<span class=string>&#x27;]&#x27;</span>)) &#123;</span><br><span class=line>            <span class=keyword>return</span> <span class=string>&#x27;array&#x27;</span>;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>if</span> (value.<span class="title function_">startsWith</span>(<span class=string>&#x27;&#123;&#x27;</span>) &amp;&amp; value.<span class="title function_">endsWith</span>(<span class=string>&#x27;&#125;&#x27;</span>)) &#123;</span><br><span class=line>            <span class=keyword>return</span> <span class=string>&#x27;object&#x27;</span>;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> <span class=literal>undefined</span>;</span><br><span class=line>    &#125;</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><h3 id=2-3-è¯Šæ–­æä¾›è€…><a href=#2-3-è¯Šæ–­æä¾›è€… class=headerlink title="2.3 è¯Šæ–­æä¾›è€…"></a>2.3 è¯Šæ–­æä¾›è€…</h3><figure class="highlight typescript"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br><span class=line>90</span><br><span class=line>91</span><br><span class=line>92</span><br><span class=line>93</span><br><span class=line>94</span><br><span class=line>95</span><br><span class=line>96</span><br><span class=line>97</span><br><span class=line>98</span><br><span class=line>99</span><br><span class=line>100</span><br><span class=line>101</span><br><span class=line>102</span><br><span class=line>103</span><br><span class=line>104</span><br><span class=line>105</span><br><span class=line>106</span><br><span class=line>107</span><br><span class=line>108</span><br><span class=line>109</span><br><span class=line>110</span><br><span class=line>111</span><br><span class=line>112</span><br><span class=line>113</span><br><span class=line>114</span><br><span class=line>115</span><br><span class=line>116</span><br><span class=line>117</span><br><span class=line>118</span><br><span class=line>119</span><br><span class=line>120</span><br><span class=line>121</span><br><span class=line>122</span><br><span class=line>123</span><br><span class=line>124</span><br><span class=line>125</span><br><span class=line>126</span><br><span class=line>127</span><br><span class=line>128</span><br><span class=line>129</span><br><span class=line>130</span><br><span class=line>131</span><br><span class=line>132</span><br><span class=line>133</span><br><span class=line>134</span><br><span class=line>135</span><br><span class=line>136</span><br><span class=line>137</span><br><span class=line>138</span><br><span class=line>139</span><br><span class=line>140</span><br><span class=line>141</span><br><span class=line>142</span><br><span class=line>143</span><br><span class=line>144</span><br><span class=line>145</span><br><span class=line>146</span><br><span class=line>147</span><br><span class=line>148</span><br><span class=line>149</span><br><span class=line>150</span><br><span class=line>151</span><br><span class=line>152</span><br><span class=line>153</span><br><span class=line>154</span><br><span class=line>155</span><br><span class=line>156</span><br><span class=line>157</span><br><span class=line>158</span><br><span class=line>159</span><br><span class=line>160</span><br><span class=line>161</span><br><span class=line>162</span><br><span class=line>163</span><br><span class=line>164</span><br><span class=line>165</span><br><span class=line>166</span><br><span class=line>167</span><br><span class=line>168</span><br><span class=line>169</span><br><span class=line>170</span><br><span class=line>171</span><br><span class=line>172</span><br><span class=line>173</span><br><span class=line>174</span><br><span class=line>175</span><br><span class=line>176</span><br><span class=line>177</span><br><span class=line>178</span><br><span class=line>179</span><br><span class=line>180</span><br><span class=line>181</span><br><span class=line>182</span><br><span class=line>183</span><br><span class=line>184</span><br><span class=line>185</span><br><span class=line>186</span><br><span class=line>187</span><br><span class=line>188</span><br><span class=line>189</span><br><span class=line>190</span><br><span class=line>191</span><br><span class=line>192</span><br><span class=line>193</span><br><span class=line>194</span><br><span class=line>195</span><br><span class=line>196</span><br><span class=line>197</span><br><span class=line>198</span><br><span class=line>199</span><br><span class=line>200</span><br><span class=line>201</span><br><span class=line>202</span><br><span class=line>203</span><br><span class=line>204</span><br><span class=line>205</span><br><span class=line>206</span><br><span class=line>207</span><br><span class=line>208</span><br><span class=line>209</span><br><span class=line>210</span><br><span class=line>211</span><br><span class=line>212</span><br><span class=line>213</span><br><span class=line>214</span><br><span class=line>215</span><br><span class=line>216</span><br><span class=line>217</span><br><span class=line>218</span><br><span class=line>219</span><br><span class=line>220</span><br><span class=line>221</span><br><span class=line>222</span><br><span class=line>223</span><br><span class=line>224</span><br><span class=line>225</span><br><span class=line>226</span><br><span class=line>227</span><br><span class=line>228</span><br><span class=line>229</span><br><span class=line>230</span><br><span class=line>231</span><br><span class=line>232</span><br><span class=line>233</span><br><span class=line>234</span><br><span class=line>235</span><br><span class=line>236</span><br><span class=line>237</span><br><span class=line>238</span><br><span class=line>239</span><br><span class=line>240</span><br><span class=line>241</span><br><span class=line>242</span><br><span class=line>243</span><br><span class=line>244</span><br><span class=line>245</span><br><span class=line>246</span><br><span class=line>247</span><br><span class=line>248</span><br><span class=line>249</span><br><span class=line>250</span><br><span class=line>251</span><br><span class=line>252</span><br><span class=line>253</span><br><span class=line>254</span><br><span class=line>255</span><br><span class=line>256</span><br><span class=line>257</span><br><span class=line>258</span><br><span class=line>259</span><br><span class=line>260</span><br><span class=line>261</span><br><span class=line>262</span><br><span class=line>263</span><br><span class=line>264</span><br><span class=line>265</span><br><span class=line>266</span><br><span class=line>267</span><br><span class=line>268</span><br><span class=line>269</span><br><span class=line>270</span><br><span class=line>271</span><br><span class=line>272</span><br><span class=line>273</span><br><span class=line>274</span><br><span class=line>275</span><br><span class=line>276</span><br><span class=line>277</span><br><span class=line>278</span><br><span class=line>279</span><br><span class=line>280</span><br><span class=line>281</span><br><span class=line>282</span><br><span class=line>283</span><br></pre></td><td class=code><pre><span class=line><span class=comment>// src/diagnosticProvider.ts</span></span><br><span class=line><span class=keyword>import</span> * <span class=keyword>as</span> vscode <span class=keyword>from</span> <span class=string>&#x27;vscode&#x27;</span>;</span><br><span class=line></span><br><span class=line><span class=keyword>export</span> <span class=keyword>class</span> <span class="title class_">MyLangDiagnosticProvider</span> &#123;</span><br><span class=line>    <span class=keyword>private</span> <span class=attr>diagnosticCollection</span>: vscode.<span class=property>DiagnosticCollection</span>;</span><br><span class=line>    </span><br><span class=line>    <span class="title function_">constructor</span>(<span class=params></span>) &#123;</span><br><span class=line>        <span class="variable language_">this</span>.<span class=property>diagnosticCollection</span> = vscode.<span class=property>languages</span>.<span class="title function_">createDiagnosticCollection</span>(<span class=string>&#x27;mylang&#x27;</span>);</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>async</span> <span class="title function_">provideDiagnostics</span>(<span class=attr>document</span>: vscode.<span class=property>TextDocument</span>): <span class="title class_">Promise</span>&lt;<span class=built_in>void</span>&gt; &#123;</span><br><span class=line>        <span class=keyword>const</span> <span class=attr>diagnostics</span>: vscode.<span class=property>Diagnostic</span>[] = [];</span><br><span class=line>        <span class=keyword>const</span> text = <span class="variable language_">document</span>.<span class="title function_">getText</span>();</span><br><span class=line>        <span class=keyword>const</span> lines = text.<span class="title function_">split</span>(<span class=string>&#x27;\n&#x27;</span>);</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>for</span> (<span class=keyword>let</span> lineIndex = <span class=number>0</span>; lineIndex &lt; lines.<span class=property>length</span>; lineIndex++) &#123;</span><br><span class=line>            <span class=keyword>const</span> line = lines[lineIndex];</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// æ£€æŸ¥è¯­æ³•é”™è¯¯</span></span><br><span class=line>            diagnostics.<span class="title function_">push</span>(...<span class="variable language_">this</span>.<span class="title function_">checkSyntaxErrors</span>(line, lineIndex));</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// æ£€æŸ¥æœªä½¿ç”¨çš„å˜é‡</span></span><br><span class=line>            diagnostics.<span class="title function_">push</span>(...<span class="variable language_">this</span>.<span class="title function_">checkUnusedVariables</span>(<span class="variable language_">document</span>, lineIndex));</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// æ£€æŸ¥ç±»å‹é”™è¯¯</span></span><br><span class=line>            diagnostics.<span class="title function_">push</span>(...<span class="variable language_">this</span>.<span class="title function_">checkTypeErrors</span>(line, lineIndex));</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// æ£€æŸ¥ä»£ç é£æ ¼é—®é¢˜</span></span><br><span class=line>            diagnostics.<span class="title function_">push</span>(...<span class="variable language_">this</span>.<span class="title function_">checkStyleIssues</span>(line, lineIndex));</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// æ£€æŸ¥æœ€ä½³å®è·µ</span></span><br><span class=line>            diagnostics.<span class="title function_">push</span>(...<span class="variable language_">this</span>.<span class="title function_">checkBestPractices</span>(line, lineIndex));</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class="variable language_">this</span>.<span class=property>diagnosticCollection</span>.<span class="title function_">set</span>(<span class="variable language_">document</span>.<span class=property>uri</span>, diagnostics);</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">checkSyntaxErrors</span>(<span class=attr>line</span>: <span class=built_in>string</span>, <span class=attr>lineIndex</span>: <span class=built_in>number</span>): vscode.<span class=property>Diagnostic</span>[] &#123;</span><br><span class=line>        <span class=keyword>const</span> <span class=attr>diagnostics</span>: vscode.<span class=property>Diagnostic</span>[] = [];</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// æ£€æŸ¥æœªé—­åˆçš„æ‹¬å·</span></span><br><span class=line>        <span class=keyword>const</span> openParens = (line.<span class="title function_">match</span>(<span class=regexp>/\(/g</span>) || []).<span class=property>length</span>;</span><br><span class=line>        <span class=keyword>const</span> closeParens = (line.<span class="title function_">match</span>(<span class=regexp>/\)/g</span>) || []).<span class=property>length</span>;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>if</span> (openParens &gt; closeParens) &#123;</span><br><span class=line>            <span class=keyword>const</span> lastOpenParen = line.<span class="title function_">lastIndexOf</span>(<span class=string>&#x27;(&#x27;</span>);</span><br><span class=line>            <span class=keyword>if</span> (lastOpenParen !== -<span class=number>1</span>) &#123;</span><br><span class=line>                <span class=keyword>const</span> diagnostic = <span class=keyword>new</span> vscode.<span class="title class_">Diagnostic</span>(</span><br><span class=line>                    <span class=keyword>new</span> vscode.<span class="title class_">Range</span>(lineIndex, lastOpenParen, lineIndex, lastOpenParen + <span class=number>1</span>),</span><br><span class=line>                    <span class=string>&#x27;ç¼ºå°‘é—­åˆæ‹¬å·&#x27;</span>,</span><br><span class=line>                    vscode.<span class=property>DiagnosticSeverity</span>.<span class=property>Error</span></span><br><span class=line>                );</span><br><span class=line>                diagnostic.<span class=property>code</span> = <span class=string>&#x27;missing-close-paren&#x27;</span>;</span><br><span class=line>                diagnostic.<span class=property>source</span> = <span class=string>&#x27;mylang&#x27;</span>;</span><br><span class=line>                diagnostics.<span class="title function_">push</span>(diagnostic);</span><br><span class=line>            &#125;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// æ£€æŸ¥æœªé—­åˆçš„å¤§æ‹¬å·</span></span><br><span class=line>        <span class=keyword>const</span> openBraces = (line.<span class="title function_">match</span>(<span class=regexp>/\&#123;/g</span>) || []).<span class=property>length</span>;</span><br><span class=line>        <span class=keyword>const</span> closeBraces = (line.<span class="title function_">match</span>(<span class=regexp>/\&#125;/g</span>) || []).<span class=property>length</span>;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>if</span> (openBraces &gt; closeBraces &amp;&amp; !line.<span class="title function_">trim</span>().<span class="title function_">endsWith</span>(<span class=string>&#x27;&#123;&#x27;</span>)) &#123;</span><br><span class=line>            <span class=keyword>const</span> lastOpenBrace = line.<span class="title function_">lastIndexOf</span>(<span class=string>&#x27;&#123;&#x27;</span>);</span><br><span class=line>            <span class=keyword>if</span> (lastOpenBrace !== -<span class=number>1</span>) &#123;</span><br><span class=line>                <span class=keyword>const</span> diagnostic = <span class=keyword>new</span> vscode.<span class="title class_">Diagnostic</span>(</span><br><span class=line>                    <span class=keyword>new</span> vscode.<span class="title class_">Range</span>(lineIndex, lastOpenBrace, lineIndex, lastOpenBrace + <span class=number>1</span>),</span><br><span class=line>                    <span class=string>&#x27;ç¼ºå°‘é—­åˆå¤§æ‹¬å·&#x27;</span>,</span><br><span class=line>                    vscode.<span class=property>DiagnosticSeverity</span>.<span class=property>Error</span></span><br><span class=line>                );</span><br><span class=line>                diagnostic.<span class=property>code</span> = <span class=string>&#x27;missing-close-brace&#x27;</span>;</span><br><span class=line>                diagnostic.<span class=property>source</span> = <span class=string>&#x27;mylang&#x27;</span>;</span><br><span class=line>                diagnostics.<span class="title function_">push</span>(diagnostic);</span><br><span class=line>            &#125;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// æ£€æŸ¥æœªç»ˆæ­¢çš„å­—ç¬¦ä¸²</span></span><br><span class=line>        <span class=keyword>const</span> quotes = (line.<span class="title function_">match</span>(<span class=regexp>/&quot;/g</span>) || []).<span class=property>length</span>;</span><br><span class=line>        <span class=keyword>if</span> (quotes % <span class=number>2</span> === <span class=number>1</span> &amp;&amp; !line.<span class="title function_">trim</span>().<span class="title function_">endsWith</span>(<span class=string>&#x27;\\&#x27;</span>)) &#123;</span><br><span class=line>            <span class=keyword>const</span> lastQuote = line.<span class="title function_">lastIndexOf</span>(<span class=string>&#x27;&quot;&#x27;</span>);</span><br><span class=line>            <span class=keyword>const</span> diagnostic = <span class=keyword>new</span> vscode.<span class="title class_">Diagnostic</span>(</span><br><span class=line>                <span class=keyword>new</span> vscode.<span class="title class_">Range</span>(lineIndex, lastQuote, lineIndex, line.<span class=property>length</span>),</span><br><span class=line>                <span class=string>&#x27;æœªç»ˆæ­¢çš„å­—ç¬¦ä¸²&#x27;</span>,</span><br><span class=line>                vscode.<span class=property>DiagnosticSeverity</span>.<span class=property>Error</span></span><br><span class=line>            );</span><br><span class=line>            diagnostic.<span class=property>code</span> = <span class=string>&#x27;unterminated-string&#x27;</span>;</span><br><span class=line>            diagnostic.<span class=property>source</span> = <span class=string>&#x27;mylang&#x27;</span>;</span><br><span class=line>            diagnostics.<span class="title function_">push</span>(diagnostic);</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// æ£€æŸ¥æ— æ•ˆçš„å…³é”®å­—ä½¿ç”¨</span></span><br><span class=line>        <span class=keyword>const</span> invalidKeywordUsage = <span class=regexp>/\b(function|class|interface)\s*\(/g</span>;</span><br><span class=line>        <span class=keyword>let</span> match;</span><br><span class=line>        <span class=keyword>while</span> ((match = invalidKeywordUsage.<span class="title function_">exec</span>(line)) !== <span class=literal>null</span>) &#123;</span><br><span class=line>            <span class=keyword>const</span> diagnostic = <span class=keyword>new</span> vscode.<span class="title class_">Diagnostic</span>(</span><br><span class=line>                <span class=keyword>new</span> vscode.<span class="title class_">Range</span>(lineIndex, match.<span class=property>index</span>, lineIndex, match.<span class=property>index</span> + match[<span class=number>0</span>].<span class=property>length</span>),</span><br><span class=line>                <span class=string>`å…³é”®å­— <span class=subst>$&#123;match[<span class=number>1</span>]&#125;</span> ä½¿ç”¨é”™è¯¯`</span>,</span><br><span class=line>                vscode.<span class=property>DiagnosticSeverity</span>.<span class=property>Error</span></span><br><span class=line>            );</span><br><span class=line>            diagnostic.<span class=property>code</span> = <span class=string>&#x27;invalid-keyword-usage&#x27;</span>;</span><br><span class=line>            diagnostic.<span class=property>source</span> = <span class=string>&#x27;mylang&#x27;</span>;</span><br><span class=line>            diagnostics.<span class="title function_">push</span>(diagnostic);</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> diagnostics;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">checkUnusedVariables</span>(<span class=attr>document</span>: vscode.<span class=property>TextDocument</span>, <span class=attr>lineIndex</span>: <span class=built_in>number</span>): vscode.<span class=property>Diagnostic</span>[] &#123;</span><br><span class=line>        <span class=keyword>const</span> <span class=attr>diagnostics</span>: vscode.<span class=property>Diagnostic</span>[] = [];</span><br><span class=line>        <span class=keyword>const</span> line = <span class="variable language_">document</span>.<span class="title function_">lineAt</span>(lineIndex).<span class=property>text</span>;</span><br><span class=line>        <span class=keyword>const</span> text = <span class="variable language_">document</span>.<span class="title function_">getText</span>();</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// æŸ¥æ‰¾å˜é‡å£°æ˜</span></span><br><span class=line>        <span class=keyword>const</span> variableDeclaration = <span class=regexp>/(var|let|const)\s+(\w+)/g</span>;</span><br><span class=line>        <span class=keyword>let</span> match;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>while</span> ((match = variableDeclaration.<span class="title function_">exec</span>(line)) !== <span class=literal>null</span>) &#123;</span><br><span class=line>            <span class=keyword>const</span> [, , variableName] = match;</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// æ£€æŸ¥å˜é‡æ˜¯å¦åœ¨å…¶ä»–åœ°æ–¹è¢«ä½¿ç”¨</span></span><br><span class=line>            <span class=keyword>const</span> usagePattern = <span class=keyword>new</span> <span class="title class_">RegExp</span>(<span class=string>`\\b<span class=subst>$&#123;variableName&#125;</span>\\b`</span>, <span class=string>&#x27;g&#x27;</span>);</span><br><span class=line>            <span class=keyword>const</span> allMatches = <span class="title class_">Array</span>.<span class="title function_">from</span>(text.<span class="title function_">matchAll</span>(usagePattern));</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// å¦‚æœåªæœ‰ä¸€ä¸ªåŒ¹é…ï¼ˆå°±æ˜¯å£°æ˜æœ¬èº«ï¼‰ï¼Œåˆ™è®¤ä¸ºæœªä½¿ç”¨</span></span><br><span class=line>            <span class=keyword>if</span> (allMatches.<span class=property>length</span> === <span class=number>1</span>) &#123;</span><br><span class=line>                <span class=keyword>const</span> startPos = match.<span class=property>index</span> + match[<span class=number>0</span>].<span class="title function_">indexOf</span>(variableName);</span><br><span class=line>                <span class=keyword>const</span> diagnostic = <span class=keyword>new</span> vscode.<span class="title class_">Diagnostic</span>(</span><br><span class=line>                    <span class=keyword>new</span> vscode.<span class="title class_">Range</span>(lineIndex, startPos, lineIndex, startPos + variableName.<span class=property>length</span>),</span><br><span class=line>                    <span class=string>`å˜é‡ &#x27;<span class=subst>$&#123;variableName&#125;</span>&#x27; å·²å£°æ˜ä½†æœªä½¿ç”¨`</span>,</span><br><span class=line>                    vscode.<span class=property>DiagnosticSeverity</span>.<span class=property>Warning</span></span><br><span class=line>                );</span><br><span class=line>                diagnostic.<span class=property>code</span> = <span class=string>&#x27;unused-variable&#x27;</span>;</span><br><span class=line>                diagnostic.<span class=property>source</span> = <span class=string>&#x27;mylang&#x27;</span>;</span><br><span class=line>                diagnostic.<span class=property>tags</span> = [vscode.<span class=property>DiagnosticTag</span>.<span class=property>Unnecessary</span>];</span><br><span class=line>                diagnostics.<span class="title function_">push</span>(diagnostic);</span><br><span class=line>            &#125;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> diagnostics;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">checkTypeErrors</span>(<span class=attr>line</span>: <span class=built_in>string</span>, <span class=attr>lineIndex</span>: <span class=built_in>number</span>): vscode.<span class=property>Diagnostic</span>[] &#123;</span><br><span class=line>        <span class=keyword>const</span> <span class=attr>diagnostics</span>: vscode.<span class=property>Diagnostic</span>[] = [];</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// æ£€æŸ¥ç±»å‹ä¸åŒ¹é…ï¼ˆç®€åŒ–ç‰ˆï¼‰</span></span><br><span class=line>        <span class=keyword>const</span> numberAssignment = <span class=regexp>/(\w+)\s*=\s*&quot;[^&quot;]*&quot;/g</span>;</span><br><span class=line>        <span class=keyword>let</span> match;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>while</span> ((match = numberAssignment.<span class="title function_">exec</span>(line)) !== <span class=literal>null</span>) &#123;</span><br><span class=line>            <span class=comment>// å‡è®¾å˜é‡ååŒ…å« &#x27;num&#x27; æˆ– &#x27;count&#x27; æ„å‘³ç€åº”è¯¥æ˜¯æ•°å­—</span></span><br><span class=line>            <span class=keyword>const</span> variableName = match[<span class=number>1</span>];</span><br><span class=line>            <span class=keyword>if</span> (variableName.<span class="title function_">includes</span>(<span class=string>&#x27;num&#x27;</span>) || variableName.<span class="title function_">includes</span>(<span class=string>&#x27;count&#x27;</span>) || variableName.<span class="title function_">includes</span>(<span class=string>&#x27;index&#x27;</span>)) &#123;</span><br><span class=line>                <span class=keyword>const</span> diagnostic = <span class=keyword>new</span> vscode.<span class="title class_">Diagnostic</span>(</span><br><span class=line>                    <span class=keyword>new</span> vscode.<span class="title class_">Range</span>(lineIndex, match.<span class=property>index</span>, lineIndex, match.<span class=property>index</span> + match[<span class=number>0</span>].<span class=property>length</span>),</span><br><span class=line>                    <span class=string>`å¯èƒ½çš„ç±»å‹é”™è¯¯ï¼šå°†å­—ç¬¦ä¸²èµ‹å€¼ç»™æ•°å­—å˜é‡ &#x27;<span class=subst>$&#123;variableName&#125;</span>&#x27;`</span>,</span><br><span class=line>                    vscode.<span class=property>DiagnosticSeverity</span>.<span class=property>Warning</span></span><br><span class=line>                );</span><br><span class=line>                diagnostic.<span class=property>code</span> = <span class=string>&#x27;type-mismatch&#x27;</span>;</span><br><span class=line>                diagnostic.<span class=property>source</span> = <span class=string>&#x27;mylang&#x27;</span>;</span><br><span class=line>                diagnostics.<span class="title function_">push</span>(diagnostic);</span><br><span class=line>            &#125;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> diagnostics;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">checkStyleIssues</span>(<span class=attr>line</span>: <span class=built_in>string</span>, <span class=attr>lineIndex</span>: <span class=built_in>number</span>): vscode.<span class=property>Diagnostic</span>[] &#123;</span><br><span class=line>        <span class=keyword>const</span> <span class=attr>diagnostics</span>: vscode.<span class=property>Diagnostic</span>[] = [];</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// æ£€æŸ¥ç¼©è¿›é—®é¢˜</span></span><br><span class=line>        <span class=keyword>if</span> (line.<span class="title function_">match</span>(<span class=regexp>/^\s*\t/</span>)) &#123;</span><br><span class=line>            <span class=keyword>const</span> diagnostic = <span class=keyword>new</span> vscode.<span class="title class_">Diagnostic</span>(</span><br><span class=line>                <span class=keyword>new</span> vscode.<span class="title class_">Range</span>(lineIndex, <span class=number>0</span>, lineIndex, line.<span class="title function_">search</span>(<span class=regexp>/[^\s]/</span>)),</span><br><span class=line>                <span class=string>&#x27;å»ºè®®ä½¿ç”¨ç©ºæ ¼è€Œä¸æ˜¯åˆ¶è¡¨ç¬¦è¿›è¡Œç¼©è¿›&#x27;</span>,</span><br><span class=line>                vscode.<span class=property>DiagnosticSeverity</span>.<span class=property>Information</span></span><br><span class=line>            );</span><br><span class=line>            diagnostic.<span class=property>code</span> = <span class=string>&#x27;tab-indentation&#x27;</span>;</span><br><span class=line>            diagnostic.<span class=property>source</span> = <span class=string>&#x27;mylang&#x27;</span>;</span><br><span class=line>            diagnostics.<span class="title function_">push</span>(diagnostic);</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// æ£€æŸ¥è¡Œå°¾ç©ºæ ¼</span></span><br><span class=line>        <span class=keyword>if</span> (line.<span class="title function_">match</span>(<span class=regexp>/\s+$/</span>)) &#123;</span><br><span class=line>            <span class=keyword>const</span> trimmedLength = line.<span class="title function_">trimEnd</span>().<span class=property>length</span>;</span><br><span class=line>            <span class=keyword>const</span> diagnostic = <span class=keyword>new</span> vscode.<span class="title class_">Diagnostic</span>(</span><br><span class=line>                <span class=keyword>new</span> vscode.<span class="title class_">Range</span>(lineIndex, trimmedLength, lineIndex, line.<span class=property>length</span>),</span><br><span class=line>                <span class=string>&#x27;è¡Œå°¾æœ‰å¤šä½™çš„ç©ºæ ¼&#x27;</span>,</span><br><span class=line>                vscode.<span class=property>DiagnosticSeverity</span>.<span class=property>Information</span></span><br><span class=line>            );</span><br><span class=line>            diagnostic.<span class=property>code</span> = <span class=string>&#x27;trailing-whitespace&#x27;</span>;</span><br><span class=line>            diagnostic.<span class=property>source</span> = <span class=string>&#x27;mylang&#x27;</span>;</span><br><span class=line>            diagnostic.<span class=property>tags</span> = [vscode.<span class=property>DiagnosticTag</span>.<span class=property>Unnecessary</span>];</span><br><span class=line>            diagnostics.<span class="title function_">push</span>(diagnostic);</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// æ£€æŸ¥è¿‡é•¿çš„è¡Œ</span></span><br><span class=line>        <span class=keyword>if</span> (line.<span class=property>length</span> &gt; <span class=number>100</span>) &#123;</span><br><span class=line>            <span class=keyword>const</span> diagnostic = <span class=keyword>new</span> vscode.<span class="title class_">Diagnostic</span>(</span><br><span class=line>                <span class=keyword>new</span> vscode.<span class="title class_">Range</span>(lineIndex, <span class=number>100</span>, lineIndex, line.<span class=property>length</span>),</span><br><span class=line>                <span class=string>&#x27;è¡Œè¿‡é•¿ï¼Œå»ºè®®ä¸è¶…è¿‡100ä¸ªå­—ç¬¦&#x27;</span>,</span><br><span class=line>                vscode.<span class=property>DiagnosticSeverity</span>.<span class=property>Information</span></span><br><span class=line>            );</span><br><span class=line>            diagnostic.<span class=property>code</span> = <span class=string>&#x27;line-too-long&#x27;</span>;</span><br><span class=line>            diagnostic.<span class=property>source</span> = <span class=string>&#x27;mylang&#x27;</span>;</span><br><span class=line>            diagnostics.<span class="title function_">push</span>(diagnostic);</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// æ£€æŸ¥å‘½åçº¦å®š</span></span><br><span class=line>        <span class=keyword>const</span> variableDeclaration = <span class=regexp>/(var|let|const)\s+([A-Z]\w*)/g</span>;</span><br><span class=line>        <span class=keyword>let</span> match;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>while</span> ((match = variableDeclaration.<span class="title function_">exec</span>(line)) !== <span class=literal>null</span>) &#123;</span><br><span class=line>            <span class=keyword>const</span> variableName = match[<span class=number>2</span>];</span><br><span class=line>            <span class=keyword>const</span> startPos = match.<span class=property>index</span> + match[<span class=number>0</span>].<span class="title function_">indexOf</span>(variableName);</span><br><span class=line>            </span><br><span class=line>            <span class=keyword>const</span> diagnostic = <span class=keyword>new</span> vscode.<span class="title class_">Diagnostic</span>(</span><br><span class=line>                <span class=keyword>new</span> vscode.<span class="title class_">Range</span>(lineIndex, startPos, lineIndex, startPos + variableName.<span class=property>length</span>),</span><br><span class=line>                <span class=string>`å˜é‡å &#x27;<span class=subst>$&#123;variableName&#125;</span>&#x27; åº”è¯¥ä½¿ç”¨é©¼å³°å‘½åæ³•`</span>,</span><br><span class=line>                vscode.<span class=property>DiagnosticSeverity</span>.<span class=property>Information</span></span><br><span class=line>            );</span><br><span class=line>            diagnostic.<span class=property>code</span> = <span class=string>&#x27;naming-convention&#x27;</span>;</span><br><span class=line>            diagnostic.<span class=property>source</span> = <span class=string>&#x27;mylang&#x27;</span>;</span><br><span class=line>            diagnostics.<span class="title function_">push</span>(diagnostic);</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> diagnostics;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">checkBestPractices</span>(<span class=attr>line</span>: <span class=built_in>string</span>, <span class=attr>lineIndex</span>: <span class=built_in>number</span>): vscode.<span class=property>Diagnostic</span>[] &#123;</span><br><span class=line>        <span class=keyword>const</span> <span class=attr>diagnostics</span>: vscode.<span class=property>Diagnostic</span>[] = [];</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// æ£€æŸ¥console.logçš„ä½¿ç”¨</span></span><br><span class=line>        <span class=keyword>if</span> (line.<span class="title function_">includes</span>(<span class=string>&#x27;console.log&#x27;</span>)) &#123;</span><br><span class=line>            <span class=keyword>const</span> index = line.<span class="title function_">indexOf</span>(<span class=string>&#x27;console.log&#x27;</span>);</span><br><span class=line>            <span class=keyword>const</span> diagnostic = <span class=keyword>new</span> vscode.<span class="title class_">Diagnostic</span>(</span><br><span class=line>                <span class=keyword>new</span> vscode.<span class="title class_">Range</span>(lineIndex, index, lineIndex, index + <span class=string>&#x27;console.log&#x27;</span>.<span class=property>length</span>),</span><br><span class=line>                <span class=string>&#x27;ç”Ÿäº§ä»£ç ä¸­åº”é¿å…ä½¿ç”¨console.log&#x27;</span>,</span><br><span class=line>                vscode.<span class=property>DiagnosticSeverity</span>.<span class=property>Information</span></span><br><span class=line>            );</span><br><span class=line>            diagnostic.<span class=property>code</span> = <span class=string>&#x27;console-log-usage&#x27;</span>;</span><br><span class=line>            diagnostic.<span class=property>source</span> = <span class=string>&#x27;mylang&#x27;</span>;</span><br><span class=line>            diagnostics.<span class="title function_">push</span>(diagnostic);</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// æ£€æŸ¥varçš„ä½¿ç”¨</span></span><br><span class=line>        <span class=keyword>if</span> (line.<span class="title function_">includes</span>(<span class=string>&#x27;var &#x27;</span>)) &#123;</span><br><span class=line>            <span class=keyword>const</span> index = line.<span class="title function_">indexOf</span>(<span class=string>&#x27;var &#x27;</span>);</span><br><span class=line>            <span class=keyword>const</span> diagnostic = <span class=keyword>new</span> vscode.<span class="title class_">Diagnostic</span>(</span><br><span class=line>                <span class=keyword>new</span> vscode.<span class="title class_">Range</span>(lineIndex, index, lineIndex, index + <span class=number>3</span>),</span><br><span class=line>                <span class=string>&#x27;å»ºè®®ä½¿ç”¨letæˆ–constæ›¿ä»£var&#x27;</span>,</span><br><span class=line>                vscode.<span class=property>DiagnosticSeverity</span>.<span class=property>Information</span></span><br><span class=line>            );</span><br><span class=line>            diagnostic.<span class=property>code</span> = <span class=string>&#x27;var-usage&#x27;</span>;</span><br><span class=line>            diagnostic.<span class=property>source</span> = <span class=string>&#x27;mylang&#x27;</span>;</span><br><span class=line>            diagnostics.<span class="title function_">push</span>(diagnostic);</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// æ£€æŸ¥é­”æ³•æ•°å­—</span></span><br><span class=line>        <span class=keyword>const</span> magicNumbers = <span class=regexp>/\b\d&#123;2,&#125;\b/g</span>;</span><br><span class=line>        <span class=keyword>let</span> match;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>while</span> ((match = magicNumbers.<span class="title function_">exec</span>(line)) !== <span class=literal>null</span>) &#123;</span><br><span class=line>            <span class=keyword>const</span> <span class=built_in>number</span> = match[<span class=number>0</span>];</span><br><span class=line>            <span class=comment>// æ’é™¤å¸¸è§çš„éé­”æ³•æ•°å­—</span></span><br><span class=line>            <span class=keyword>if</span> (![<span class=string>&#x27;100&#x27;</span>, <span class=string>&#x27;200&#x27;</span>, <span class=string>&#x27;404&#x27;</span>, <span class=string>&#x27;500&#x27;</span>].<span class="title function_">includes</span>(<span class=built_in>number</span>)) &#123;</span><br><span class=line>                <span class=keyword>const</span> diagnostic = <span class=keyword>new</span> vscode.<span class="title class_">Diagnostic</span>(</span><br><span class=line>                    <span class=keyword>new</span> vscode.<span class="title class_">Range</span>(lineIndex, match.<span class=property>index</span>, lineIndex, match.<span class=property>index</span> + <span class=built_in>number</span>.<span class=property>length</span>),</span><br><span class=line>                    <span class=string>`è€ƒè™‘å°†é­”æ³•æ•°å­— <span class=subst>$&#123;<span class=built_in>number</span>&#125;</span> å®šä¹‰ä¸ºå¸¸é‡`</span>,</span><br><span class=line>                    vscode.<span class=property>DiagnosticSeverity</span>.<span class=property>Information</span></span><br><span class=line>                );</span><br><span class=line>                diagnostic.<span class=property>code</span> = <span class=string>&#x27;magic-number&#x27;</span>;</span><br><span class=line>                diagnostic.<span class=property>source</span> = <span class=string>&#x27;mylang&#x27;</span>;</span><br><span class=line>                diagnostics.<span class="title function_">push</span>(diagnostic);</span><br><span class=line>            &#125;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> diagnostics;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class="title function_">dispose</span>(): <span class=built_in>void</span> &#123;</span><br><span class=line>        <span class="variable language_">this</span>.<span class=property>diagnosticCollection</span>.<span class="title function_">dispose</span>();</span><br><span class=line>    &#125;</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><hr><h2 id=ğŸŒ-ç¬¬ä¸‰éƒ¨åˆ†ï¼šLanguage-Server-Protocol-LSP><a href=#ğŸŒ-ç¬¬ä¸‰éƒ¨åˆ†ï¼šLanguage-Server-Protocol-LSP class=headerlink title="ğŸŒ ç¬¬ä¸‰éƒ¨åˆ†ï¼šLanguage Server Protocol (LSP)"></a>ğŸŒ ç¬¬ä¸‰éƒ¨åˆ†ï¼šLanguage Server Protocol (LSP)</h2><h3 id=3-1-LSPå®¢æˆ·ç«¯å¼€å‘><a href=#3-1-LSPå®¢æˆ·ç«¯å¼€å‘ class=headerlink title="3.1 LSPå®¢æˆ·ç«¯å¼€å‘"></a>3.1 LSPå®¢æˆ·ç«¯å¼€å‘</h3><figure class="highlight typescript"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br><span class=line>90</span><br><span class=line>91</span><br><span class=line>92</span><br><span class=line>93</span><br><span class=line>94</span><br><span class=line>95</span><br><span class=line>96</span><br><span class=line>97</span><br><span class=line>98</span><br><span class=line>99</span><br><span class=line>100</span><br><span class=line>101</span><br><span class=line>102</span><br><span class=line>103</span><br><span class=line>104</span><br><span class=line>105</span><br><span class=line>106</span><br><span class=line>107</span><br><span class=line>108</span><br><span class=line>109</span><br><span class=line>110</span><br><span class=line>111</span><br><span class=line>112</span><br><span class=line>113</span><br><span class=line>114</span><br><span class=line>115</span><br><span class=line>116</span><br><span class=line>117</span><br><span class=line>118</span><br><span class=line>119</span><br><span class=line>120</span><br><span class=line>121</span><br><span class=line>122</span><br><span class=line>123</span><br><span class=line>124</span><br><span class=line>125</span><br><span class=line>126</span><br><span class=line>127</span><br><span class=line>128</span><br><span class=line>129</span><br><span class=line>130</span><br><span class=line>131</span><br><span class=line>132</span><br><span class=line>133</span><br><span class=line>134</span><br><span class=line>135</span><br><span class=line>136</span><br><span class=line>137</span><br><span class=line>138</span><br><span class=line>139</span><br><span class=line>140</span><br><span class=line>141</span><br><span class=line>142</span><br><span class=line>143</span><br><span class=line>144</span><br><span class=line>145</span><br><span class=line>146</span><br><span class=line>147</span><br><span class=line>148</span><br><span class=line>149</span><br><span class=line>150</span><br><span class=line>151</span><br><span class=line>152</span><br><span class=line>153</span><br><span class=line>154</span><br><span class=line>155</span><br><span class=line>156</span><br><span class=line>157</span><br><span class=line>158</span><br><span class=line>159</span><br><span class=line>160</span><br><span class=line>161</span><br><span class=line>162</span><br><span class=line>163</span><br><span class=line>164</span><br><span class=line>165</span><br><span class=line>166</span><br><span class=line>167</span><br><span class=line>168</span><br><span class=line>169</span><br></pre></td><td class=code><pre><span class=line><span class=comment>// src/languageClient.ts</span></span><br><span class=line><span class=keyword>import</span> * <span class=keyword>as</span> vscode <span class=keyword>from</span> <span class=string>&#x27;vscode&#x27;</span>;</span><br><span class=line><span class=keyword>import</span> &#123;</span><br><span class=line>    <span class="title class_">LanguageClient</span>,</span><br><span class=line>    <span class="title class_">LanguageClientOptions</span>,</span><br><span class=line>    <span class="title class_">ServerOptions</span>,</span><br><span class=line>    <span class="title class_">TransportKind</span>,</span><br><span class=line>    <span class="title class_">RevealOutputChannelOn</span></span><br><span class=line>&#125; <span class=keyword>from</span> <span class=string>&#x27;vscode-languageclient/node&#x27;</span>;</span><br><span class=line></span><br><span class=line><span class=keyword>export</span> <span class=keyword>class</span> <span class="title class_">MyLangLanguageClient</span> &#123;</span><br><span class=line>    <span class=keyword>private</span> <span class=attr>client</span>: <span class="title class_">LanguageClient</span> | <span class=literal>undefined</span>;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>async</span> <span class="title function_">activate</span>(<span class=attr>context</span>: vscode.<span class=property>ExtensionContext</span>): <span class="title class_">Promise</span>&lt;<span class=built_in>void</span>&gt; &#123;</span><br><span class=line>        <span class=comment>// Language Serverçš„å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„</span></span><br><span class=line>        <span class=keyword>const</span> serverModule = context.<span class="title function_">asAbsolutePath</span>(<span class=string>&#x27;out/server/server.js&#x27;</span>);</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// è°ƒè¯•é€‰é¡¹</span></span><br><span class=line>        <span class=keyword>const</span> debugOptions = &#123; <span class=attr>execArgv</span>: [<span class=string>&#x27;--nolazy&#x27;</span>, <span class=string>&#x27;--inspect=6009&#x27;</span>] &#125;;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// æœåŠ¡å™¨é€‰é¡¹</span></span><br><span class=line>        <span class=keyword>const</span> <span class=attr>serverOptions</span>: <span class="title class_">ServerOptions</span> = &#123;</span><br><span class=line>            <span class=attr>run</span>: &#123; <span class=attr>module</span>: serverModule, <span class=attr>transport</span>: <span class="title class_">TransportKind</span>.<span class=property>ipc</span> &#125;,</span><br><span class=line>            <span class=attr>debug</span>: &#123;</span><br><span class=line>                <span class=attr>module</span>: serverModule,</span><br><span class=line>                <span class=attr>transport</span>: <span class="title class_">TransportKind</span>.<span class=property>ipc</span>,</span><br><span class=line>                <span class=attr>options</span>: debugOptions</span><br><span class=line>            &#125;</span><br><span class=line>        &#125;;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// å®¢æˆ·ç«¯é€‰é¡¹</span></span><br><span class=line>        <span class=keyword>const</span> <span class=attr>clientOptions</span>: <span class="title class_">LanguageClientOptions</span> = &#123;</span><br><span class=line>            <span class=comment>// æ³¨å†Œè¦å¤„ç†çš„æ–‡æ¡£é€‰æ‹©å™¨</span></span><br><span class=line>            <span class=attr>documentSelector</span>: [</span><br><span class=line>                &#123; <span class=attr>scheme</span>: <span class=string>&#x27;file&#x27;</span>, <span class=attr>language</span>: <span class=string>&#x27;mylang&#x27;</span> &#125;,</span><br><span class=line>                &#123; <span class=attr>scheme</span>: <span class=string>&#x27;untitled&#x27;</span>, <span class=attr>language</span>: <span class=string>&#x27;mylang&#x27;</span> &#125;</span><br><span class=line>            ],</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// åŒæ­¥é…ç½®</span></span><br><span class=line>            <span class=attr>synchronize</span>: &#123;</span><br><span class=line>                <span class=comment>// ç›‘å¬é…ç½®å˜åŒ–</span></span><br><span class=line>                <span class=attr>configurationSection</span>: <span class=string>&#x27;mylang&#x27;</span>,</span><br><span class=line>                <span class=comment>// ç›‘å¬æ–‡ä»¶å˜åŒ–</span></span><br><span class=line>                <span class=attr>fileEvents</span>: vscode.<span class=property>workspace</span>.<span class="title function_">createFileSystemWatcher</span>(<span class=string>&#x27;**/.mylangrc&#x27;</span>)</span><br><span class=line>            &#125;,</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// è¾“å‡ºé€šé“</span></span><br><span class=line>            <span class=attr>outputChannelName</span>: <span class=string>&#x27;MyLang Language Server&#x27;</span>,</span><br><span class=line>            <span class=attr>revealOutputChannelOn</span>: <span class="title class_">RevealOutputChannelOn</span>.<span class=property>Never</span>,</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// é”™è¯¯å¤„ç†</span></span><br><span class=line>            <span class=attr>errorHandler</span>: &#123;</span><br><span class=line>                <span class=attr>error</span>: <span class=function>(<span class=params>error, message, count</span>) =&gt;</span> &#123;</span><br><span class=line>                    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class=string>&#x27;Language server error:&#x27;</span>, error, message, count);</span><br><span class=line>                    <span class=keyword>return</span> &#123; <span class=attr>action</span>: vscode.<span class=property>languages</span>.<span class=property>ErrorAction</span>.<span class=property>Continue</span> &#125;;</span><br><span class=line>                &#125;,</span><br><span class=line>                <span class=attr>closed</span>: <span class=function>() =&gt;</span> &#123;</span><br><span class=line>                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class=string>&#x27;Language server connection closed&#x27;</span>);</span><br><span class=line>                    <span class=keyword>return</span> &#123; <span class=attr>action</span>: vscode.<span class=property>languages</span>.<span class=property>CloseAction</span>.<span class=property>Restart</span> &#125;;</span><br><span class=line>                &#125;</span><br><span class=line>            &#125;,</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// åˆå§‹åŒ–é€‰é¡¹</span></span><br><span class=line>            <span class=attr>initializationOptions</span>: &#123;</span><br><span class=line>                <span class=attr>settings</span>: vscode.<span class=property>workspace</span>.<span class="title function_">getConfiguration</span>(<span class=string>&#x27;mylang&#x27;</span>)</span><br><span class=line>            &#125;,</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// å·¥ä½œåŒºæ–‡ä»¶å¤¹</span></span><br><span class=line>            <span class=attr>workspaceFolder</span>: vscode.<span class=property>workspace</span>.<span class=property>workspaceFolders</span>?.[<span class=number>0</span>]</span><br><span class=line>        &#125;;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// åˆ›å»ºLanguage Client</span></span><br><span class=line>        <span class="variable language_">this</span>.<span class=property>client</span> = <span class=keyword>new</span> <span class="title class_">LanguageClient</span>(</span><br><span class=line>            <span class=string>&#x27;mylang-language-server&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;MyLang Language Server&#x27;</span>,</span><br><span class=line>            serverOptions,</span><br><span class=line>            clientOptions</span><br><span class=line>        );</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// æ³¨å†Œè‡ªå®šä¹‰é€šçŸ¥å’Œè¯·æ±‚å¤„ç†å™¨</span></span><br><span class=line>        <span class="variable language_">this</span>.<span class="title function_">registerCustomHandlers</span>();</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// å¯åŠ¨å®¢æˆ·ç«¯</span></span><br><span class=line>        <span class=keyword>await</span> <span class="variable language_">this</span>.<span class=property>client</span>.<span class="title function_">start</span>();</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// æ³¨å†Œå®¢æˆ·ç«¯å‘½ä»¤</span></span><br><span class=line>        <span class="variable language_">this</span>.<span class="title function_">registerCommands</span>(context);</span><br><span class=line>        </span><br><span class=line>        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class=string>&#x27;MyLang Language Serverå¯åŠ¨æˆåŠŸ&#x27;</span>);</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">registerCustomHandlers</span>(): <span class=built_in>void</span> &#123;</span><br><span class=line>        <span class=keyword>if</span> (!<span class="variable language_">this</span>.<span class=property>client</span>) <span class=keyword>return</span>;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// æ³¨å†Œè‡ªå®šä¹‰é€šçŸ¥å¤„ç†å™¨</span></span><br><span class=line>        <span class="variable language_">this</span>.<span class=property>client</span>.<span class="title function_">onNotification</span>(<span class=string>&#x27;mylang/status&#x27;</span>, <span class=function>(<span class=params>params: <span class=built_in>any</span></span>) =&gt;</span> &#123;</span><br><span class=line>            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class=string>&#x27;Language ServerçŠ¶æ€:&#x27;</span>, params);</span><br><span class=line>            vscode.<span class=property>window</span>.<span class="title function_">showInformationMessage</span>(<span class=string>`Language Server: <span class=subst>$&#123;params.message&#125;</span>`</span>);</span><br><span class=line>        &#125;);</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// æ³¨å†Œè‡ªå®šä¹‰è¯·æ±‚å¤„ç†å™¨</span></span><br><span class=line>        <span class="variable language_">this</span>.<span class=property>client</span>.<span class="title function_">onRequest</span>(<span class=string>&#x27;mylang/getWorkspaceInfo&#x27;</span>, <span class=keyword>async</span> () =&gt; &#123;</span><br><span class=line>            <span class=keyword>const</span> workspaceFolders = vscode.<span class=property>workspace</span>.<span class=property>workspaceFolders</span>;</span><br><span class=line>            <span class=keyword>return</span> &#123;</span><br><span class=line>                <span class=attr>folders</span>: workspaceFolders?.<span class="title function_">map</span>(<span class=function><span class=params>folder</span> =&gt;</span> (&#123;</span><br><span class=line>                    <span class=attr>name</span>: folder.<span class=property>name</span>,</span><br><span class=line>                    <span class=attr>uri</span>: folder.<span class=property>uri</span>.<span class="title function_">toString</span>()</span><br><span class=line>                &#125;)) || [],</span><br><span class=line>                <span class=attr>configuration</span>: vscode.<span class=property>workspace</span>.<span class="title function_">getConfiguration</span>(<span class=string>&#x27;mylang&#x27;</span>)</span><br><span class=line>            &#125;;</span><br><span class=line>        &#125;);</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">registerCommands</span>(<span class=attr>context</span>: vscode.<span class=property>ExtensionContext</span>): <span class=built_in>void</span> &#123;</span><br><span class=line>        <span class=comment>// é‡å¯Language Serverå‘½ä»¤</span></span><br><span class=line>        <span class=keyword>const</span> restartCommand = vscode.<span class=property>commands</span>.<span class="title function_">registerCommand</span>(<span class=string>&#x27;mylang.restartServer&#x27;</span>, <span class=keyword>async</span> () =&gt; &#123;</span><br><span class=line>            <span class=keyword>if</span> (<span class="variable language_">this</span>.<span class=property>client</span>) &#123;</span><br><span class=line>                <span class=keyword>await</span> <span class="variable language_">this</span>.<span class=property>client</span>.<span class="title function_">stop</span>();</span><br><span class=line>                <span class=keyword>await</span> <span class="variable language_">this</span>.<span class=property>client</span>.<span class="title function_">start</span>();</span><br><span class=line>                vscode.<span class=property>window</span>.<span class="title function_">showInformationMessage</span>(<span class=string>&#x27;MyLang Language Serverå·²é‡å¯&#x27;</span>);</span><br><span class=line>            &#125;</span><br><span class=line>        &#125;);</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// æ˜¾ç¤ºæœåŠ¡å™¨çŠ¶æ€å‘½ä»¤</span></span><br><span class=line>        <span class=keyword>const</span> statusCommand = vscode.<span class=property>commands</span>.<span class="title function_">registerCommand</span>(<span class=string>&#x27;mylang.showServerStatus&#x27;</span>, <span class=keyword>async</span> () =&gt; &#123;</span><br><span class=line>            <span class=keyword>if</span> (<span class="variable language_">this</span>.<span class=property>client</span>) &#123;</span><br><span class=line>                <span class=keyword>const</span> result = <span class=keyword>await</span> <span class="variable language_">this</span>.<span class=property>client</span>.<span class="title function_">sendRequest</span>(<span class=string>&#x27;mylang/getStatus&#x27;</span>);</span><br><span class=line>                vscode.<span class=property>window</span>.<span class="title function_">showInformationMessage</span>(<span class=string>`æœåŠ¡å™¨çŠ¶æ€: <span class=subst>$&#123;<span class=built_in>JSON</span>.stringify(result)&#125;</span>`</span>);</span><br><span class=line>            &#125;</span><br><span class=line>        &#125;);</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// æ ¼å¼åŒ–æ–‡æ¡£å‘½ä»¤</span></span><br><span class=line>        <span class=keyword>const</span> formatCommand = vscode.<span class=property>commands</span>.<span class="title function_">registerCommand</span>(<span class=string>&#x27;mylang.formatDocument&#x27;</span>, <span class=keyword>async</span> () =&gt; &#123;</span><br><span class=line>            <span class=keyword>const</span> editor = vscode.<span class=property>window</span>.<span class=property>activeTextEditor</span>;</span><br><span class=line>            <span class=keyword>if</span> (editor &amp;&amp; editor.<span class=property>document</span>.<span class=property>languageId</span> === <span class=string>&#x27;mylang&#x27;</span>) &#123;</span><br><span class=line>                <span class=keyword>await</span> vscode.<span class=property>commands</span>.<span class="title function_">executeCommand</span>(<span class=string>&#x27;editor.action.formatDocument&#x27;</span>);</span><br><span class=line>            &#125;</span><br><span class=line>        &#125;);</span><br><span class=line>        </span><br><span class=line>        context.<span class=property>subscriptions</span>.<span class="title function_">push</span>(restartCommand, statusCommand, formatCommand);</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>async</span> <span class="title function_">deactivate</span>(): <span class="title class_">Promise</span>&lt;<span class=built_in>void</span>&gt; &#123;</span><br><span class=line>        <span class=keyword>if</span> (<span class="variable language_">this</span>.<span class=property>client</span>) &#123;</span><br><span class=line>            <span class=keyword>await</span> <span class="variable language_">this</span>.<span class=property>client</span>.<span class="title function_">stop</span>();</span><br><span class=line>        &#125;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=comment>// å‘é€è‡ªå®šä¹‰è¯·æ±‚åˆ°æœåŠ¡å™¨</span></span><br><span class=line>    <span class=keyword>async</span> sendCustomRequest&lt;T&gt;(<span class=attr>method</span>: <span class=built_in>string</span>, params?: <span class=built_in>any</span>): <span class="title class_">Promise</span>&lt;T&gt; &#123;</span><br><span class=line>        <span class=keyword>if</span> (!<span class="variable language_">this</span>.<span class=property>client</span>) &#123;</span><br><span class=line>            <span class=keyword>throw</span> <span class=keyword>new</span> <span class="title class_">Error</span>(<span class=string>&#x27;Language Clientæœªåˆå§‹åŒ–&#x27;</span>);</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> <span class="variable language_">this</span>.<span class=property>client</span>.<span class="title function_">sendRequest</span>(method, params);</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=comment>// å‘é€é€šçŸ¥åˆ°æœåŠ¡å™¨</span></span><br><span class=line>    <span class="title function_">sendNotification</span>(<span class=attr>method</span>: <span class=built_in>string</span>, params?: <span class=built_in>any</span>): <span class=built_in>void</span> &#123;</span><br><span class=line>        <span class=keyword>if</span> (<span class="variable language_">this</span>.<span class=property>client</span>) &#123;</span><br><span class=line>            <span class="variable language_">this</span>.<span class=property>client</span>.<span class="title function_">sendNotification</span>(method, params);</span><br><span class=line>        &#125;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=comment>// è·å–å®¢æˆ·ç«¯çŠ¶æ€</span></span><br><span class=line>    <span class="title function_">isReady</span>(): <span class=built_in>boolean</span> &#123;</span><br><span class=line>        <span class=keyword>return</span> <span class="variable language_">this</span>.<span class=property>client</span>?.<span class="title function_">isRunning</span>() || <span class=literal>false</span>;</span><br><span class=line>    &#125;</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><h3 id=3-2-LSPæœåŠ¡å™¨å¼€å‘><a href=#3-2-LSPæœåŠ¡å™¨å¼€å‘ class=headerlink title="3.2 LSPæœåŠ¡å™¨å¼€å‘"></a>3.2 LSPæœåŠ¡å™¨å¼€å‘</h3><figure class="highlight typescript"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br><span class=line>90</span><br><span class=line>91</span><br><span class=line>92</span><br><span class=line>93</span><br><span class=line>94</span><br><span class=line>95</span><br><span class=line>96</span><br><span class=line>97</span><br><span class=line>98</span><br><span class=line>99</span><br><span class=line>100</span><br><span class=line>101</span><br><span class=line>102</span><br><span class=line>103</span><br><span class=line>104</span><br><span class=line>105</span><br><span class=line>106</span><br><span class=line>107</span><br><span class=line>108</span><br><span class=line>109</span><br><span class=line>110</span><br><span class=line>111</span><br><span class=line>112</span><br><span class=line>113</span><br><span class=line>114</span><br><span class=line>115</span><br><span class=line>116</span><br><span class=line>117</span><br><span class=line>118</span><br><span class=line>119</span><br><span class=line>120</span><br><span class=line>121</span><br><span class=line>122</span><br><span class=line>123</span><br><span class=line>124</span><br><span class=line>125</span><br><span class=line>126</span><br><span class=line>127</span><br><span class=line>128</span><br><span class=line>129</span><br><span class=line>130</span><br><span class=line>131</span><br><span class=line>132</span><br><span class=line>133</span><br><span class=line>134</span><br><span class=line>135</span><br><span class=line>136</span><br><span class=line>137</span><br><span class=line>138</span><br><span class=line>139</span><br><span class=line>140</span><br><span class=line>141</span><br><span class=line>142</span><br><span class=line>143</span><br><span class=line>144</span><br><span class=line>145</span><br><span class=line>146</span><br><span class=line>147</span><br><span class=line>148</span><br><span class=line>149</span><br><span class=line>150</span><br><span class=line>151</span><br><span class=line>152</span><br><span class=line>153</span><br><span class=line>154</span><br><span class=line>155</span><br><span class=line>156</span><br><span class=line>157</span><br><span class=line>158</span><br><span class=line>159</span><br><span class=line>160</span><br><span class=line>161</span><br><span class=line>162</span><br><span class=line>163</span><br><span class=line>164</span><br><span class=line>165</span><br><span class=line>166</span><br><span class=line>167</span><br><span class=line>168</span><br><span class=line>169</span><br><span class=line>170</span><br><span class=line>171</span><br><span class=line>172</span><br><span class=line>173</span><br><span class=line>174</span><br><span class=line>175</span><br><span class=line>176</span><br><span class=line>177</span><br><span class=line>178</span><br><span class=line>179</span><br><span class=line>180</span><br><span class=line>181</span><br><span class=line>182</span><br><span class=line>183</span><br><span class=line>184</span><br><span class=line>185</span><br><span class=line>186</span><br><span class=line>187</span><br><span class=line>188</span><br><span class=line>189</span><br><span class=line>190</span><br><span class=line>191</span><br><span class=line>192</span><br><span class=line>193</span><br><span class=line>194</span><br><span class=line>195</span><br><span class=line>196</span><br><span class=line>197</span><br><span class=line>198</span><br><span class=line>199</span><br><span class=line>200</span><br><span class=line>201</span><br><span class=line>202</span><br><span class=line>203</span><br><span class=line>204</span><br><span class=line>205</span><br><span class=line>206</span><br><span class=line>207</span><br><span class=line>208</span><br><span class=line>209</span><br><span class=line>210</span><br><span class=line>211</span><br><span class=line>212</span><br><span class=line>213</span><br><span class=line>214</span><br><span class=line>215</span><br><span class=line>216</span><br><span class=line>217</span><br><span class=line>218</span><br><span class=line>219</span><br><span class=line>220</span><br><span class=line>221</span><br><span class=line>222</span><br><span class=line>223</span><br><span class=line>224</span><br><span class=line>225</span><br><span class=line>226</span><br><span class=line>227</span><br><span class=line>228</span><br><span class=line>229</span><br><span class=line>230</span><br><span class=line>231</span><br><span class=line>232</span><br><span class=line>233</span><br><span class=line>234</span><br><span class=line>235</span><br><span class=line>236</span><br><span class=line>237</span><br><span class=line>238</span><br><span class=line>239</span><br><span class=line>240</span><br><span class=line>241</span><br><span class=line>242</span><br><span class=line>243</span><br><span class=line>244</span><br><span class=line>245</span><br><span class=line>246</span><br><span class=line>247</span><br><span class=line>248</span><br><span class=line>249</span><br><span class=line>250</span><br><span class=line>251</span><br><span class=line>252</span><br><span class=line>253</span><br><span class=line>254</span><br><span class=line>255</span><br><span class=line>256</span><br><span class=line>257</span><br><span class=line>258</span><br><span class=line>259</span><br><span class=line>260</span><br><span class=line>261</span><br><span class=line>262</span><br><span class=line>263</span><br><span class=line>264</span><br><span class=line>265</span><br><span class=line>266</span><br><span class=line>267</span><br><span class=line>268</span><br><span class=line>269</span><br><span class=line>270</span><br><span class=line>271</span><br><span class=line>272</span><br><span class=line>273</span><br><span class=line>274</span><br><span class=line>275</span><br><span class=line>276</span><br><span class=line>277</span><br><span class=line>278</span><br><span class=line>279</span><br><span class=line>280</span><br><span class=line>281</span><br><span class=line>282</span><br><span class=line>283</span><br><span class=line>284</span><br><span class=line>285</span><br><span class=line>286</span><br><span class=line>287</span><br><span class=line>288</span><br><span class=line>289</span><br><span class=line>290</span><br><span class=line>291</span><br><span class=line>292</span><br><span class=line>293</span><br><span class=line>294</span><br><span class=line>295</span><br><span class=line>296</span><br><span class=line>297</span><br><span class=line>298</span><br><span class=line>299</span><br><span class=line>300</span><br><span class=line>301</span><br><span class=line>302</span><br><span class=line>303</span><br><span class=line>304</span><br><span class=line>305</span><br><span class=line>306</span><br><span class=line>307</span><br><span class=line>308</span><br><span class=line>309</span><br><span class=line>310</span><br><span class=line>311</span><br><span class=line>312</span><br><span class=line>313</span><br><span class=line>314</span><br><span class=line>315</span><br><span class=line>316</span><br><span class=line>317</span><br><span class=line>318</span><br><span class=line>319</span><br><span class=line>320</span><br><span class=line>321</span><br><span class=line>322</span><br><span class=line>323</span><br><span class=line>324</span><br><span class=line>325</span><br><span class=line>326</span><br><span class=line>327</span><br><span class=line>328</span><br><span class=line>329</span><br><span class=line>330</span><br><span class=line>331</span><br><span class=line>332</span><br><span class=line>333</span><br><span class=line>334</span><br><span class=line>335</span><br><span class=line>336</span><br><span class=line>337</span><br><span class=line>338</span><br><span class=line>339</span><br><span class=line>340</span><br><span class=line>341</span><br><span class=line>342</span><br><span class=line>343</span><br><span class=line>344</span><br><span class=line>345</span><br><span class=line>346</span><br><span class=line>347</span><br><span class=line>348</span><br><span class=line>349</span><br><span class=line>350</span><br><span class=line>351</span><br><span class=line>352</span><br><span class=line>353</span><br><span class=line>354</span><br><span class=line>355</span><br><span class=line>356</span><br><span class=line>357</span><br><span class=line>358</span><br><span class=line>359</span><br><span class=line>360</span><br><span class=line>361</span><br><span class=line>362</span><br><span class=line>363</span><br><span class=line>364</span><br><span class=line>365</span><br><span class=line>366</span><br><span class=line>367</span><br><span class=line>368</span><br><span class=line>369</span><br><span class=line>370</span><br><span class=line>371</span><br><span class=line>372</span><br><span class=line>373</span><br><span class=line>374</span><br><span class=line>375</span><br><span class=line>376</span><br><span class=line>377</span><br><span class=line>378</span><br><span class=line>379</span><br><span class=line>380</span><br><span class=line>381</span><br><span class=line>382</span><br><span class=line>383</span><br><span class=line>384</span><br><span class=line>385</span><br><span class=line>386</span><br><span class=line>387</span><br><span class=line>388</span><br><span class=line>389</span><br><span class=line>390</span><br><span class=line>391</span><br><span class=line>392</span><br><span class=line>393</span><br><span class=line>394</span><br><span class=line>395</span><br><span class=line>396</span><br><span class=line>397</span><br><span class=line>398</span><br><span class=line>399</span><br><span class=line>400</span><br><span class=line>401</span><br></pre></td><td class=code><pre><span class=line><span class=comment>// src/server/server.ts</span></span><br><span class=line><span class=keyword>import</span> &#123;</span><br><span class=line>    createConnection,</span><br><span class=line>    <span class="title class_">TextDocuments</span>,</span><br><span class=line>    <span class="title class_">Diagnostic</span>,</span><br><span class=line>    <span class="title class_">DiagnosticSeverity</span>,</span><br><span class=line>    <span class="title class_">ProposedFeatures</span>,</span><br><span class=line>    <span class="title class_">InitializeParams</span>,</span><br><span class=line>    <span class="title class_">DidChangeConfigurationNotification</span>,</span><br><span class=line>    <span class="title class_">CompletionItem</span>,</span><br><span class=line>    <span class="title class_">CompletionItemKind</span>,</span><br><span class=line>    <span class="title class_">TextDocumentPositionParams</span>,</span><br><span class=line>    <span class="title class_">TextDocumentSyncKind</span>,</span><br><span class=line>    <span class="title class_">InitializeResult</span>,</span><br><span class=line>    <span class="title class_">DocumentDiagnosticReportKind</span>,</span><br><span class=line>    <span class=keyword>type</span> <span class="title class_">DocumentDiagnosticReport</span></span><br><span class=line>&#125; <span class=keyword>from</span> <span class=string>&#x27;vscode-languageserver/node&#x27;</span>;</span><br><span class=line></span><br><span class=line><span class=keyword>import</span> &#123; <span class="title class_">TextDocument</span> &#125; <span class=keyword>from</span> <span class=string>&#x27;vscode-languageserver-textdocument&#x27;</span>;</span><br><span class=line></span><br><span class=line><span class=comment>// åˆ›å»ºè¿æ¥</span></span><br><span class=line><span class=keyword>const</span> connection = <span class="title function_">createConnection</span>(<span class="title class_">ProposedFeatures</span>.<span class=property>all</span>);</span><br><span class=line></span><br><span class=line><span class=comment>// åˆ›å»ºæ–‡æ¡£ç®¡ç†å™¨</span></span><br><span class=line><span class=keyword>const</span> <span class=attr>documents</span>: <span class="title class_">TextDocuments</span>&lt;<span class="title class_">TextDocument</span>&gt; = <span class=keyword>new</span> <span class="title class_">TextDocuments</span>(<span class="title class_">TextDocument</span>);</span><br><span class=line></span><br><span class=line><span class=comment>// é…ç½®ç¼“å­˜</span></span><br><span class=line><span class=keyword>interface</span> <span class="title class_">MyLangSettings</span> &#123;</span><br><span class=line>    <span class=attr>maxNumberOfProblems</span>: <span class=built_in>number</span>;</span><br><span class=line>    <span class=attr>enableLinting</span>: <span class=built_in>boolean</span>;</span><br><span class=line>    <span class=attr>enableFormatting</span>: <span class=built_in>boolean</span>;</span><br><span class=line>    <span class=attr>tabSize</span>: <span class=built_in>number</span>;</span><br><span class=line>    <span class=attr>insertSpaces</span>: <span class=built_in>boolean</span>;</span><br><span class=line>&#125;</span><br><span class=line></span><br><span class=line><span class=keyword>const</span> <span class=attr>defaultSettings</span>: <span class="title class_">MyLangSettings</span> = &#123;</span><br><span class=line>    <span class=attr>maxNumberOfProblems</span>: <span class=number>1000</span>,</span><br><span class=line>    <span class=attr>enableLinting</span>: <span class=literal>true</span>,</span><br><span class=line>    <span class=attr>enableFormatting</span>: <span class=literal>true</span>,</span><br><span class=line>    <span class=attr>tabSize</span>: <span class=number>4</span>,</span><br><span class=line>    <span class=attr>insertSpaces</span>: <span class=literal>true</span></span><br><span class=line>&#125;;</span><br><span class=line></span><br><span class=line><span class=keyword>let</span> <span class=attr>globalSettings</span>: <span class="title class_">MyLangSettings</span> = defaultSettings;</span><br><span class=line><span class=keyword>const</span> <span class=attr>documentSettings</span>: <span class="title class_">Map</span>&lt;<span class=built_in>string</span>, <span class="title class_">Thenable</span>&lt;<span class="title class_">MyLangSettings</span>&gt;&gt; = <span class=keyword>new</span> <span class="title class_">Map</span>();</span><br><span class=line></span><br><span class=line><span class=comment>// åˆå§‹åŒ–å¤„ç†</span></span><br><span class=line>connection.<span class="title function_">onInitialize</span>(<span class=function>(<span class=params>params: InitializeParams</span>) =&gt;</span> &#123;</span><br><span class=line>    <span class=keyword>const</span> capabilities = params.<span class=property>capabilities</span>;</span><br><span class=line>    </span><br><span class=line>    <span class=comment>// æ£€æŸ¥å®¢æˆ·ç«¯æ˜¯å¦æ”¯æŒå·¥ä½œåŒºæ–‡ä»¶å¤¹</span></span><br><span class=line>    <span class=keyword>const</span> hasWorkspaceFolderCapability = !!(</span><br><span class=line>        capabilities.<span class=property>workspace</span> &amp;&amp; !!capabilities.<span class=property>workspace</span>.<span class=property>workspaceFolders</span></span><br><span class=line>    );</span><br><span class=line>    </span><br><span class=line>    <span class=comment>// æ£€æŸ¥å®¢æˆ·ç«¯æ˜¯å¦æ”¯æŒé…ç½®å˜åŒ–</span></span><br><span class=line>    <span class=keyword>const</span> hasConfigurationCapability = !!(</span><br><span class=line>        capabilities.<span class=property>workspace</span> &amp;&amp; !!capabilities.<span class=property>workspace</span>.<span class=property>configuration</span></span><br><span class=line>    );</span><br><span class=line>    </span><br><span class=line>    <span class=comment>// æ£€æŸ¥å®¢æˆ·ç«¯æ˜¯å¦æ”¯æŒè¯Šæ–­åˆ·æ–°</span></span><br><span class=line>    <span class=keyword>const</span> hasDiagnosticRefreshSupport = !!(</span><br><span class=line>        capabilities.<span class=property>workspace</span> &amp;&amp; !!capabilities.<span class=property>workspace</span>.<span class=property>diagnostics</span> &amp;&amp; !!capabilities.<span class=property>workspace</span>.<span class=property>diagnostics</span>.<span class=property>refreshSupport</span></span><br><span class=line>    );</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>const</span> <span class=attr>result</span>: <span class="title class_">InitializeResult</span> = &#123;</span><br><span class=line>        <span class=attr>capabilities</span>: &#123;</span><br><span class=line>            <span class=attr>textDocumentSync</span>: <span class="title class_">TextDocumentSyncKind</span>.<span class=property>Incremental</span>,</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// ä»£ç è¡¥å…¨</span></span><br><span class=line>            <span class=attr>completionProvider</span>: &#123;</span><br><span class=line>                <span class=attr>resolveProvider</span>: <span class=literal>true</span>,</span><br><span class=line>                <span class=attr>triggerCharacters</span>: [<span class=string>&#x27;.&#x27;</span>, <span class=string>&#x27;:&#x27;</span>, <span class=string>&#x27;&lt;&#x27;</span>]</span><br><span class=line>            &#125;,</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// æ‚¬åœä¿¡æ¯</span></span><br><span class=line>            <span class=attr>hoverProvider</span>: <span class=literal>true</span>,</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// ç­¾åå¸®åŠ©</span></span><br><span class=line>            <span class=attr>signatureHelpProvider</span>: &#123;</span><br><span class=line>                <span class=attr>triggerCharacters</span>: [<span class=string>&#x27;(&#x27;</span>, <span class=string>&#x27;,&#x27;</span>]</span><br><span class=line>            &#125;,</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// å®šä¹‰è·³è½¬</span></span><br><span class=line>            <span class=attr>definitionProvider</span>: <span class=literal>true</span>,</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// å¼•ç”¨æŸ¥æ‰¾</span></span><br><span class=line>            <span class=attr>referencesProvider</span>: <span class=literal>true</span>,</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// æ–‡æ¡£é«˜äº®</span></span><br><span class=line>            <span class=attr>documentHighlightProvider</span>: <span class=literal>true</span>,</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// ç¬¦å·æŸ¥æ‰¾</span></span><br><span class=line>            <span class=attr>documentSymbolProvider</span>: <span class=literal>true</span>,</span><br><span class=line>            <span class=attr>workspaceSymbolProvider</span>: <span class=literal>true</span>,</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// ä»£ç æ“ä½œ</span></span><br><span class=line>            <span class=attr>codeActionProvider</span>: <span class=literal>true</span>,</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// é‡å‘½å</span></span><br><span class=line>            <span class=attr>renameProvider</span>: &#123;</span><br><span class=line>                <span class=attr>prepareProvider</span>: <span class=literal>true</span></span><br><span class=line>            &#125;,</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// æ ¼å¼åŒ–</span></span><br><span class=line>            <span class=attr>documentFormattingProvider</span>: <span class=literal>true</span>,</span><br><span class=line>            <span class=attr>documentRangeFormattingProvider</span>: <span class=literal>true</span>,</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// è¯Šæ–­</span></span><br><span class=line>            <span class=attr>diagnosticProvider</span>: &#123;</span><br><span class=line>                <span class=attr>interFileDependencies</span>: <span class=literal>false</span>,</span><br><span class=line>                <span class=attr>workspaceDiagnostics</span>: <span class=literal>false</span></span><br><span class=line>            &#125;</span><br><span class=line>        &#125;</span><br><span class=line>    &#125;;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>if</span> (hasWorkspaceFolderCapability) &#123;</span><br><span class=line>        result.<span class=property>capabilities</span>.<span class=property>workspace</span> = &#123;</span><br><span class=line>            <span class=attr>workspaceFolders</span>: &#123;</span><br><span class=line>                <span class=attr>supported</span>: <span class=literal>true</span></span><br><span class=line>            &#125;</span><br><span class=line>        &#125;;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>return</span> result;</span><br><span class=line>&#125;);</span><br><span class=line></span><br><span class=line><span class=comment>// åˆå§‹åŒ–å®Œæˆå¤„ç†</span></span><br><span class=line>connection.<span class="title function_">onInitialized</span>(<span class=function>() =&gt;</span> &#123;</span><br><span class=line>    connection.<span class=property>client</span>.<span class="title function_">register</span>(<span class="title class_">DidChangeConfigurationNotification</span>.<span class=property>type</span>, <span class=literal>undefined</span>);</span><br><span class=line>    </span><br><span class=line>    <span class=comment>// å‘é€åˆå§‹åŒ–å®Œæˆé€šçŸ¥</span></span><br><span class=line>    connection.<span class="title function_">sendNotification</span>(<span class=string>&#x27;mylang/status&#x27;</span>, &#123;</span><br><span class=line>        <span class=attr>message</span>: <span class=string>&#x27;Language Serveråˆå§‹åŒ–å®Œæˆ&#x27;</span></span><br><span class=line>    &#125;);</span><br><span class=line>&#125;);</span><br><span class=line></span><br><span class=line><span class=comment>// é…ç½®å˜åŒ–å¤„ç†</span></span><br><span class=line>connection.<span class="title function_">onDidChangeConfiguration</span>(<span class=function><span class=params>change</span> =&gt;</span> &#123;</span><br><span class=line>    <span class=keyword>if</span> (change.<span class=property>settings</span>) &#123;</span><br><span class=line>        globalSettings = &lt;<span class="title class_">MyLangSettings</span>&gt;(change.<span class=property>settings</span>.<span class=property>mylang</span> || defaultSettings);</span><br><span class=line>    &#125; <span class=keyword>else</span> &#123;</span><br><span class=line>        globalSettings = defaultSettings;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=comment>// æ¸…é™¤æ–‡æ¡£è®¾ç½®ç¼“å­˜</span></span><br><span class=line>    documentSettings.<span class="title function_">clear</span>();</span><br><span class=line>    </span><br><span class=line>    <span class=comment>// é‡æ–°éªŒè¯æ‰€æœ‰æ‰“å¼€çš„æ–‡æ¡£</span></span><br><span class=line>    documents.<span class="title function_">all</span>().<span class="title function_">forEach</span>(validateTextDocument);</span><br><span class=line>&#125;);</span><br><span class=line></span><br><span class=line><span class=comment>// è·å–æ–‡æ¡£è®¾ç½®</span></span><br><span class=line><span class=keyword>function</span> <span class="title function_">getDocumentSettings</span>(<span class=params>resource: <span class=built_in>string</span></span>): <span class="title class_">Thenable</span>&lt;<span class="title class_">MyLangSettings</span>&gt; &#123;</span><br><span class=line>    <span class=keyword>let</span> result = documentSettings.<span class="title function_">get</span>(resource);</span><br><span class=line>    <span class=keyword>if</span> (!result) &#123;</span><br><span class=line>        result = connection.<span class=property>workspace</span>.<span class="title function_">getConfiguration</span>(&#123;</span><br><span class=line>            <span class=attr>scopeUri</span>: resource,</span><br><span class=line>            <span class=attr>section</span>: <span class=string>&#x27;mylang&#x27;</span></span><br><span class=line>        &#125;);</span><br><span class=line>        documentSettings.<span class="title function_">set</span>(resource, result);</span><br><span class=line>    &#125;</span><br><span class=line>    <span class=keyword>return</span> result;</span><br><span class=line>&#125;</span><br><span class=line></span><br><span class=line><span class=comment>// æ–‡æ¡£å˜åŒ–å¤„ç†</span></span><br><span class=line>documents.<span class="title function_">onDidChangeContent</span>(<span class=function><span class=params>change</span> =&gt;</span> &#123;</span><br><span class=line>    <span class="title function_">validateTextDocument</span>(change.<span class=property>document</span>);</span><br><span class=line>&#125;);</span><br><span class=line></span><br><span class=line><span class=comment>// æ–‡æ¡£éªŒè¯</span></span><br><span class=line><span class=keyword>async</span> <span class=keyword>function</span> <span class="title function_">validateTextDocument</span>(<span class=params>textDocument: TextDocument</span>): <span class="title class_">Promise</span>&lt;<span class=built_in>void</span>&gt; &#123;</span><br><span class=line>    <span class=keyword>const</span> settings = <span class=keyword>await</span> <span class="title function_">getDocumentSettings</span>(textDocument.<span class=property>uri</span>);</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>if</span> (!settings.<span class=property>enableLinting</span>) &#123;</span><br><span class=line>        <span class=keyword>return</span>;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>const</span> text = textDocument.<span class="title function_">getText</span>();</span><br><span class=line>    <span class=keyword>const</span> <span class=attr>diagnostics</span>: <span class="title class_">Diagnostic</span>[] = [];</span><br><span class=line>    </span><br><span class=line>    <span class=comment>// è¯­æ³•æ£€æŸ¥</span></span><br><span class=line>    diagnostics.<span class="title function_">push</span>(...<span class="title function_">checkSyntax</span>(text, textDocument));</span><br><span class=line>    </span><br><span class=line>    <span class=comment>// è¯­ä¹‰æ£€æŸ¥</span></span><br><span class=line>    diagnostics.<span class="title function_">push</span>(...<span class="title function_">checkSemantics</span>(text, textDocument));</span><br><span class=line>    </span><br><span class=line>    <span class=comment>// æ ·å¼æ£€æŸ¥</span></span><br><span class=line>    diagnostics.<span class="title function_">push</span>(...<span class="title function_">checkStyle</span>(text, textDocument, settings));</span><br><span class=line>    </span><br><span class=line>    <span class=comment>// é™åˆ¶è¯Šæ–­æ•°é‡</span></span><br><span class=line>    <span class=keyword>const</span> limitedDiagnostics = diagnostics.<span class="title function_">slice</span>(<span class=number>0</span>, settings.<span class=property>maxNumberOfProblems</span>);</span><br><span class=line>    </span><br><span class=line>    <span class=comment>// å‘é€è¯Šæ–­ä¿¡æ¯</span></span><br><span class=line>    connection.<span class="title function_">sendDiagnostics</span>(&#123; <span class=attr>uri</span>: textDocument.<span class=property>uri</span>, <span class=attr>diagnostics</span>: limitedDiagnostics &#125;);</span><br><span class=line>&#125;</span><br><span class=line></span><br><span class=line><span class=comment>// è¯­æ³•æ£€æŸ¥</span></span><br><span class=line><span class=keyword>function</span> <span class="title function_">checkSyntax</span>(<span class=params>text: <span class=built_in>string</span>, <span class="variable language_">document</span>: TextDocument</span>): <span class="title class_">Diagnostic</span>[] &#123;</span><br><span class=line>    <span class=keyword>const</span> <span class=attr>diagnostics</span>: <span class="title class_">Diagnostic</span>[] = [];</span><br><span class=line>    <span class=keyword>const</span> lines = text.<span class="title function_">split</span>(<span class=string>&#x27;\n&#x27;</span>);</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>for</span> (<span class=keyword>let</span> i = <span class=number>0</span>; i &lt; lines.<span class=property>length</span>; i++) &#123;</span><br><span class=line>        <span class=keyword>const</span> line = lines[i];</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// æ£€æŸ¥æœªé—­åˆçš„æ‹¬å·</span></span><br><span class=line>        <span class=keyword>const</span> openParens = (line.<span class="title function_">match</span>(<span class=regexp>/\(/g</span>) || []).<span class=property>length</span>;</span><br><span class=line>        <span class=keyword>const</span> closeParens = (line.<span class="title function_">match</span>(<span class=regexp>/\)/g</span>) || []).<span class=property>length</span>;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>if</span> (openParens &gt; closeParens) &#123;</span><br><span class=line>            <span class=keyword>const</span> <span class=attr>diagnostic</span>: <span class="title class_">Diagnostic</span> = &#123;</span><br><span class=line>                <span class=attr>severity</span>: <span class="title class_">DiagnosticSeverity</span>.<span class=property>Error</span>,</span><br><span class=line>                <span class=attr>range</span>: &#123;</span><br><span class=line>                    <span class=attr>start</span>: &#123; <span class=attr>line</span>: i, <span class=attr>character</span>: line.<span class="title function_">lastIndexOf</span>(<span class=string>&#x27;(&#x27;</span>) &#125;,</span><br><span class=line>                    <span class=attr>end</span>: &#123; <span class=attr>line</span>: i, <span class=attr>character</span>: line.<span class="title function_">lastIndexOf</span>(<span class=string>&#x27;(&#x27;</span>) + <span class=number>1</span> &#125;</span><br><span class=line>                &#125;,</span><br><span class=line>                <span class=attr>message</span>: <span class=string>&#x27;ç¼ºå°‘é—­åˆæ‹¬å·&#x27;</span>,</span><br><span class=line>                <span class=attr>source</span>: <span class=string>&#x27;mylang&#x27;</span></span><br><span class=line>            &#125;;</span><br><span class=line>            diagnostics.<span class="title function_">push</span>(diagnostic);</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// æ£€æŸ¥æœªç»ˆæ­¢çš„å­—ç¬¦ä¸²</span></span><br><span class=line>        <span class=keyword>const</span> quotes = (line.<span class="title function_">match</span>(<span class=regexp>/&quot;/g</span>) || []).<span class=property>length</span>;</span><br><span class=line>        <span class=keyword>if</span> (quotes % <span class=number>2</span> === <span class=number>1</span>) &#123;</span><br><span class=line>            <span class=keyword>const</span> <span class=attr>diagnostic</span>: <span class="title class_">Diagnostic</span> = &#123;</span><br><span class=line>                <span class=attr>severity</span>: <span class="title class_">DiagnosticSeverity</span>.<span class=property>Error</span>,</span><br><span class=line>                <span class=attr>range</span>: &#123;</span><br><span class=line>                    <span class=attr>start</span>: &#123; <span class=attr>line</span>: i, <span class=attr>character</span>: line.<span class="title function_">lastIndexOf</span>(<span class=string>&#x27;&quot;&#x27;</span>) &#125;,</span><br><span class=line>                    <span class=attr>end</span>: &#123; <span class=attr>line</span>: i, <span class=attr>character</span>: line.<span class=property>length</span> &#125;</span><br><span class=line>                &#125;,</span><br><span class=line>                <span class=attr>message</span>: <span class=string>&#x27;æœªç»ˆæ­¢çš„å­—ç¬¦ä¸²&#x27;</span>,</span><br><span class=line>                <span class=attr>source</span>: <span class=string>&#x27;mylang&#x27;</span></span><br><span class=line>            &#125;;</span><br><span class=line>            diagnostics.<span class="title function_">push</span>(diagnostic);</span><br><span class=line>        &#125;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>return</span> diagnostics;</span><br><span class=line>&#125;</span><br><span class=line></span><br><span class=line><span class=comment>// è¯­ä¹‰æ£€æŸ¥</span></span><br><span class=line><span class=keyword>function</span> <span class="title function_">checkSemantics</span>(<span class=params>text: <span class=built_in>string</span>, <span class="variable language_">document</span>: TextDocument</span>): <span class="title class_">Diagnostic</span>[] &#123;</span><br><span class=line>    <span class=keyword>const</span> <span class=attr>diagnostics</span>: <span class="title class_">Diagnostic</span>[] = [];</span><br><span class=line>    </span><br><span class=line>    <span class=comment>// æ£€æŸ¥æœªå®šä¹‰çš„å˜é‡</span></span><br><span class=line>    <span class=keyword>const</span> variableUsage = <span class=regexp>/\b([a-zA-Z_][a-zA-Z0-9_]*)\b/g</span>;</span><br><span class=line>    <span class=keyword>const</span> variableDeclarations = <span class=keyword>new</span> <span class="title class_">Set</span>&lt;<span class=built_in>string</span>&gt;();</span><br><span class=line>    <span class=keyword>const</span> usedVariables = <span class=keyword>new</span> <span class="title class_">Map</span>&lt;<span class=built_in>string</span>, <span class="title class_">Array</span>&lt;&#123; <span class=attr>line</span>: <span class=built_in>number</span>, <span class=attr>character</span>: <span class=built_in>number</span> &#125;&gt;&gt;();</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>const</span> lines = text.<span class="title function_">split</span>(<span class=string>&#x27;\n&#x27;</span>);</span><br><span class=line>    </span><br><span class=line>    <span class=comment>// æ”¶é›†å˜é‡å£°æ˜</span></span><br><span class=line>    <span class=keyword>for</span> (<span class=keyword>let</span> i = <span class=number>0</span>; i &lt; lines.<span class=property>length</span>; i++) &#123;</span><br><span class=line>        <span class=keyword>const</span> line = lines[i];</span><br><span class=line>        <span class=keyword>const</span> declarationMatch = <span class=regexp>/(var|let|const)\s+(\w+)/g</span>;</span><br><span class=line>        <span class=keyword>let</span> match;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>while</span> ((match = declarationMatch.<span class="title function_">exec</span>(line)) !== <span class=literal>null</span>) &#123;</span><br><span class=line>            variableDeclarations.<span class="title function_">add</span>(match[<span class=number>2</span>]);</span><br><span class=line>        &#125;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=comment>// æ£€æŸ¥å˜é‡ä½¿ç”¨</span></span><br><span class=line>    <span class=keyword>for</span> (<span class=keyword>let</span> i = <span class=number>0</span>; i &lt; lines.<span class=property>length</span>; i++) &#123;</span><br><span class=line>        <span class=keyword>const</span> line = lines[i];</span><br><span class=line>        <span class=keyword>let</span> match;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>while</span> ((match = variableUsage.<span class="title function_">exec</span>(line)) !== <span class=literal>null</span>) &#123;</span><br><span class=line>            <span class=keyword>const</span> variable = match[<span class=number>1</span>];</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// è·³è¿‡å…³é”®å­—</span></span><br><span class=line>            <span class=keyword>if</span> ([<span class=string>&#x27;function&#x27;</span>, <span class=string>&#x27;var&#x27;</span>, <span class=string>&#x27;let&#x27;</span>, <span class=string>&#x27;const&#x27;</span>, <span class=string>&#x27;if&#x27;</span>, <span class=string>&#x27;else&#x27;</span>, <span class=string>&#x27;while&#x27;</span>, <span class=string>&#x27;for&#x27;</span>].<span class="title function_">includes</span>(variable)) &#123;</span><br><span class=line>                <span class=keyword>continue</span>;</span><br><span class=line>            &#125;</span><br><span class=line>            </span><br><span class=line>            <span class=keyword>if</span> (!usedVariables.<span class="title function_">has</span>(variable)) &#123;</span><br><span class=line>                usedVariables.<span class="title function_">set</span>(variable, []);</span><br><span class=line>            &#125;</span><br><span class=line>            </span><br><span class=line>            usedVariables.<span class="title function_">get</span>(variable)!.<span class="title function_">push</span>(&#123;</span><br><span class=line>                <span class=attr>line</span>: i,</span><br><span class=line>                <span class=attr>character</span>: match.<span class=property>index</span></span><br><span class=line>            &#125;);</span><br><span class=line>        &#125;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=comment>// æŠ¥å‘Šæœªå®šä¹‰çš„å˜é‡</span></span><br><span class=line>    <span class=keyword>for</span> (<span class=keyword>const</span> [variable, positions] <span class=keyword>of</span> usedVariables) &#123;</span><br><span class=line>        <span class=keyword>if</span> (!variableDeclarations.<span class="title function_">has</span>(variable)) &#123;</span><br><span class=line>            <span class=keyword>for</span> (<span class=keyword>const</span> pos <span class=keyword>of</span> positions) &#123;</span><br><span class=line>                <span class=keyword>const</span> <span class=attr>diagnostic</span>: <span class="title class_">Diagnostic</span> = &#123;</span><br><span class=line>                    <span class=attr>severity</span>: <span class="title class_">DiagnosticSeverity</span>.<span class=property>Warning</span>,</span><br><span class=line>                    <span class=attr>range</span>: &#123;</span><br><span class=line>                        <span class=attr>start</span>: &#123; <span class=attr>line</span>: pos.<span class=property>line</span>, <span class=attr>character</span>: pos.<span class=property>character</span> &#125;,</span><br><span class=line>                        <span class=attr>end</span>: &#123; <span class=attr>line</span>: pos.<span class=property>line</span>, <span class=attr>character</span>: pos.<span class=property>character</span> + variable.<span class=property>length</span> &#125;</span><br><span class=line>                    &#125;,</span><br><span class=line>                    <span class=attr>message</span>: <span class=string>`æœªå®šä¹‰çš„å˜é‡ &#x27;<span class=subst>$&#123;variable&#125;</span>&#x27;`</span>,</span><br><span class=line>                    <span class=attr>source</span>: <span class=string>&#x27;mylang&#x27;</span></span><br><span class=line>                &#125;;</span><br><span class=line>                diagnostics.<span class="title function_">push</span>(diagnostic);</span><br><span class=line>            &#125;</span><br><span class=line>        &#125;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>return</span> diagnostics;</span><br><span class=line>&#125;</span><br><span class=line></span><br><span class=line><span class=comment>// æ ·å¼æ£€æŸ¥</span></span><br><span class=line><span class=keyword>function</span> <span class="title function_">checkStyle</span>(<span class=params>text: <span class=built_in>string</span>, <span class="variable language_">document</span>: TextDocument, settings: MyLangSettings</span>): <span class="title class_">Diagnostic</span>[] &#123;</span><br><span class=line>    <span class=keyword>const</span> <span class=attr>diagnostics</span>: <span class="title class_">Diagnostic</span>[] = [];</span><br><span class=line>    <span class=keyword>const</span> lines = text.<span class="title function_">split</span>(<span class=string>&#x27;\n&#x27;</span>);</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>for</span> (<span class=keyword>let</span> i = <span class=number>0</span>; i &lt; lines.<span class=property>length</span>; i++) &#123;</span><br><span class=line>        <span class=keyword>const</span> line = lines[i];</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// æ£€æŸ¥ç¼©è¿›</span></span><br><span class=line>        <span class=keyword>if</span> (settings.<span class=property>insertSpaces</span>) &#123;</span><br><span class=line>            <span class=keyword>if</span> (line.<span class="title function_">match</span>(<span class=regexp>/^\t/</span>)) &#123;</span><br><span class=line>                <span class=keyword>const</span> <span class=attr>diagnostic</span>: <span class="title class_">Diagnostic</span> = &#123;</span><br><span class=line>                    <span class=attr>severity</span>: <span class="title class_">DiagnosticSeverity</span>.<span class=property>Information</span>,</span><br><span class=line>                    <span class=attr>range</span>: &#123;</span><br><span class=line>                        <span class=attr>start</span>: &#123; <span class=attr>line</span>: i, <span class=attr>character</span>: <span class=number>0</span> &#125;,</span><br><span class=line>                        <span class=attr>end</span>: &#123; <span class=attr>line</span>: i, <span class=attr>character</span>: line.<span class="title function_">search</span>(<span class=regexp>/[^\t]/</span>) &#125;</span><br><span class=line>                    &#125;,</span><br><span class=line>                    <span class=attr>message</span>: <span class=string>&#x27;å»ºè®®ä½¿ç”¨ç©ºæ ¼è€Œä¸æ˜¯åˆ¶è¡¨ç¬¦&#x27;</span>,</span><br><span class=line>                    <span class=attr>source</span>: <span class=string>&#x27;mylang&#x27;</span></span><br><span class=line>                &#125;;</span><br><span class=line>                diagnostics.<span class="title function_">push</span>(diagnostic);</span><br><span class=line>            &#125;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// æ£€æŸ¥è¡Œå°¾ç©ºæ ¼</span></span><br><span class=line>        <span class=keyword>if</span> (line.<span class="title function_">match</span>(<span class=regexp>/\s+$/</span>)) &#123;</span><br><span class=line>            <span class=keyword>const</span> trimmedLength = line.<span class="title function_">trimEnd</span>().<span class=property>length</span>;</span><br><span class=line>            <span class=keyword>const</span> <span class=attr>diagnostic</span>: <span class="title class_">Diagnostic</span> = &#123;</span><br><span class=line>                <span class=attr>severity</span>: <span class="title class_">DiagnosticSeverity</span>.<span class=property>Information</span>,</span><br><span class=line>                <span class=attr>range</span>: &#123;</span><br><span class=line>                    <span class=attr>start</span>: &#123; <span class=attr>line</span>: i, <span class=attr>character</span>: trimmedLength &#125;,</span><br><span class=line>                    <span class=attr>end</span>: &#123; <span class=attr>line</span>: i, <span class=attr>character</span>: line.<span class=property>length</span> &#125;</span><br><span class=line>                &#125;,</span><br><span class=line>                <span class=attr>message</span>: <span class=string>&#x27;è¡Œå°¾æœ‰å¤šä½™çš„ç©ºæ ¼&#x27;</span>,</span><br><span class=line>                <span class=attr>source</span>: <span class=string>&#x27;mylang&#x27;</span></span><br><span class=line>            &#125;;</span><br><span class=line>            diagnostics.<span class="title function_">push</span>(diagnostic);</span><br><span class=line>        &#125;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>return</span> diagnostics;</span><br><span class=line>&#125;</span><br><span class=line></span><br><span class=line><span class=comment>// ä»£ç è¡¥å…¨</span></span><br><span class=line>connection.<span class="title function_">onCompletion</span>((<span class=attr>textDocumentPosition</span>: <span class="title class_">TextDocumentPositionParams</span>): <span class="title class_">CompletionItem</span>[] =&gt; &#123;</span><br><span class=line>    <span class=keyword>return</span> [</span><br><span class=line>        &#123;</span><br><span class=line>            <span class=attr>label</span>: <span class=string>&#x27;function&#x27;</span>,</span><br><span class=line>            <span class=attr>kind</span>: <span class="title class_">CompletionItemKind</span>.<span class=property>Keyword</span>,</span><br><span class=line>            <span class=attr>data</span>: <span class=number>1</span></span><br><span class=line>        &#125;,</span><br><span class=line>        &#123;</span><br><span class=line>            <span class=attr>label</span>: <span class=string>&#x27;variable&#x27;</span>,</span><br><span class=line>            <span class=attr>kind</span>: <span class="title class_">CompletionItemKind</span>.<span class=property>Variable</span>,</span><br><span class=line>            <span class=attr>data</span>: <span class=number>2</span></span><br><span class=line>        &#125;,</span><br><span class=line>        &#123;</span><br><span class=line>            <span class=attr>label</span>: <span class=string>&#x27;class&#x27;</span>,</span><br><span class=line>            <span class=attr>kind</span>: <span class="title class_">CompletionItemKind</span>.<span class=property>Class</span>,</span><br><span class=line>            <span class=attr>data</span>: <span class=number>3</span></span><br><span class=line>        &#125;</span><br><span class=line>    ];</span><br><span class=line>&#125;);</span><br><span class=line></span><br><span class=line><span class=comment>// è¡¥å…¨é¡¹è§£æ</span></span><br><span class=line>connection.<span class="title function_">onCompletionResolve</span>((<span class=attr>item</span>: <span class="title class_">CompletionItem</span>): <span class=function><span class=params>CompletionItem</span> =&gt;</span> &#123;</span><br><span class=line>    <span class=keyword>if</span> (item.<span class=property>data</span> === <span class=number>1</span>) &#123;</span><br><span class=line>        item.<span class=property>detail</span> = <span class=string>&#x27;Function keyword&#x27;</span>;</span><br><span class=line>        item.<span class=property>documentation</span> = <span class=string>&#x27;Declares a function&#x27;</span>;</span><br><span class=line>    &#125; <span class=keyword>else</span> <span class=keyword>if</span> (item.<span class=property>data</span> === <span class=number>2</span>) &#123;</span><br><span class=line>        item.<span class=property>detail</span> = <span class=string>&#x27;Variable&#x27;</span>;</span><br><span class=line>        item.<span class=property>documentation</span> = <span class=string>&#x27;A variable declaration&#x27;</span>;</span><br><span class=line>    &#125; <span class=keyword>else</span> <span class=keyword>if</span> (item.<span class=property>data</span> === <span class=number>3</span>) &#123;</span><br><span class=line>        item.<span class=property>detail</span> = <span class=string>&#x27;Class keyword&#x27;</span>;</span><br><span class=line>        item.<span class=property>documentation</span> = <span class=string>&#x27;Declares a class&#x27;</span>;</span><br><span class=line>    &#125;</span><br><span class=line>    <span class=keyword>return</span> item;</span><br><span class=line>&#125;);</span><br><span class=line></span><br><span class=line><span class=comment>// è‡ªå®šä¹‰è¯·æ±‚å¤„ç†</span></span><br><span class=line>connection.<span class="title function_">onRequest</span>(<span class=string>&#x27;mylang/getStatus&#x27;</span>, <span class=function>() =&gt;</span> &#123;</span><br><span class=line>    <span class=keyword>return</span> &#123;</span><br><span class=line>        <span class=attr>status</span>: <span class=string>&#x27;running&#x27;</span>,</span><br><span class=line>        <span class=attr>documentsCount</span>: documents.<span class="title function_">all</span>().<span class=property>length</span>,</span><br><span class=line>        <span class=attr>diagnosticsEnabled</span>: globalSettings.<span class=property>enableLinting</span></span><br><span class=line>    &#125;;</span><br><span class=line>&#125;);</span><br><span class=line></span><br><span class=line><span class=comment>// ç›‘å¬æ–‡æ¡£</span></span><br><span class=line>documents.<span class="title function_">listen</span>(connection);</span><br><span class=line></span><br><span class=line><span class=comment>// ç›‘å¬è¿æ¥</span></span><br><span class=line>connection.<span class="title function_">listen</span>();</span><br></pre></td></tr></table></figure><hr><h2 id=ğŸ“š-æœ¬é˜¶æ®µæ€»ç»“><a href=#ğŸ“š-æœ¬é˜¶æ®µæ€»ç»“ class=headerlink title="ğŸ“š æœ¬é˜¶æ®µæ€»ç»“"></a>ğŸ“š æœ¬é˜¶æ®µæ€»ç»“</h2><p>é€šè¿‡æœ¬é˜¶æ®µå­¦ä¹ ï¼Œä½ å·²ç»æŒæ¡äº†ï¼š</p><p>âœ… <strong>è¯­æ³•é«˜äº®æŠ€æœ¯</strong>ï¼šTextMateè¯­æ³•ã€è¯­ä¹‰é«˜äº®ã€åµŒå…¥è¯­è¨€æ”¯æŒ<br>âœ… <strong>ä»£ç ç‰‡æ®µç³»ç»Ÿ</strong>ï¼šåŠ¨æ€ç‰‡æ®µã€æ¡ä»¶è§¦å‘ã€æ™ºèƒ½è¡¥å…¨<br>âœ… <strong>æ™ºèƒ½æ„ŸçŸ¥åŠŸèƒ½</strong>ï¼šä»£ç è¡¥å…¨ã€æ‚¬åœä¿¡æ¯ã€å‚æ•°æç¤ºã€é”™è¯¯è¯Šæ–­<br>âœ… <strong>Language Server Protocol</strong>ï¼šLSPæ¶æ„ã€å®¢æˆ·ç«¯&#x2F;æœåŠ¡å™¨å¼€å‘<br>âœ… <strong>ä»£ç æ“ä½œèƒ½åŠ›</strong>ï¼šæ ¼å¼åŒ–ã€é‡æ„ã€å¿«é€Ÿä¿®å¤ã€ä»£ç å¯¼èˆª</p><h3 id=æ ¸å¿ƒæŠ€æœ¯å›é¡¾><a href=#æ ¸å¿ƒæŠ€æœ¯å›é¡¾ class=headerlink title=æ ¸å¿ƒæŠ€æœ¯å›é¡¾></a>æ ¸å¿ƒæŠ€æœ¯å›é¡¾</h3><ul><li><strong>è¯­æ³•æ–‡ä»¶å¼€å‘</strong>ï¼šä½¿ç”¨TextMateè¯­æ³•è§„åˆ™å’Œæ­£åˆ™è¡¨è¾¾å¼</li><li><strong>è¯­ä¹‰tokens</strong>ï¼šåŸºäºè¯­è¨€ç†è§£çš„æ™ºèƒ½é«˜äº®</li><li><strong>LSPé€šä¿¡</strong>ï¼šJSON-RPCåè®®ã€å¢é‡åŒæ­¥ã€é”™è¯¯å¤„ç†</li><li><strong>è¯Šæ–­ç³»ç»Ÿ</strong>ï¼šè¯­æ³•æ£€æŸ¥ã€è¯­ä¹‰åˆ†æã€æ ·å¼å»ºè®®</li><li><strong>æ™ºèƒ½è¡¥å…¨</strong>ï¼šä¸Šä¸‹æ–‡æ„ŸçŸ¥ã€ç±»å‹æ¨æ–­ã€ä»£ç ç‰‡æ®µ</li></ul><hr><h2 id=ğŸš€-ä¸‹ä¸€æ­¥å­¦ä¹ æ–¹å‘><a href=#ğŸš€-ä¸‹ä¸€æ­¥å­¦ä¹ æ–¹å‘ class=headerlink title="ğŸš€ ä¸‹ä¸€æ­¥å­¦ä¹ æ–¹å‘"></a>ğŸš€ ä¸‹ä¸€æ­¥å­¦ä¹ æ–¹å‘</h2><p>åœ¨ä¸‹ä¸€é˜¶æ®µï¼ˆé«˜çº§ä¸»é¢˜ï¼‰ï¼Œæˆ‘ä»¬å°†å­¦ä¹ ï¼š</p><ul><li>ğŸ› <strong>è°ƒè¯•å™¨æ‰©å±•</strong>ï¼šDebug Adapter Protocolã€æ–­ç‚¹ç®¡ç†</li><li>âš™ï¸ <strong>ä»»åŠ¡ç³»ç»Ÿ</strong>ï¼šè‡ªå®šä¹‰æ„å»ºä»»åŠ¡ã€å·¥å…·é“¾é›†æˆ</li><li>ğŸ“‚ <strong>æºä»£ç ç®¡ç†</strong>ï¼šSCM Providerã€ç‰ˆæœ¬æ§åˆ¶é›†æˆ</li><li>ğŸ”§ <strong>å·¥ä½œåŒºå¢å¼º</strong>ï¼šè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿã€è¿œç¨‹å¼€å‘æ”¯æŒ</li></ul><p>ç»§ç»­æ·±å…¥å­¦ä¹ ä¹‹å‰ï¼Œå»ºè®®ï¼š</p><ol><li>å®è·µå¼€å‘ä¸€ä¸ªç®€å•è¯­è¨€çš„å®Œæ•´æ”¯æŒ</li><li>ç ”ç©¶ç°æœ‰ä¼˜ç§€è¯­è¨€æ‰©å±•çš„å®ç°</li><li>ç†è§£LSPåè®®çš„é«˜çº§ç‰¹æ€§</li><li>ä¼˜åŒ–è¯­è¨€æœåŠ¡å™¨çš„æ€§èƒ½</li></ol><hr><p><strong>ç›¸å…³èµ„æº</strong></p><ul><li><a target=_blank rel=noopener href=https://microsoft.github.io/language-server-protocol/ >Language Server Protocolè§„èŒƒ</a></li><li><a target=_blank rel=noopener href=https://macromates.com/manual/en/language_grammars>TextMateè¯­æ³•æŒ‡å—</a></li><li><a target=_blank rel=noopener href=https://code.visualstudio.com/api/language-extensions/overview>VS Codeè¯­è¨€æ‰©å±•API</a></li><li><a target=_blank rel=noopener href=https://github.com/microsoft/vscode-extension-samples/tree/main/lsp-sample>LSPç¤ºä¾‹å®ç°</a></li></ul><p>æ­å–œä½ å®Œæˆäº†VS Codeæ‰©å±•å¼€å‘çš„è¯­è¨€æ‰©å±•é˜¶æ®µï¼ç°åœ¨ä½ å·²ç»å…·å¤‡äº†å¼€å‘ä¸“ä¸šçº§ç¼–ç¨‹è¯­è¨€å·¥å…·çš„èƒ½åŠ›ã€‚</p></article><div class=post-copyright><div class=post-copyright__author><span class=post-copyright-meta><i class="fas fa-circle-user fa-fw"></i>æ–‡ç« ä½œè€…: </span><span class=post-copyright-info><a href=https://alunworker.com>AlunWorker</a></span></div><div class=post-copyright__type><span class=post-copyright-meta><i class="fas fa-square-arrow-up-right fa-fw"></i>æ–‡ç« é“¾æ¥: </span><span class=post-copyright-info><a href=https://alunworker.com/vscode/extension/05-language-extensions/ >https://alunworker.com/vscode/extension/05-language-extensions/</a></span></div><div class=post-copyright__notice><span class=post-copyright-meta><i class="fas fa-circle-exclamation fa-fw"></i>ç‰ˆæƒå£°æ˜: </span><span class=post-copyright-info>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank>CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href=https://alunworker.com target=_blank>AlunWorker</a>ï¼</span></div></div><div class=tag_share><div class=post-meta__tag-list><a class=post-meta__tags href=/tags/VSCode/ >VSCode</a><a class=post-meta__tags href=/tags/%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/ >æ’ä»¶å¼€å‘</a><a class=post-meta__tags href=/tags/%E8%AF%AD%E8%A8%80%E6%89%A9%E5%B1%95/ >è¯­è¨€æ‰©å±•</a><a class=post-meta__tags href=/tags/Language-Server/ >Language Server</a><a class=post-meta__tags href=/tags/%E8%AF%AD%E6%B3%95%E9%AB%98%E4%BA%AE/ >è¯­æ³•é«˜äº®</a><a class=post-meta__tags href=/tags/%E6%99%BA%E8%83%BD%E6%84%9F%E7%9F%A5/ >æ™ºèƒ½æ„ŸçŸ¥</a></div><div class=post_share><div class=social-share data-image=/images/icon.webp data-sites=facebook,twitter,wechat,weibo,qq></div><link rel=stylesheet href=https://lib.baomitu.com/social-share.js/1.0.16/css/share.min.css media=print onload='this.media="all"'><script src=https://lib.baomitu.com/social-share.js/1.0.16/js/social-share.min.js defer></script></div></div><nav class=pagination-post id=pagination><div class="prev-post pull-left"><a href=/vscode/extension/04-ux-design/ title="VS Code æ‰©å±•å¼€å‘é˜¶æ®µå››ï¼šç”¨æˆ·ä½“éªŒè®¾è®¡ - UXåŸåˆ™ä¸äº¤äº’æ¨¡å¼"><div class=cover style=background:var(--default-bg-color)></div><div class=pagination-info><div class=label>ä¸Šä¸€ç¯‡</div><div class=prev_info>VS Code æ‰©å±•å¼€å‘é˜¶æ®µå››ï¼šç”¨æˆ·ä½“éªŒè®¾è®¡ - UXåŸåˆ™ä¸äº¤äº’æ¨¡å¼</div></div></a></div><div class="next-post pull-right"><a href=/vscode/extension/06-advanced-topics/ title="VS Code æ‰©å±•å¼€å‘é˜¶æ®µå…­ï¼šé«˜çº§ä¸»é¢˜ - è°ƒè¯•å™¨ã€ä»»åŠ¡ç³»ç»Ÿä¸SCMé›†æˆ"><div class=cover style=background:var(--default-bg-color)></div><div class=pagination-info><div class=label>ä¸‹ä¸€ç¯‡</div><div class=next_info>VS Code æ‰©å±•å¼€å‘é˜¶æ®µå…­ï¼šé«˜çº§ä¸»é¢˜ - è°ƒè¯•å™¨ã€ä»»åŠ¡ç³»ç»Ÿä¸SCMé›†æˆ</div></div></a></div></nav><div class=relatedPosts><div class=headline><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class=relatedPosts-list><div><a href=/vscode/extension/01-foundation/ title="VS Code æ‰©å±•å¼€å‘é˜¶æ®µä¸€ï¼šåŸºç¡€å…¥é—¨ - ç¯å¢ƒæ­å»ºä¸æ ¸å¿ƒæ¦‚å¿µ"><div class=cover style=background:var(--default-bg-color)></div><div class="content is-center"><div class=date><i class="far fa-calendar-alt fa-fw"></i> 2025-09-20</div><div class=title>VS Code æ‰©å±•å¼€å‘é˜¶æ®µä¸€ï¼šåŸºç¡€å…¥é—¨ - ç¯å¢ƒæ­å»ºä¸æ ¸å¿ƒæ¦‚å¿µ</div></div></a></div><div><a href=/vscode/extension/02-core-capabilities/ title="VS Code æ‰©å±•å¼€å‘é˜¶æ®µäºŒï¼šæ ¸å¿ƒèƒ½åŠ›å¼€å‘ - ä¸»é¢˜ã€å·¥ä½œå°ä¸ç¼–è¾‘å™¨åŠŸèƒ½"><div class=cover style=background:var(--default-bg-color)></div><div class="content is-center"><div class=date><i class="far fa-calendar-alt fa-fw"></i> 2025-09-20</div><div class=title>VS Code æ‰©å±•å¼€å‘é˜¶æ®µäºŒï¼šæ ¸å¿ƒèƒ½åŠ›å¼€å‘ - ä¸»é¢˜ã€å·¥ä½œå°ä¸ç¼–è¾‘å™¨åŠŸèƒ½</div></div></a></div><div><a href=/vscode/extension/03-advanced-guides/ title="VS Code æ‰©å±•å¼€å‘é˜¶æ®µä¸‰ï¼šæ‰©å±•æŒ‡å—ä¸“é¢˜ - AIé›†æˆã€WebViewä¸è‡ªå®šä¹‰ç¼–è¾‘å™¨"><div class=cover style=background:var(--default-bg-color)></div><div class="content is-center"><div class=date><i class="far fa-calendar-alt fa-fw"></i> 2025-09-20</div><div class=title>VS Code æ‰©å±•å¼€å‘é˜¶æ®µä¸‰ï¼šæ‰©å±•æŒ‡å—ä¸“é¢˜ - AIé›†æˆã€WebViewä¸è‡ªå®šä¹‰ç¼–è¾‘å™¨</div></div></a></div><div><a href=/vscode/extension/04-ux-design/ title="VS Code æ‰©å±•å¼€å‘é˜¶æ®µå››ï¼šç”¨æˆ·ä½“éªŒè®¾è®¡ - UXåŸåˆ™ä¸äº¤äº’æ¨¡å¼"><div class=cover style=background:var(--default-bg-color)></div><div class="content is-center"><div class=date><i class="far fa-calendar-alt fa-fw"></i> 2025-09-20</div><div class=title>VS Code æ‰©å±•å¼€å‘é˜¶æ®µå››ï¼šç”¨æˆ·ä½“éªŒè®¾è®¡ - UXåŸåˆ™ä¸äº¤äº’æ¨¡å¼</div></div></a></div><div><a href=/vscode/extension/06-advanced-topics/ title="VS Code æ‰©å±•å¼€å‘é˜¶æ®µå…­ï¼šé«˜çº§ä¸»é¢˜ - è°ƒè¯•å™¨ã€ä»»åŠ¡ç³»ç»Ÿä¸SCMé›†æˆ"><div class=cover style=background:var(--default-bg-color)></div><div class="content is-center"><div class=date><i class="far fa-calendar-alt fa-fw"></i> 2025-09-20</div><div class=title>VS Code æ‰©å±•å¼€å‘é˜¶æ®µå…­ï¼šé«˜çº§ä¸»é¢˜ - è°ƒè¯•å™¨ã€ä»»åŠ¡ç³»ç»Ÿä¸SCMé›†æˆ</div></div></a></div><div><a href=/vscode/extension/07-testing-publishing/ title="VS Code æ‰©å±•å¼€å‘é˜¶æ®µä¸ƒï¼šæµ‹è¯•ä¸å‘å¸ƒ - è´¨é‡ä¿è¯ä¸å¸‚åœºå‘å¸ƒ"><div class=cover style=background:var(--default-bg-color)></div><div class="content is-center"><div class=date><i class="far fa-calendar-alt fa-fw"></i> 2025-09-20</div><div class=title>VS Code æ‰©å±•å¼€å‘é˜¶æ®µä¸ƒï¼šæµ‹è¯•ä¸å‘å¸ƒ - è´¨é‡ä¿è¯ä¸å¸‚åœºå‘å¸ƒ</div></div></a></div></div></div></div><div class=aside-content id=aside-content><div class="card-widget card-info"><div class=is-center><div class=avatar-img><img src=/images/loading.gif data-original=/images/icon.webp onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt=avatar></div><div class=author-info__name>AlunWorker</div><div class=author-info__description>è¶ŠåŠªåŠ›è¶Šå¹¸è¿!</div></div><div class="card-info-data site-data is-center"><a href=/archives/ ><div class=headline>æ–‡ç« </div><div class=length-num>82</div></a><a href=/tags/ ><div class=headline>æ ‡ç­¾</div><div class=length-num>174</div></a><a href=/categories/ ><div class=headline>åˆ†ç±»</div><div class=length-num>14</div></a></div><a id=card-info-btn target=_blank rel=noopener href=https://github.com/xxxxxx><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class=sticky_layout><div class=card-widget id=card-toc><div class=item-headline><i class="fas fa-stream"></i><span>ç›®å½•</span><span class=toc-percentage></span></div><div class=toc-content><ol class=toc><li class="toc-item toc-level-2"><a class=toc-link href=#%F0%9F%8E%AF-%E5%AD%A6%E4%B9%A0%E7%9B%AE%E6%A0%87><span class=toc-number>1.</span> <span class=toc-text>ğŸ¯ å­¦ä¹ ç›®æ ‡</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%F0%9F%93%9D-%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86%EF%BC%9A%E8%AF%AD%E6%B3%95%E9%AB%98%E4%BA%AE%E4%B8%8E%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE><span class=toc-number>2.</span> <span class=toc-text>ğŸ“ ç¬¬ä¸€éƒ¨åˆ†ï¼šè¯­æ³•é«˜äº®ä¸åŸºç¡€é…ç½®</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#1-1-TextMate%E8%AF%AD%E6%B3%95%E5%BC%80%E5%8F%91><span class=toc-number>2.1.</span> <span class=toc-text>1.1 TextMateè¯­æ³•å¼€å‘</span></a><ol class=toc-child><li class="toc-item toc-level-4"><a class=toc-link href=#%E8%AF%AD%E6%B3%95%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84><span class=toc-number>2.1.1.</span> <span class=toc-text>è¯­æ³•æ–‡ä»¶ç»“æ„</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#%E8%AF%AD%E8%A8%80%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6><span class=toc-number>2.1.2.</span> <span class=toc-text>è¯­è¨€é…ç½®æ–‡ä»¶</span></a></li></ol></li><li class="toc-item toc-level-3"><a class=toc-link href=#1-2-%E8%AF%AD%E4%B9%89%E9%AB%98%E4%BA%AE%E5%AE%9E%E7%8E%B0><span class=toc-number>2.2.</span> <span class=toc-text>1.2 è¯­ä¹‰é«˜äº®å®ç°</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#1-3-%E4%BB%A3%E7%A0%81%E7%89%87%E6%AE%B5%E7%B3%BB%E7%BB%9F><span class=toc-number>2.3.</span> <span class=toc-text>1.3 ä»£ç ç‰‡æ®µç³»ç»Ÿ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%F0%9F%94%8D-%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%EF%BC%9A%E6%99%BA%E8%83%BD%E6%84%9F%E7%9F%A5%E5%8A%9F%E8%83%BD><span class=toc-number>3.</span> <span class=toc-text>ğŸ” ç¬¬äºŒéƒ¨åˆ†ï¼šæ™ºèƒ½æ„ŸçŸ¥åŠŸèƒ½</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#2-1-%E4%BB%A3%E7%A0%81%E8%A1%A5%E5%85%A8%E6%8F%90%E4%BE%9B%E8%80%85><span class=toc-number>3.1.</span> <span class=toc-text>2.1 ä»£ç è¡¥å…¨æä¾›è€…</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#2-2-%E6%82%AC%E5%81%9C%E4%BF%A1%E6%81%AF%E6%8F%90%E4%BE%9B%E8%80%85><span class=toc-number>3.2.</span> <span class=toc-text>2.2 æ‚¬åœä¿¡æ¯æä¾›è€…</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#2-3-%E8%AF%8A%E6%96%AD%E6%8F%90%E4%BE%9B%E8%80%85><span class=toc-number>3.3.</span> <span class=toc-text>2.3 è¯Šæ–­æä¾›è€…</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%F0%9F%8C%90-%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86%EF%BC%9ALanguage-Server-Protocol-LSP><span class=toc-number>4.</span> <span class=toc-text>ğŸŒ ç¬¬ä¸‰éƒ¨åˆ†ï¼šLanguage Server Protocol (LSP)</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#3-1-LSP%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%BC%80%E5%8F%91><span class=toc-number>4.1.</span> <span class=toc-text>3.1 LSPå®¢æˆ·ç«¯å¼€å‘</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#3-2-LSP%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%BC%80%E5%8F%91><span class=toc-number>4.2.</span> <span class=toc-text>3.2 LSPæœåŠ¡å™¨å¼€å‘</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%F0%9F%93%9A-%E6%9C%AC%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93><span class=toc-number>5.</span> <span class=toc-text>ğŸ“š æœ¬é˜¶æ®µæ€»ç»“</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E5%9B%9E%E9%A1%BE><span class=toc-number>5.1.</span> <span class=toc-text>æ ¸å¿ƒæŠ€æœ¯å›é¡¾</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%F0%9F%9A%80-%E4%B8%8B%E4%B8%80%E6%AD%A5%E5%AD%A6%E4%B9%A0%E6%96%B9%E5%90%91><span class=toc-number>6.</span> <span class=toc-text>ğŸš€ ä¸‹ä¸€æ­¥å­¦ä¹ æ–¹å‘</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class=item-headline><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class=aside-list><div class="aside-list-item no-cover"><div class=content><a class=title href=/vscode/extension/01-foundation/ title="VS Code æ‰©å±•å¼€å‘é˜¶æ®µä¸€ï¼šåŸºç¡€å…¥é—¨ - ç¯å¢ƒæ­å»ºä¸æ ¸å¿ƒæ¦‚å¿µ">VS Code æ‰©å±•å¼€å‘é˜¶æ®µä¸€ï¼šåŸºç¡€å…¥é—¨ - ç¯å¢ƒæ­å»ºä¸æ ¸å¿ƒæ¦‚å¿µ</a><time datetime=2025-09-19T16:00:00.000Z title="å‘è¡¨äº 2025-09-20 00:00:00">2025-09-20</time></div></div><div class="aside-list-item no-cover"><div class=content><a class=title href=/vscode/extension/02-core-capabilities/ title="VS Code æ‰©å±•å¼€å‘é˜¶æ®µäºŒï¼šæ ¸å¿ƒèƒ½åŠ›å¼€å‘ - ä¸»é¢˜ã€å·¥ä½œå°ä¸ç¼–è¾‘å™¨åŠŸèƒ½">VS Code æ‰©å±•å¼€å‘é˜¶æ®µäºŒï¼šæ ¸å¿ƒèƒ½åŠ›å¼€å‘ - ä¸»é¢˜ã€å·¥ä½œå°ä¸ç¼–è¾‘å™¨åŠŸèƒ½</a><time datetime=2025-09-19T16:00:00.000Z title="å‘è¡¨äº 2025-09-20 00:00:00">2025-09-20</time></div></div><div class="aside-list-item no-cover"><div class=content><a class=title href=/vscode/extension/03-advanced-guides/ title="VS Code æ‰©å±•å¼€å‘é˜¶æ®µä¸‰ï¼šæ‰©å±•æŒ‡å—ä¸“é¢˜ - AIé›†æˆã€WebViewä¸è‡ªå®šä¹‰ç¼–è¾‘å™¨">VS Code æ‰©å±•å¼€å‘é˜¶æ®µä¸‰ï¼šæ‰©å±•æŒ‡å—ä¸“é¢˜ - AIé›†æˆã€WebViewä¸è‡ªå®šä¹‰ç¼–è¾‘å™¨</a><time datetime=2025-09-19T16:00:00.000Z title="å‘è¡¨äº 2025-09-20 00:00:00">2025-09-20</time></div></div><div class="aside-list-item no-cover"><div class=content><a class=title href=/vscode/extension/04-ux-design/ title="VS Code æ‰©å±•å¼€å‘é˜¶æ®µå››ï¼šç”¨æˆ·ä½“éªŒè®¾è®¡ - UXåŸåˆ™ä¸äº¤äº’æ¨¡å¼">VS Code æ‰©å±•å¼€å‘é˜¶æ®µå››ï¼šç”¨æˆ·ä½“éªŒè®¾è®¡ - UXåŸåˆ™ä¸äº¤äº’æ¨¡å¼</a><time datetime=2025-09-19T16:00:00.000Z title="å‘è¡¨äº 2025-09-20 00:00:00">2025-09-20</time></div></div><div class="aside-list-item no-cover"><div class=content><a class=title href=/vscode/extension/05-language-extensions/ title="VS Code æ‰©å±•å¼€å‘é˜¶æ®µäº”ï¼šè¯­è¨€æ‰©å±•å¼€å‘ - è¯­æ³•é«˜äº®ã€æ™ºèƒ½æ„ŸçŸ¥ä¸LSP">VS Code æ‰©å±•å¼€å‘é˜¶æ®µäº”ï¼šè¯­è¨€æ‰©å±•å¼€å‘ - è¯­æ³•é«˜äº®ã€æ™ºèƒ½æ„ŸçŸ¥ä¸LSP</a><time datetime=2025-09-19T16:00:00.000Z title="å‘è¡¨äº 2025-09-20 00:00:00">2025-09-20</time></div></div></div></div></div></div></main><footer id=footer style=background:#000><div id=footer-wrap><div class=copyright>&copy;2020 - 2025 By AlunWorker</div><div class=framework-info><span>æ¡†æ¶ </span><a target=_blank rel=noopener href=https://hexo.io>Hexo</a><span class=footer-separator>|</span><span>ä¸»é¢˜ </span><a target=_blank rel=noopener href=https://github.com/jerryc127/hexo-theme-butterfly>Butterfly</a></div></div></footer></div><div id=rightside><div id=rightside-config-hide><button id=readmode type=button title=é˜…è¯»æ¨¡å¼><i class="fas fa-book-open"></i></button><button id=darkmode type=button title=æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢><i class="fas fa-adjust"></i></button><button id=hide-aside-btn type=button title=å•æ å’ŒåŒæ åˆ‡æ¢><i class="fas fa-arrows-alt-h"></i></button></div><div id=rightside-config-show><button id=rightside-config type=button title=è®¾ç½®><i class="fas fa-cog fa-spin"></i></button><button class=close id=mobile-toc-button type=button title=ç›®å½•><i class="fas fa-list-ul"></i></button><button id=go-up type=button title=å›åˆ°é¡¶éƒ¨><span class=scroll-percent></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src=/ ></script><div class=js-pjax></div><script async data-pjax src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><div id=local-search><div class=search-dialog><nav class=search-nav><span class=search-dialog-title>æœç´¢</span><span id=loading-status></span><button class=search-close-button><i class="fas fa-times"></i></button></nav><div class=is-center id=loading-database><i class="fas fa-spinner fa-pulse"></i><span> æ•°æ®åº“åŠ è½½ä¸­</span></div><div class=search-wrap><div id=local-search-input><div class=local-search-box><input class=local-search-box--input placeholder=æœç´¢æ–‡ç«  type=text></div></div><hr><div id=local-search-results></div><div id=local-search-stats-wrap></div></div></div><div id=search-mask></div><script src="/js/search/local-search.js?v=4.13.0"></script></div></div><style>[bg-lazy]{background-image:none!important;background-color:#eee!important}</style><script>window.imageLazyLoadSetting={isSPA:!1,preloadRatio:1,processImages:null}</script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})})</script><script>!function(r){r.imageLazyLoadSetting.processImages=t;var e=r.imageLazyLoadSetting.isSPA,n=r.imageLazyLoadSetting.preloadRatio||1,c=a();function a(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(){e&&(c=a());for(var t,o=0;o<c.length;o++)0<=(t=(t=c[o]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(r.innerHeight*n||document.documentElement.clientHeight*n)&&function(){var t,e,n,a,i=c[o];e=function(){c=c.filter(function(t){return i!==t}),r.imageLazyLoadSetting.onImageLoaded&&r.imageLazyLoadSetting.onImageLoaded(i)},(t=i).hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),e()):(n=new Image,a=t.getAttribute("data-original"),n.onload=function(){t.src=a,t.removeAttribute("data-original"),e()},t.src!==a&&(n.src=a))}()}function i(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",i),r.addEventListener("resize",i),r.addEventListener("orientationchange",i)}(this)</script></body></html>