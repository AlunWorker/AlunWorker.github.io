<!doctype html><html lang=zh-CN data-theme=dark><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><title>VS Code 扩展开发阶段五：语言扩展开发 - 语法高亮、智能感知与LSP | AlunWorker</title><meta name=author content=AlunWorker><meta name=copyright content=AlunWorker><meta name=format-detection content="telephone=no"><meta name=theme-color content=#0d0d0d><meta name=description content="VS Code扩展开发第五阶段：深入语言扩展开发技术，包括语法高亮、代码补全、Language Server Protocol实现和智能编程功能"><meta property=og:type content=article><meta property=og:title content="VS Code 扩展开发阶段五：语言扩展开发 - 语法高亮、智能感知与LSP"><meta property=og:url content=https://alunworker.com/vscode/extension/05-language-extensions/index.html><meta property=og:site_name content=AlunWorker><meta property=og:description content="VS Code扩展开发第五阶段：深入语言扩展开发技术，包括语法高亮、代码补全、Language Server Protocol实现和智能编程功能"><meta property=og:locale content=zh_CN><meta property=og:image content=https://alunworker.com/images/icon.webp><meta property=article:published_time content=2025-09-19T16:00:00.000Z><meta property=article:modified_time content=2025-09-20T11:01:46.983Z><meta property=article:author content=AlunWorker><meta property=article:tag content=VSCode><meta property=article:tag content=插件开发><meta property=article:tag content=语言扩展><meta property=article:tag content="Language Server"><meta property=article:tag content=语法高亮><meta property=article:tag content=智能感知><meta name=twitter:card content=summary><meta name=twitter:image content=https://alunworker.com/images/icon.webp><link rel="shortcut icon" href=/images/favicon.webp><link rel=canonical href=https://alunworker.com/vscode/extension/05-language-extensions/index.html><link rel=preconnect><link rel=preconnect href=//busuanzi.ibruce.info><link rel=stylesheet href="/css/index.css?v=4.13.0"><link rel=stylesheet href=https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/6.0.0/css/all.min.css><link rel=stylesheet href=/ media=print onload='this.media="all"'><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: '/',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id=config-diff>var GLOBAL_CONFIG_SITE={title:"VS Code 扩展开发阶段五：语言扩展开发 - 语法高亮、智能感知与LSP",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2025-09-20 19:01:46"}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name=generator content="Hexo 7.1.1"></head><body><div id=loading-box><div class=loading-left-bg></div><div class=loading-right-bg></div><div class=spinner-box><div class=configure-border-1><div class=configure-core></div></div><div class=configure-border-2><div class=configure-core></div></div><div class=loading-word>加载中...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load',() => { preloader.endLoading() })

  if (false) {
    document.addEventListener('pjax:send', () => { preloader.initLoading() })
    document.addEventListener('pjax:complete', () => { preloader.endLoading() })
  }
})()</script><div id=sidebar><div id=menu-mask></div><div id=sidebar-menus><div class="avatar-img is-center"><img src=/images/loading.gif data-original=/images/icon.webp onerror='onerror=null,src="/img/friend_404.gif"' alt=avatar></div><div class="sidebar-site-data site-data is-center"><a href=/archives/ ><div class=headline>文章</div><div class=length-num>82</div></a><a href=/tags/ ><div class=headline>标签</div><div class=length-num>174</div></a><a href=/categories/ ><div class=headline>分类</div><div class=length-num>14</div></a></div><hr class=custom-hr><div class=menus_items><div class=menus_item><a class=site-page href=/ ><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class=menus_item><a class=site-page href=/archives/ ><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class=menus_item><a class=site-page href=/tags/ ><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class=menus_item><a class=site-page href=/categories/ ><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class=menus_item><a class=site-page href=/about/ ><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class=post id=body-wrap><header class=post-bg id=page-header style=background-image:url(/images/blog_bg.webp)><nav id=nav><span id=blog-info><a href=/ title=AlunWorker><span class=site-name>AlunWorker</span></a></span><div id=menus><div id=search-button><a class="site-page social-icon search" href=javascript:void(0);><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class=menus_items><div class=menus_item><a class=site-page href=/ ><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class=menus_item><a class=site-page href=/archives/ ><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class=menus_item><a class=site-page href=/tags/ ><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class=menus_item><a class=site-page href=/categories/ ><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class=menus_item><a class=site-page href=/about/ ><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id=toggle-menu><a class=site-page href=javascript:void(0);><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id=post-info><h1 class=post-title>VS Code 扩展开发阶段五：语言扩展开发 - 语法高亮、智能感知与LSP</h1><div id=post-meta><div class=meta-firstline><span class=post-meta-date><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class=post-meta-label>发表于</span><time class=post-meta-date-created datetime=2025-09-19T16:00:00.000Z title="发表于 2025-09-20 00:00:00">2025-09-20</time><span class=post-meta-separator>|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class=post-meta-label>更新于</span><time class=post-meta-date-updated datetime=2025-09-20T11:01:46.983Z title="更新于 2025-09-20 19:01:46">2025-09-20</time></span><span class=post-meta-categories><span class=post-meta-separator>|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class=post-meta-categories href=/categories/VSCode/ >VSCode</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class=post-meta-categories href=/categories/VSCode/%E6%89%A9%E5%B1%95%E5%BC%80%E5%8F%91/ >扩展开发</a></span></div><div class=meta-secondline><span class=post-meta-separator>|</span><span class=post-meta-wordcount><i class="far fa-file-word fa-fw post-meta-icon"></i><span class=post-meta-label>字数总计:</span><span class=word-count>9.6k</span><span class=post-meta-separator>|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class=post-meta-label>阅读时长:</span><span>52分钟</span></span><span class=post-meta-separator>|</span><span class=post-meta-pv-cv id="" data-flag-title="VS Code 扩展开发阶段五：语言扩展开发 - 语法高亮、智能感知与LSP"><i class="far fa-eye fa-fw post-meta-icon"></i><span class=post-meta-label>阅读量:</span><span id=busuanzi_value_page_pv><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class=layout id=content-inner><div id=post><article class=post-content id=article-container><blockquote><p>语言扩展是VS Code生态系统的核心，为不同编程语言提供智能编辑支持。本阶段将深入探讨如何开发完整的语言支持扩展，从基础的语法高亮到高级的Language Server Protocol实现，帮你构建专业级的编程语言工具。</p></blockquote><hr><h2 id=🎯-学习目标><a href=#🎯-学习目标 class=headerlink title="🎯 学习目标"></a>🎯 学习目标</h2><p>完成本阶段学习后，你将能够：</p><ul><li>📝 <strong>语法高亮开发</strong>：TextMate语法、语义高亮、嵌入语言支持</li><li>🧩 <strong>代码片段系统</strong>：动态片段、条件片段、智能触发</li><li>⚙️ <strong>语言基础配置</strong>：文件关联、注释样式、括号匹配</li><li>🔍 <strong>智能感知功能</strong>：代码补全、参数提示、悬停信息、错误诊断</li><li>🌐 <strong>Language Server Protocol</strong>：架构设计、客户端&#x2F;服务器开发</li><li>🛠️ <strong>代码操作</strong>：格式化、重构、快速修复、代码导航</li></ul><p><strong>预计学习时间：2-3周（每天1-2小时）</strong></p><hr><h2 id=📝-第一部分：语法高亮与基础配置><a href=#📝-第一部分：语法高亮与基础配置 class=headerlink title="📝 第一部分：语法高亮与基础配置"></a>📝 第一部分：语法高亮与基础配置</h2><h3 id=1-1-TextMate语法开发><a href=#1-1-TextMate语法开发 class=headerlink title="1.1 TextMate语法开发"></a>1.1 TextMate语法开发</h3><h4 id=语法文件结构><a href=#语法文件结构 class=headerlink title=语法文件结构></a>语法文件结构</h4><figure class="highlight json"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br><span class=line>90</span><br><span class=line>91</span><br><span class=line>92</span><br><span class=line>93</span><br><span class=line>94</span><br><span class=line>95</span><br><span class=line>96</span><br><span class=line>97</span><br><span class=line>98</span><br><span class=line>99</span><br><span class=line>100</span><br><span class=line>101</span><br><span class=line>102</span><br><span class=line>103</span><br><span class=line>104</span><br><span class=line>105</span><br><span class=line>106</span><br><span class=line>107</span><br><span class=line>108</span><br><span class=line>109</span><br><span class=line>110</span><br><span class=line>111</span><br><span class=line>112</span><br><span class=line>113</span><br><span class=line>114</span><br><span class=line>115</span><br><span class=line>116</span><br><span class=line>117</span><br><span class=line>118</span><br><span class=line>119</span><br><span class=line>120</span><br><span class=line>121</span><br><span class=line>122</span><br><span class=line>123</span><br><span class=line>124</span><br><span class=line>125</span><br><span class=line>126</span><br><span class=line>127</span><br><span class=line>128</span><br><span class=line>129</span><br><span class=line>130</span><br><span class=line>131</span><br><span class=line>132</span><br><span class=line>133</span><br><span class=line>134</span><br><span class=line>135</span><br><span class=line>136</span><br><span class=line>137</span><br><span class=line>138</span><br><span class=line>139</span><br><span class=line>140</span><br><span class=line>141</span><br><span class=line>142</span><br><span class=line>143</span><br><span class=line>144</span><br><span class=line>145</span><br><span class=line>146</span><br><span class=line>147</span><br><span class=line>148</span><br><span class=line>149</span><br><span class=line>150</span><br><span class=line>151</span><br><span class=line>152</span><br><span class=line>153</span><br><span class=line>154</span><br><span class=line>155</span><br><span class=line>156</span><br><span class=line>157</span><br><span class=line>158</span><br><span class=line>159</span><br><span class=line>160</span><br><span class=line>161</span><br><span class=line>162</span><br><span class=line>163</span><br><span class=line>164</span><br><span class=line>165</span><br><span class=line>166</span><br><span class=line>167</span><br><span class=line>168</span><br><span class=line>169</span><br><span class=line>170</span><br><span class=line>171</span><br><span class=line>172</span><br><span class=line>173</span><br><span class=line>174</span><br><span class=line>175</span><br><span class=line>176</span><br><span class=line>177</span><br><span class=line>178</span><br><span class=line>179</span><br><span class=line>180</span><br><span class=line>181</span><br><span class=line>182</span><br><span class=line>183</span><br><span class=line>184</span><br><span class=line>185</span><br><span class=line>186</span><br><span class=line>187</span><br><span class=line>188</span><br><span class=line>189</span><br><span class=line>190</span><br><span class=line>191</span><br><span class=line>192</span><br><span class=line>193</span><br><span class=line>194</span><br><span class=line>195</span><br><span class=line>196</span><br><span class=line>197</span><br><span class=line>198</span><br><span class=line>199</span><br><span class=line>200</span><br><span class=line>201</span><br><span class=line>202</span><br><span class=line>203</span><br><span class=line>204</span><br><span class=line>205</span><br><span class=line>206</span><br><span class=line>207</span><br><span class=line>208</span><br><span class=line>209</span><br><span class=line>210</span><br><span class=line>211</span><br><span class=line>212</span><br><span class=line>213</span><br></pre></td><td class=code><pre><span class=line><span class=comment>// syntaxes/mylang.tmLanguage.json</span></span><br><span class=line><span class=punctuation>&#123;</span></span><br><span class=line>    <span class=attr>&quot;$schema&quot;</span><span class=punctuation>:</span> <span class=string>&quot;https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json&quot;</span><span class=punctuation>,</span></span><br><span class=line>    <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;MyLang&quot;</span><span class=punctuation>,</span></span><br><span class=line>    <span class=attr>&quot;scopeName&quot;</span><span class=punctuation>:</span> <span class=string>&quot;source.mylang&quot;</span><span class=punctuation>,</span></span><br><span class=line>    <span class=attr>&quot;fileTypes&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span><span class=string>&quot;ml&quot;</span><span class=punctuation>,</span> <span class=string>&quot;mylang&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>    <span class=attr>&quot;patterns&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>        <span class=punctuation>&#123;</span></span><br><span class=line>            <span class=attr>&quot;include&quot;</span><span class=punctuation>:</span> <span class=string>&quot;#comments&quot;</span></span><br><span class=line>        <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=punctuation>&#123;</span></span><br><span class=line>            <span class=attr>&quot;include&quot;</span><span class=punctuation>:</span> <span class=string>&quot;#keywords&quot;</span></span><br><span class=line>        <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=punctuation>&#123;</span></span><br><span class=line>            <span class=attr>&quot;include&quot;</span><span class=punctuation>:</span> <span class=string>&quot;#strings&quot;</span></span><br><span class=line>        <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=punctuation>&#123;</span></span><br><span class=line>            <span class=attr>&quot;include&quot;</span><span class=punctuation>:</span> <span class=string>&quot;#numbers&quot;</span></span><br><span class=line>        <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=punctuation>&#123;</span></span><br><span class=line>            <span class=attr>&quot;include&quot;</span><span class=punctuation>:</span> <span class=string>&quot;#functions&quot;</span></span><br><span class=line>        <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=punctuation>&#123;</span></span><br><span class=line>            <span class=attr>&quot;include&quot;</span><span class=punctuation>:</span> <span class=string>&quot;#operators&quot;</span></span><br><span class=line>        <span class=punctuation>&#125;</span></span><br><span class=line>    <span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>    <span class=attr>&quot;repository&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>        <span class=attr>&quot;comments&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>            <span class=attr>&quot;patterns&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>                <span class=punctuation>&#123;</span></span><br><span class=line>                    <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;comment.line.double-slash.mylang&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;begin&quot;</span><span class=punctuation>:</span> <span class=string>&quot;//&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;end&quot;</span><span class=punctuation>:</span> <span class=string>&quot;$&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;captures&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>                        <span class=attr>&quot;0&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>                            <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;punctuation.definition.comment.mylang&quot;</span></span><br><span class=line>                        <span class=punctuation>&#125;</span></span><br><span class=line>                    <span class=punctuation>&#125;</span></span><br><span class=line>                <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>                <span class=punctuation>&#123;</span></span><br><span class=line>                    <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;comment.block.mylang&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;begin&quot;</span><span class=punctuation>:</span> <span class=string>&quot;/\\*&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;end&quot;</span><span class=punctuation>:</span> <span class=string>&quot;\\*/&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;captures&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>                        <span class=attr>&quot;0&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>                            <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;punctuation.definition.comment.mylang&quot;</span></span><br><span class=line>                        <span class=punctuation>&#125;</span></span><br><span class=line>                    <span class=punctuation>&#125;</span></span><br><span class=line>                <span class=punctuation>&#125;</span></span><br><span class=line>            <span class=punctuation>]</span></span><br><span class=line>        <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;keywords&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>            <span class=attr>&quot;patterns&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>                <span class=punctuation>&#123;</span></span><br><span class=line>                    <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;keyword.control.mylang&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;match&quot;</span><span class=punctuation>:</span> <span class=string>&quot;\\b(if|else|while|for|return|break|continue)\\b&quot;</span></span><br><span class=line>                <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>                <span class=punctuation>&#123;</span></span><br><span class=line>                    <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;keyword.other.mylang&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;match&quot;</span><span class=punctuation>:</span> <span class=string>&quot;\\b(var|let|const|function|class|interface)\\b&quot;</span></span><br><span class=line>                <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>                <span class=punctuation>&#123;</span></span><br><span class=line>                    <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;storage.type.mylang&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;match&quot;</span><span class=punctuation>:</span> <span class=string>&quot;\\b(int|string|bool|float|void)\\b&quot;</span></span><br><span class=line>                <span class=punctuation>&#125;</span></span><br><span class=line>            <span class=punctuation>]</span></span><br><span class=line>        <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;strings&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>            <span class=attr>&quot;patterns&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>                <span class=punctuation>&#123;</span></span><br><span class=line>                    <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;string.quoted.double.mylang&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;begin&quot;</span><span class=punctuation>:</span> <span class=string>&quot;\&quot;&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;end&quot;</span><span class=punctuation>:</span> <span class=string>&quot;\&quot;&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;patterns&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>                        <span class=punctuation>&#123;</span></span><br><span class=line>                            <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;constant.character.escape.mylang&quot;</span><span class=punctuation>,</span></span><br><span class=line>                            <span class=attr>&quot;match&quot;</span><span class=punctuation>:</span> <span class=string>&quot;\\\\.&quot;</span></span><br><span class=line>                        <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>                        <span class=punctuation>&#123;</span></span><br><span class=line>                            <span class=attr>&quot;include&quot;</span><span class=punctuation>:</span> <span class=string>&quot;#string-interpolation&quot;</span></span><br><span class=line>                        <span class=punctuation>&#125;</span></span><br><span class=line>                    <span class=punctuation>]</span></span><br><span class=line>                <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>                <span class=punctuation>&#123;</span></span><br><span class=line>                    <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;string.quoted.single.mylang&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;begin&quot;</span><span class=punctuation>:</span> <span class=string>&quot;&#x27;&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;end&quot;</span><span class=punctuation>:</span> <span class=string>&quot;&#x27;&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;patterns&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>                        <span class=punctuation>&#123;</span></span><br><span class=line>                            <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;constant.character.escape.mylang&quot;</span><span class=punctuation>,</span></span><br><span class=line>                            <span class=attr>&quot;match&quot;</span><span class=punctuation>:</span> <span class=string>&quot;\\\\.&quot;</span></span><br><span class=line>                        <span class=punctuation>&#125;</span></span><br><span class=line>                    <span class=punctuation>]</span></span><br><span class=line>                <span class=punctuation>&#125;</span></span><br><span class=line>            <span class=punctuation>]</span></span><br><span class=line>        <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;string-interpolation&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>            <span class=attr>&quot;patterns&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>                <span class=punctuation>&#123;</span></span><br><span class=line>                    <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;meta.interpolation.mylang&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;begin&quot;</span><span class=punctuation>:</span> <span class=string>&quot;\\$\\&#123;&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;end&quot;</span><span class=punctuation>:</span> <span class=string>&quot;\\&#125;&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;patterns&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>                        <span class=punctuation>&#123;</span></span><br><span class=line>                            <span class=attr>&quot;include&quot;</span><span class=punctuation>:</span> <span class=string>&quot;$self&quot;</span></span><br><span class=line>                        <span class=punctuation>&#125;</span></span><br><span class=line>                    <span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;beginCaptures&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>                        <span class=attr>&quot;0&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>                            <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;punctuation.definition.interpolation.begin.mylang&quot;</span></span><br><span class=line>                        <span class=punctuation>&#125;</span></span><br><span class=line>                    <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;endCaptures&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>                        <span class=attr>&quot;0&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>                            <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;punctuation.definition.interpolation.end.mylang&quot;</span></span><br><span class=line>                        <span class=punctuation>&#125;</span></span><br><span class=line>                    <span class=punctuation>&#125;</span></span><br><span class=line>                <span class=punctuation>&#125;</span></span><br><span class=line>            <span class=punctuation>]</span></span><br><span class=line>        <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;numbers&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>            <span class=attr>&quot;patterns&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>                <span class=punctuation>&#123;</span></span><br><span class=line>                    <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;constant.numeric.float.mylang&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;match&quot;</span><span class=punctuation>:</span> <span class=string>&quot;\\b\\d+\\.\\d+([eE][+-]?\\d+)?\\b&quot;</span></span><br><span class=line>                <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>                <span class=punctuation>&#123;</span></span><br><span class=line>                    <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;constant.numeric.integer.mylang&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;match&quot;</span><span class=punctuation>:</span> <span class=string>&quot;\\b\\d+\\b&quot;</span></span><br><span class=line>                <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>                <span class=punctuation>&#123;</span></span><br><span class=line>                    <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;constant.numeric.hex.mylang&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;match&quot;</span><span class=punctuation>:</span> <span class=string>&quot;\\b0[xX][0-9a-fA-F]+\\b&quot;</span></span><br><span class=line>                <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>                <span class=punctuation>&#123;</span></span><br><span class=line>                    <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;constant.numeric.binary.mylang&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;match&quot;</span><span class=punctuation>:</span> <span class=string>&quot;\\b0[bB][01]+\\b&quot;</span></span><br><span class=line>                <span class=punctuation>&#125;</span></span><br><span class=line>            <span class=punctuation>]</span></span><br><span class=line>        <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;functions&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>            <span class=attr>&quot;patterns&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>                <span class=punctuation>&#123;</span></span><br><span class=line>                    <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;meta.function.declaration.mylang&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;begin&quot;</span><span class=punctuation>:</span> <span class=string>&quot;\\b(function)\\s+(\\w+)\\s*\\(&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;end&quot;</span><span class=punctuation>:</span> <span class=string>&quot;\\)&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;beginCaptures&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>                        <span class=attr>&quot;1&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>                            <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;keyword.other.mylang&quot;</span></span><br><span class=line>                        <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>                        <span class=attr>&quot;2&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>                            <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;entity.name.function.mylang&quot;</span></span><br><span class=line>                        <span class=punctuation>&#125;</span></span><br><span class=line>                    <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;patterns&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>                        <span class=punctuation>&#123;</span></span><br><span class=line>                            <span class=attr>&quot;include&quot;</span><span class=punctuation>:</span> <span class=string>&quot;#function-parameters&quot;</span></span><br><span class=line>                        <span class=punctuation>&#125;</span></span><br><span class=line>                    <span class=punctuation>]</span></span><br><span class=line>                <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>                <span class=punctuation>&#123;</span></span><br><span class=line>                    <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;meta.function.call.mylang&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;begin&quot;</span><span class=punctuation>:</span> <span class=string>&quot;\\b(\\w+)\\s*\\(&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;end&quot;</span><span class=punctuation>:</span> <span class=string>&quot;\\)&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;beginCaptures&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>                        <span class=attr>&quot;1&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>                            <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;entity.name.function.mylang&quot;</span></span><br><span class=line>                        <span class=punctuation>&#125;</span></span><br><span class=line>                    <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;patterns&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>                        <span class=punctuation>&#123;</span></span><br><span class=line>                            <span class=attr>&quot;include&quot;</span><span class=punctuation>:</span> <span class=string>&quot;$self&quot;</span></span><br><span class=line>                        <span class=punctuation>&#125;</span></span><br><span class=line>                    <span class=punctuation>]</span></span><br><span class=line>                <span class=punctuation>&#125;</span></span><br><span class=line>            <span class=punctuation>]</span></span><br><span class=line>        <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;function-parameters&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>            <span class=attr>&quot;patterns&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>                <span class=punctuation>&#123;</span></span><br><span class=line>                    <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;variable.parameter.mylang&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;match&quot;</span><span class=punctuation>:</span> <span class=string>&quot;\\b\\w+\\b&quot;</span></span><br><span class=line>                <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>                <span class=punctuation>&#123;</span></span><br><span class=line>                    <span class=attr>&quot;include&quot;</span><span class=punctuation>:</span> <span class=string>&quot;#strings&quot;</span></span><br><span class=line>                <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>                <span class=punctuation>&#123;</span></span><br><span class=line>                    <span class=attr>&quot;include&quot;</span><span class=punctuation>:</span> <span class=string>&quot;#numbers&quot;</span></span><br><span class=line>                <span class=punctuation>&#125;</span></span><br><span class=line>            <span class=punctuation>]</span></span><br><span class=line>        <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;operators&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>            <span class=attr>&quot;patterns&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>                <span class=punctuation>&#123;</span></span><br><span class=line>                    <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;keyword.operator.arithmetic.mylang&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;match&quot;</span><span class=punctuation>:</span> <span class=string>&quot;[+\\-*/%]&quot;</span></span><br><span class=line>                <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>                <span class=punctuation>&#123;</span></span><br><span class=line>                    <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;keyword.operator.comparison.mylang&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;match&quot;</span><span class=punctuation>:</span> <span class=string>&quot;(==|!=|&lt;=|&gt;=|&lt;|&gt;)&quot;</span></span><br><span class=line>                <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>                <span class=punctuation>&#123;</span></span><br><span class=line>                    <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;keyword.operator.logical.mylang&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;match&quot;</span><span class=punctuation>:</span> <span class=string>&quot;(&amp;&amp;|\\|\\||!)&quot;</span></span><br><span class=line>                <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>                <span class=punctuation>&#123;</span></span><br><span class=line>                    <span class=attr>&quot;name&quot;</span><span class=punctuation>:</span> <span class=string>&quot;keyword.operator.assignment.mylang&quot;</span><span class=punctuation>,</span></span><br><span class=line>                    <span class=attr>&quot;match&quot;</span><span class=punctuation>:</span> <span class=string>&quot;(=|\\+=|-=|\\*=|/=)&quot;</span></span><br><span class=line>                <span class=punctuation>&#125;</span></span><br><span class=line>            <span class=punctuation>]</span></span><br><span class=line>        <span class=punctuation>&#125;</span></span><br><span class=line>    <span class=punctuation>&#125;</span></span><br><span class=line><span class=punctuation>&#125;</span></span><br></pre></td></tr></table></figure><h4 id=语言配置文件><a href=#语言配置文件 class=headerlink title=语言配置文件></a>语言配置文件</h4><figure class="highlight json"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br></pre></td><td class=code><pre><span class=line><span class=comment>// language-configuration.json</span></span><br><span class=line><span class=punctuation>&#123;</span></span><br><span class=line>    <span class=attr>&quot;comments&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>        <span class=attr>&quot;lineComment&quot;</span><span class=punctuation>:</span> <span class=string>&quot;//&quot;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;blockComment&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span> <span class=string>&quot;/*&quot;</span><span class=punctuation>,</span> <span class=string>&quot;*/&quot;</span> <span class=punctuation>]</span></span><br><span class=line>    <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>    <span class=attr>&quot;brackets&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>        <span class=punctuation>[</span><span class=string>&quot;&#123;&quot;</span><span class=punctuation>,</span> <span class=string>&quot;&#125;&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=punctuation>[</span><span class=string>&quot;[&quot;</span><span class=punctuation>,</span> <span class=string>&quot;]&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=punctuation>[</span><span class=string>&quot;(&quot;</span><span class=punctuation>,</span> <span class=string>&quot;)&quot;</span><span class=punctuation>]</span></span><br><span class=line>    <span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>    <span class=attr>&quot;autoClosingPairs&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>        <span class=punctuation>[</span><span class=string>&quot;&#123;&quot;</span><span class=punctuation>,</span> <span class=string>&quot;&#125;&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=punctuation>[</span><span class=string>&quot;[&quot;</span><span class=punctuation>,</span> <span class=string>&quot;]&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=punctuation>[</span><span class=string>&quot;(&quot;</span><span class=punctuation>,</span> <span class=string>&quot;)&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=punctuation>[</span><span class=string>&quot;\&quot;&quot;</span><span class=punctuation>,</span> <span class=string>&quot;\&quot;&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=punctuation>[</span><span class=string>&quot;&#x27;&quot;</span><span class=punctuation>,</span> <span class=string>&quot;&#x27;&quot;</span><span class=punctuation>]</span></span><br><span class=line>    <span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>    <span class=attr>&quot;surroundingPairs&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>        <span class=punctuation>[</span><span class=string>&quot;&#123;&quot;</span><span class=punctuation>,</span> <span class=string>&quot;&#125;&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=punctuation>[</span><span class=string>&quot;[&quot;</span><span class=punctuation>,</span> <span class=string>&quot;]&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=punctuation>[</span><span class=string>&quot;(&quot;</span><span class=punctuation>,</span> <span class=string>&quot;)&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=punctuation>[</span><span class=string>&quot;\&quot;&quot;</span><span class=punctuation>,</span> <span class=string>&quot;\&quot;&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=punctuation>[</span><span class=string>&quot;&#x27;&quot;</span><span class=punctuation>,</span> <span class=string>&quot;&#x27;&quot;</span><span class=punctuation>]</span></span><br><span class=line>    <span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>    <span class=attr>&quot;folding&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>        <span class=attr>&quot;markers&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>            <span class=attr>&quot;start&quot;</span><span class=punctuation>:</span> <span class=string>&quot;^\\s*//\\s*#?region\\b&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=attr>&quot;end&quot;</span><span class=punctuation>:</span> <span class=string>&quot;^\\s*//\\s*#?endregion\\b&quot;</span></span><br><span class=line>        <span class=punctuation>&#125;</span></span><br><span class=line>    <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>    <span class=attr>&quot;wordPattern&quot;</span><span class=punctuation>:</span> <span class=string>&quot;\\b[a-zA-Z_][a-zA-Z0-9_]*\\b&quot;</span><span class=punctuation>,</span></span><br><span class=line>    <span class=attr>&quot;indentationRules&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>        <span class=attr>&quot;increaseIndentPattern&quot;</span><span class=punctuation>:</span> <span class=string>&quot;^((?!\\/\\*).)*(\\&#123;[^&#125;\&quot;&#x27;`]*|\\([^)\&quot;&#x27;`]*|\\[[^\\]\&quot;&#x27;`]*)$&quot;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;decreaseIndentPattern&quot;</span><span class=punctuation>:</span> <span class=string>&quot;^((?!.*?\\/\\*).*\\*/)?\\s*[\\&#125;\\]].*$&quot;</span></span><br><span class=line>    <span class=punctuation>&#125;</span></span><br><span class=line><span class=punctuation>&#125;</span></span><br></pre></td></tr></table></figure><h3 id=1-2-语义高亮实现><a href=#1-2-语义高亮实现 class=headerlink title="1.2 语义高亮实现"></a>1.2 语义高亮实现</h3><figure class="highlight typescript"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br><span class=line>90</span><br><span class=line>91</span><br><span class=line>92</span><br><span class=line>93</span><br><span class=line>94</span><br><span class=line>95</span><br><span class=line>96</span><br><span class=line>97</span><br><span class=line>98</span><br><span class=line>99</span><br><span class=line>100</span><br><span class=line>101</span><br><span class=line>102</span><br><span class=line>103</span><br><span class=line>104</span><br><span class=line>105</span><br><span class=line>106</span><br><span class=line>107</span><br><span class=line>108</span><br><span class=line>109</span><br><span class=line>110</span><br><span class=line>111</span><br><span class=line>112</span><br><span class=line>113</span><br><span class=line>114</span><br><span class=line>115</span><br><span class=line>116</span><br><span class=line>117</span><br><span class=line>118</span><br><span class=line>119</span><br><span class=line>120</span><br></pre></td><td class=code><pre><span class=line><span class=comment>// src/semanticTokensProvider.ts</span></span><br><span class=line><span class=keyword>import</span> * <span class=keyword>as</span> vscode <span class=keyword>from</span> <span class=string>&#x27;vscode&#x27;</span>;</span><br><span class=line></span><br><span class=line><span class=keyword>export</span> <span class=keyword>class</span> <span class="title class_">MyLangSemanticTokensProvider</span> <span class=keyword>implements</span> vscode.<span class=property>DocumentSemanticTokensProvider</span> &#123;</span><br><span class=line>    </span><br><span class=line>    <span class=comment>// 定义语义token类型和修饰符</span></span><br><span class=line>    <span class=keyword>private</span> <span class=keyword>readonly</span> <span class=attr>legend</span>: vscode.<span class=property>SemanticTokensLegend</span> = <span class=keyword>new</span> vscode.<span class="title class_">SemanticTokensLegend</span>(</span><br><span class=line>        [</span><br><span class=line>            <span class=string>&#x27;namespace&#x27;</span>, <span class=string>&#x27;type&#x27;</span>, <span class=string>&#x27;class&#x27;</span>, <span class=string>&#x27;enum&#x27;</span>, <span class=string>&#x27;interface&#x27;</span>, <span class=string>&#x27;struct&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;typeParameter&#x27;</span>, <span class=string>&#x27;parameter&#x27;</span>, <span class=string>&#x27;variable&#x27;</span>, <span class=string>&#x27;property&#x27;</span>, <span class=string>&#x27;enumMember&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;event&#x27;</span>, <span class=string>&#x27;function&#x27;</span>, <span class=string>&#x27;method&#x27;</span>, <span class=string>&#x27;macro&#x27;</span>, <span class=string>&#x27;keyword&#x27;</span>, <span class=string>&#x27;modifier&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;comment&#x27;</span>, <span class=string>&#x27;string&#x27;</span>, <span class=string>&#x27;number&#x27;</span>, <span class=string>&#x27;regexp&#x27;</span>, <span class=string>&#x27;operator&#x27;</span></span><br><span class=line>        ],</span><br><span class=line>        [</span><br><span class=line>            <span class=string>&#x27;declaration&#x27;</span>, <span class=string>&#x27;definition&#x27;</span>, <span class=string>&#x27;readonly&#x27;</span>, <span class=string>&#x27;static&#x27;</span>, <span class=string>&#x27;deprecated&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;abstract&#x27;</span>, <span class=string>&#x27;async&#x27;</span>, <span class=string>&#x27;modification&#x27;</span>, <span class=string>&#x27;documentation&#x27;</span>, <span class=string>&#x27;defaultLibrary&#x27;</span></span><br><span class=line>        ]</span><br><span class=line>    );</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>async</span> <span class="title function_">provideDocumentSemanticTokens</span>(</span><br><span class=line>        <span class=attr>document</span>: vscode.<span class=property>TextDocument</span>,</span><br><span class=line>        <span class=attr>token</span>: vscode.<span class=property>CancellationToken</span></span><br><span class=line>    ): <span class="title class_">Promise</span>&lt;vscode.<span class=property>SemanticTokens</span>&gt; &#123;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>const</span> tokensBuilder = <span class=keyword>new</span> vscode.<span class="title class_">SemanticTokensBuilder</span>(<span class="variable language_">this</span>.<span class=property>legend</span>);</span><br><span class=line>        <span class=keyword>const</span> text = <span class="variable language_">document</span>.<span class="title function_">getText</span>();</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 解析文档并生成语义tokens</span></span><br><span class=line>        <span class=keyword>await</span> <span class="variable language_">this</span>.<span class="title function_">parseDocument</span>(<span class="variable language_">document</span>, tokensBuilder);</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> tokensBuilder.<span class="title function_">build</span>();</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class=keyword>async</span> <span class="title function_">parseDocument</span>(</span><br><span class=line>        <span class=attr>document</span>: vscode.<span class=property>TextDocument</span>,</span><br><span class=line>        <span class=attr>builder</span>: vscode.<span class=property>SemanticTokensBuilder</span></span><br><span class=line>    ): <span class="title class_">Promise</span>&lt;<span class=built_in>void</span>&gt; &#123;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>const</span> text = <span class="variable language_">document</span>.<span class="title function_">getText</span>();</span><br><span class=line>        <span class=keyword>const</span> lines = text.<span class="title function_">split</span>(<span class=string>&#x27;\n&#x27;</span>);</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>for</span> (<span class=keyword>let</span> lineIndex = <span class=number>0</span>; lineIndex &lt; lines.<span class=property>length</span>; lineIndex++) &#123;</span><br><span class=line>            <span class=keyword>const</span> line = lines[lineIndex];</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// 解析函数定义</span></span><br><span class=line>            <span class=keyword>const</span> functionMatch = <span class=regexp>/function\s+(\w+)\s*\(/g</span>;</span><br><span class=line>            <span class=keyword>let</span> match;</span><br><span class=line>            <span class=keyword>while</span> ((match = functionMatch.<span class="title function_">exec</span>(line)) !== <span class=literal>null</span>) &#123;</span><br><span class=line>                <span class=keyword>const</span> startPos = match.<span class=property>index</span> + match[<span class=number>0</span>].<span class="title function_">indexOf</span>(match[<span class=number>1</span>]);</span><br><span class=line>                builder.<span class="title function_">push</span>(</span><br><span class=line>                    <span class=keyword>new</span> vscode.<span class="title class_">Range</span>(lineIndex, startPos, lineIndex, startPos + match[<span class=number>1</span>].<span class=property>length</span>),</span><br><span class=line>                    <span class=string>&#x27;function&#x27;</span>,</span><br><span class=line>                    [<span class=string>&#x27;declaration&#x27;</span>]</span><br><span class=line>                );</span><br><span class=line>            &#125;</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// 解析变量声明</span></span><br><span class=line>            <span class=keyword>const</span> variableMatch = <span class=regexp>/(var|let|const)\s+(\w+)/g</span>;</span><br><span class=line>            <span class=keyword>while</span> ((match = variableMatch.<span class="title function_">exec</span>(line)) !== <span class=literal>null</span>) &#123;</span><br><span class=line>                <span class=keyword>const</span> startPos = match.<span class=property>index</span> + match[<span class=number>0</span>].<span class="title function_">indexOf</span>(match[<span class=number>2</span>]);</span><br><span class=line>                builder.<span class="title function_">push</span>(</span><br><span class=line>                    <span class=keyword>new</span> vscode.<span class="title class_">Range</span>(lineIndex, startPos, lineIndex, startPos + match[<span class=number>2</span>].<span class=property>length</span>),</span><br><span class=line>                    <span class=string>&#x27;variable&#x27;</span>,</span><br><span class=line>                    [<span class=string>&#x27;declaration&#x27;</span>]</span><br><span class=line>                );</span><br><span class=line>            &#125;</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// 解析类型声明</span></span><br><span class=line>            <span class=keyword>const</span> typeMatch = <span class=regexp>/(class|interface|enum)\s+(\w+)/g</span>;</span><br><span class=line>            <span class=keyword>while</span> ((match = typeMatch.<span class="title function_">exec</span>(line)) !== <span class=literal>null</span>) &#123;</span><br><span class=line>                <span class=keyword>const</span> startPos = match.<span class=property>index</span> + match[<span class=number>0</span>].<span class="title function_">indexOf</span>(match[<span class=number>2</span>]);</span><br><span class=line>                <span class=keyword>const</span> tokenType = match[<span class=number>1</span>] === <span class=string>&#x27;class&#x27;</span> ? <span class=string>&#x27;class&#x27;</span> : </span><br><span class=line>                                match[<span class=number>1</span>] === <span class=string>&#x27;interface&#x27;</span> ? <span class=string>&#x27;interface&#x27;</span> : <span class=string>&#x27;enum&#x27;</span>;</span><br><span class=line>                builder.<span class="title function_">push</span>(</span><br><span class=line>                    <span class=keyword>new</span> vscode.<span class="title class_">Range</span>(lineIndex, startPos, lineIndex, startPos + match[<span class=number>2</span>].<span class=property>length</span>),</span><br><span class=line>                    tokenType,</span><br><span class=line>                    [<span class=string>&#x27;declaration&#x27;</span>]</span><br><span class=line>                );</span><br><span class=line>            &#125;</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// 解析字符串字面量中的变量插值</span></span><br><span class=line>            <span class=keyword>const</span> interpolationMatch = <span class=regexp>/\$\&#123;(\w+)\&#125;/g</span>;</span><br><span class=line>            <span class=keyword>while</span> ((match = interpolationMatch.<span class="title function_">exec</span>(line)) !== <span class=literal>null</span>) &#123;</span><br><span class=line>                <span class=keyword>const</span> startPos = match.<span class=property>index</span> + <span class=number>2</span>; <span class=comment>// 跳过 $&#123;</span></span><br><span class=line>                builder.<span class="title function_">push</span>(</span><br><span class=line>                    <span class=keyword>new</span> vscode.<span class="title class_">Range</span>(lineIndex, startPos, lineIndex, startPos + match[<span class=number>1</span>].<span class=property>length</span>),</span><br><span class=line>                    <span class=string>&#x27;variable&#x27;</span>,</span><br><span class=line>                    [<span class=string>&#x27;readonly&#x27;</span>]</span><br><span class=line>                );</span><br><span class=line>            &#125;</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// 解析注释中的TODO、FIXME等</span></span><br><span class=line>            <span class=keyword>const</span> commentTodoMatch = <span class=regexp>/\/\/.*?(TODO|FIXME|NOTE|HACK):/g</span>;</span><br><span class=line>            <span class=keyword>while</span> ((match = commentTodoMatch.<span class="title function_">exec</span>(line)) !== <span class=literal>null</span>) &#123;</span><br><span class=line>                <span class=keyword>const</span> startPos = match.<span class=property>index</span> + match[<span class=number>0</span>].<span class="title function_">indexOf</span>(match[<span class=number>1</span>]);</span><br><span class=line>                builder.<span class="title function_">push</span>(</span><br><span class=line>                    <span class=keyword>new</span> vscode.<span class="title class_">Range</span>(lineIndex, startPos, lineIndex, startPos + match[<span class=number>1</span>].<span class=property>length</span>),</span><br><span class=line>                    <span class=string>&#x27;keyword&#x27;</span>,</span><br><span class=line>                    [<span class=string>&#x27;documentation&#x27;</span>]</span><br><span class=line>                );</span><br><span class=line>            &#125;</span><br><span class=line>        &#125;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=comment>// 增量更新支持</span></span><br><span class=line>    <span class=keyword>async</span> <span class="title function_">provideDocumentSemanticTokensEdits</span>(</span><br><span class=line>        <span class=attr>document</span>: vscode.<span class=property>TextDocument</span>,</span><br><span class=line>        <span class=attr>previousResultId</span>: <span class=built_in>string</span>,</span><br><span class=line>        <span class=attr>token</span>: vscode.<span class=property>CancellationToken</span></span><br><span class=line>    ): <span class="title class_">Promise</span>&lt;vscode.<span class=property>SemanticTokens</span> | vscode.<span class=property>SemanticTokensEdits</span>&gt; &#123;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 对于简单情况，直接返回新的tokens</span></span><br><span class=line>        <span class=comment>// 复杂的增量更新需要实现差异检测</span></span><br><span class=line>        <span class=keyword>return</span> <span class="variable language_">this</span>.<span class="title function_">provideDocumentSemanticTokens</span>(<span class="variable language_">document</span>, token);</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class="title function_">getLegend</span>(): vscode.<span class=property>SemanticTokensLegend</span> &#123;</span><br><span class=line>        <span class=keyword>return</span> <span class="variable language_">this</span>.<span class=property>legend</span>;</span><br><span class=line>    &#125;</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><h3 id=1-3-代码片段系统><a href=#1-3-代码片段系统 class=headerlink title="1.3 代码片段系统"></a>1.3 代码片段系统</h3><figure class="highlight json"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br><span class=line>90</span><br><span class=line>91</span><br><span class=line>92</span><br><span class=line>93</span><br><span class=line>94</span><br><span class=line>95</span><br><span class=line>96</span><br><span class=line>97</span><br><span class=line>98</span><br><span class=line>99</span><br><span class=line>100</span><br><span class=line>101</span><br><span class=line>102</span><br><span class=line>103</span><br><span class=line>104</span><br><span class=line>105</span><br><span class=line>106</span><br><span class=line>107</span><br><span class=line>108</span><br><span class=line>109</span><br><span class=line>110</span><br><span class=line>111</span><br><span class=line>112</span><br><span class=line>113</span><br><span class=line>114</span><br><span class=line>115</span><br><span class=line>116</span><br><span class=line>117</span><br><span class=line>118</span><br><span class=line>119</span><br><span class=line>120</span><br><span class=line>121</span><br><span class=line>122</span><br><span class=line>123</span><br><span class=line>124</span><br><span class=line>125</span><br><span class=line>126</span><br><span class=line>127</span><br><span class=line>128</span><br><span class=line>129</span><br><span class=line>130</span><br><span class=line>131</span><br><span class=line>132</span><br><span class=line>133</span><br><span class=line>134</span><br><span class=line>135</span><br><span class=line>136</span><br><span class=line>137</span><br><span class=line>138</span><br><span class=line>139</span><br><span class=line>140</span><br><span class=line>141</span><br><span class=line>142</span><br><span class=line>143</span><br><span class=line>144</span><br><span class=line>145</span><br><span class=line>146</span><br><span class=line>147</span><br><span class=line>148</span><br><span class=line>149</span><br><span class=line>150</span><br><span class=line>151</span><br><span class=line>152</span><br><span class=line>153</span><br><span class=line>154</span><br><span class=line>155</span><br><span class=line>156</span><br><span class=line>157</span><br><span class=line>158</span><br><span class=line>159</span><br><span class=line>160</span><br><span class=line>161</span><br><span class=line>162</span><br><span class=line>163</span><br><span class=line>164</span><br><span class=line>165</span><br><span class=line>166</span><br><span class=line>167</span><br><span class=line>168</span><br><span class=line>169</span><br><span class=line>170</span><br><span class=line>171</span><br><span class=line>172</span><br><span class=line>173</span><br><span class=line>174</span><br><span class=line>175</span><br></pre></td><td class=code><pre><span class=line><span class=comment>// snippets/mylang.code-snippets</span></span><br><span class=line><span class=punctuation>&#123;</span></span><br><span class=line>    <span class=attr>&quot;Function Declaration&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>        <span class=attr>&quot;prefix&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span><span class=string>&quot;func&quot;</span><span class=punctuation>,</span> <span class=string>&quot;function&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;body&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>            <span class=string>&quot;function $&#123;1:functionName&#125;($&#123;2:parameters&#125;) &#123;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;\t$&#123;3:// function body&#125;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;\treturn $&#123;4:undefined&#125;;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;&#125;&quot;</span></span><br><span class=line>        <span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;description&quot;</span><span class=punctuation>:</span> <span class=string>&quot;创建函数声明&quot;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;scope&quot;</span><span class=punctuation>:</span> <span class=string>&quot;source.mylang&quot;</span></span><br><span class=line>    <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>    </span><br><span class=line>    <span class=attr>&quot;Class Declaration&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>        <span class=attr>&quot;prefix&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span><span class=string>&quot;class&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;body&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>            <span class=string>&quot;class $&#123;1:ClassName&#125; &#123;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;\tconstructor($&#123;2:parameters&#125;) &#123;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;\t\t$&#123;3:// constructor body&#125;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;\t&#125;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;\t$&#123;4:methodName&#125;() &#123;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;\t\t$&#123;5:// method body&#125;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;\t&#125;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;&#125;&quot;</span></span><br><span class=line>        <span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;description&quot;</span><span class=punctuation>:</span> <span class=string>&quot;创建类声明&quot;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;scope&quot;</span><span class=punctuation>:</span> <span class=string>&quot;source.mylang&quot;</span></span><br><span class=line>    <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>    </span><br><span class=line>    <span class=attr>&quot;If Statement&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>        <span class=attr>&quot;prefix&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span><span class=string>&quot;if&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;body&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>            <span class=string>&quot;if ($&#123;1:condition&#125;) &#123;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;\t$&#123;2:// if body&#125;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;&#125;&quot;</span></span><br><span class=line>        <span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;description&quot;</span><span class=punctuation>:</span> <span class=string>&quot;创建if语句&quot;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;scope&quot;</span><span class=punctuation>:</span> <span class=string>&quot;source.mylang&quot;</span></span><br><span class=line>    <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>    </span><br><span class=line>    <span class=attr>&quot;If-Else Statement&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>        <span class=attr>&quot;prefix&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span><span class=string>&quot;ifelse&quot;</span><span class=punctuation>,</span> <span class=string>&quot;ife&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;body&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>            <span class=string>&quot;if ($&#123;1:condition&#125;) &#123;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;\t$&#123;2:// if body&#125;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;&#125; else &#123;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;\t$&#123;3:// else body&#125;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;&#125;&quot;</span></span><br><span class=line>        <span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;description&quot;</span><span class=punctuation>:</span> <span class=string>&quot;创建if-else语句&quot;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;scope&quot;</span><span class=punctuation>:</span> <span class=string>&quot;source.mylang&quot;</span></span><br><span class=line>    <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>    </span><br><span class=line>    <span class=attr>&quot;For Loop&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>        <span class=attr>&quot;prefix&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span><span class=string>&quot;for&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;body&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>            <span class=string>&quot;for (let $&#123;1:i&#125; = 0; $&#123;1:i&#125; &lt; $&#123;2:length&#125;; $&#123;1:i&#125;++) &#123;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;\t$&#123;3:// loop body&#125;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;&#125;&quot;</span></span><br><span class=line>        <span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;description&quot;</span><span class=punctuation>:</span> <span class=string>&quot;创建for循环&quot;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;scope&quot;</span><span class=punctuation>:</span> <span class=string>&quot;source.mylang&quot;</span></span><br><span class=line>    <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>    </span><br><span class=line>    <span class=attr>&quot;While Loop&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>        <span class=attr>&quot;prefix&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span><span class=string>&quot;while&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;body&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>            <span class=string>&quot;while ($&#123;1:condition&#125;) &#123;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;\t$&#123;2:// loop body&#125;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;&#125;&quot;</span></span><br><span class=line>        <span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;description&quot;</span><span class=punctuation>:</span> <span class=string>&quot;创建while循环&quot;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;scope&quot;</span><span class=punctuation>:</span> <span class=string>&quot;source.mylang&quot;</span></span><br><span class=line>    <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>    </span><br><span class=line>    <span class=attr>&quot;Try-Catch&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>        <span class=attr>&quot;prefix&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span><span class=string>&quot;try&quot;</span><span class=punctuation>,</span> <span class=string>&quot;tryc&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;body&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>            <span class=string>&quot;try &#123;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;\t$&#123;1:// try body&#125;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;&#125; catch ($&#123;2:error&#125;) &#123;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;\t$&#123;3:// catch body&#125;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;&#125;&quot;</span></span><br><span class=line>        <span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;description&quot;</span><span class=punctuation>:</span> <span class=string>&quot;创建try-catch语句&quot;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;scope&quot;</span><span class=punctuation>:</span> <span class=string>&quot;source.mylang&quot;</span></span><br><span class=line>    <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>    </span><br><span class=line>    <span class=attr>&quot;Variable Declaration&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>        <span class=attr>&quot;prefix&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span><span class=string>&quot;var&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;body&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>            <span class=string>&quot;$&#123;1|var,let,const|&#125; $&#123;2:variableName&#125; = $&#123;3:value&#125;;&quot;</span></span><br><span class=line>        <span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;description&quot;</span><span class=punctuation>:</span> <span class=string>&quot;创建变量声明&quot;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;scope&quot;</span><span class=punctuation>:</span> <span class=string>&quot;source.mylang&quot;</span></span><br><span class=line>    <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>    </span><br><span class=line>    <span class=attr>&quot;Console Log&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>        <span class=attr>&quot;prefix&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span><span class=string>&quot;log&quot;</span><span class=punctuation>,</span> <span class=string>&quot;console&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;body&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>            <span class=string>&quot;console.log($&#123;1:message&#125;);&quot;</span></span><br><span class=line>        <span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;description&quot;</span><span class=punctuation>:</span> <span class=string>&quot;创建console.log语句&quot;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;scope&quot;</span><span class=punctuation>:</span> <span class=string>&quot;source.mylang&quot;</span></span><br><span class=line>    <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>    </span><br><span class=line>    <span class=attr>&quot;Import Statement&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>        <span class=attr>&quot;prefix&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span><span class=string>&quot;import&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;body&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>            <span class=string>&quot;import &#123; $&#123;2:exports&#125; &#125; from &#x27;$&#123;1:module&#125;&#x27;;&quot;</span></span><br><span class=line>        <span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;description&quot;</span><span class=punctuation>:</span> <span class=string>&quot;创建import语句&quot;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;scope&quot;</span><span class=punctuation>:</span> <span class=string>&quot;source.mylang&quot;</span></span><br><span class=line>    <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>    </span><br><span class=line>    <span class=attr>&quot;Export Statement&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>        <span class=attr>&quot;prefix&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span><span class=string>&quot;export&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;body&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>            <span class=string>&quot;export $&#123;1|default,|&#125; $&#123;2:exportName&#125;;&quot;</span></span><br><span class=line>        <span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;description&quot;</span><span class=punctuation>:</span> <span class=string>&quot;创建export语句&quot;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;scope&quot;</span><span class=punctuation>:</span> <span class=string>&quot;source.mylang&quot;</span></span><br><span class=line>    <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>    </span><br><span class=line>    <span class=attr>&quot;Arrow Function&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>        <span class=attr>&quot;prefix&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span><span class=string>&quot;arrow&quot;</span><span class=punctuation>,</span> <span class=string>&quot;=&gt;&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;body&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>            <span class=string>&quot;const $&#123;1:functionName&#125; = ($&#123;2:parameters&#125;) =&gt; &#123;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;\t$&#123;3:// function body&#125;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;\treturn $&#123;4:undefined&#125;;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;&#125;;&quot;</span></span><br><span class=line>        <span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;description&quot;</span><span class=punctuation>:</span> <span class=string>&quot;创建箭头函数&quot;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;scope&quot;</span><span class=punctuation>:</span> <span class=string>&quot;source.mylang&quot;</span></span><br><span class=line>    <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>    </span><br><span class=line>    <span class=attr>&quot;Async Function&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>        <span class=attr>&quot;prefix&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span><span class=string>&quot;async&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;body&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>            <span class=string>&quot;async function $&#123;1:functionName&#125;($&#123;2:parameters&#125;) &#123;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;\t$&#123;3:// async function body&#125;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;\treturn $&#123;4:undefined&#125;;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;&#125;&quot;</span></span><br><span class=line>        <span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;description&quot;</span><span class=punctuation>:</span> <span class=string>&quot;创建异步函数&quot;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;scope&quot;</span><span class=punctuation>:</span> <span class=string>&quot;source.mylang&quot;</span></span><br><span class=line>    <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>    </span><br><span class=line>    <span class=attr>&quot;Interface Declaration&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>        <span class=attr>&quot;prefix&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span><span class=string>&quot;interface&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;body&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>            <span class=string>&quot;interface $&#123;1:InterfaceName&#125; &#123;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;\t$&#123;2:propertyName&#125;: $&#123;3:type&#125;;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;\t$&#123;4:methodName&#125;($&#123;5:parameters&#125;): $&#123;6:returnType&#125;;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;&#125;&quot;</span></span><br><span class=line>        <span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;description&quot;</span><span class=punctuation>:</span> <span class=string>&quot;创建接口声明&quot;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;scope&quot;</span><span class=punctuation>:</span> <span class=string>&quot;source.mylang&quot;</span></span><br><span class=line>    <span class=punctuation>&#125;</span><span class=punctuation>,</span></span><br><span class=line>    </span><br><span class=line>    <span class=attr>&quot;Enum Declaration&quot;</span><span class=punctuation>:</span> <span class=punctuation>&#123;</span></span><br><span class=line>        <span class=attr>&quot;prefix&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span><span class=string>&quot;enum&quot;</span><span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;body&quot;</span><span class=punctuation>:</span> <span class=punctuation>[</span></span><br><span class=line>            <span class=string>&quot;enum $&#123;1:EnumName&#125; &#123;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;\t$&#123;2:VALUE1&#125;,&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;\t$&#123;3:VALUE2&#125;,&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;\t$&#123;4:VALUE3&#125;&quot;</span><span class=punctuation>,</span></span><br><span class=line>            <span class=string>&quot;&#125;&quot;</span></span><br><span class=line>        <span class=punctuation>]</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;description&quot;</span><span class=punctuation>:</span> <span class=string>&quot;创建枚举声明&quot;</span><span class=punctuation>,</span></span><br><span class=line>        <span class=attr>&quot;scope&quot;</span><span class=punctuation>:</span> <span class=string>&quot;source.mylang&quot;</span></span><br><span class=line>    <span class=punctuation>&#125;</span></span><br><span class=line><span class=punctuation>&#125;</span></span><br></pre></td></tr></table></figure><hr><h2 id=🔍-第二部分：智能感知功能><a href=#🔍-第二部分：智能感知功能 class=headerlink title="🔍 第二部分：智能感知功能"></a>🔍 第二部分：智能感知功能</h2><h3 id=2-1-代码补全提供者><a href=#2-1-代码补全提供者 class=headerlink title="2.1 代码补全提供者"></a>2.1 代码补全提供者</h3><figure class="highlight typescript"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br><span class=line>90</span><br><span class=line>91</span><br><span class=line>92</span><br><span class=line>93</span><br><span class=line>94</span><br><span class=line>95</span><br><span class=line>96</span><br><span class=line>97</span><br><span class=line>98</span><br><span class=line>99</span><br><span class=line>100</span><br><span class=line>101</span><br><span class=line>102</span><br><span class=line>103</span><br><span class=line>104</span><br><span class=line>105</span><br><span class=line>106</span><br><span class=line>107</span><br><span class=line>108</span><br><span class=line>109</span><br><span class=line>110</span><br><span class=line>111</span><br><span class=line>112</span><br><span class=line>113</span><br><span class=line>114</span><br><span class=line>115</span><br><span class=line>116</span><br><span class=line>117</span><br><span class=line>118</span><br><span class=line>119</span><br><span class=line>120</span><br><span class=line>121</span><br><span class=line>122</span><br><span class=line>123</span><br><span class=line>124</span><br><span class=line>125</span><br><span class=line>126</span><br><span class=line>127</span><br><span class=line>128</span><br><span class=line>129</span><br><span class=line>130</span><br><span class=line>131</span><br><span class=line>132</span><br><span class=line>133</span><br><span class=line>134</span><br><span class=line>135</span><br><span class=line>136</span><br><span class=line>137</span><br><span class=line>138</span><br><span class=line>139</span><br><span class=line>140</span><br><span class=line>141</span><br><span class=line>142</span><br><span class=line>143</span><br><span class=line>144</span><br><span class=line>145</span><br><span class=line>146</span><br><span class=line>147</span><br><span class=line>148</span><br><span class=line>149</span><br><span class=line>150</span><br><span class=line>151</span><br><span class=line>152</span><br><span class=line>153</span><br><span class=line>154</span><br><span class=line>155</span><br><span class=line>156</span><br><span class=line>157</span><br><span class=line>158</span><br><span class=line>159</span><br><span class=line>160</span><br><span class=line>161</span><br><span class=line>162</span><br><span class=line>163</span><br><span class=line>164</span><br><span class=line>165</span><br><span class=line>166</span><br><span class=line>167</span><br><span class=line>168</span><br><span class=line>169</span><br><span class=line>170</span><br><span class=line>171</span><br><span class=line>172</span><br><span class=line>173</span><br><span class=line>174</span><br><span class=line>175</span><br><span class=line>176</span><br><span class=line>177</span><br><span class=line>178</span><br><span class=line>179</span><br><span class=line>180</span><br><span class=line>181</span><br><span class=line>182</span><br><span class=line>183</span><br><span class=line>184</span><br><span class=line>185</span><br><span class=line>186</span><br><span class=line>187</span><br><span class=line>188</span><br><span class=line>189</span><br><span class=line>190</span><br><span class=line>191</span><br><span class=line>192</span><br><span class=line>193</span><br><span class=line>194</span><br><span class=line>195</span><br><span class=line>196</span><br><span class=line>197</span><br><span class=line>198</span><br><span class=line>199</span><br><span class=line>200</span><br><span class=line>201</span><br><span class=line>202</span><br><span class=line>203</span><br><span class=line>204</span><br><span class=line>205</span><br><span class=line>206</span><br><span class=line>207</span><br><span class=line>208</span><br><span class=line>209</span><br><span class=line>210</span><br><span class=line>211</span><br><span class=line>212</span><br><span class=line>213</span><br><span class=line>214</span><br><span class=line>215</span><br><span class=line>216</span><br><span class=line>217</span><br><span class=line>218</span><br><span class=line>219</span><br><span class=line>220</span><br><span class=line>221</span><br><span class=line>222</span><br><span class=line>223</span><br><span class=line>224</span><br><span class=line>225</span><br><span class=line>226</span><br><span class=line>227</span><br><span class=line>228</span><br><span class=line>229</span><br><span class=line>230</span><br><span class=line>231</span><br><span class=line>232</span><br><span class=line>233</span><br><span class=line>234</span><br><span class=line>235</span><br><span class=line>236</span><br><span class=line>237</span><br><span class=line>238</span><br><span class=line>239</span><br><span class=line>240</span><br><span class=line>241</span><br></pre></td><td class=code><pre><span class=line><span class=comment>// src/completionProvider.ts</span></span><br><span class=line><span class=keyword>import</span> * <span class=keyword>as</span> vscode <span class=keyword>from</span> <span class=string>&#x27;vscode&#x27;</span>;</span><br><span class=line></span><br><span class=line><span class=keyword>export</span> <span class=keyword>class</span> <span class="title class_">MyLangCompletionProvider</span> <span class=keyword>implements</span> vscode.<span class=property>CompletionItemProvider</span> &#123;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> keywords = [</span><br><span class=line>        <span class=string>&#x27;function&#x27;</span>, <span class=string>&#x27;var&#x27;</span>, <span class=string>&#x27;let&#x27;</span>, <span class=string>&#x27;const&#x27;</span>, <span class=string>&#x27;if&#x27;</span>, <span class=string>&#x27;else&#x27;</span>, <span class=string>&#x27;while&#x27;</span>, <span class=string>&#x27;for&#x27;</span>,</span><br><span class=line>        <span class=string>&#x27;return&#x27;</span>, <span class=string>&#x27;break&#x27;</span>, <span class=string>&#x27;continue&#x27;</span>, <span class=string>&#x27;class&#x27;</span>, <span class=string>&#x27;interface&#x27;</span>, <span class=string>&#x27;enum&#x27;</span>,</span><br><span class=line>        <span class=string>&#x27;import&#x27;</span>, <span class=string>&#x27;export&#x27;</span>, <span class=string>&#x27;async&#x27;</span>, <span class=string>&#x27;await&#x27;</span>, <span class=string>&#x27;try&#x27;</span>, <span class=string>&#x27;catch&#x27;</span>, <span class=string>&#x27;finally&#x27;</span></span><br><span class=line>    ];</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> builtinTypes = [</span><br><span class=line>        <span class=string>&#x27;string&#x27;</span>, <span class=string>&#x27;number&#x27;</span>, <span class=string>&#x27;boolean&#x27;</span>, <span class=string>&#x27;object&#x27;</span>, <span class=string>&#x27;array&#x27;</span>, <span class=string>&#x27;void&#x27;</span>, <span class=string>&#x27;any&#x27;</span></span><br><span class=line>    ];</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>async</span> <span class="title function_">provideCompletionItems</span>(</span><br><span class=line>        <span class=attr>document</span>: vscode.<span class=property>TextDocument</span>,</span><br><span class=line>        <span class=attr>position</span>: vscode.<span class=property>Position</span>,</span><br><span class=line>        <span class=attr>token</span>: vscode.<span class=property>CancellationToken</span>,</span><br><span class=line>        <span class=attr>context</span>: vscode.<span class=property>CompletionContext</span></span><br><span class=line>    ): <span class="title class_">Promise</span>&lt;vscode.<span class=property>CompletionItem</span>[]&gt; &#123;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>const</span> lineText = <span class="variable language_">document</span>.<span class="title function_">lineAt</span>(position).<span class=property>text</span>;</span><br><span class=line>        <span class=keyword>const</span> wordRange = <span class="variable language_">document</span>.<span class="title function_">getWordRangeAtPosition</span>(position);</span><br><span class=line>        <span class=keyword>const</span> currentWord = wordRange ? <span class="variable language_">document</span>.<span class="title function_">getText</span>(wordRange) : <span class=string>&#x27;&#x27;</span>;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>const</span> <span class=attr>completions</span>: vscode.<span class=property>CompletionItem</span>[] = [];</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 根据上下文提供不同的补全</span></span><br><span class=line>        <span class=keyword>if</span> (<span class="variable language_">this</span>.<span class="title function_">isInStringContext</span>(lineText, position.<span class=property>character</span>)) &#123;</span><br><span class=line>            <span class=comment>// 字符串内的补全</span></span><br><span class=line>            completions.<span class="title function_">push</span>(...<span class="variable language_">this</span>.<span class="title function_">getStringCompletions</span>());</span><br><span class=line>        &#125; <span class=keyword>else</span> <span class=keyword>if</span> (<span class="variable language_">this</span>.<span class="title function_">isInCommentContext</span>(lineText, position.<span class=property>character</span>)) &#123;</span><br><span class=line>            <span class=comment>// 注释内的补全</span></span><br><span class=line>            completions.<span class="title function_">push</span>(...<span class="variable language_">this</span>.<span class="title function_">getCommentCompletions</span>());</span><br><span class=line>        &#125; <span class=keyword>else</span> &#123;</span><br><span class=line>            <span class=comment>// 普通代码补全</span></span><br><span class=line>            completions.<span class="title function_">push</span>(</span><br><span class=line>                ...<span class="variable language_">this</span>.<span class="title function_">getKeywordCompletions</span>(),</span><br><span class=line>                ...<span class="variable language_">this</span>.<span class="title function_">getTypeCompletions</span>(),</span><br><span class=line>                ...<span class="variable language_">this</span>.<span class="title function_">getFunctionCompletions</span>(<span class="variable language_">document</span>, position),</span><br><span class=line>                ...<span class="variable language_">this</span>.<span class="title function_">getVariableCompletions</span>(<span class="variable language_">document</span>, position),</span><br><span class=line>                ...<span class="variable language_">this</span>.<span class="title function_">getSnippetCompletions</span>()</span><br><span class=line>            );</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> completions.<span class="title function_">filter</span>(<span class=function><span class=params>item</span> =&gt;</span> </span><br><span class=line>            !currentWord || item.<span class=property>label</span>.<span class="title function_">toString</span>().<span class="title function_">toLowerCase</span>().<span class="title function_">includes</span>(currentWord.<span class="title function_">toLowerCase</span>())</span><br><span class=line>        );</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">getKeywordCompletions</span>(): vscode.<span class=property>CompletionItem</span>[] &#123;</span><br><span class=line>        <span class=keyword>return</span> <span class="variable language_">this</span>.<span class=property>keywords</span>.<span class="title function_">map</span>(<span class=function><span class=params>keyword</span> =&gt;</span> &#123;</span><br><span class=line>            <span class=keyword>const</span> item = <span class=keyword>new</span> vscode.<span class="title class_">CompletionItem</span>(keyword, vscode.<span class=property>CompletionItemKind</span>.<span class=property>Keyword</span>);</span><br><span class=line>            item.<span class=property>detail</span> = <span class=string>`关键字 <span class=subst>$&#123;keyword&#125;</span>`</span>;</span><br><span class=line>            item.<span class=property>documentation</span> = <span class=keyword>new</span> vscode.<span class="title class_">MarkdownString</span>(<span class=string>`MyLang关键字 \`<span class=subst>$&#123;keyword&#125;</span>\``</span>);</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// 为某些关键字添加代码片段</span></span><br><span class=line>            <span class=keyword>switch</span> (keyword) &#123;</span><br><span class=line>                <span class=keyword>case</span> <span class=string>&#x27;function&#x27;</span>:</span><br><span class=line>                    item.<span class=property>insertText</span> = <span class=keyword>new</span> vscode.<span class="title class_">SnippetString</span>(<span class=string>&#x27;function $&#123;1:name&#125;($&#123;2:params&#125;) &#123;\n\t$0\n&#125;&#x27;</span>);</span><br><span class=line>                    <span class=keyword>break</span>;</span><br><span class=line>                <span class=keyword>case</span> <span class=string>&#x27;if&#x27;</span>:</span><br><span class=line>                    item.<span class=property>insertText</span> = <span class=keyword>new</span> vscode.<span class="title class_">SnippetString</span>(<span class=string>&#x27;if ($&#123;1:condition&#125;) &#123;\n\t$0\n&#125;&#x27;</span>);</span><br><span class=line>                    <span class=keyword>break</span>;</span><br><span class=line>                <span class=keyword>case</span> <span class=string>&#x27;for&#x27;</span>:</span><br><span class=line>                    item.<span class=property>insertText</span> = <span class=keyword>new</span> vscode.<span class="title class_">SnippetString</span>(<span class=string>&#x27;for (let $&#123;1:i&#125; = 0; $&#123;1:i&#125; &lt; $&#123;2:length&#125;; $&#123;1:i&#125;++) &#123;\n\t$0\n&#125;&#x27;</span>);</span><br><span class=line>                    <span class=keyword>break</span>;</span><br><span class=line>                <span class=keyword>case</span> <span class=string>&#x27;class&#x27;</span>:</span><br><span class=line>                    item.<span class=property>insertText</span> = <span class=keyword>new</span> vscode.<span class="title class_">SnippetString</span>(<span class=string>&#x27;class $&#123;1:ClassName&#125; &#123;\n\tconstructor($&#123;2:params&#125;) &#123;\n\t\t$0\n\t&#125;\n&#125;&#x27;</span>);</span><br><span class=line>                    <span class=keyword>break</span>;</span><br><span class=line>            &#125;</span><br><span class=line>            </span><br><span class=line>            <span class=keyword>return</span> item;</span><br><span class=line>        &#125;);</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">getTypeCompletions</span>(): vscode.<span class=property>CompletionItem</span>[] &#123;</span><br><span class=line>        <span class=keyword>return</span> <span class="variable language_">this</span>.<span class=property>builtinTypes</span>.<span class="title function_">map</span>(<span class=function><span class=params>type</span> =&gt;</span> &#123;</span><br><span class=line>            <span class=keyword>const</span> item = <span class=keyword>new</span> vscode.<span class="title class_">CompletionItem</span>(<span class=keyword>type</span>, vscode.<span class=property>CompletionItemKind</span>.<span class=property>TypeParameter</span>);</span><br><span class=line>            item.<span class=property>detail</span> = <span class=string>`内置类型 <span class=subst>$&#123;<span class=keyword>type</span>&#125;</span>`</span>;</span><br><span class=line>            item.<span class=property>documentation</span> = <span class=keyword>new</span> vscode.<span class="title class_">MarkdownString</span>(<span class=string>`MyLang内置类型 \`<span class=subst>$&#123;<span class=keyword>type</span>&#125;</span>\``</span>);</span><br><span class=line>            <span class=keyword>return</span> item;</span><br><span class=line>        &#125;);</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">getFunctionCompletions</span>(</span><br><span class=line>        <span class=attr>document</span>: vscode.<span class=property>TextDocument</span>,</span><br><span class=line>        <span class=attr>position</span>: vscode.<span class=property>Position</span></span><br><span class=line>    ): vscode.<span class=property>CompletionItem</span>[] &#123;</span><br><span class=line>        <span class=keyword>const</span> <span class=attr>functions</span>: vscode.<span class=property>CompletionItem</span>[] = [];</span><br><span class=line>        <span class=keyword>const</span> text = <span class="variable language_">document</span>.<span class="title function_">getText</span>();</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 解析文档中的函数定义</span></span><br><span class=line>        <span class=keyword>const</span> functionRegex = <span class=regexp>/function\s+(\w+)\s*\(([^)]*)\)/g</span>;</span><br><span class=line>        <span class=keyword>let</span> match;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>while</span> ((match = functionRegex.<span class="title function_">exec</span>(text)) !== <span class=literal>null</span>) &#123;</span><br><span class=line>            <span class=keyword>const</span> [, functionName, params] = match;</span><br><span class=line>            </span><br><span class=line>            <span class=keyword>const</span> item = <span class=keyword>new</span> vscode.<span class="title class_">CompletionItem</span>(functionName, vscode.<span class=property>CompletionItemKind</span>.<span class=property>Function</span>);</span><br><span class=line>            item.<span class=property>detail</span> = <span class=string>`function <span class=subst>$&#123;functionName&#125;</span>(<span class=subst>$&#123;params&#125;</span>)`</span>;</span><br><span class=line>            item.<span class=property>documentation</span> = <span class=keyword>new</span> vscode.<span class="title class_">MarkdownString</span>(<span class=string>`用户定义的函数\n\n\`\`\`mylang\nfunction <span class=subst>$&#123;functionName&#125;</span>(<span class=subst>$&#123;params&#125;</span>)\n\`\`\``</span>);</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// 添加参数提示</span></span><br><span class=line>            <span class=keyword>const</span> paramList = params.<span class="title function_">split</span>(<span class=string>&#x27;,&#x27;</span>).<span class="title function_">map</span>(<span class=function>(<span class=params>p, i</span>) =&gt;</span> <span class=string>`\$&#123;<span class=subst>$&#123;i + <span class=number>1</span>&#125;</span>:<span class=subst>$&#123;p.trim()&#125;</span>&#125;`</span>).<span class="title function_">join</span>(<span class=string>&#x27;, &#x27;</span>);</span><br><span class=line>            item.<span class=property>insertText</span> = <span class=keyword>new</span> vscode.<span class="title class_">SnippetString</span>(<span class=string>`<span class=subst>$&#123;functionName&#125;</span>(<span class=subst>$&#123;paramList&#125;</span>)`</span>);</span><br><span class=line>            </span><br><span class=line>            functions.<span class="title function_">push</span>(item);</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 添加内置函数</span></span><br><span class=line>        <span class=keyword>const</span> builtinFunctions = [</span><br><span class=line>            &#123;</span><br><span class=line>                <span class=attr>name</span>: <span class=string>&#x27;console.log&#x27;</span>,</span><br><span class=line>                <span class=attr>params</span>: <span class=string>&#x27;message&#x27;</span>,</span><br><span class=line>                <span class=attr>description</span>: <span class=string>&#x27;在控制台输出消息&#x27;</span></span><br><span class=line>            &#125;,</span><br><span class=line>            &#123;</span><br><span class=line>                <span class=attr>name</span>: <span class=string>&#x27;Math.abs&#x27;</span>,</span><br><span class=line>                <span class=attr>params</span>: <span class=string>&#x27;x&#x27;</span>,</span><br><span class=line>                <span class=attr>description</span>: <span class=string>&#x27;返回数字的绝对值&#x27;</span></span><br><span class=line>            &#125;,</span><br><span class=line>            &#123;</span><br><span class=line>                <span class=attr>name</span>: <span class=string>&#x27;String.prototype.charAt&#x27;</span>,</span><br><span class=line>                <span class=attr>params</span>: <span class=string>&#x27;index&#x27;</span>,</span><br><span class=line>                <span class=attr>description</span>: <span class=string>&#x27;返回指定位置的字符&#x27;</span></span><br><span class=line>            &#125;</span><br><span class=line>        ];</span><br><span class=line>        </span><br><span class=line>        builtinFunctions.<span class="title function_">forEach</span>(<span class=function><span class=params>func</span> =&gt;</span> &#123;</span><br><span class=line>            <span class=keyword>const</span> item = <span class=keyword>new</span> vscode.<span class="title class_">CompletionItem</span>(func.<span class=property>name</span>, vscode.<span class=property>CompletionItemKind</span>.<span class=property>Function</span>);</span><br><span class=line>            item.<span class=property>detail</span> = <span class=string>`<span class=subst>$&#123;func.name&#125;</span>(<span class=subst>$&#123;func.params&#125;</span>)`</span>;</span><br><span class=line>            item.<span class=property>documentation</span> = <span class=keyword>new</span> vscode.<span class="title class_">MarkdownString</span>(func.<span class=property>description</span>);</span><br><span class=line>            item.<span class=property>insertText</span> = <span class=keyword>new</span> vscode.<span class="title class_">SnippetString</span>(<span class=string>`<span class=subst>$&#123;func.name&#125;</span>(\$&#123;1:<span class=subst>$&#123;func.params&#125;</span>&#125;)`</span>);</span><br><span class=line>            functions.<span class="title function_">push</span>(item);</span><br><span class=line>        &#125;);</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> functions;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">getVariableCompletions</span>(</span><br><span class=line>        <span class=attr>document</span>: vscode.<span class=property>TextDocument</span>,</span><br><span class=line>        <span class=attr>position</span>: vscode.<span class=property>Position</span></span><br><span class=line>    ): vscode.<span class=property>CompletionItem</span>[] &#123;</span><br><span class=line>        <span class=keyword>const</span> <span class=attr>variables</span>: vscode.<span class=property>CompletionItem</span>[] = [];</span><br><span class=line>        <span class=keyword>const</span> text = <span class="variable language_">document</span>.<span class="title function_">getText</span>(<span class=keyword>new</span> vscode.<span class="title class_">Range</span>(<span class=keyword>new</span> vscode.<span class="title class_">Position</span>(<span class=number>0</span>, <span class=number>0</span>), position));</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 解析变量声明</span></span><br><span class=line>        <span class=keyword>const</span> variableRegex = <span class=regexp>/(var|let|const)\s+(\w+)/g</span>;</span><br><span class=line>        <span class=keyword>let</span> match;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>while</span> ((match = variableRegex.<span class="title function_">exec</span>(text)) !== <span class=literal>null</span>) &#123;</span><br><span class=line>            <span class=keyword>const</span> [, <span class=keyword>type</span>, variableName] = match;</span><br><span class=line>            </span><br><span class=line>            <span class=keyword>const</span> item = <span class=keyword>new</span> vscode.<span class="title class_">CompletionItem</span>(variableName, vscode.<span class=property>CompletionItemKind</span>.<span class=property>Variable</span>);</span><br><span class=line>            item.<span class=property>detail</span> = <span class=string>`<span class=subst>$&#123;<span class=keyword>type</span>&#125;</span> <span class=subst>$&#123;variableName&#125;</span>`</span>;</span><br><span class=line>            item.<span class=property>documentation</span> = <span class=keyword>new</span> vscode.<span class="title class_">MarkdownString</span>(<span class=string>`变量声明：\`<span class=subst>$&#123;<span class=keyword>type</span>&#125;</span> <span class=subst>$&#123;variableName&#125;</span>\``</span>);</span><br><span class=line>            </span><br><span class=line>            variables.<span class="title function_">push</span>(item);</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> variables;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">getSnippetCompletions</span>(): vscode.<span class=property>CompletionItem</span>[] &#123;</span><br><span class=line>        <span class=keyword>const</span> snippets = [</span><br><span class=line>            &#123;</span><br><span class=line>                <span class=attr>label</span>: <span class=string>&#x27;log&#x27;</span>,</span><br><span class=line>                <span class=attr>detail</span>: <span class=string>&#x27;console.log语句&#x27;</span>,</span><br><span class=line>                <span class=attr>snippet</span>: <span class=string>&#x27;console.log($&#123;1:message&#125;);&#x27;</span></span><br><span class=line>            &#125;,</span><br><span class=line>            &#123;</span><br><span class=line>                <span class=attr>label</span>: <span class=string>&#x27;func&#x27;</span>,</span><br><span class=line>                <span class=attr>detail</span>: <span class=string>&#x27;函数声明&#x27;</span>,</span><br><span class=line>                <span class=attr>snippet</span>: <span class=string>&#x27;function $&#123;1:name&#125;($&#123;2:params&#125;) &#123;\n\t$&#123;3:// body&#125;\n\treturn $&#123;4:undefined&#125;;\n&#125;&#x27;</span></span><br><span class=line>            &#125;,</span><br><span class=line>            &#123;</span><br><span class=line>                <span class=attr>label</span>: <span class=string>&#x27;tryc&#x27;</span>,</span><br><span class=line>                <span class=attr>detail</span>: <span class=string>&#x27;try-catch语句&#x27;</span>,</span><br><span class=line>                <span class=attr>snippet</span>: <span class=string>&#x27;try &#123;\n\t$&#123;1:// try body&#125;\n&#125; catch ($&#123;2:error&#125;) &#123;\n\t$&#123;3:// catch body&#125;\n&#125;&#x27;</span></span><br><span class=line>            &#125;</span><br><span class=line>        ];</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> snippets.<span class="title function_">map</span>(<span class=function><span class=params>snippet</span> =&gt;</span> &#123;</span><br><span class=line>            <span class=keyword>const</span> item = <span class=keyword>new</span> vscode.<span class="title class_">CompletionItem</span>(snippet.<span class=property>label</span>, vscode.<span class=property>CompletionItemKind</span>.<span class=property>Snippet</span>);</span><br><span class=line>            item.<span class=property>detail</span> = snippet.<span class=property>detail</span>;</span><br><span class=line>            item.<span class=property>insertText</span> = <span class=keyword>new</span> vscode.<span class="title class_">SnippetString</span>(snippet.<span class=property>snippet</span>);</span><br><span class=line>            item.<span class=property>documentation</span> = <span class=keyword>new</span> vscode.<span class="title class_">MarkdownString</span>(<span class=string>`代码片段：<span class=subst>$&#123;snippet.detail&#125;</span>`</span>);</span><br><span class=line>            <span class=keyword>return</span> item;</span><br><span class=line>        &#125;);</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">getStringCompletions</span>(): vscode.<span class=property>CompletionItem</span>[] &#123;</span><br><span class=line>        <span class=comment>// 字符串内的特殊补全（如模板字符串变量）</span></span><br><span class=line>        <span class=keyword>return</span> [</span><br><span class=line>            <span class=keyword>new</span> vscode.<span class="title class_">CompletionItem</span>(<span class=string>&#x27;$&#123;variable&#125;&#x27;</span>, vscode.<span class=property>CompletionItemKind</span>.<span class=property>Text</span>)</span><br><span class=line>        ];</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">getCommentCompletions</span>(): vscode.<span class=property>CompletionItem</span>[] &#123;</span><br><span class=line>        <span class=comment>// 注释内的补全（如TODO、FIXME）</span></span><br><span class=line>        <span class=keyword>const</span> commentKeywords = [<span class=string>&#x27;TODO&#x27;</span>, <span class=string>&#x27;FIXME&#x27;</span>, <span class=string>&#x27;NOTE&#x27;</span>, <span class=string>&#x27;HACK&#x27;</span>, <span class=string>&#x27;XXX&#x27;</span>];</span><br><span class=line>        <span class=keyword>return</span> commentKeywords.<span class="title function_">map</span>(<span class=function><span class=params>keyword</span> =&gt;</span> &#123;</span><br><span class=line>            <span class=keyword>const</span> item = <span class=keyword>new</span> vscode.<span class="title class_">CompletionItem</span>(keyword, vscode.<span class=property>CompletionItemKind</span>.<span class=property>Keyword</span>);</span><br><span class=line>            item.<span class=property>detail</span> = <span class=string>`注释关键字 <span class=subst>$&#123;keyword&#125;</span>`</span>;</span><br><span class=line>            <span class=keyword>return</span> item;</span><br><span class=line>        &#125;);</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">isInStringContext</span>(<span class=attr>lineText</span>: <span class=built_in>string</span>, <span class=attr>position</span>: <span class=built_in>number</span>): <span class=built_in>boolean</span> &#123;</span><br><span class=line>        <span class=keyword>const</span> beforeCursor = lineText.<span class="title function_">substring</span>(<span class=number>0</span>, position);</span><br><span class=line>        <span class=keyword>const</span> quoteCount = (beforeCursor.<span class="title function_">match</span>(<span class=regexp>/&quot;/g</span>) || []).<span class=property>length</span>;</span><br><span class=line>        <span class=keyword>return</span> quoteCount % <span class=number>2</span> === <span class=number>1</span>;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">isInCommentContext</span>(<span class=attr>lineText</span>: <span class=built_in>string</span>, <span class=attr>position</span>: <span class=built_in>number</span>): <span class=built_in>boolean</span> &#123;</span><br><span class=line>        <span class=keyword>const</span> beforeCursor = lineText.<span class="title function_">substring</span>(<span class=number>0</span>, position);</span><br><span class=line>        <span class=keyword>return</span> beforeCursor.<span class="title function_">includes</span>(<span class=string>&#x27;//&#x27;</span>) || beforeCursor.<span class="title function_">includes</span>(<span class=string>&#x27;/*&#x27;</span>);</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class="title function_">resolveCompletionItem</span>(</span><br><span class=line>        <span class=attr>item</span>: vscode.<span class=property>CompletionItem</span>,</span><br><span class=line>        <span class=attr>token</span>: vscode.<span class=property>CancellationToken</span></span><br><span class=line>    ): vscode.<span class=property>ProviderResult</span>&lt;vscode.<span class=property>CompletionItem</span>&gt; &#123;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 为补全项添加更详细的信息</span></span><br><span class=line>        <span class=keyword>if</span> (item.<span class=property>kind</span> === vscode.<span class=property>CompletionItemKind</span>.<span class=property>Function</span>) &#123;</span><br><span class=line>            item.<span class=property>documentation</span> = <span class=keyword>new</span> vscode.<span class="title class_">MarkdownString</span>(</span><br><span class=line>                <span class=string>`函数：<span class=subst>$&#123;item.label&#125;</span>\n\n`</span> +</span><br><span class=line>                <span class=string>`**详细信息：**\n`</span> +</span><br><span class=line>                <span class=string>`- 参数：<span class=subst>$&#123;item.detail&#125;</span>\n`</span> +</span><br><span class=line>                <span class=string>`- 返回值：根据实现而定\n\n`</span> +</span><br><span class=line>                <span class=string>`**示例：**\n`</span> +</span><br><span class=line>                <span class=string>`\`\`\`mylang\n<span class=subst>$&#123;item.label&#125;</span>(参数)\n\`\`\``</span></span><br><span class=line>            );</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> item;</span><br><span class=line>    &#125;</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><h3 id=2-2-悬停信息提供者><a href=#2-2-悬停信息提供者 class=headerlink title="2.2 悬停信息提供者"></a>2.2 悬停信息提供者</h3><figure class="highlight typescript"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br><span class=line>90</span><br><span class=line>91</span><br><span class=line>92</span><br><span class=line>93</span><br><span class=line>94</span><br><span class=line>95</span><br><span class=line>96</span><br><span class=line>97</span><br><span class=line>98</span><br><span class=line>99</span><br><span class=line>100</span><br><span class=line>101</span><br><span class=line>102</span><br><span class=line>103</span><br><span class=line>104</span><br><span class=line>105</span><br><span class=line>106</span><br><span class=line>107</span><br><span class=line>108</span><br><span class=line>109</span><br><span class=line>110</span><br><span class=line>111</span><br><span class=line>112</span><br><span class=line>113</span><br><span class=line>114</span><br><span class=line>115</span><br><span class=line>116</span><br><span class=line>117</span><br><span class=line>118</span><br><span class=line>119</span><br><span class=line>120</span><br><span class=line>121</span><br><span class=line>122</span><br><span class=line>123</span><br><span class=line>124</span><br><span class=line>125</span><br><span class=line>126</span><br><span class=line>127</span><br><span class=line>128</span><br><span class=line>129</span><br><span class=line>130</span><br><span class=line>131</span><br><span class=line>132</span><br><span class=line>133</span><br><span class=line>134</span><br><span class=line>135</span><br><span class=line>136</span><br><span class=line>137</span><br><span class=line>138</span><br><span class=line>139</span><br><span class=line>140</span><br><span class=line>141</span><br><span class=line>142</span><br><span class=line>143</span><br><span class=line>144</span><br><span class=line>145</span><br><span class=line>146</span><br><span class=line>147</span><br><span class=line>148</span><br><span class=line>149</span><br><span class=line>150</span><br><span class=line>151</span><br><span class=line>152</span><br><span class=line>153</span><br><span class=line>154</span><br><span class=line>155</span><br><span class=line>156</span><br><span class=line>157</span><br><span class=line>158</span><br><span class=line>159</span><br><span class=line>160</span><br><span class=line>161</span><br><span class=line>162</span><br><span class=line>163</span><br><span class=line>164</span><br><span class=line>165</span><br><span class=line>166</span><br><span class=line>167</span><br><span class=line>168</span><br><span class=line>169</span><br><span class=line>170</span><br><span class=line>171</span><br><span class=line>172</span><br><span class=line>173</span><br><span class=line>174</span><br><span class=line>175</span><br><span class=line>176</span><br><span class=line>177</span><br><span class=line>178</span><br><span class=line>179</span><br><span class=line>180</span><br><span class=line>181</span><br><span class=line>182</span><br><span class=line>183</span><br><span class=line>184</span><br><span class=line>185</span><br><span class=line>186</span><br><span class=line>187</span><br><span class=line>188</span><br><span class=line>189</span><br><span class=line>190</span><br><span class=line>191</span><br><span class=line>192</span><br><span class=line>193</span><br><span class=line>194</span><br><span class=line>195</span><br><span class=line>196</span><br><span class=line>197</span><br><span class=line>198</span><br><span class=line>199</span><br><span class=line>200</span><br><span class=line>201</span><br><span class=line>202</span><br><span class=line>203</span><br><span class=line>204</span><br><span class=line>205</span><br><span class=line>206</span><br><span class=line>207</span><br><span class=line>208</span><br><span class=line>209</span><br><span class=line>210</span><br><span class=line>211</span><br><span class=line>212</span><br><span class=line>213</span><br><span class=line>214</span><br><span class=line>215</span><br><span class=line>216</span><br><span class=line>217</span><br><span class=line>218</span><br><span class=line>219</span><br><span class=line>220</span><br><span class=line>221</span><br><span class=line>222</span><br><span class=line>223</span><br><span class=line>224</span><br><span class=line>225</span><br><span class=line>226</span><br><span class=line>227</span><br><span class=line>228</span><br><span class=line>229</span><br><span class=line>230</span><br><span class=line>231</span><br><span class=line>232</span><br><span class=line>233</span><br><span class=line>234</span><br><span class=line>235</span><br><span class=line>236</span><br><span class=line>237</span><br><span class=line>238</span><br><span class=line>239</span><br><span class=line>240</span><br><span class=line>241</span><br><span class=line>242</span><br><span class=line>243</span><br><span class=line>244</span><br><span class=line>245</span><br><span class=line>246</span><br><span class=line>247</span><br><span class=line>248</span><br><span class=line>249</span><br><span class=line>250</span><br><span class=line>251</span><br><span class=line>252</span><br><span class=line>253</span><br><span class=line>254</span><br><span class=line>255</span><br><span class=line>256</span><br><span class=line>257</span><br><span class=line>258</span><br><span class=line>259</span><br><span class=line>260</span><br><span class=line>261</span><br><span class=line>262</span><br><span class=line>263</span><br><span class=line>264</span><br><span class=line>265</span><br><span class=line>266</span><br><span class=line>267</span><br><span class=line>268</span><br><span class=line>269</span><br><span class=line>270</span><br><span class=line>271</span><br><span class=line>272</span><br><span class=line>273</span><br><span class=line>274</span><br><span class=line>275</span><br><span class=line>276</span><br><span class=line>277</span><br><span class=line>278</span><br><span class=line>279</span><br><span class=line>280</span><br><span class=line>281</span><br><span class=line>282</span><br><span class=line>283</span><br><span class=line>284</span><br><span class=line>285</span><br><span class=line>286</span><br><span class=line>287</span><br><span class=line>288</span><br><span class=line>289</span><br><span class=line>290</span><br><span class=line>291</span><br><span class=line>292</span><br><span class=line>293</span><br><span class=line>294</span><br><span class=line>295</span><br><span class=line>296</span><br><span class=line>297</span><br><span class=line>298</span><br><span class=line>299</span><br><span class=line>300</span><br><span class=line>301</span><br><span class=line>302</span><br><span class=line>303</span><br><span class=line>304</span><br><span class=line>305</span><br><span class=line>306</span><br><span class=line>307</span><br><span class=line>308</span><br><span class=line>309</span><br><span class=line>310</span><br><span class=line>311</span><br><span class=line>312</span><br><span class=line>313</span><br><span class=line>314</span><br><span class=line>315</span><br><span class=line>316</span><br><span class=line>317</span><br><span class=line>318</span><br><span class=line>319</span><br><span class=line>320</span><br><span class=line>321</span><br><span class=line>322</span><br><span class=line>323</span><br><span class=line>324</span><br><span class=line>325</span><br><span class=line>326</span><br><span class=line>327</span><br><span class=line>328</span><br><span class=line>329</span><br><span class=line>330</span><br><span class=line>331</span><br><span class=line>332</span><br><span class=line>333</span><br><span class=line>334</span><br><span class=line>335</span><br><span class=line>336</span><br><span class=line>337</span><br><span class=line>338</span><br><span class=line>339</span><br><span class=line>340</span><br><span class=line>341</span><br><span class=line>342</span><br><span class=line>343</span><br><span class=line>344</span><br><span class=line>345</span><br><span class=line>346</span><br><span class=line>347</span><br><span class=line>348</span><br><span class=line>349</span><br><span class=line>350</span><br><span class=line>351</span><br><span class=line>352</span><br><span class=line>353</span><br><span class=line>354</span><br><span class=line>355</span><br></pre></td><td class=code><pre><span class=line><span class=comment>// src/hoverProvider.ts</span></span><br><span class=line><span class=keyword>import</span> * <span class=keyword>as</span> vscode <span class=keyword>from</span> <span class=string>&#x27;vscode&#x27;</span>;</span><br><span class=line></span><br><span class=line><span class=keyword>export</span> <span class=keyword>class</span> <span class="title class_">MyLangHoverProvider</span> <span class=keyword>implements</span> vscode.<span class=property>HoverProvider</span> &#123;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>async</span> <span class="title function_">provideHover</span>(</span><br><span class=line>        <span class=attr>document</span>: vscode.<span class=property>TextDocument</span>,</span><br><span class=line>        <span class=attr>position</span>: vscode.<span class=property>Position</span>,</span><br><span class=line>        <span class=attr>token</span>: vscode.<span class=property>CancellationToken</span></span><br><span class=line>    ): <span class="title class_">Promise</span>&lt;vscode.<span class=property>Hover</span> | <span class=literal>undefined</span>&gt; &#123;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>const</span> wordRange = <span class="variable language_">document</span>.<span class="title function_">getWordRangeAtPosition</span>(position);</span><br><span class=line>        <span class=keyword>if</span> (!wordRange) &#123;</span><br><span class=line>            <span class=keyword>return</span> <span class=literal>undefined</span>;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>const</span> word = <span class="variable language_">document</span>.<span class="title function_">getText</span>(wordRange);</span><br><span class=line>        <span class=keyword>const</span> line = <span class="variable language_">document</span>.<span class="title function_">lineAt</span>(position.<span class=property>line</span>).<span class=property>text</span>;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 获取悬停信息</span></span><br><span class=line>        <span class=keyword>const</span> hoverInfo = <span class=keyword>await</span> <span class="variable language_">this</span>.<span class="title function_">getHoverInfo</span>(<span class="variable language_">document</span>, word, position, line);</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>if</span> (hoverInfo) &#123;</span><br><span class=line>            <span class=keyword>return</span> <span class=keyword>new</span> vscode.<span class="title class_">Hover</span>(hoverInfo, wordRange);</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> <span class=literal>undefined</span>;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class=keyword>async</span> <span class="title function_">getHoverInfo</span>(</span><br><span class=line>        <span class=attr>document</span>: vscode.<span class=property>TextDocument</span>,</span><br><span class=line>        <span class=attr>word</span>: <span class=built_in>string</span>,</span><br><span class=line>        <span class=attr>position</span>: vscode.<span class=property>Position</span>,</span><br><span class=line>        <span class=attr>line</span>: <span class=built_in>string</span></span><br><span class=line>    ): <span class="title class_">Promise</span>&lt;vscode.<span class=property>MarkdownString</span> | <span class=literal>undefined</span>&gt; &#123;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 检查是否是关键字</span></span><br><span class=line>        <span class=keyword>if</span> (<span class="variable language_">this</span>.<span class="title function_">isKeyword</span>(word)) &#123;</span><br><span class=line>            <span class=keyword>return</span> <span class="variable language_">this</span>.<span class="title function_">getKeywordHover</span>(word);</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 检查是否是函数调用</span></span><br><span class=line>        <span class=keyword>if</span> (<span class="variable language_">this</span>.<span class="title function_">isFunctionCall</span>(line, word)) &#123;</span><br><span class=line>            <span class=keyword>return</span> <span class="variable language_">this</span>.<span class="title function_">getFunctionHover</span>(<span class="variable language_">document</span>, word);</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 检查是否是变量</span></span><br><span class=line>        <span class=keyword>if</span> (<span class="variable language_">this</span>.<span class="title function_">isVariable</span>(<span class="variable language_">document</span>, word, position)) &#123;</span><br><span class=line>            <span class=keyword>return</span> <span class="variable language_">this</span>.<span class="title function_">getVariableHover</span>(<span class="variable language_">document</span>, word, position);</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 检查是否是类型</span></span><br><span class=line>        <span class=keyword>if</span> (<span class="variable language_">this</span>.<span class="title function_">isType</span>(word)) &#123;</span><br><span class=line>            <span class=keyword>return</span> <span class="variable language_">this</span>.<span class="title function_">getTypeHover</span>(word);</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 检查是否是内置函数或对象</span></span><br><span class=line>        <span class=keyword>if</span> (<span class="variable language_">this</span>.<span class="title function_">isBuiltinFunction</span>(word)) &#123;</span><br><span class=line>            <span class=keyword>return</span> <span class="variable language_">this</span>.<span class="title function_">getBuiltinFunctionHover</span>(word);</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> <span class=literal>undefined</span>;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">isKeyword</span>(<span class=attr>word</span>: <span class=built_in>string</span>): <span class=built_in>boolean</span> &#123;</span><br><span class=line>        <span class=keyword>const</span> keywords = [</span><br><span class=line>            <span class=string>&#x27;function&#x27;</span>, <span class=string>&#x27;var&#x27;</span>, <span class=string>&#x27;let&#x27;</span>, <span class=string>&#x27;const&#x27;</span>, <span class=string>&#x27;if&#x27;</span>, <span class=string>&#x27;else&#x27;</span>, <span class=string>&#x27;while&#x27;</span>, <span class=string>&#x27;for&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;return&#x27;</span>, <span class=string>&#x27;break&#x27;</span>, <span class=string>&#x27;continue&#x27;</span>, <span class=string>&#x27;class&#x27;</span>, <span class=string>&#x27;interface&#x27;</span>, <span class=string>&#x27;enum&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;import&#x27;</span>, <span class=string>&#x27;export&#x27;</span>, <span class=string>&#x27;async&#x27;</span>, <span class=string>&#x27;await&#x27;</span>, <span class=string>&#x27;try&#x27;</span>, <span class=string>&#x27;catch&#x27;</span>, <span class=string>&#x27;finally&#x27;</span></span><br><span class=line>        ];</span><br><span class=line>        <span class=keyword>return</span> keywords.<span class="title function_">includes</span>(word);</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">getKeywordHover</span>(<span class=attr>keyword</span>: <span class=built_in>string</span>): vscode.<span class=property>MarkdownString</span> &#123;</span><br><span class=line>        <span class=keyword>const</span> <span class=attr>descriptions</span>: <span class="title class_">Record</span>&lt;<span class=built_in>string</span>, <span class=built_in>string</span>&gt; = &#123;</span><br><span class=line>            <span class=string>&#x27;function&#x27;</span>: <span class=string>&#x27;用于声明函数的关键字&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;var&#x27;</span>: <span class=string>&#x27;声明变量（函数作用域）&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;let&#x27;</span>: <span class=string>&#x27;声明变量（块作用域）&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;const&#x27;</span>: <span class=string>&#x27;声明常量（块作用域）&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;if&#x27;</span>: <span class=string>&#x27;条件语句&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;else&#x27;</span>: <span class=string>&#x27;条件语句的否则分支&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;while&#x27;</span>: <span class=string>&#x27;循环语句&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;for&#x27;</span>: <span class=string>&#x27;循环语句&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;return&#x27;</span>: <span class=string>&#x27;函数返回语句&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;break&#x27;</span>: <span class=string>&#x27;跳出循环或switch语句&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;continue&#x27;</span>: <span class=string>&#x27;跳过当前循环迭代&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;class&#x27;</span>: <span class=string>&#x27;声明类&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;interface&#x27;</span>: <span class=string>&#x27;声明接口&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;enum&#x27;</span>: <span class=string>&#x27;声明枚举&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;import&#x27;</span>: <span class=string>&#x27;导入模块&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;export&#x27;</span>: <span class=string>&#x27;导出模块成员&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;async&#x27;</span>: <span class=string>&#x27;声明异步函数&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;await&#x27;</span>: <span class=string>&#x27;等待异步操作完成&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;try&#x27;</span>: <span class=string>&#x27;异常处理语句&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;catch&#x27;</span>: <span class=string>&#x27;捕获异常&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;finally&#x27;</span>: <span class=string>&#x27;异常处理的最终执行块&#x27;</span></span><br><span class=line>        &#125;;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>const</span> description = descriptions[keyword] || <span class=string>&#x27;关键字&#x27;</span>;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>const</span> markdown = <span class=keyword>new</span> vscode.<span class="title class_">MarkdownString</span>();</span><br><span class=line>        markdown.<span class="title function_">appendCodeblock</span>(<span class=string>`<span class=subst>$&#123;keyword&#125;</span>`</span>, <span class=string>&#x27;mylang&#x27;</span>);</span><br><span class=line>        markdown.<span class="title function_">appendMarkdown</span>(<span class=string>`**关键字：** <span class=subst>$&#123;keyword&#125;</span>\n\n`</span>);</span><br><span class=line>        markdown.<span class="title function_">appendMarkdown</span>(<span class=string>`**描述：** <span class=subst>$&#123;description&#125;</span>\n\n`</span>);</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 添加使用示例</span></span><br><span class=line>        <span class=keyword>const</span> <span class=attr>examples</span>: <span class="title class_">Record</span>&lt;<span class=built_in>string</span>, <span class=built_in>string</span>&gt; = &#123;</span><br><span class=line>            <span class=string>&#x27;function&#x27;</span>: <span class=string>&#x27;function myFunction(param1, param2) &#123;\n    return param1 + param2;\n&#125;&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;if&#x27;</span>: <span class=string>&#x27;if (condition) &#123;\n    // 执行代码\n&#125;&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;for&#x27;</span>: <span class=string>&#x27;for (let i = 0; i &lt; 10; i++) &#123;\n    // 循环体\n&#125;&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;class&#x27;</span>: <span class=string>&#x27;class MyClass &#123;\n    constructor() &#123;\n        // 构造函数\n    &#125;\n&#125;&#x27;</span></span><br><span class=line>        &#125;;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>if</span> (examples[keyword]) &#123;</span><br><span class=line>            markdown.<span class="title function_">appendMarkdown</span>(<span class=string>`**示例：**\n`</span>);</span><br><span class=line>            markdown.<span class="title function_">appendCodeblock</span>(examples[keyword], <span class=string>&#x27;mylang&#x27;</span>);</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> markdown;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">isFunctionCall</span>(<span class=attr>line</span>: <span class=built_in>string</span>, <span class=attr>word</span>: <span class=built_in>string</span>): <span class=built_in>boolean</span> &#123;</span><br><span class=line>        <span class=keyword>const</span> functionCallPattern = <span class=keyword>new</span> <span class="title class_">RegExp</span>(<span class=string>`\\b<span class=subst>$&#123;word&#125;</span>\\s*\\(`</span>);</span><br><span class=line>        <span class=keyword>return</span> functionCallPattern.<span class="title function_">test</span>(line);</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">getFunctionHover</span>(<span class=attr>document</span>: vscode.<span class=property>TextDocument</span>, <span class=attr>functionName</span>: <span class=built_in>string</span>): vscode.<span class=property>MarkdownString</span> &#123;</span><br><span class=line>        <span class=keyword>const</span> text = <span class="variable language_">document</span>.<span class="title function_">getText</span>();</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 查找函数定义</span></span><br><span class=line>        <span class=keyword>const</span> functionDefPattern = <span class=keyword>new</span> <span class="title class_">RegExp</span>(<span class=string>`function\\s+<span class=subst>$&#123;functionName&#125;</span>\\s*\\(([^)]*)\\)\\s*\\&#123;`</span>, <span class=string>&#x27;g&#x27;</span>);</span><br><span class=line>        <span class=keyword>const</span> match = functionDefPattern.<span class="title function_">exec</span>(text);</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>const</span> markdown = <span class=keyword>new</span> vscode.<span class="title class_">MarkdownString</span>();</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>if</span> (match) &#123;</span><br><span class=line>            <span class=keyword>const</span> params = match[<span class=number>1</span>];</span><br><span class=line>            markdown.<span class="title function_">appendCodeblock</span>(<span class=string>`function <span class=subst>$&#123;functionName&#125;</span>(<span class=subst>$&#123;params&#125;</span>)`</span>, <span class=string>&#x27;mylang&#x27;</span>);</span><br><span class=line>            markdown.<span class="title function_">appendMarkdown</span>(<span class=string>`**函数：** <span class=subst>$&#123;functionName&#125;</span>\n\n`</span>);</span><br><span class=line>            markdown.<span class="title function_">appendMarkdown</span>(<span class=string>`**参数：** <span class=subst>$&#123;params || <span class=string>&#x27;无&#x27;</span>&#125;</span>\n\n`</span>);</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// 尝试提取函数注释</span></span><br><span class=line>            <span class=keyword>const</span> functionComment = <span class="variable language_">this</span>.<span class="title function_">extractFunctionComment</span>(text, match.<span class=property>index</span>);</span><br><span class=line>            <span class=keyword>if</span> (functionComment) &#123;</span><br><span class=line>                markdown.<span class="title function_">appendMarkdown</span>(<span class=string>`**描述：** <span class=subst>$&#123;functionComment&#125;</span>\n\n`</span>);</span><br><span class=line>            &#125;</span><br><span class=line>        &#125; <span class=keyword>else</span> &#123;</span><br><span class=line>            <span class=comment>// 检查是否是内置函数</span></span><br><span class=line>            <span class=keyword>const</span> builtinInfo = <span class="variable language_">this</span>.<span class="title function_">getBuiltinFunctionInfo</span>(functionName);</span><br><span class=line>            <span class=keyword>if</span> (builtinInfo) &#123;</span><br><span class=line>                markdown.<span class="title function_">appendCodeblock</span>(<span class=string>`<span class=subst>$&#123;functionName&#125;</span>(<span class=subst>$&#123;builtinInfo.params&#125;</span>)`</span>, <span class=string>&#x27;mylang&#x27;</span>);</span><br><span class=line>                markdown.<span class="title function_">appendMarkdown</span>(<span class=string>`**内置函数：** <span class=subst>$&#123;functionName&#125;</span>\n\n`</span>);</span><br><span class=line>                markdown.<span class="title function_">appendMarkdown</span>(<span class=string>`**描述：** <span class=subst>$&#123;builtinInfo.description&#125;</span>\n\n`</span>);</span><br><span class=line>                markdown.<span class="title function_">appendMarkdown</span>(<span class=string>`**返回值：** <span class=subst>$&#123;builtinInfo.returnType&#125;</span>\n\n`</span>);</span><br><span class=line>            &#125; <span class=keyword>else</span> &#123;</span><br><span class=line>                markdown.<span class="title function_">appendCodeblock</span>(functionName, <span class=string>&#x27;mylang&#x27;</span>);</span><br><span class=line>                markdown.<span class="title function_">appendMarkdown</span>(<span class=string>`**函数：** <span class=subst>$&#123;functionName&#125;</span>\n\n`</span>);</span><br><span class=line>                markdown.<span class="title function_">appendMarkdown</span>(<span class=string>`*未找到函数定义*`</span>);</span><br><span class=line>            &#125;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> markdown;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">isVariable</span>(<span class=attr>document</span>: vscode.<span class=property>TextDocument</span>, <span class=attr>word</span>: <span class=built_in>string</span>, <span class=attr>position</span>: vscode.<span class=property>Position</span>): <span class=built_in>boolean</span> &#123;</span><br><span class=line>        <span class=keyword>const</span> text = <span class="variable language_">document</span>.<span class="title function_">getText</span>(<span class=keyword>new</span> vscode.<span class="title class_">Range</span>(<span class=keyword>new</span> vscode.<span class="title class_">Position</span>(<span class=number>0</span>, <span class=number>0</span>), position));</span><br><span class=line>        <span class=keyword>const</span> variablePattern = <span class=keyword>new</span> <span class="title class_">RegExp</span>(<span class=string>`\\b(var|let|const)\\s+<span class=subst>$&#123;word&#125;</span>\\b`</span>);</span><br><span class=line>        <span class=keyword>return</span> variablePattern.<span class="title function_">test</span>(text);</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">getVariableHover</span>(</span><br><span class=line>        <span class=attr>document</span>: vscode.<span class=property>TextDocument</span>,</span><br><span class=line>        <span class=attr>variableName</span>: <span class=built_in>string</span>,</span><br><span class=line>        <span class=attr>position</span>: vscode.<span class=property>Position</span></span><br><span class=line>    ): vscode.<span class=property>MarkdownString</span> &#123;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>const</span> text = <span class="variable language_">document</span>.<span class="title function_">getText</span>(<span class=keyword>new</span> vscode.<span class="title class_">Range</span>(<span class=keyword>new</span> vscode.<span class="title class_">Position</span>(<span class=number>0</span>, <span class=number>0</span>), position));</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 查找变量声明</span></span><br><span class=line>        <span class=keyword>const</span> variablePattern = <span class=keyword>new</span> <span class="title class_">RegExp</span>(<span class=string>`\\b(var|let|const)\\s+<span class=subst>$&#123;variableName&#125;</span>(\\s*=\\s*([^;\\n]+))?`</span>, <span class=string>&#x27;g&#x27;</span>);</span><br><span class=line>        <span class=keyword>const</span> matches = <span class="title class_">Array</span>.<span class="title function_">from</span>(text.<span class="title function_">matchAll</span>(variablePattern));</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>const</span> markdown = <span class=keyword>new</span> vscode.<span class="title class_">MarkdownString</span>();</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>if</span> (matches.<span class=property>length</span> &gt; <span class=number>0</span>) &#123;</span><br><span class=line>            <span class=keyword>const</span> lastMatch = matches[matches.<span class=property>length</span> - <span class=number>1</span>];</span><br><span class=line>            <span class=keyword>const</span> [, declarationType, , initialValue] = lastMatch;</span><br><span class=line>            </span><br><span class=line>            markdown.<span class="title function_">appendCodeblock</span>(<span class=string>`<span class=subst>$&#123;declarationType&#125;</span> <span class=subst>$&#123;variableName&#125;</span><span class=subst>$&#123;initialValue ? <span class=string>` = <span class=subst>$&#123;initialValue&#125;</span>`</span> : <span class=string>&#x27;&#x27;</span>&#125;</span>`</span>, <span class=string>&#x27;mylang&#x27;</span>);</span><br><span class=line>            markdown.<span class="title function_">appendMarkdown</span>(<span class=string>`**变量：** <span class=subst>$&#123;variableName&#125;</span>\n\n`</span>);</span><br><span class=line>            markdown.<span class="title function_">appendMarkdown</span>(<span class=string>`**类型：** <span class=subst>$&#123;declarationType&#125;</span>\n\n`</span>);</span><br><span class=line>            </span><br><span class=line>            <span class=keyword>if</span> (initialValue) &#123;</span><br><span class=line>                markdown.<span class="title function_">appendMarkdown</span>(<span class=string>`**初始值：** <span class=subst>$&#123;initialValue.trim()&#125;</span>\n\n`</span>);</span><br><span class=line>                </span><br><span class=line>                <span class=comment>// 尝试推断类型</span></span><br><span class=line>                <span class=keyword>const</span> inferredType = <span class="variable language_">this</span>.<span class="title function_">inferType</span>(initialValue.<span class="title function_">trim</span>());</span><br><span class=line>                <span class=keyword>if</span> (inferredType) &#123;</span><br><span class=line>                    markdown.<span class="title function_">appendMarkdown</span>(<span class=string>`**推断类型：** <span class=subst>$&#123;inferredType&#125;</span>\n\n`</span>);</span><br><span class=line>                &#125;</span><br><span class=line>            &#125;</span><br><span class=line>        &#125; <span class=keyword>else</span> &#123;</span><br><span class=line>            markdown.<span class="title function_">appendCodeblock</span>(variableName, <span class=string>&#x27;mylang&#x27;</span>);</span><br><span class=line>            markdown.<span class="title function_">appendMarkdown</span>(<span class=string>`**变量：** <span class=subst>$&#123;variableName&#125;</span>\n\n`</span>);</span><br><span class=line>            markdown.<span class="title function_">appendMarkdown</span>(<span class=string>`*未找到变量声明*`</span>);</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> markdown;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">isType</span>(<span class=attr>word</span>: <span class=built_in>string</span>): <span class=built_in>boolean</span> &#123;</span><br><span class=line>        <span class=keyword>const</span> types = [<span class=string>&#x27;string&#x27;</span>, <span class=string>&#x27;number&#x27;</span>, <span class=string>&#x27;boolean&#x27;</span>, <span class=string>&#x27;object&#x27;</span>, <span class=string>&#x27;array&#x27;</span>, <span class=string>&#x27;void&#x27;</span>, <span class=string>&#x27;any&#x27;</span>];</span><br><span class=line>        <span class=keyword>return</span> types.<span class="title function_">includes</span>(word);</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">getTypeHover</span>(<span class=attr>typeName</span>: <span class=built_in>string</span>): vscode.<span class=property>MarkdownString</span> &#123;</span><br><span class=line>        <span class=keyword>const</span> <span class=attr>typeDescriptions</span>: <span class="title class_">Record</span>&lt;<span class=built_in>string</span>, <span class=built_in>string</span>&gt; = &#123;</span><br><span class=line>            <span class=string>&#x27;string&#x27;</span>: <span class=string>&#x27;字符串类型 - 表示文本数据&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;number&#x27;</span>: <span class=string>&#x27;数字类型 - 表示整数或浮点数&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;boolean&#x27;</span>: <span class=string>&#x27;布尔类型 - 表示true或false&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;object&#x27;</span>: <span class=string>&#x27;对象类型 - 表示复合数据结构&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;array&#x27;</span>: <span class=string>&#x27;数组类型 - 表示有序的元素集合&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;void&#x27;</span>: <span class=string>&#x27;void类型 - 表示无返回值&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;any&#x27;</span>: <span class=string>&#x27;any类型 - 表示任意类型&#x27;</span></span><br><span class=line>        &#125;;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>const</span> markdown = <span class=keyword>new</span> vscode.<span class="title class_">MarkdownString</span>();</span><br><span class=line>        markdown.<span class="title function_">appendCodeblock</span>(typeName, <span class=string>&#x27;mylang&#x27;</span>);</span><br><span class=line>        markdown.<span class="title function_">appendMarkdown</span>(<span class=string>`**类型：** <span class=subst>$&#123;typeName&#125;</span>\n\n`</span>);</span><br><span class=line>        markdown.<span class="title function_">appendMarkdown</span>(<span class=string>`**描述：** <span class=subst>$&#123;typeDescriptions[typeName]&#125;</span>\n\n`</span>);</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> markdown;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">isBuiltinFunction</span>(<span class=attr>word</span>: <span class=built_in>string</span>): <span class=built_in>boolean</span> &#123;</span><br><span class=line>        <span class=keyword>const</span> builtinFunctions = [<span class=string>&#x27;console&#x27;</span>, <span class=string>&#x27;Math&#x27;</span>, <span class=string>&#x27;String&#x27;</span>, <span class=string>&#x27;Array&#x27;</span>, <span class=string>&#x27;Object&#x27;</span>, <span class=string>&#x27;Date&#x27;</span>];</span><br><span class=line>        <span class=keyword>return</span> builtinFunctions.<span class="title function_">some</span>(<span class=function><span class=params>builtin</span> =&gt;</span> word.<span class="title function_">startsWith</span>(builtin));</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">getBuiltinFunctionHover</span>(<span class=attr>word</span>: <span class=built_in>string</span>): vscode.<span class=property>MarkdownString</span> &#123;</span><br><span class=line>        <span class=keyword>const</span> builtinInfo = <span class="variable language_">this</span>.<span class="title function_">getBuiltinFunctionInfo</span>(word);</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>const</span> markdown = <span class=keyword>new</span> vscode.<span class="title class_">MarkdownString</span>();</span><br><span class=line>        markdown.<span class="title function_">appendCodeblock</span>(word, <span class=string>&#x27;mylang&#x27;</span>);</span><br><span class=line>        markdown.<span class="title function_">appendMarkdown</span>(<span class=string>`**内置对象/方法：** <span class=subst>$&#123;word&#125;</span>\n\n`</span>);</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>if</span> (builtinInfo) &#123;</span><br><span class=line>            markdown.<span class="title function_">appendMarkdown</span>(<span class=string>`**描述：** <span class=subst>$&#123;builtinInfo.description&#125;</span>\n\n`</span>);</span><br><span class=line>            <span class=keyword>if</span> (builtinInfo.<span class=property>params</span>) &#123;</span><br><span class=line>                markdown.<span class="title function_">appendMarkdown</span>(<span class=string>`**参数：** <span class=subst>$&#123;builtinInfo.params&#125;</span>\n\n`</span>);</span><br><span class=line>            &#125;</span><br><span class=line>            <span class=keyword>if</span> (builtinInfo.<span class=property>returnType</span>) &#123;</span><br><span class=line>                markdown.<span class="title function_">appendMarkdown</span>(<span class=string>`**返回值：** <span class=subst>$&#123;builtinInfo.returnType&#125;</span>\n\n`</span>);</span><br><span class=line>            &#125;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> markdown;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">getBuiltinFunctionInfo</span>(<span class=attr>name</span>: <span class=built_in>string</span>): &#123;</span><br><span class=line>        <span class=attr>description</span>: <span class=built_in>string</span>;</span><br><span class=line>        params?: <span class=built_in>string</span>;</span><br><span class=line>        returnType?: <span class=built_in>string</span>;</span><br><span class=line>    &#125; | <span class=literal>undefined</span> &#123;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>const</span> <span class=attr>builtins</span>: <span class="title class_">Record</span>&lt;<span class=built_in>string</span>, <span class=built_in>any</span>&gt; = &#123;</span><br><span class=line>            <span class=string>&#x27;console.log&#x27;</span>: &#123;</span><br><span class=line>                <span class=attr>description</span>: <span class=string>&#x27;在控制台输出信息&#x27;</span>,</span><br><span class=line>                <span class=attr>params</span>: <span class=string>&#x27;message: any&#x27;</span>,</span><br><span class=line>                <span class=attr>returnType</span>: <span class=string>&#x27;void&#x27;</span></span><br><span class=line>            &#125;,</span><br><span class=line>            <span class=string>&#x27;Math.abs&#x27;</span>: &#123;</span><br><span class=line>                <span class=attr>description</span>: <span class=string>&#x27;返回数字的绝对值&#x27;</span>,</span><br><span class=line>                <span class=attr>params</span>: <span class=string>&#x27;x: number&#x27;</span>,</span><br><span class=line>                <span class=attr>returnType</span>: <span class=string>&#x27;number&#x27;</span></span><br><span class=line>            &#125;,</span><br><span class=line>            <span class=string>&#x27;Math.max&#x27;</span>: &#123;</span><br><span class=line>                <span class=attr>description</span>: <span class=string>&#x27;返回最大值&#x27;</span>,</span><br><span class=line>                <span class=attr>params</span>: <span class=string>&#x27;...values: number[]&#x27;</span>,</span><br><span class=line>                <span class=attr>returnType</span>: <span class=string>&#x27;number&#x27;</span></span><br><span class=line>            &#125;,</span><br><span class=line>            <span class=string>&#x27;String.prototype.charAt&#x27;</span>: &#123;</span><br><span class=line>                <span class=attr>description</span>: <span class=string>&#x27;返回指定位置的字符&#x27;</span>,</span><br><span class=line>                <span class=attr>params</span>: <span class=string>&#x27;index: number&#x27;</span>,</span><br><span class=line>                <span class=attr>returnType</span>: <span class=string>&#x27;string&#x27;</span></span><br><span class=line>            &#125;,</span><br><span class=line>            <span class=string>&#x27;Array.prototype.push&#x27;</span>: &#123;</span><br><span class=line>                <span class=attr>description</span>: <span class=string>&#x27;向数组末尾添加元素&#x27;</span>,</span><br><span class=line>                <span class=attr>params</span>: <span class=string>&#x27;...items: any[]&#x27;</span>,</span><br><span class=line>                <span class=attr>returnType</span>: <span class=string>&#x27;number&#x27;</span></span><br><span class=line>            &#125;</span><br><span class=line>        &#125;;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> builtins[name];</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">extractFunctionComment</span>(<span class=attr>text</span>: <span class=built_in>string</span>, <span class=attr>functionIndex</span>: <span class=built_in>number</span>): <span class=built_in>string</span> | <span class=literal>undefined</span> &#123;</span><br><span class=line>        <span class=comment>// 向前查找注释</span></span><br><span class=line>        <span class=keyword>const</span> beforeFunction = text.<span class="title function_">substring</span>(<span class=number>0</span>, functionIndex);</span><br><span class=line>        <span class=keyword>const</span> lines = beforeFunction.<span class="title function_">split</span>(<span class=string>&#x27;\n&#x27;</span>);</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 从函数定义行往前查找注释</span></span><br><span class=line>        <span class=keyword>for</span> (<span class=keyword>let</span> i = lines.<span class=property>length</span> - <span class=number>1</span>; i &gt;= <span class=number>0</span>; i--) &#123;</span><br><span class=line>            <span class=keyword>const</span> line = lines[i].<span class="title function_">trim</span>();</span><br><span class=line>            </span><br><span class=line>            <span class=keyword>if</span> (line.<span class="title function_">startsWith</span>(<span class=string>&#x27;//&#x27;</span>)) &#123;</span><br><span class=line>                <span class=keyword>return</span> line.<span class="title function_">substring</span>(<span class=number>2</span>).<span class="title function_">trim</span>();</span><br><span class=line>            &#125; <span class=keyword>else</span> <span class=keyword>if</span> (line.<span class="title function_">includes</span>(<span class=string>&#x27;/*&#x27;</span>) &amp;&amp; line.<span class="title function_">includes</span>(<span class=string>&#x27;*/&#x27;</span>)) &#123;</span><br><span class=line>                <span class=keyword>const</span> commentMatch = line.<span class="title function_">match</span>(<span class=regexp>/\/\*(.*?)\*\//</span>);</span><br><span class=line>                <span class=keyword>if</span> (commentMatch) &#123;</span><br><span class=line>                    <span class=keyword>return</span> commentMatch[<span class=number>1</span>].<span class="title function_">trim</span>();</span><br><span class=line>                &#125;</span><br><span class=line>            &#125; <span class=keyword>else</span> <span class=keyword>if</span> (line &amp;&amp; !line.<span class="title function_">startsWith</span>(<span class=string>&#x27;//&#x27;</span>) &amp;&amp; !line.<span class="title function_">includes</span>(<span class=string>&#x27;/*&#x27;</span>)) &#123;</span><br><span class=line>                <span class=comment>// 如果遇到非注释的非空行，停止查找</span></span><br><span class=line>                <span class=keyword>break</span>;</span><br><span class=line>            &#125;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> <span class=literal>undefined</span>;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">inferType</span>(<span class=attr>value</span>: <span class=built_in>string</span>): <span class=built_in>string</span> | <span class=literal>undefined</span> &#123;</span><br><span class=line>        value = value.<span class="title function_">trim</span>();</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>if</span> (value.<span class="title function_">startsWith</span>(<span class=string>&#x27;&quot;&#x27;</span>) &amp;&amp; value.<span class="title function_">endsWith</span>(<span class=string>&#x27;&quot;&#x27;</span>)) &#123;</span><br><span class=line>            <span class=keyword>return</span> <span class=string>&#x27;string&#x27;</span>;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>if</span> (value.<span class="title function_">startsWith</span>(<span class=string>&quot;&#x27;&quot;</span>) &amp;&amp; value.<span class="title function_">endsWith</span>(<span class=string>&quot;&#x27;&quot;</span>)) &#123;</span><br><span class=line>            <span class=keyword>return</span> <span class=string>&#x27;string&#x27;</span>;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>if</span> (<span class=regexp>/^\d+$/</span>.<span class="title function_">test</span>(value)) &#123;</span><br><span class=line>            <span class=keyword>return</span> <span class=string>&#x27;number&#x27;</span>;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>if</span> (<span class=regexp>/^\d+\.\d+$/</span>.<span class="title function_">test</span>(value)) &#123;</span><br><span class=line>            <span class=keyword>return</span> <span class=string>&#x27;number&#x27;</span>;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>if</span> (value === <span class=string>&#x27;true&#x27;</span> || value === <span class=string>&#x27;false&#x27;</span>) &#123;</span><br><span class=line>            <span class=keyword>return</span> <span class=string>&#x27;boolean&#x27;</span>;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>if</span> (value.<span class="title function_">startsWith</span>(<span class=string>&#x27;[&#x27;</span>) &amp;&amp; value.<span class="title function_">endsWith</span>(<span class=string>&#x27;]&#x27;</span>)) &#123;</span><br><span class=line>            <span class=keyword>return</span> <span class=string>&#x27;array&#x27;</span>;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>if</span> (value.<span class="title function_">startsWith</span>(<span class=string>&#x27;&#123;&#x27;</span>) &amp;&amp; value.<span class="title function_">endsWith</span>(<span class=string>&#x27;&#125;&#x27;</span>)) &#123;</span><br><span class=line>            <span class=keyword>return</span> <span class=string>&#x27;object&#x27;</span>;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> <span class=literal>undefined</span>;</span><br><span class=line>    &#125;</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><h3 id=2-3-诊断提供者><a href=#2-3-诊断提供者 class=headerlink title="2.3 诊断提供者"></a>2.3 诊断提供者</h3><figure class="highlight typescript"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br><span class=line>90</span><br><span class=line>91</span><br><span class=line>92</span><br><span class=line>93</span><br><span class=line>94</span><br><span class=line>95</span><br><span class=line>96</span><br><span class=line>97</span><br><span class=line>98</span><br><span class=line>99</span><br><span class=line>100</span><br><span class=line>101</span><br><span class=line>102</span><br><span class=line>103</span><br><span class=line>104</span><br><span class=line>105</span><br><span class=line>106</span><br><span class=line>107</span><br><span class=line>108</span><br><span class=line>109</span><br><span class=line>110</span><br><span class=line>111</span><br><span class=line>112</span><br><span class=line>113</span><br><span class=line>114</span><br><span class=line>115</span><br><span class=line>116</span><br><span class=line>117</span><br><span class=line>118</span><br><span class=line>119</span><br><span class=line>120</span><br><span class=line>121</span><br><span class=line>122</span><br><span class=line>123</span><br><span class=line>124</span><br><span class=line>125</span><br><span class=line>126</span><br><span class=line>127</span><br><span class=line>128</span><br><span class=line>129</span><br><span class=line>130</span><br><span class=line>131</span><br><span class=line>132</span><br><span class=line>133</span><br><span class=line>134</span><br><span class=line>135</span><br><span class=line>136</span><br><span class=line>137</span><br><span class=line>138</span><br><span class=line>139</span><br><span class=line>140</span><br><span class=line>141</span><br><span class=line>142</span><br><span class=line>143</span><br><span class=line>144</span><br><span class=line>145</span><br><span class=line>146</span><br><span class=line>147</span><br><span class=line>148</span><br><span class=line>149</span><br><span class=line>150</span><br><span class=line>151</span><br><span class=line>152</span><br><span class=line>153</span><br><span class=line>154</span><br><span class=line>155</span><br><span class=line>156</span><br><span class=line>157</span><br><span class=line>158</span><br><span class=line>159</span><br><span class=line>160</span><br><span class=line>161</span><br><span class=line>162</span><br><span class=line>163</span><br><span class=line>164</span><br><span class=line>165</span><br><span class=line>166</span><br><span class=line>167</span><br><span class=line>168</span><br><span class=line>169</span><br><span class=line>170</span><br><span class=line>171</span><br><span class=line>172</span><br><span class=line>173</span><br><span class=line>174</span><br><span class=line>175</span><br><span class=line>176</span><br><span class=line>177</span><br><span class=line>178</span><br><span class=line>179</span><br><span class=line>180</span><br><span class=line>181</span><br><span class=line>182</span><br><span class=line>183</span><br><span class=line>184</span><br><span class=line>185</span><br><span class=line>186</span><br><span class=line>187</span><br><span class=line>188</span><br><span class=line>189</span><br><span class=line>190</span><br><span class=line>191</span><br><span class=line>192</span><br><span class=line>193</span><br><span class=line>194</span><br><span class=line>195</span><br><span class=line>196</span><br><span class=line>197</span><br><span class=line>198</span><br><span class=line>199</span><br><span class=line>200</span><br><span class=line>201</span><br><span class=line>202</span><br><span class=line>203</span><br><span class=line>204</span><br><span class=line>205</span><br><span class=line>206</span><br><span class=line>207</span><br><span class=line>208</span><br><span class=line>209</span><br><span class=line>210</span><br><span class=line>211</span><br><span class=line>212</span><br><span class=line>213</span><br><span class=line>214</span><br><span class=line>215</span><br><span class=line>216</span><br><span class=line>217</span><br><span class=line>218</span><br><span class=line>219</span><br><span class=line>220</span><br><span class=line>221</span><br><span class=line>222</span><br><span class=line>223</span><br><span class=line>224</span><br><span class=line>225</span><br><span class=line>226</span><br><span class=line>227</span><br><span class=line>228</span><br><span class=line>229</span><br><span class=line>230</span><br><span class=line>231</span><br><span class=line>232</span><br><span class=line>233</span><br><span class=line>234</span><br><span class=line>235</span><br><span class=line>236</span><br><span class=line>237</span><br><span class=line>238</span><br><span class=line>239</span><br><span class=line>240</span><br><span class=line>241</span><br><span class=line>242</span><br><span class=line>243</span><br><span class=line>244</span><br><span class=line>245</span><br><span class=line>246</span><br><span class=line>247</span><br><span class=line>248</span><br><span class=line>249</span><br><span class=line>250</span><br><span class=line>251</span><br><span class=line>252</span><br><span class=line>253</span><br><span class=line>254</span><br><span class=line>255</span><br><span class=line>256</span><br><span class=line>257</span><br><span class=line>258</span><br><span class=line>259</span><br><span class=line>260</span><br><span class=line>261</span><br><span class=line>262</span><br><span class=line>263</span><br><span class=line>264</span><br><span class=line>265</span><br><span class=line>266</span><br><span class=line>267</span><br><span class=line>268</span><br><span class=line>269</span><br><span class=line>270</span><br><span class=line>271</span><br><span class=line>272</span><br><span class=line>273</span><br><span class=line>274</span><br><span class=line>275</span><br><span class=line>276</span><br><span class=line>277</span><br><span class=line>278</span><br><span class=line>279</span><br><span class=line>280</span><br><span class=line>281</span><br><span class=line>282</span><br><span class=line>283</span><br></pre></td><td class=code><pre><span class=line><span class=comment>// src/diagnosticProvider.ts</span></span><br><span class=line><span class=keyword>import</span> * <span class=keyword>as</span> vscode <span class=keyword>from</span> <span class=string>&#x27;vscode&#x27;</span>;</span><br><span class=line></span><br><span class=line><span class=keyword>export</span> <span class=keyword>class</span> <span class="title class_">MyLangDiagnosticProvider</span> &#123;</span><br><span class=line>    <span class=keyword>private</span> <span class=attr>diagnosticCollection</span>: vscode.<span class=property>DiagnosticCollection</span>;</span><br><span class=line>    </span><br><span class=line>    <span class="title function_">constructor</span>(<span class=params></span>) &#123;</span><br><span class=line>        <span class="variable language_">this</span>.<span class=property>diagnosticCollection</span> = vscode.<span class=property>languages</span>.<span class="title function_">createDiagnosticCollection</span>(<span class=string>&#x27;mylang&#x27;</span>);</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>async</span> <span class="title function_">provideDiagnostics</span>(<span class=attr>document</span>: vscode.<span class=property>TextDocument</span>): <span class="title class_">Promise</span>&lt;<span class=built_in>void</span>&gt; &#123;</span><br><span class=line>        <span class=keyword>const</span> <span class=attr>diagnostics</span>: vscode.<span class=property>Diagnostic</span>[] = [];</span><br><span class=line>        <span class=keyword>const</span> text = <span class="variable language_">document</span>.<span class="title function_">getText</span>();</span><br><span class=line>        <span class=keyword>const</span> lines = text.<span class="title function_">split</span>(<span class=string>&#x27;\n&#x27;</span>);</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>for</span> (<span class=keyword>let</span> lineIndex = <span class=number>0</span>; lineIndex &lt; lines.<span class=property>length</span>; lineIndex++) &#123;</span><br><span class=line>            <span class=keyword>const</span> line = lines[lineIndex];</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// 检查语法错误</span></span><br><span class=line>            diagnostics.<span class="title function_">push</span>(...<span class="variable language_">this</span>.<span class="title function_">checkSyntaxErrors</span>(line, lineIndex));</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// 检查未使用的变量</span></span><br><span class=line>            diagnostics.<span class="title function_">push</span>(...<span class="variable language_">this</span>.<span class="title function_">checkUnusedVariables</span>(<span class="variable language_">document</span>, lineIndex));</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// 检查类型错误</span></span><br><span class=line>            diagnostics.<span class="title function_">push</span>(...<span class="variable language_">this</span>.<span class="title function_">checkTypeErrors</span>(line, lineIndex));</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// 检查代码风格问题</span></span><br><span class=line>            diagnostics.<span class="title function_">push</span>(...<span class="variable language_">this</span>.<span class="title function_">checkStyleIssues</span>(line, lineIndex));</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// 检查最佳实践</span></span><br><span class=line>            diagnostics.<span class="title function_">push</span>(...<span class="variable language_">this</span>.<span class="title function_">checkBestPractices</span>(line, lineIndex));</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class="variable language_">this</span>.<span class=property>diagnosticCollection</span>.<span class="title function_">set</span>(<span class="variable language_">document</span>.<span class=property>uri</span>, diagnostics);</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">checkSyntaxErrors</span>(<span class=attr>line</span>: <span class=built_in>string</span>, <span class=attr>lineIndex</span>: <span class=built_in>number</span>): vscode.<span class=property>Diagnostic</span>[] &#123;</span><br><span class=line>        <span class=keyword>const</span> <span class=attr>diagnostics</span>: vscode.<span class=property>Diagnostic</span>[] = [];</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 检查未闭合的括号</span></span><br><span class=line>        <span class=keyword>const</span> openParens = (line.<span class="title function_">match</span>(<span class=regexp>/\(/g</span>) || []).<span class=property>length</span>;</span><br><span class=line>        <span class=keyword>const</span> closeParens = (line.<span class="title function_">match</span>(<span class=regexp>/\)/g</span>) || []).<span class=property>length</span>;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>if</span> (openParens &gt; closeParens) &#123;</span><br><span class=line>            <span class=keyword>const</span> lastOpenParen = line.<span class="title function_">lastIndexOf</span>(<span class=string>&#x27;(&#x27;</span>);</span><br><span class=line>            <span class=keyword>if</span> (lastOpenParen !== -<span class=number>1</span>) &#123;</span><br><span class=line>                <span class=keyword>const</span> diagnostic = <span class=keyword>new</span> vscode.<span class="title class_">Diagnostic</span>(</span><br><span class=line>                    <span class=keyword>new</span> vscode.<span class="title class_">Range</span>(lineIndex, lastOpenParen, lineIndex, lastOpenParen + <span class=number>1</span>),</span><br><span class=line>                    <span class=string>&#x27;缺少闭合括号&#x27;</span>,</span><br><span class=line>                    vscode.<span class=property>DiagnosticSeverity</span>.<span class=property>Error</span></span><br><span class=line>                );</span><br><span class=line>                diagnostic.<span class=property>code</span> = <span class=string>&#x27;missing-close-paren&#x27;</span>;</span><br><span class=line>                diagnostic.<span class=property>source</span> = <span class=string>&#x27;mylang&#x27;</span>;</span><br><span class=line>                diagnostics.<span class="title function_">push</span>(diagnostic);</span><br><span class=line>            &#125;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 检查未闭合的大括号</span></span><br><span class=line>        <span class=keyword>const</span> openBraces = (line.<span class="title function_">match</span>(<span class=regexp>/\&#123;/g</span>) || []).<span class=property>length</span>;</span><br><span class=line>        <span class=keyword>const</span> closeBraces = (line.<span class="title function_">match</span>(<span class=regexp>/\&#125;/g</span>) || []).<span class=property>length</span>;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>if</span> (openBraces &gt; closeBraces &amp;&amp; !line.<span class="title function_">trim</span>().<span class="title function_">endsWith</span>(<span class=string>&#x27;&#123;&#x27;</span>)) &#123;</span><br><span class=line>            <span class=keyword>const</span> lastOpenBrace = line.<span class="title function_">lastIndexOf</span>(<span class=string>&#x27;&#123;&#x27;</span>);</span><br><span class=line>            <span class=keyword>if</span> (lastOpenBrace !== -<span class=number>1</span>) &#123;</span><br><span class=line>                <span class=keyword>const</span> diagnostic = <span class=keyword>new</span> vscode.<span class="title class_">Diagnostic</span>(</span><br><span class=line>                    <span class=keyword>new</span> vscode.<span class="title class_">Range</span>(lineIndex, lastOpenBrace, lineIndex, lastOpenBrace + <span class=number>1</span>),</span><br><span class=line>                    <span class=string>&#x27;缺少闭合大括号&#x27;</span>,</span><br><span class=line>                    vscode.<span class=property>DiagnosticSeverity</span>.<span class=property>Error</span></span><br><span class=line>                );</span><br><span class=line>                diagnostic.<span class=property>code</span> = <span class=string>&#x27;missing-close-brace&#x27;</span>;</span><br><span class=line>                diagnostic.<span class=property>source</span> = <span class=string>&#x27;mylang&#x27;</span>;</span><br><span class=line>                diagnostics.<span class="title function_">push</span>(diagnostic);</span><br><span class=line>            &#125;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 检查未终止的字符串</span></span><br><span class=line>        <span class=keyword>const</span> quotes = (line.<span class="title function_">match</span>(<span class=regexp>/&quot;/g</span>) || []).<span class=property>length</span>;</span><br><span class=line>        <span class=keyword>if</span> (quotes % <span class=number>2</span> === <span class=number>1</span> &amp;&amp; !line.<span class="title function_">trim</span>().<span class="title function_">endsWith</span>(<span class=string>&#x27;\\&#x27;</span>)) &#123;</span><br><span class=line>            <span class=keyword>const</span> lastQuote = line.<span class="title function_">lastIndexOf</span>(<span class=string>&#x27;&quot;&#x27;</span>);</span><br><span class=line>            <span class=keyword>const</span> diagnostic = <span class=keyword>new</span> vscode.<span class="title class_">Diagnostic</span>(</span><br><span class=line>                <span class=keyword>new</span> vscode.<span class="title class_">Range</span>(lineIndex, lastQuote, lineIndex, line.<span class=property>length</span>),</span><br><span class=line>                <span class=string>&#x27;未终止的字符串&#x27;</span>,</span><br><span class=line>                vscode.<span class=property>DiagnosticSeverity</span>.<span class=property>Error</span></span><br><span class=line>            );</span><br><span class=line>            diagnostic.<span class=property>code</span> = <span class=string>&#x27;unterminated-string&#x27;</span>;</span><br><span class=line>            diagnostic.<span class=property>source</span> = <span class=string>&#x27;mylang&#x27;</span>;</span><br><span class=line>            diagnostics.<span class="title function_">push</span>(diagnostic);</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 检查无效的关键字使用</span></span><br><span class=line>        <span class=keyword>const</span> invalidKeywordUsage = <span class=regexp>/\b(function|class|interface)\s*\(/g</span>;</span><br><span class=line>        <span class=keyword>let</span> match;</span><br><span class=line>        <span class=keyword>while</span> ((match = invalidKeywordUsage.<span class="title function_">exec</span>(line)) !== <span class=literal>null</span>) &#123;</span><br><span class=line>            <span class=keyword>const</span> diagnostic = <span class=keyword>new</span> vscode.<span class="title class_">Diagnostic</span>(</span><br><span class=line>                <span class=keyword>new</span> vscode.<span class="title class_">Range</span>(lineIndex, match.<span class=property>index</span>, lineIndex, match.<span class=property>index</span> + match[<span class=number>0</span>].<span class=property>length</span>),</span><br><span class=line>                <span class=string>`关键字 <span class=subst>$&#123;match[<span class=number>1</span>]&#125;</span> 使用错误`</span>,</span><br><span class=line>                vscode.<span class=property>DiagnosticSeverity</span>.<span class=property>Error</span></span><br><span class=line>            );</span><br><span class=line>            diagnostic.<span class=property>code</span> = <span class=string>&#x27;invalid-keyword-usage&#x27;</span>;</span><br><span class=line>            diagnostic.<span class=property>source</span> = <span class=string>&#x27;mylang&#x27;</span>;</span><br><span class=line>            diagnostics.<span class="title function_">push</span>(diagnostic);</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> diagnostics;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">checkUnusedVariables</span>(<span class=attr>document</span>: vscode.<span class=property>TextDocument</span>, <span class=attr>lineIndex</span>: <span class=built_in>number</span>): vscode.<span class=property>Diagnostic</span>[] &#123;</span><br><span class=line>        <span class=keyword>const</span> <span class=attr>diagnostics</span>: vscode.<span class=property>Diagnostic</span>[] = [];</span><br><span class=line>        <span class=keyword>const</span> line = <span class="variable language_">document</span>.<span class="title function_">lineAt</span>(lineIndex).<span class=property>text</span>;</span><br><span class=line>        <span class=keyword>const</span> text = <span class="variable language_">document</span>.<span class="title function_">getText</span>();</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 查找变量声明</span></span><br><span class=line>        <span class=keyword>const</span> variableDeclaration = <span class=regexp>/(var|let|const)\s+(\w+)/g</span>;</span><br><span class=line>        <span class=keyword>let</span> match;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>while</span> ((match = variableDeclaration.<span class="title function_">exec</span>(line)) !== <span class=literal>null</span>) &#123;</span><br><span class=line>            <span class=keyword>const</span> [, , variableName] = match;</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// 检查变量是否在其他地方被使用</span></span><br><span class=line>            <span class=keyword>const</span> usagePattern = <span class=keyword>new</span> <span class="title class_">RegExp</span>(<span class=string>`\\b<span class=subst>$&#123;variableName&#125;</span>\\b`</span>, <span class=string>&#x27;g&#x27;</span>);</span><br><span class=line>            <span class=keyword>const</span> allMatches = <span class="title class_">Array</span>.<span class="title function_">from</span>(text.<span class="title function_">matchAll</span>(usagePattern));</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// 如果只有一个匹配（就是声明本身），则认为未使用</span></span><br><span class=line>            <span class=keyword>if</span> (allMatches.<span class=property>length</span> === <span class=number>1</span>) &#123;</span><br><span class=line>                <span class=keyword>const</span> startPos = match.<span class=property>index</span> + match[<span class=number>0</span>].<span class="title function_">indexOf</span>(variableName);</span><br><span class=line>                <span class=keyword>const</span> diagnostic = <span class=keyword>new</span> vscode.<span class="title class_">Diagnostic</span>(</span><br><span class=line>                    <span class=keyword>new</span> vscode.<span class="title class_">Range</span>(lineIndex, startPos, lineIndex, startPos + variableName.<span class=property>length</span>),</span><br><span class=line>                    <span class=string>`变量 &#x27;<span class=subst>$&#123;variableName&#125;</span>&#x27; 已声明但未使用`</span>,</span><br><span class=line>                    vscode.<span class=property>DiagnosticSeverity</span>.<span class=property>Warning</span></span><br><span class=line>                );</span><br><span class=line>                diagnostic.<span class=property>code</span> = <span class=string>&#x27;unused-variable&#x27;</span>;</span><br><span class=line>                diagnostic.<span class=property>source</span> = <span class=string>&#x27;mylang&#x27;</span>;</span><br><span class=line>                diagnostic.<span class=property>tags</span> = [vscode.<span class=property>DiagnosticTag</span>.<span class=property>Unnecessary</span>];</span><br><span class=line>                diagnostics.<span class="title function_">push</span>(diagnostic);</span><br><span class=line>            &#125;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> diagnostics;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">checkTypeErrors</span>(<span class=attr>line</span>: <span class=built_in>string</span>, <span class=attr>lineIndex</span>: <span class=built_in>number</span>): vscode.<span class=property>Diagnostic</span>[] &#123;</span><br><span class=line>        <span class=keyword>const</span> <span class=attr>diagnostics</span>: vscode.<span class=property>Diagnostic</span>[] = [];</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 检查类型不匹配（简化版）</span></span><br><span class=line>        <span class=keyword>const</span> numberAssignment = <span class=regexp>/(\w+)\s*=\s*&quot;[^&quot;]*&quot;/g</span>;</span><br><span class=line>        <span class=keyword>let</span> match;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>while</span> ((match = numberAssignment.<span class="title function_">exec</span>(line)) !== <span class=literal>null</span>) &#123;</span><br><span class=line>            <span class=comment>// 假设变量名包含 &#x27;num&#x27; 或 &#x27;count&#x27; 意味着应该是数字</span></span><br><span class=line>            <span class=keyword>const</span> variableName = match[<span class=number>1</span>];</span><br><span class=line>            <span class=keyword>if</span> (variableName.<span class="title function_">includes</span>(<span class=string>&#x27;num&#x27;</span>) || variableName.<span class="title function_">includes</span>(<span class=string>&#x27;count&#x27;</span>) || variableName.<span class="title function_">includes</span>(<span class=string>&#x27;index&#x27;</span>)) &#123;</span><br><span class=line>                <span class=keyword>const</span> diagnostic = <span class=keyword>new</span> vscode.<span class="title class_">Diagnostic</span>(</span><br><span class=line>                    <span class=keyword>new</span> vscode.<span class="title class_">Range</span>(lineIndex, match.<span class=property>index</span>, lineIndex, match.<span class=property>index</span> + match[<span class=number>0</span>].<span class=property>length</span>),</span><br><span class=line>                    <span class=string>`可能的类型错误：将字符串赋值给数字变量 &#x27;<span class=subst>$&#123;variableName&#125;</span>&#x27;`</span>,</span><br><span class=line>                    vscode.<span class=property>DiagnosticSeverity</span>.<span class=property>Warning</span></span><br><span class=line>                );</span><br><span class=line>                diagnostic.<span class=property>code</span> = <span class=string>&#x27;type-mismatch&#x27;</span>;</span><br><span class=line>                diagnostic.<span class=property>source</span> = <span class=string>&#x27;mylang&#x27;</span>;</span><br><span class=line>                diagnostics.<span class="title function_">push</span>(diagnostic);</span><br><span class=line>            &#125;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> diagnostics;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">checkStyleIssues</span>(<span class=attr>line</span>: <span class=built_in>string</span>, <span class=attr>lineIndex</span>: <span class=built_in>number</span>): vscode.<span class=property>Diagnostic</span>[] &#123;</span><br><span class=line>        <span class=keyword>const</span> <span class=attr>diagnostics</span>: vscode.<span class=property>Diagnostic</span>[] = [];</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 检查缩进问题</span></span><br><span class=line>        <span class=keyword>if</span> (line.<span class="title function_">match</span>(<span class=regexp>/^\s*\t/</span>)) &#123;</span><br><span class=line>            <span class=keyword>const</span> diagnostic = <span class=keyword>new</span> vscode.<span class="title class_">Diagnostic</span>(</span><br><span class=line>                <span class=keyword>new</span> vscode.<span class="title class_">Range</span>(lineIndex, <span class=number>0</span>, lineIndex, line.<span class="title function_">search</span>(<span class=regexp>/[^\s]/</span>)),</span><br><span class=line>                <span class=string>&#x27;建议使用空格而不是制表符进行缩进&#x27;</span>,</span><br><span class=line>                vscode.<span class=property>DiagnosticSeverity</span>.<span class=property>Information</span></span><br><span class=line>            );</span><br><span class=line>            diagnostic.<span class=property>code</span> = <span class=string>&#x27;tab-indentation&#x27;</span>;</span><br><span class=line>            diagnostic.<span class=property>source</span> = <span class=string>&#x27;mylang&#x27;</span>;</span><br><span class=line>            diagnostics.<span class="title function_">push</span>(diagnostic);</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 检查行尾空格</span></span><br><span class=line>        <span class=keyword>if</span> (line.<span class="title function_">match</span>(<span class=regexp>/\s+$/</span>)) &#123;</span><br><span class=line>            <span class=keyword>const</span> trimmedLength = line.<span class="title function_">trimEnd</span>().<span class=property>length</span>;</span><br><span class=line>            <span class=keyword>const</span> diagnostic = <span class=keyword>new</span> vscode.<span class="title class_">Diagnostic</span>(</span><br><span class=line>                <span class=keyword>new</span> vscode.<span class="title class_">Range</span>(lineIndex, trimmedLength, lineIndex, line.<span class=property>length</span>),</span><br><span class=line>                <span class=string>&#x27;行尾有多余的空格&#x27;</span>,</span><br><span class=line>                vscode.<span class=property>DiagnosticSeverity</span>.<span class=property>Information</span></span><br><span class=line>            );</span><br><span class=line>            diagnostic.<span class=property>code</span> = <span class=string>&#x27;trailing-whitespace&#x27;</span>;</span><br><span class=line>            diagnostic.<span class=property>source</span> = <span class=string>&#x27;mylang&#x27;</span>;</span><br><span class=line>            diagnostic.<span class=property>tags</span> = [vscode.<span class=property>DiagnosticTag</span>.<span class=property>Unnecessary</span>];</span><br><span class=line>            diagnostics.<span class="title function_">push</span>(diagnostic);</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 检查过长的行</span></span><br><span class=line>        <span class=keyword>if</span> (line.<span class=property>length</span> &gt; <span class=number>100</span>) &#123;</span><br><span class=line>            <span class=keyword>const</span> diagnostic = <span class=keyword>new</span> vscode.<span class="title class_">Diagnostic</span>(</span><br><span class=line>                <span class=keyword>new</span> vscode.<span class="title class_">Range</span>(lineIndex, <span class=number>100</span>, lineIndex, line.<span class=property>length</span>),</span><br><span class=line>                <span class=string>&#x27;行过长，建议不超过100个字符&#x27;</span>,</span><br><span class=line>                vscode.<span class=property>DiagnosticSeverity</span>.<span class=property>Information</span></span><br><span class=line>            );</span><br><span class=line>            diagnostic.<span class=property>code</span> = <span class=string>&#x27;line-too-long&#x27;</span>;</span><br><span class=line>            diagnostic.<span class=property>source</span> = <span class=string>&#x27;mylang&#x27;</span>;</span><br><span class=line>            diagnostics.<span class="title function_">push</span>(diagnostic);</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 检查命名约定</span></span><br><span class=line>        <span class=keyword>const</span> variableDeclaration = <span class=regexp>/(var|let|const)\s+([A-Z]\w*)/g</span>;</span><br><span class=line>        <span class=keyword>let</span> match;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>while</span> ((match = variableDeclaration.<span class="title function_">exec</span>(line)) !== <span class=literal>null</span>) &#123;</span><br><span class=line>            <span class=keyword>const</span> variableName = match[<span class=number>2</span>];</span><br><span class=line>            <span class=keyword>const</span> startPos = match.<span class=property>index</span> + match[<span class=number>0</span>].<span class="title function_">indexOf</span>(variableName);</span><br><span class=line>            </span><br><span class=line>            <span class=keyword>const</span> diagnostic = <span class=keyword>new</span> vscode.<span class="title class_">Diagnostic</span>(</span><br><span class=line>                <span class=keyword>new</span> vscode.<span class="title class_">Range</span>(lineIndex, startPos, lineIndex, startPos + variableName.<span class=property>length</span>),</span><br><span class=line>                <span class=string>`变量名 &#x27;<span class=subst>$&#123;variableName&#125;</span>&#x27; 应该使用驼峰命名法`</span>,</span><br><span class=line>                vscode.<span class=property>DiagnosticSeverity</span>.<span class=property>Information</span></span><br><span class=line>            );</span><br><span class=line>            diagnostic.<span class=property>code</span> = <span class=string>&#x27;naming-convention&#x27;</span>;</span><br><span class=line>            diagnostic.<span class=property>source</span> = <span class=string>&#x27;mylang&#x27;</span>;</span><br><span class=line>            diagnostics.<span class="title function_">push</span>(diagnostic);</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> diagnostics;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">checkBestPractices</span>(<span class=attr>line</span>: <span class=built_in>string</span>, <span class=attr>lineIndex</span>: <span class=built_in>number</span>): vscode.<span class=property>Diagnostic</span>[] &#123;</span><br><span class=line>        <span class=keyword>const</span> <span class=attr>diagnostics</span>: vscode.<span class=property>Diagnostic</span>[] = [];</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 检查console.log的使用</span></span><br><span class=line>        <span class=keyword>if</span> (line.<span class="title function_">includes</span>(<span class=string>&#x27;console.log&#x27;</span>)) &#123;</span><br><span class=line>            <span class=keyword>const</span> index = line.<span class="title function_">indexOf</span>(<span class=string>&#x27;console.log&#x27;</span>);</span><br><span class=line>            <span class=keyword>const</span> diagnostic = <span class=keyword>new</span> vscode.<span class="title class_">Diagnostic</span>(</span><br><span class=line>                <span class=keyword>new</span> vscode.<span class="title class_">Range</span>(lineIndex, index, lineIndex, index + <span class=string>&#x27;console.log&#x27;</span>.<span class=property>length</span>),</span><br><span class=line>                <span class=string>&#x27;生产代码中应避免使用console.log&#x27;</span>,</span><br><span class=line>                vscode.<span class=property>DiagnosticSeverity</span>.<span class=property>Information</span></span><br><span class=line>            );</span><br><span class=line>            diagnostic.<span class=property>code</span> = <span class=string>&#x27;console-log-usage&#x27;</span>;</span><br><span class=line>            diagnostic.<span class=property>source</span> = <span class=string>&#x27;mylang&#x27;</span>;</span><br><span class=line>            diagnostics.<span class="title function_">push</span>(diagnostic);</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 检查var的使用</span></span><br><span class=line>        <span class=keyword>if</span> (line.<span class="title function_">includes</span>(<span class=string>&#x27;var &#x27;</span>)) &#123;</span><br><span class=line>            <span class=keyword>const</span> index = line.<span class="title function_">indexOf</span>(<span class=string>&#x27;var &#x27;</span>);</span><br><span class=line>            <span class=keyword>const</span> diagnostic = <span class=keyword>new</span> vscode.<span class="title class_">Diagnostic</span>(</span><br><span class=line>                <span class=keyword>new</span> vscode.<span class="title class_">Range</span>(lineIndex, index, lineIndex, index + <span class=number>3</span>),</span><br><span class=line>                <span class=string>&#x27;建议使用let或const替代var&#x27;</span>,</span><br><span class=line>                vscode.<span class=property>DiagnosticSeverity</span>.<span class=property>Information</span></span><br><span class=line>            );</span><br><span class=line>            diagnostic.<span class=property>code</span> = <span class=string>&#x27;var-usage&#x27;</span>;</span><br><span class=line>            diagnostic.<span class=property>source</span> = <span class=string>&#x27;mylang&#x27;</span>;</span><br><span class=line>            diagnostics.<span class="title function_">push</span>(diagnostic);</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 检查魔法数字</span></span><br><span class=line>        <span class=keyword>const</span> magicNumbers = <span class=regexp>/\b\d&#123;2,&#125;\b/g</span>;</span><br><span class=line>        <span class=keyword>let</span> match;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>while</span> ((match = magicNumbers.<span class="title function_">exec</span>(line)) !== <span class=literal>null</span>) &#123;</span><br><span class=line>            <span class=keyword>const</span> <span class=built_in>number</span> = match[<span class=number>0</span>];</span><br><span class=line>            <span class=comment>// 排除常见的非魔法数字</span></span><br><span class=line>            <span class=keyword>if</span> (![<span class=string>&#x27;100&#x27;</span>, <span class=string>&#x27;200&#x27;</span>, <span class=string>&#x27;404&#x27;</span>, <span class=string>&#x27;500&#x27;</span>].<span class="title function_">includes</span>(<span class=built_in>number</span>)) &#123;</span><br><span class=line>                <span class=keyword>const</span> diagnostic = <span class=keyword>new</span> vscode.<span class="title class_">Diagnostic</span>(</span><br><span class=line>                    <span class=keyword>new</span> vscode.<span class="title class_">Range</span>(lineIndex, match.<span class=property>index</span>, lineIndex, match.<span class=property>index</span> + <span class=built_in>number</span>.<span class=property>length</span>),</span><br><span class=line>                    <span class=string>`考虑将魔法数字 <span class=subst>$&#123;<span class=built_in>number</span>&#125;</span> 定义为常量`</span>,</span><br><span class=line>                    vscode.<span class=property>DiagnosticSeverity</span>.<span class=property>Information</span></span><br><span class=line>                );</span><br><span class=line>                diagnostic.<span class=property>code</span> = <span class=string>&#x27;magic-number&#x27;</span>;</span><br><span class=line>                diagnostic.<span class=property>source</span> = <span class=string>&#x27;mylang&#x27;</span>;</span><br><span class=line>                diagnostics.<span class="title function_">push</span>(diagnostic);</span><br><span class=line>            &#125;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> diagnostics;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class="title function_">dispose</span>(): <span class=built_in>void</span> &#123;</span><br><span class=line>        <span class="variable language_">this</span>.<span class=property>diagnosticCollection</span>.<span class="title function_">dispose</span>();</span><br><span class=line>    &#125;</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><hr><h2 id=🌐-第三部分：Language-Server-Protocol-LSP><a href=#🌐-第三部分：Language-Server-Protocol-LSP class=headerlink title="🌐 第三部分：Language Server Protocol (LSP)"></a>🌐 第三部分：Language Server Protocol (LSP)</h2><h3 id=3-1-LSP客户端开发><a href=#3-1-LSP客户端开发 class=headerlink title="3.1 LSP客户端开发"></a>3.1 LSP客户端开发</h3><figure class="highlight typescript"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br><span class=line>90</span><br><span class=line>91</span><br><span class=line>92</span><br><span class=line>93</span><br><span class=line>94</span><br><span class=line>95</span><br><span class=line>96</span><br><span class=line>97</span><br><span class=line>98</span><br><span class=line>99</span><br><span class=line>100</span><br><span class=line>101</span><br><span class=line>102</span><br><span class=line>103</span><br><span class=line>104</span><br><span class=line>105</span><br><span class=line>106</span><br><span class=line>107</span><br><span class=line>108</span><br><span class=line>109</span><br><span class=line>110</span><br><span class=line>111</span><br><span class=line>112</span><br><span class=line>113</span><br><span class=line>114</span><br><span class=line>115</span><br><span class=line>116</span><br><span class=line>117</span><br><span class=line>118</span><br><span class=line>119</span><br><span class=line>120</span><br><span class=line>121</span><br><span class=line>122</span><br><span class=line>123</span><br><span class=line>124</span><br><span class=line>125</span><br><span class=line>126</span><br><span class=line>127</span><br><span class=line>128</span><br><span class=line>129</span><br><span class=line>130</span><br><span class=line>131</span><br><span class=line>132</span><br><span class=line>133</span><br><span class=line>134</span><br><span class=line>135</span><br><span class=line>136</span><br><span class=line>137</span><br><span class=line>138</span><br><span class=line>139</span><br><span class=line>140</span><br><span class=line>141</span><br><span class=line>142</span><br><span class=line>143</span><br><span class=line>144</span><br><span class=line>145</span><br><span class=line>146</span><br><span class=line>147</span><br><span class=line>148</span><br><span class=line>149</span><br><span class=line>150</span><br><span class=line>151</span><br><span class=line>152</span><br><span class=line>153</span><br><span class=line>154</span><br><span class=line>155</span><br><span class=line>156</span><br><span class=line>157</span><br><span class=line>158</span><br><span class=line>159</span><br><span class=line>160</span><br><span class=line>161</span><br><span class=line>162</span><br><span class=line>163</span><br><span class=line>164</span><br><span class=line>165</span><br><span class=line>166</span><br><span class=line>167</span><br><span class=line>168</span><br><span class=line>169</span><br></pre></td><td class=code><pre><span class=line><span class=comment>// src/languageClient.ts</span></span><br><span class=line><span class=keyword>import</span> * <span class=keyword>as</span> vscode <span class=keyword>from</span> <span class=string>&#x27;vscode&#x27;</span>;</span><br><span class=line><span class=keyword>import</span> &#123;</span><br><span class=line>    <span class="title class_">LanguageClient</span>,</span><br><span class=line>    <span class="title class_">LanguageClientOptions</span>,</span><br><span class=line>    <span class="title class_">ServerOptions</span>,</span><br><span class=line>    <span class="title class_">TransportKind</span>,</span><br><span class=line>    <span class="title class_">RevealOutputChannelOn</span></span><br><span class=line>&#125; <span class=keyword>from</span> <span class=string>&#x27;vscode-languageclient/node&#x27;</span>;</span><br><span class=line></span><br><span class=line><span class=keyword>export</span> <span class=keyword>class</span> <span class="title class_">MyLangLanguageClient</span> &#123;</span><br><span class=line>    <span class=keyword>private</span> <span class=attr>client</span>: <span class="title class_">LanguageClient</span> | <span class=literal>undefined</span>;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>async</span> <span class="title function_">activate</span>(<span class=attr>context</span>: vscode.<span class=property>ExtensionContext</span>): <span class="title class_">Promise</span>&lt;<span class=built_in>void</span>&gt; &#123;</span><br><span class=line>        <span class=comment>// Language Server的可执行文件路径</span></span><br><span class=line>        <span class=keyword>const</span> serverModule = context.<span class="title function_">asAbsolutePath</span>(<span class=string>&#x27;out/server/server.js&#x27;</span>);</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 调试选项</span></span><br><span class=line>        <span class=keyword>const</span> debugOptions = &#123; <span class=attr>execArgv</span>: [<span class=string>&#x27;--nolazy&#x27;</span>, <span class=string>&#x27;--inspect=6009&#x27;</span>] &#125;;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 服务器选项</span></span><br><span class=line>        <span class=keyword>const</span> <span class=attr>serverOptions</span>: <span class="title class_">ServerOptions</span> = &#123;</span><br><span class=line>            <span class=attr>run</span>: &#123; <span class=attr>module</span>: serverModule, <span class=attr>transport</span>: <span class="title class_">TransportKind</span>.<span class=property>ipc</span> &#125;,</span><br><span class=line>            <span class=attr>debug</span>: &#123;</span><br><span class=line>                <span class=attr>module</span>: serverModule,</span><br><span class=line>                <span class=attr>transport</span>: <span class="title class_">TransportKind</span>.<span class=property>ipc</span>,</span><br><span class=line>                <span class=attr>options</span>: debugOptions</span><br><span class=line>            &#125;</span><br><span class=line>        &#125;;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 客户端选项</span></span><br><span class=line>        <span class=keyword>const</span> <span class=attr>clientOptions</span>: <span class="title class_">LanguageClientOptions</span> = &#123;</span><br><span class=line>            <span class=comment>// 注册要处理的文档选择器</span></span><br><span class=line>            <span class=attr>documentSelector</span>: [</span><br><span class=line>                &#123; <span class=attr>scheme</span>: <span class=string>&#x27;file&#x27;</span>, <span class=attr>language</span>: <span class=string>&#x27;mylang&#x27;</span> &#125;,</span><br><span class=line>                &#123; <span class=attr>scheme</span>: <span class=string>&#x27;untitled&#x27;</span>, <span class=attr>language</span>: <span class=string>&#x27;mylang&#x27;</span> &#125;</span><br><span class=line>            ],</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// 同步配置</span></span><br><span class=line>            <span class=attr>synchronize</span>: &#123;</span><br><span class=line>                <span class=comment>// 监听配置变化</span></span><br><span class=line>                <span class=attr>configurationSection</span>: <span class=string>&#x27;mylang&#x27;</span>,</span><br><span class=line>                <span class=comment>// 监听文件变化</span></span><br><span class=line>                <span class=attr>fileEvents</span>: vscode.<span class=property>workspace</span>.<span class="title function_">createFileSystemWatcher</span>(<span class=string>&#x27;**/.mylangrc&#x27;</span>)</span><br><span class=line>            &#125;,</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// 输出通道</span></span><br><span class=line>            <span class=attr>outputChannelName</span>: <span class=string>&#x27;MyLang Language Server&#x27;</span>,</span><br><span class=line>            <span class=attr>revealOutputChannelOn</span>: <span class="title class_">RevealOutputChannelOn</span>.<span class=property>Never</span>,</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// 错误处理</span></span><br><span class=line>            <span class=attr>errorHandler</span>: &#123;</span><br><span class=line>                <span class=attr>error</span>: <span class=function>(<span class=params>error, message, count</span>) =&gt;</span> &#123;</span><br><span class=line>                    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class=string>&#x27;Language server error:&#x27;</span>, error, message, count);</span><br><span class=line>                    <span class=keyword>return</span> &#123; <span class=attr>action</span>: vscode.<span class=property>languages</span>.<span class=property>ErrorAction</span>.<span class=property>Continue</span> &#125;;</span><br><span class=line>                &#125;,</span><br><span class=line>                <span class=attr>closed</span>: <span class=function>() =&gt;</span> &#123;</span><br><span class=line>                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class=string>&#x27;Language server connection closed&#x27;</span>);</span><br><span class=line>                    <span class=keyword>return</span> &#123; <span class=attr>action</span>: vscode.<span class=property>languages</span>.<span class=property>CloseAction</span>.<span class=property>Restart</span> &#125;;</span><br><span class=line>                &#125;</span><br><span class=line>            &#125;,</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// 初始化选项</span></span><br><span class=line>            <span class=attr>initializationOptions</span>: &#123;</span><br><span class=line>                <span class=attr>settings</span>: vscode.<span class=property>workspace</span>.<span class="title function_">getConfiguration</span>(<span class=string>&#x27;mylang&#x27;</span>)</span><br><span class=line>            &#125;,</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// 工作区文件夹</span></span><br><span class=line>            <span class=attr>workspaceFolder</span>: vscode.<span class=property>workspace</span>.<span class=property>workspaceFolders</span>?.[<span class=number>0</span>]</span><br><span class=line>        &#125;;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 创建Language Client</span></span><br><span class=line>        <span class="variable language_">this</span>.<span class=property>client</span> = <span class=keyword>new</span> <span class="title class_">LanguageClient</span>(</span><br><span class=line>            <span class=string>&#x27;mylang-language-server&#x27;</span>,</span><br><span class=line>            <span class=string>&#x27;MyLang Language Server&#x27;</span>,</span><br><span class=line>            serverOptions,</span><br><span class=line>            clientOptions</span><br><span class=line>        );</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 注册自定义通知和请求处理器</span></span><br><span class=line>        <span class="variable language_">this</span>.<span class="title function_">registerCustomHandlers</span>();</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 启动客户端</span></span><br><span class=line>        <span class=keyword>await</span> <span class="variable language_">this</span>.<span class=property>client</span>.<span class="title function_">start</span>();</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 注册客户端命令</span></span><br><span class=line>        <span class="variable language_">this</span>.<span class="title function_">registerCommands</span>(context);</span><br><span class=line>        </span><br><span class=line>        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class=string>&#x27;MyLang Language Server启动成功&#x27;</span>);</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">registerCustomHandlers</span>(): <span class=built_in>void</span> &#123;</span><br><span class=line>        <span class=keyword>if</span> (!<span class="variable language_">this</span>.<span class=property>client</span>) <span class=keyword>return</span>;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 注册自定义通知处理器</span></span><br><span class=line>        <span class="variable language_">this</span>.<span class=property>client</span>.<span class="title function_">onNotification</span>(<span class=string>&#x27;mylang/status&#x27;</span>, <span class=function>(<span class=params>params: <span class=built_in>any</span></span>) =&gt;</span> &#123;</span><br><span class=line>            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class=string>&#x27;Language Server状态:&#x27;</span>, params);</span><br><span class=line>            vscode.<span class=property>window</span>.<span class="title function_">showInformationMessage</span>(<span class=string>`Language Server: <span class=subst>$&#123;params.message&#125;</span>`</span>);</span><br><span class=line>        &#125;);</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 注册自定义请求处理器</span></span><br><span class=line>        <span class="variable language_">this</span>.<span class=property>client</span>.<span class="title function_">onRequest</span>(<span class=string>&#x27;mylang/getWorkspaceInfo&#x27;</span>, <span class=keyword>async</span> () =&gt; &#123;</span><br><span class=line>            <span class=keyword>const</span> workspaceFolders = vscode.<span class=property>workspace</span>.<span class=property>workspaceFolders</span>;</span><br><span class=line>            <span class=keyword>return</span> &#123;</span><br><span class=line>                <span class=attr>folders</span>: workspaceFolders?.<span class="title function_">map</span>(<span class=function><span class=params>folder</span> =&gt;</span> (&#123;</span><br><span class=line>                    <span class=attr>name</span>: folder.<span class=property>name</span>,</span><br><span class=line>                    <span class=attr>uri</span>: folder.<span class=property>uri</span>.<span class="title function_">toString</span>()</span><br><span class=line>                &#125;)) || [],</span><br><span class=line>                <span class=attr>configuration</span>: vscode.<span class=property>workspace</span>.<span class="title function_">getConfiguration</span>(<span class=string>&#x27;mylang&#x27;</span>)</span><br><span class=line>            &#125;;</span><br><span class=line>        &#125;);</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>private</span> <span class="title function_">registerCommands</span>(<span class=attr>context</span>: vscode.<span class=property>ExtensionContext</span>): <span class=built_in>void</span> &#123;</span><br><span class=line>        <span class=comment>// 重启Language Server命令</span></span><br><span class=line>        <span class=keyword>const</span> restartCommand = vscode.<span class=property>commands</span>.<span class="title function_">registerCommand</span>(<span class=string>&#x27;mylang.restartServer&#x27;</span>, <span class=keyword>async</span> () =&gt; &#123;</span><br><span class=line>            <span class=keyword>if</span> (<span class="variable language_">this</span>.<span class=property>client</span>) &#123;</span><br><span class=line>                <span class=keyword>await</span> <span class="variable language_">this</span>.<span class=property>client</span>.<span class="title function_">stop</span>();</span><br><span class=line>                <span class=keyword>await</span> <span class="variable language_">this</span>.<span class=property>client</span>.<span class="title function_">start</span>();</span><br><span class=line>                vscode.<span class=property>window</span>.<span class="title function_">showInformationMessage</span>(<span class=string>&#x27;MyLang Language Server已重启&#x27;</span>);</span><br><span class=line>            &#125;</span><br><span class=line>        &#125;);</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 显示服务器状态命令</span></span><br><span class=line>        <span class=keyword>const</span> statusCommand = vscode.<span class=property>commands</span>.<span class="title function_">registerCommand</span>(<span class=string>&#x27;mylang.showServerStatus&#x27;</span>, <span class=keyword>async</span> () =&gt; &#123;</span><br><span class=line>            <span class=keyword>if</span> (<span class="variable language_">this</span>.<span class=property>client</span>) &#123;</span><br><span class=line>                <span class=keyword>const</span> result = <span class=keyword>await</span> <span class="variable language_">this</span>.<span class=property>client</span>.<span class="title function_">sendRequest</span>(<span class=string>&#x27;mylang/getStatus&#x27;</span>);</span><br><span class=line>                vscode.<span class=property>window</span>.<span class="title function_">showInformationMessage</span>(<span class=string>`服务器状态: <span class=subst>$&#123;<span class=built_in>JSON</span>.stringify(result)&#125;</span>`</span>);</span><br><span class=line>            &#125;</span><br><span class=line>        &#125;);</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 格式化文档命令</span></span><br><span class=line>        <span class=keyword>const</span> formatCommand = vscode.<span class=property>commands</span>.<span class="title function_">registerCommand</span>(<span class=string>&#x27;mylang.formatDocument&#x27;</span>, <span class=keyword>async</span> () =&gt; &#123;</span><br><span class=line>            <span class=keyword>const</span> editor = vscode.<span class=property>window</span>.<span class=property>activeTextEditor</span>;</span><br><span class=line>            <span class=keyword>if</span> (editor &amp;&amp; editor.<span class=property>document</span>.<span class=property>languageId</span> === <span class=string>&#x27;mylang&#x27;</span>) &#123;</span><br><span class=line>                <span class=keyword>await</span> vscode.<span class=property>commands</span>.<span class="title function_">executeCommand</span>(<span class=string>&#x27;editor.action.formatDocument&#x27;</span>);</span><br><span class=line>            &#125;</span><br><span class=line>        &#125;);</span><br><span class=line>        </span><br><span class=line>        context.<span class=property>subscriptions</span>.<span class="title function_">push</span>(restartCommand, statusCommand, formatCommand);</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>async</span> <span class="title function_">deactivate</span>(): <span class="title class_">Promise</span>&lt;<span class=built_in>void</span>&gt; &#123;</span><br><span class=line>        <span class=keyword>if</span> (<span class="variable language_">this</span>.<span class=property>client</span>) &#123;</span><br><span class=line>            <span class=keyword>await</span> <span class="variable language_">this</span>.<span class=property>client</span>.<span class="title function_">stop</span>();</span><br><span class=line>        &#125;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=comment>// 发送自定义请求到服务器</span></span><br><span class=line>    <span class=keyword>async</span> sendCustomRequest&lt;T&gt;(<span class=attr>method</span>: <span class=built_in>string</span>, params?: <span class=built_in>any</span>): <span class="title class_">Promise</span>&lt;T&gt; &#123;</span><br><span class=line>        <span class=keyword>if</span> (!<span class="variable language_">this</span>.<span class=property>client</span>) &#123;</span><br><span class=line>            <span class=keyword>throw</span> <span class=keyword>new</span> <span class="title class_">Error</span>(<span class=string>&#x27;Language Client未初始化&#x27;</span>);</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>return</span> <span class="variable language_">this</span>.<span class=property>client</span>.<span class="title function_">sendRequest</span>(method, params);</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=comment>// 发送通知到服务器</span></span><br><span class=line>    <span class="title function_">sendNotification</span>(<span class=attr>method</span>: <span class=built_in>string</span>, params?: <span class=built_in>any</span>): <span class=built_in>void</span> &#123;</span><br><span class=line>        <span class=keyword>if</span> (<span class="variable language_">this</span>.<span class=property>client</span>) &#123;</span><br><span class=line>            <span class="variable language_">this</span>.<span class=property>client</span>.<span class="title function_">sendNotification</span>(method, params);</span><br><span class=line>        &#125;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=comment>// 获取客户端状态</span></span><br><span class=line>    <span class="title function_">isReady</span>(): <span class=built_in>boolean</span> &#123;</span><br><span class=line>        <span class=keyword>return</span> <span class="variable language_">this</span>.<span class=property>client</span>?.<span class="title function_">isRunning</span>() || <span class=literal>false</span>;</span><br><span class=line>    &#125;</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><h3 id=3-2-LSP服务器开发><a href=#3-2-LSP服务器开发 class=headerlink title="3.2 LSP服务器开发"></a>3.2 LSP服务器开发</h3><figure class="highlight typescript"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br><span class=line>90</span><br><span class=line>91</span><br><span class=line>92</span><br><span class=line>93</span><br><span class=line>94</span><br><span class=line>95</span><br><span class=line>96</span><br><span class=line>97</span><br><span class=line>98</span><br><span class=line>99</span><br><span class=line>100</span><br><span class=line>101</span><br><span class=line>102</span><br><span class=line>103</span><br><span class=line>104</span><br><span class=line>105</span><br><span class=line>106</span><br><span class=line>107</span><br><span class=line>108</span><br><span class=line>109</span><br><span class=line>110</span><br><span class=line>111</span><br><span class=line>112</span><br><span class=line>113</span><br><span class=line>114</span><br><span class=line>115</span><br><span class=line>116</span><br><span class=line>117</span><br><span class=line>118</span><br><span class=line>119</span><br><span class=line>120</span><br><span class=line>121</span><br><span class=line>122</span><br><span class=line>123</span><br><span class=line>124</span><br><span class=line>125</span><br><span class=line>126</span><br><span class=line>127</span><br><span class=line>128</span><br><span class=line>129</span><br><span class=line>130</span><br><span class=line>131</span><br><span class=line>132</span><br><span class=line>133</span><br><span class=line>134</span><br><span class=line>135</span><br><span class=line>136</span><br><span class=line>137</span><br><span class=line>138</span><br><span class=line>139</span><br><span class=line>140</span><br><span class=line>141</span><br><span class=line>142</span><br><span class=line>143</span><br><span class=line>144</span><br><span class=line>145</span><br><span class=line>146</span><br><span class=line>147</span><br><span class=line>148</span><br><span class=line>149</span><br><span class=line>150</span><br><span class=line>151</span><br><span class=line>152</span><br><span class=line>153</span><br><span class=line>154</span><br><span class=line>155</span><br><span class=line>156</span><br><span class=line>157</span><br><span class=line>158</span><br><span class=line>159</span><br><span class=line>160</span><br><span class=line>161</span><br><span class=line>162</span><br><span class=line>163</span><br><span class=line>164</span><br><span class=line>165</span><br><span class=line>166</span><br><span class=line>167</span><br><span class=line>168</span><br><span class=line>169</span><br><span class=line>170</span><br><span class=line>171</span><br><span class=line>172</span><br><span class=line>173</span><br><span class=line>174</span><br><span class=line>175</span><br><span class=line>176</span><br><span class=line>177</span><br><span class=line>178</span><br><span class=line>179</span><br><span class=line>180</span><br><span class=line>181</span><br><span class=line>182</span><br><span class=line>183</span><br><span class=line>184</span><br><span class=line>185</span><br><span class=line>186</span><br><span class=line>187</span><br><span class=line>188</span><br><span class=line>189</span><br><span class=line>190</span><br><span class=line>191</span><br><span class=line>192</span><br><span class=line>193</span><br><span class=line>194</span><br><span class=line>195</span><br><span class=line>196</span><br><span class=line>197</span><br><span class=line>198</span><br><span class=line>199</span><br><span class=line>200</span><br><span class=line>201</span><br><span class=line>202</span><br><span class=line>203</span><br><span class=line>204</span><br><span class=line>205</span><br><span class=line>206</span><br><span class=line>207</span><br><span class=line>208</span><br><span class=line>209</span><br><span class=line>210</span><br><span class=line>211</span><br><span class=line>212</span><br><span class=line>213</span><br><span class=line>214</span><br><span class=line>215</span><br><span class=line>216</span><br><span class=line>217</span><br><span class=line>218</span><br><span class=line>219</span><br><span class=line>220</span><br><span class=line>221</span><br><span class=line>222</span><br><span class=line>223</span><br><span class=line>224</span><br><span class=line>225</span><br><span class=line>226</span><br><span class=line>227</span><br><span class=line>228</span><br><span class=line>229</span><br><span class=line>230</span><br><span class=line>231</span><br><span class=line>232</span><br><span class=line>233</span><br><span class=line>234</span><br><span class=line>235</span><br><span class=line>236</span><br><span class=line>237</span><br><span class=line>238</span><br><span class=line>239</span><br><span class=line>240</span><br><span class=line>241</span><br><span class=line>242</span><br><span class=line>243</span><br><span class=line>244</span><br><span class=line>245</span><br><span class=line>246</span><br><span class=line>247</span><br><span class=line>248</span><br><span class=line>249</span><br><span class=line>250</span><br><span class=line>251</span><br><span class=line>252</span><br><span class=line>253</span><br><span class=line>254</span><br><span class=line>255</span><br><span class=line>256</span><br><span class=line>257</span><br><span class=line>258</span><br><span class=line>259</span><br><span class=line>260</span><br><span class=line>261</span><br><span class=line>262</span><br><span class=line>263</span><br><span class=line>264</span><br><span class=line>265</span><br><span class=line>266</span><br><span class=line>267</span><br><span class=line>268</span><br><span class=line>269</span><br><span class=line>270</span><br><span class=line>271</span><br><span class=line>272</span><br><span class=line>273</span><br><span class=line>274</span><br><span class=line>275</span><br><span class=line>276</span><br><span class=line>277</span><br><span class=line>278</span><br><span class=line>279</span><br><span class=line>280</span><br><span class=line>281</span><br><span class=line>282</span><br><span class=line>283</span><br><span class=line>284</span><br><span class=line>285</span><br><span class=line>286</span><br><span class=line>287</span><br><span class=line>288</span><br><span class=line>289</span><br><span class=line>290</span><br><span class=line>291</span><br><span class=line>292</span><br><span class=line>293</span><br><span class=line>294</span><br><span class=line>295</span><br><span class=line>296</span><br><span class=line>297</span><br><span class=line>298</span><br><span class=line>299</span><br><span class=line>300</span><br><span class=line>301</span><br><span class=line>302</span><br><span class=line>303</span><br><span class=line>304</span><br><span class=line>305</span><br><span class=line>306</span><br><span class=line>307</span><br><span class=line>308</span><br><span class=line>309</span><br><span class=line>310</span><br><span class=line>311</span><br><span class=line>312</span><br><span class=line>313</span><br><span class=line>314</span><br><span class=line>315</span><br><span class=line>316</span><br><span class=line>317</span><br><span class=line>318</span><br><span class=line>319</span><br><span class=line>320</span><br><span class=line>321</span><br><span class=line>322</span><br><span class=line>323</span><br><span class=line>324</span><br><span class=line>325</span><br><span class=line>326</span><br><span class=line>327</span><br><span class=line>328</span><br><span class=line>329</span><br><span class=line>330</span><br><span class=line>331</span><br><span class=line>332</span><br><span class=line>333</span><br><span class=line>334</span><br><span class=line>335</span><br><span class=line>336</span><br><span class=line>337</span><br><span class=line>338</span><br><span class=line>339</span><br><span class=line>340</span><br><span class=line>341</span><br><span class=line>342</span><br><span class=line>343</span><br><span class=line>344</span><br><span class=line>345</span><br><span class=line>346</span><br><span class=line>347</span><br><span class=line>348</span><br><span class=line>349</span><br><span class=line>350</span><br><span class=line>351</span><br><span class=line>352</span><br><span class=line>353</span><br><span class=line>354</span><br><span class=line>355</span><br><span class=line>356</span><br><span class=line>357</span><br><span class=line>358</span><br><span class=line>359</span><br><span class=line>360</span><br><span class=line>361</span><br><span class=line>362</span><br><span class=line>363</span><br><span class=line>364</span><br><span class=line>365</span><br><span class=line>366</span><br><span class=line>367</span><br><span class=line>368</span><br><span class=line>369</span><br><span class=line>370</span><br><span class=line>371</span><br><span class=line>372</span><br><span class=line>373</span><br><span class=line>374</span><br><span class=line>375</span><br><span class=line>376</span><br><span class=line>377</span><br><span class=line>378</span><br><span class=line>379</span><br><span class=line>380</span><br><span class=line>381</span><br><span class=line>382</span><br><span class=line>383</span><br><span class=line>384</span><br><span class=line>385</span><br><span class=line>386</span><br><span class=line>387</span><br><span class=line>388</span><br><span class=line>389</span><br><span class=line>390</span><br><span class=line>391</span><br><span class=line>392</span><br><span class=line>393</span><br><span class=line>394</span><br><span class=line>395</span><br><span class=line>396</span><br><span class=line>397</span><br><span class=line>398</span><br><span class=line>399</span><br><span class=line>400</span><br><span class=line>401</span><br></pre></td><td class=code><pre><span class=line><span class=comment>// src/server/server.ts</span></span><br><span class=line><span class=keyword>import</span> &#123;</span><br><span class=line>    createConnection,</span><br><span class=line>    <span class="title class_">TextDocuments</span>,</span><br><span class=line>    <span class="title class_">Diagnostic</span>,</span><br><span class=line>    <span class="title class_">DiagnosticSeverity</span>,</span><br><span class=line>    <span class="title class_">ProposedFeatures</span>,</span><br><span class=line>    <span class="title class_">InitializeParams</span>,</span><br><span class=line>    <span class="title class_">DidChangeConfigurationNotification</span>,</span><br><span class=line>    <span class="title class_">CompletionItem</span>,</span><br><span class=line>    <span class="title class_">CompletionItemKind</span>,</span><br><span class=line>    <span class="title class_">TextDocumentPositionParams</span>,</span><br><span class=line>    <span class="title class_">TextDocumentSyncKind</span>,</span><br><span class=line>    <span class="title class_">InitializeResult</span>,</span><br><span class=line>    <span class="title class_">DocumentDiagnosticReportKind</span>,</span><br><span class=line>    <span class=keyword>type</span> <span class="title class_">DocumentDiagnosticReport</span></span><br><span class=line>&#125; <span class=keyword>from</span> <span class=string>&#x27;vscode-languageserver/node&#x27;</span>;</span><br><span class=line></span><br><span class=line><span class=keyword>import</span> &#123; <span class="title class_">TextDocument</span> &#125; <span class=keyword>from</span> <span class=string>&#x27;vscode-languageserver-textdocument&#x27;</span>;</span><br><span class=line></span><br><span class=line><span class=comment>// 创建连接</span></span><br><span class=line><span class=keyword>const</span> connection = <span class="title function_">createConnection</span>(<span class="title class_">ProposedFeatures</span>.<span class=property>all</span>);</span><br><span class=line></span><br><span class=line><span class=comment>// 创建文档管理器</span></span><br><span class=line><span class=keyword>const</span> <span class=attr>documents</span>: <span class="title class_">TextDocuments</span>&lt;<span class="title class_">TextDocument</span>&gt; = <span class=keyword>new</span> <span class="title class_">TextDocuments</span>(<span class="title class_">TextDocument</span>);</span><br><span class=line></span><br><span class=line><span class=comment>// 配置缓存</span></span><br><span class=line><span class=keyword>interface</span> <span class="title class_">MyLangSettings</span> &#123;</span><br><span class=line>    <span class=attr>maxNumberOfProblems</span>: <span class=built_in>number</span>;</span><br><span class=line>    <span class=attr>enableLinting</span>: <span class=built_in>boolean</span>;</span><br><span class=line>    <span class=attr>enableFormatting</span>: <span class=built_in>boolean</span>;</span><br><span class=line>    <span class=attr>tabSize</span>: <span class=built_in>number</span>;</span><br><span class=line>    <span class=attr>insertSpaces</span>: <span class=built_in>boolean</span>;</span><br><span class=line>&#125;</span><br><span class=line></span><br><span class=line><span class=keyword>const</span> <span class=attr>defaultSettings</span>: <span class="title class_">MyLangSettings</span> = &#123;</span><br><span class=line>    <span class=attr>maxNumberOfProblems</span>: <span class=number>1000</span>,</span><br><span class=line>    <span class=attr>enableLinting</span>: <span class=literal>true</span>,</span><br><span class=line>    <span class=attr>enableFormatting</span>: <span class=literal>true</span>,</span><br><span class=line>    <span class=attr>tabSize</span>: <span class=number>4</span>,</span><br><span class=line>    <span class=attr>insertSpaces</span>: <span class=literal>true</span></span><br><span class=line>&#125;;</span><br><span class=line></span><br><span class=line><span class=keyword>let</span> <span class=attr>globalSettings</span>: <span class="title class_">MyLangSettings</span> = defaultSettings;</span><br><span class=line><span class=keyword>const</span> <span class=attr>documentSettings</span>: <span class="title class_">Map</span>&lt;<span class=built_in>string</span>, <span class="title class_">Thenable</span>&lt;<span class="title class_">MyLangSettings</span>&gt;&gt; = <span class=keyword>new</span> <span class="title class_">Map</span>();</span><br><span class=line></span><br><span class=line><span class=comment>// 初始化处理</span></span><br><span class=line>connection.<span class="title function_">onInitialize</span>(<span class=function>(<span class=params>params: InitializeParams</span>) =&gt;</span> &#123;</span><br><span class=line>    <span class=keyword>const</span> capabilities = params.<span class=property>capabilities</span>;</span><br><span class=line>    </span><br><span class=line>    <span class=comment>// 检查客户端是否支持工作区文件夹</span></span><br><span class=line>    <span class=keyword>const</span> hasWorkspaceFolderCapability = !!(</span><br><span class=line>        capabilities.<span class=property>workspace</span> &amp;&amp; !!capabilities.<span class=property>workspace</span>.<span class=property>workspaceFolders</span></span><br><span class=line>    );</span><br><span class=line>    </span><br><span class=line>    <span class=comment>// 检查客户端是否支持配置变化</span></span><br><span class=line>    <span class=keyword>const</span> hasConfigurationCapability = !!(</span><br><span class=line>        capabilities.<span class=property>workspace</span> &amp;&amp; !!capabilities.<span class=property>workspace</span>.<span class=property>configuration</span></span><br><span class=line>    );</span><br><span class=line>    </span><br><span class=line>    <span class=comment>// 检查客户端是否支持诊断刷新</span></span><br><span class=line>    <span class=keyword>const</span> hasDiagnosticRefreshSupport = !!(</span><br><span class=line>        capabilities.<span class=property>workspace</span> &amp;&amp; !!capabilities.<span class=property>workspace</span>.<span class=property>diagnostics</span> &amp;&amp; !!capabilities.<span class=property>workspace</span>.<span class=property>diagnostics</span>.<span class=property>refreshSupport</span></span><br><span class=line>    );</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>const</span> <span class=attr>result</span>: <span class="title class_">InitializeResult</span> = &#123;</span><br><span class=line>        <span class=attr>capabilities</span>: &#123;</span><br><span class=line>            <span class=attr>textDocumentSync</span>: <span class="title class_">TextDocumentSyncKind</span>.<span class=property>Incremental</span>,</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// 代码补全</span></span><br><span class=line>            <span class=attr>completionProvider</span>: &#123;</span><br><span class=line>                <span class=attr>resolveProvider</span>: <span class=literal>true</span>,</span><br><span class=line>                <span class=attr>triggerCharacters</span>: [<span class=string>&#x27;.&#x27;</span>, <span class=string>&#x27;:&#x27;</span>, <span class=string>&#x27;&lt;&#x27;</span>]</span><br><span class=line>            &#125;,</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// 悬停信息</span></span><br><span class=line>            <span class=attr>hoverProvider</span>: <span class=literal>true</span>,</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// 签名帮助</span></span><br><span class=line>            <span class=attr>signatureHelpProvider</span>: &#123;</span><br><span class=line>                <span class=attr>triggerCharacters</span>: [<span class=string>&#x27;(&#x27;</span>, <span class=string>&#x27;,&#x27;</span>]</span><br><span class=line>            &#125;,</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// 定义跳转</span></span><br><span class=line>            <span class=attr>definitionProvider</span>: <span class=literal>true</span>,</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// 引用查找</span></span><br><span class=line>            <span class=attr>referencesProvider</span>: <span class=literal>true</span>,</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// 文档高亮</span></span><br><span class=line>            <span class=attr>documentHighlightProvider</span>: <span class=literal>true</span>,</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// 符号查找</span></span><br><span class=line>            <span class=attr>documentSymbolProvider</span>: <span class=literal>true</span>,</span><br><span class=line>            <span class=attr>workspaceSymbolProvider</span>: <span class=literal>true</span>,</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// 代码操作</span></span><br><span class=line>            <span class=attr>codeActionProvider</span>: <span class=literal>true</span>,</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// 重命名</span></span><br><span class=line>            <span class=attr>renameProvider</span>: &#123;</span><br><span class=line>                <span class=attr>prepareProvider</span>: <span class=literal>true</span></span><br><span class=line>            &#125;,</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// 格式化</span></span><br><span class=line>            <span class=attr>documentFormattingProvider</span>: <span class=literal>true</span>,</span><br><span class=line>            <span class=attr>documentRangeFormattingProvider</span>: <span class=literal>true</span>,</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// 诊断</span></span><br><span class=line>            <span class=attr>diagnosticProvider</span>: &#123;</span><br><span class=line>                <span class=attr>interFileDependencies</span>: <span class=literal>false</span>,</span><br><span class=line>                <span class=attr>workspaceDiagnostics</span>: <span class=literal>false</span></span><br><span class=line>            &#125;</span><br><span class=line>        &#125;</span><br><span class=line>    &#125;;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>if</span> (hasWorkspaceFolderCapability) &#123;</span><br><span class=line>        result.<span class=property>capabilities</span>.<span class=property>workspace</span> = &#123;</span><br><span class=line>            <span class=attr>workspaceFolders</span>: &#123;</span><br><span class=line>                <span class=attr>supported</span>: <span class=literal>true</span></span><br><span class=line>            &#125;</span><br><span class=line>        &#125;;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>return</span> result;</span><br><span class=line>&#125;);</span><br><span class=line></span><br><span class=line><span class=comment>// 初始化完成处理</span></span><br><span class=line>connection.<span class="title function_">onInitialized</span>(<span class=function>() =&gt;</span> &#123;</span><br><span class=line>    connection.<span class=property>client</span>.<span class="title function_">register</span>(<span class="title class_">DidChangeConfigurationNotification</span>.<span class=property>type</span>, <span class=literal>undefined</span>);</span><br><span class=line>    </span><br><span class=line>    <span class=comment>// 发送初始化完成通知</span></span><br><span class=line>    connection.<span class="title function_">sendNotification</span>(<span class=string>&#x27;mylang/status&#x27;</span>, &#123;</span><br><span class=line>        <span class=attr>message</span>: <span class=string>&#x27;Language Server初始化完成&#x27;</span></span><br><span class=line>    &#125;);</span><br><span class=line>&#125;);</span><br><span class=line></span><br><span class=line><span class=comment>// 配置变化处理</span></span><br><span class=line>connection.<span class="title function_">onDidChangeConfiguration</span>(<span class=function><span class=params>change</span> =&gt;</span> &#123;</span><br><span class=line>    <span class=keyword>if</span> (change.<span class=property>settings</span>) &#123;</span><br><span class=line>        globalSettings = &lt;<span class="title class_">MyLangSettings</span>&gt;(change.<span class=property>settings</span>.<span class=property>mylang</span> || defaultSettings);</span><br><span class=line>    &#125; <span class=keyword>else</span> &#123;</span><br><span class=line>        globalSettings = defaultSettings;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=comment>// 清除文档设置缓存</span></span><br><span class=line>    documentSettings.<span class="title function_">clear</span>();</span><br><span class=line>    </span><br><span class=line>    <span class=comment>// 重新验证所有打开的文档</span></span><br><span class=line>    documents.<span class="title function_">all</span>().<span class="title function_">forEach</span>(validateTextDocument);</span><br><span class=line>&#125;);</span><br><span class=line></span><br><span class=line><span class=comment>// 获取文档设置</span></span><br><span class=line><span class=keyword>function</span> <span class="title function_">getDocumentSettings</span>(<span class=params>resource: <span class=built_in>string</span></span>): <span class="title class_">Thenable</span>&lt;<span class="title class_">MyLangSettings</span>&gt; &#123;</span><br><span class=line>    <span class=keyword>let</span> result = documentSettings.<span class="title function_">get</span>(resource);</span><br><span class=line>    <span class=keyword>if</span> (!result) &#123;</span><br><span class=line>        result = connection.<span class=property>workspace</span>.<span class="title function_">getConfiguration</span>(&#123;</span><br><span class=line>            <span class=attr>scopeUri</span>: resource,</span><br><span class=line>            <span class=attr>section</span>: <span class=string>&#x27;mylang&#x27;</span></span><br><span class=line>        &#125;);</span><br><span class=line>        documentSettings.<span class="title function_">set</span>(resource, result);</span><br><span class=line>    &#125;</span><br><span class=line>    <span class=keyword>return</span> result;</span><br><span class=line>&#125;</span><br><span class=line></span><br><span class=line><span class=comment>// 文档变化处理</span></span><br><span class=line>documents.<span class="title function_">onDidChangeContent</span>(<span class=function><span class=params>change</span> =&gt;</span> &#123;</span><br><span class=line>    <span class="title function_">validateTextDocument</span>(change.<span class=property>document</span>);</span><br><span class=line>&#125;);</span><br><span class=line></span><br><span class=line><span class=comment>// 文档验证</span></span><br><span class=line><span class=keyword>async</span> <span class=keyword>function</span> <span class="title function_">validateTextDocument</span>(<span class=params>textDocument: TextDocument</span>): <span class="title class_">Promise</span>&lt;<span class=built_in>void</span>&gt; &#123;</span><br><span class=line>    <span class=keyword>const</span> settings = <span class=keyword>await</span> <span class="title function_">getDocumentSettings</span>(textDocument.<span class=property>uri</span>);</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>if</span> (!settings.<span class=property>enableLinting</span>) &#123;</span><br><span class=line>        <span class=keyword>return</span>;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>const</span> text = textDocument.<span class="title function_">getText</span>();</span><br><span class=line>    <span class=keyword>const</span> <span class=attr>diagnostics</span>: <span class="title class_">Diagnostic</span>[] = [];</span><br><span class=line>    </span><br><span class=line>    <span class=comment>// 语法检查</span></span><br><span class=line>    diagnostics.<span class="title function_">push</span>(...<span class="title function_">checkSyntax</span>(text, textDocument));</span><br><span class=line>    </span><br><span class=line>    <span class=comment>// 语义检查</span></span><br><span class=line>    diagnostics.<span class="title function_">push</span>(...<span class="title function_">checkSemantics</span>(text, textDocument));</span><br><span class=line>    </span><br><span class=line>    <span class=comment>// 样式检查</span></span><br><span class=line>    diagnostics.<span class="title function_">push</span>(...<span class="title function_">checkStyle</span>(text, textDocument, settings));</span><br><span class=line>    </span><br><span class=line>    <span class=comment>// 限制诊断数量</span></span><br><span class=line>    <span class=keyword>const</span> limitedDiagnostics = diagnostics.<span class="title function_">slice</span>(<span class=number>0</span>, settings.<span class=property>maxNumberOfProblems</span>);</span><br><span class=line>    </span><br><span class=line>    <span class=comment>// 发送诊断信息</span></span><br><span class=line>    connection.<span class="title function_">sendDiagnostics</span>(&#123; <span class=attr>uri</span>: textDocument.<span class=property>uri</span>, <span class=attr>diagnostics</span>: limitedDiagnostics &#125;);</span><br><span class=line>&#125;</span><br><span class=line></span><br><span class=line><span class=comment>// 语法检查</span></span><br><span class=line><span class=keyword>function</span> <span class="title function_">checkSyntax</span>(<span class=params>text: <span class=built_in>string</span>, <span class="variable language_">document</span>: TextDocument</span>): <span class="title class_">Diagnostic</span>[] &#123;</span><br><span class=line>    <span class=keyword>const</span> <span class=attr>diagnostics</span>: <span class="title class_">Diagnostic</span>[] = [];</span><br><span class=line>    <span class=keyword>const</span> lines = text.<span class="title function_">split</span>(<span class=string>&#x27;\n&#x27;</span>);</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>for</span> (<span class=keyword>let</span> i = <span class=number>0</span>; i &lt; lines.<span class=property>length</span>; i++) &#123;</span><br><span class=line>        <span class=keyword>const</span> line = lines[i];</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 检查未闭合的括号</span></span><br><span class=line>        <span class=keyword>const</span> openParens = (line.<span class="title function_">match</span>(<span class=regexp>/\(/g</span>) || []).<span class=property>length</span>;</span><br><span class=line>        <span class=keyword>const</span> closeParens = (line.<span class="title function_">match</span>(<span class=regexp>/\)/g</span>) || []).<span class=property>length</span>;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>if</span> (openParens &gt; closeParens) &#123;</span><br><span class=line>            <span class=keyword>const</span> <span class=attr>diagnostic</span>: <span class="title class_">Diagnostic</span> = &#123;</span><br><span class=line>                <span class=attr>severity</span>: <span class="title class_">DiagnosticSeverity</span>.<span class=property>Error</span>,</span><br><span class=line>                <span class=attr>range</span>: &#123;</span><br><span class=line>                    <span class=attr>start</span>: &#123; <span class=attr>line</span>: i, <span class=attr>character</span>: line.<span class="title function_">lastIndexOf</span>(<span class=string>&#x27;(&#x27;</span>) &#125;,</span><br><span class=line>                    <span class=attr>end</span>: &#123; <span class=attr>line</span>: i, <span class=attr>character</span>: line.<span class="title function_">lastIndexOf</span>(<span class=string>&#x27;(&#x27;</span>) + <span class=number>1</span> &#125;</span><br><span class=line>                &#125;,</span><br><span class=line>                <span class=attr>message</span>: <span class=string>&#x27;缺少闭合括号&#x27;</span>,</span><br><span class=line>                <span class=attr>source</span>: <span class=string>&#x27;mylang&#x27;</span></span><br><span class=line>            &#125;;</span><br><span class=line>            diagnostics.<span class="title function_">push</span>(diagnostic);</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 检查未终止的字符串</span></span><br><span class=line>        <span class=keyword>const</span> quotes = (line.<span class="title function_">match</span>(<span class=regexp>/&quot;/g</span>) || []).<span class=property>length</span>;</span><br><span class=line>        <span class=keyword>if</span> (quotes % <span class=number>2</span> === <span class=number>1</span>) &#123;</span><br><span class=line>            <span class=keyword>const</span> <span class=attr>diagnostic</span>: <span class="title class_">Diagnostic</span> = &#123;</span><br><span class=line>                <span class=attr>severity</span>: <span class="title class_">DiagnosticSeverity</span>.<span class=property>Error</span>,</span><br><span class=line>                <span class=attr>range</span>: &#123;</span><br><span class=line>                    <span class=attr>start</span>: &#123; <span class=attr>line</span>: i, <span class=attr>character</span>: line.<span class="title function_">lastIndexOf</span>(<span class=string>&#x27;&quot;&#x27;</span>) &#125;,</span><br><span class=line>                    <span class=attr>end</span>: &#123; <span class=attr>line</span>: i, <span class=attr>character</span>: line.<span class=property>length</span> &#125;</span><br><span class=line>                &#125;,</span><br><span class=line>                <span class=attr>message</span>: <span class=string>&#x27;未终止的字符串&#x27;</span>,</span><br><span class=line>                <span class=attr>source</span>: <span class=string>&#x27;mylang&#x27;</span></span><br><span class=line>            &#125;;</span><br><span class=line>            diagnostics.<span class="title function_">push</span>(diagnostic);</span><br><span class=line>        &#125;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>return</span> diagnostics;</span><br><span class=line>&#125;</span><br><span class=line></span><br><span class=line><span class=comment>// 语义检查</span></span><br><span class=line><span class=keyword>function</span> <span class="title function_">checkSemantics</span>(<span class=params>text: <span class=built_in>string</span>, <span class="variable language_">document</span>: TextDocument</span>): <span class="title class_">Diagnostic</span>[] &#123;</span><br><span class=line>    <span class=keyword>const</span> <span class=attr>diagnostics</span>: <span class="title class_">Diagnostic</span>[] = [];</span><br><span class=line>    </span><br><span class=line>    <span class=comment>// 检查未定义的变量</span></span><br><span class=line>    <span class=keyword>const</span> variableUsage = <span class=regexp>/\b([a-zA-Z_][a-zA-Z0-9_]*)\b/g</span>;</span><br><span class=line>    <span class=keyword>const</span> variableDeclarations = <span class=keyword>new</span> <span class="title class_">Set</span>&lt;<span class=built_in>string</span>&gt;();</span><br><span class=line>    <span class=keyword>const</span> usedVariables = <span class=keyword>new</span> <span class="title class_">Map</span>&lt;<span class=built_in>string</span>, <span class="title class_">Array</span>&lt;&#123; <span class=attr>line</span>: <span class=built_in>number</span>, <span class=attr>character</span>: <span class=built_in>number</span> &#125;&gt;&gt;();</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>const</span> lines = text.<span class="title function_">split</span>(<span class=string>&#x27;\n&#x27;</span>);</span><br><span class=line>    </span><br><span class=line>    <span class=comment>// 收集变量声明</span></span><br><span class=line>    <span class=keyword>for</span> (<span class=keyword>let</span> i = <span class=number>0</span>; i &lt; lines.<span class=property>length</span>; i++) &#123;</span><br><span class=line>        <span class=keyword>const</span> line = lines[i];</span><br><span class=line>        <span class=keyword>const</span> declarationMatch = <span class=regexp>/(var|let|const)\s+(\w+)/g</span>;</span><br><span class=line>        <span class=keyword>let</span> match;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>while</span> ((match = declarationMatch.<span class="title function_">exec</span>(line)) !== <span class=literal>null</span>) &#123;</span><br><span class=line>            variableDeclarations.<span class="title function_">add</span>(match[<span class=number>2</span>]);</span><br><span class=line>        &#125;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=comment>// 检查变量使用</span></span><br><span class=line>    <span class=keyword>for</span> (<span class=keyword>let</span> i = <span class=number>0</span>; i &lt; lines.<span class=property>length</span>; i++) &#123;</span><br><span class=line>        <span class=keyword>const</span> line = lines[i];</span><br><span class=line>        <span class=keyword>let</span> match;</span><br><span class=line>        </span><br><span class=line>        <span class=keyword>while</span> ((match = variableUsage.<span class="title function_">exec</span>(line)) !== <span class=literal>null</span>) &#123;</span><br><span class=line>            <span class=keyword>const</span> variable = match[<span class=number>1</span>];</span><br><span class=line>            </span><br><span class=line>            <span class=comment>// 跳过关键字</span></span><br><span class=line>            <span class=keyword>if</span> ([<span class=string>&#x27;function&#x27;</span>, <span class=string>&#x27;var&#x27;</span>, <span class=string>&#x27;let&#x27;</span>, <span class=string>&#x27;const&#x27;</span>, <span class=string>&#x27;if&#x27;</span>, <span class=string>&#x27;else&#x27;</span>, <span class=string>&#x27;while&#x27;</span>, <span class=string>&#x27;for&#x27;</span>].<span class="title function_">includes</span>(variable)) &#123;</span><br><span class=line>                <span class=keyword>continue</span>;</span><br><span class=line>            &#125;</span><br><span class=line>            </span><br><span class=line>            <span class=keyword>if</span> (!usedVariables.<span class="title function_">has</span>(variable)) &#123;</span><br><span class=line>                usedVariables.<span class="title function_">set</span>(variable, []);</span><br><span class=line>            &#125;</span><br><span class=line>            </span><br><span class=line>            usedVariables.<span class="title function_">get</span>(variable)!.<span class="title function_">push</span>(&#123;</span><br><span class=line>                <span class=attr>line</span>: i,</span><br><span class=line>                <span class=attr>character</span>: match.<span class=property>index</span></span><br><span class=line>            &#125;);</span><br><span class=line>        &#125;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=comment>// 报告未定义的变量</span></span><br><span class=line>    <span class=keyword>for</span> (<span class=keyword>const</span> [variable, positions] <span class=keyword>of</span> usedVariables) &#123;</span><br><span class=line>        <span class=keyword>if</span> (!variableDeclarations.<span class="title function_">has</span>(variable)) &#123;</span><br><span class=line>            <span class=keyword>for</span> (<span class=keyword>const</span> pos <span class=keyword>of</span> positions) &#123;</span><br><span class=line>                <span class=keyword>const</span> <span class=attr>diagnostic</span>: <span class="title class_">Diagnostic</span> = &#123;</span><br><span class=line>                    <span class=attr>severity</span>: <span class="title class_">DiagnosticSeverity</span>.<span class=property>Warning</span>,</span><br><span class=line>                    <span class=attr>range</span>: &#123;</span><br><span class=line>                        <span class=attr>start</span>: &#123; <span class=attr>line</span>: pos.<span class=property>line</span>, <span class=attr>character</span>: pos.<span class=property>character</span> &#125;,</span><br><span class=line>                        <span class=attr>end</span>: &#123; <span class=attr>line</span>: pos.<span class=property>line</span>, <span class=attr>character</span>: pos.<span class=property>character</span> + variable.<span class=property>length</span> &#125;</span><br><span class=line>                    &#125;,</span><br><span class=line>                    <span class=attr>message</span>: <span class=string>`未定义的变量 &#x27;<span class=subst>$&#123;variable&#125;</span>&#x27;`</span>,</span><br><span class=line>                    <span class=attr>source</span>: <span class=string>&#x27;mylang&#x27;</span></span><br><span class=line>                &#125;;</span><br><span class=line>                diagnostics.<span class="title function_">push</span>(diagnostic);</span><br><span class=line>            &#125;</span><br><span class=line>        &#125;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>return</span> diagnostics;</span><br><span class=line>&#125;</span><br><span class=line></span><br><span class=line><span class=comment>// 样式检查</span></span><br><span class=line><span class=keyword>function</span> <span class="title function_">checkStyle</span>(<span class=params>text: <span class=built_in>string</span>, <span class="variable language_">document</span>: TextDocument, settings: MyLangSettings</span>): <span class="title class_">Diagnostic</span>[] &#123;</span><br><span class=line>    <span class=keyword>const</span> <span class=attr>diagnostics</span>: <span class="title class_">Diagnostic</span>[] = [];</span><br><span class=line>    <span class=keyword>const</span> lines = text.<span class="title function_">split</span>(<span class=string>&#x27;\n&#x27;</span>);</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>for</span> (<span class=keyword>let</span> i = <span class=number>0</span>; i &lt; lines.<span class=property>length</span>; i++) &#123;</span><br><span class=line>        <span class=keyword>const</span> line = lines[i];</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 检查缩进</span></span><br><span class=line>        <span class=keyword>if</span> (settings.<span class=property>insertSpaces</span>) &#123;</span><br><span class=line>            <span class=keyword>if</span> (line.<span class="title function_">match</span>(<span class=regexp>/^\t/</span>)) &#123;</span><br><span class=line>                <span class=keyword>const</span> <span class=attr>diagnostic</span>: <span class="title class_">Diagnostic</span> = &#123;</span><br><span class=line>                    <span class=attr>severity</span>: <span class="title class_">DiagnosticSeverity</span>.<span class=property>Information</span>,</span><br><span class=line>                    <span class=attr>range</span>: &#123;</span><br><span class=line>                        <span class=attr>start</span>: &#123; <span class=attr>line</span>: i, <span class=attr>character</span>: <span class=number>0</span> &#125;,</span><br><span class=line>                        <span class=attr>end</span>: &#123; <span class=attr>line</span>: i, <span class=attr>character</span>: line.<span class="title function_">search</span>(<span class=regexp>/[^\t]/</span>) &#125;</span><br><span class=line>                    &#125;,</span><br><span class=line>                    <span class=attr>message</span>: <span class=string>&#x27;建议使用空格而不是制表符&#x27;</span>,</span><br><span class=line>                    <span class=attr>source</span>: <span class=string>&#x27;mylang&#x27;</span></span><br><span class=line>                &#125;;</span><br><span class=line>                diagnostics.<span class="title function_">push</span>(diagnostic);</span><br><span class=line>            &#125;</span><br><span class=line>        &#125;</span><br><span class=line>        </span><br><span class=line>        <span class=comment>// 检查行尾空格</span></span><br><span class=line>        <span class=keyword>if</span> (line.<span class="title function_">match</span>(<span class=regexp>/\s+$/</span>)) &#123;</span><br><span class=line>            <span class=keyword>const</span> trimmedLength = line.<span class="title function_">trimEnd</span>().<span class=property>length</span>;</span><br><span class=line>            <span class=keyword>const</span> <span class=attr>diagnostic</span>: <span class="title class_">Diagnostic</span> = &#123;</span><br><span class=line>                <span class=attr>severity</span>: <span class="title class_">DiagnosticSeverity</span>.<span class=property>Information</span>,</span><br><span class=line>                <span class=attr>range</span>: &#123;</span><br><span class=line>                    <span class=attr>start</span>: &#123; <span class=attr>line</span>: i, <span class=attr>character</span>: trimmedLength &#125;,</span><br><span class=line>                    <span class=attr>end</span>: &#123; <span class=attr>line</span>: i, <span class=attr>character</span>: line.<span class=property>length</span> &#125;</span><br><span class=line>                &#125;,</span><br><span class=line>                <span class=attr>message</span>: <span class=string>&#x27;行尾有多余的空格&#x27;</span>,</span><br><span class=line>                <span class=attr>source</span>: <span class=string>&#x27;mylang&#x27;</span></span><br><span class=line>            &#125;;</span><br><span class=line>            diagnostics.<span class="title function_">push</span>(diagnostic);</span><br><span class=line>        &#125;</span><br><span class=line>    &#125;</span><br><span class=line>    </span><br><span class=line>    <span class=keyword>return</span> diagnostics;</span><br><span class=line>&#125;</span><br><span class=line></span><br><span class=line><span class=comment>// 代码补全</span></span><br><span class=line>connection.<span class="title function_">onCompletion</span>((<span class=attr>textDocumentPosition</span>: <span class="title class_">TextDocumentPositionParams</span>): <span class="title class_">CompletionItem</span>[] =&gt; &#123;</span><br><span class=line>    <span class=keyword>return</span> [</span><br><span class=line>        &#123;</span><br><span class=line>            <span class=attr>label</span>: <span class=string>&#x27;function&#x27;</span>,</span><br><span class=line>            <span class=attr>kind</span>: <span class="title class_">CompletionItemKind</span>.<span class=property>Keyword</span>,</span><br><span class=line>            <span class=attr>data</span>: <span class=number>1</span></span><br><span class=line>        &#125;,</span><br><span class=line>        &#123;</span><br><span class=line>            <span class=attr>label</span>: <span class=string>&#x27;variable&#x27;</span>,</span><br><span class=line>            <span class=attr>kind</span>: <span class="title class_">CompletionItemKind</span>.<span class=property>Variable</span>,</span><br><span class=line>            <span class=attr>data</span>: <span class=number>2</span></span><br><span class=line>        &#125;,</span><br><span class=line>        &#123;</span><br><span class=line>            <span class=attr>label</span>: <span class=string>&#x27;class&#x27;</span>,</span><br><span class=line>            <span class=attr>kind</span>: <span class="title class_">CompletionItemKind</span>.<span class=property>Class</span>,</span><br><span class=line>            <span class=attr>data</span>: <span class=number>3</span></span><br><span class=line>        &#125;</span><br><span class=line>    ];</span><br><span class=line>&#125;);</span><br><span class=line></span><br><span class=line><span class=comment>// 补全项解析</span></span><br><span class=line>connection.<span class="title function_">onCompletionResolve</span>((<span class=attr>item</span>: <span class="title class_">CompletionItem</span>): <span class=function><span class=params>CompletionItem</span> =&gt;</span> &#123;</span><br><span class=line>    <span class=keyword>if</span> (item.<span class=property>data</span> === <span class=number>1</span>) &#123;</span><br><span class=line>        item.<span class=property>detail</span> = <span class=string>&#x27;Function keyword&#x27;</span>;</span><br><span class=line>        item.<span class=property>documentation</span> = <span class=string>&#x27;Declares a function&#x27;</span>;</span><br><span class=line>    &#125; <span class=keyword>else</span> <span class=keyword>if</span> (item.<span class=property>data</span> === <span class=number>2</span>) &#123;</span><br><span class=line>        item.<span class=property>detail</span> = <span class=string>&#x27;Variable&#x27;</span>;</span><br><span class=line>        item.<span class=property>documentation</span> = <span class=string>&#x27;A variable declaration&#x27;</span>;</span><br><span class=line>    &#125; <span class=keyword>else</span> <span class=keyword>if</span> (item.<span class=property>data</span> === <span class=number>3</span>) &#123;</span><br><span class=line>        item.<span class=property>detail</span> = <span class=string>&#x27;Class keyword&#x27;</span>;</span><br><span class=line>        item.<span class=property>documentation</span> = <span class=string>&#x27;Declares a class&#x27;</span>;</span><br><span class=line>    &#125;</span><br><span class=line>    <span class=keyword>return</span> item;</span><br><span class=line>&#125;);</span><br><span class=line></span><br><span class=line><span class=comment>// 自定义请求处理</span></span><br><span class=line>connection.<span class="title function_">onRequest</span>(<span class=string>&#x27;mylang/getStatus&#x27;</span>, <span class=function>() =&gt;</span> &#123;</span><br><span class=line>    <span class=keyword>return</span> &#123;</span><br><span class=line>        <span class=attr>status</span>: <span class=string>&#x27;running&#x27;</span>,</span><br><span class=line>        <span class=attr>documentsCount</span>: documents.<span class="title function_">all</span>().<span class=property>length</span>,</span><br><span class=line>        <span class=attr>diagnosticsEnabled</span>: globalSettings.<span class=property>enableLinting</span></span><br><span class=line>    &#125;;</span><br><span class=line>&#125;);</span><br><span class=line></span><br><span class=line><span class=comment>// 监听文档</span></span><br><span class=line>documents.<span class="title function_">listen</span>(connection);</span><br><span class=line></span><br><span class=line><span class=comment>// 监听连接</span></span><br><span class=line>connection.<span class="title function_">listen</span>();</span><br></pre></td></tr></table></figure><hr><h2 id=📚-本阶段总结><a href=#📚-本阶段总结 class=headerlink title="📚 本阶段总结"></a>📚 本阶段总结</h2><p>通过本阶段学习，你已经掌握了：</p><p>✅ <strong>语法高亮技术</strong>：TextMate语法、语义高亮、嵌入语言支持<br>✅ <strong>代码片段系统</strong>：动态片段、条件触发、智能补全<br>✅ <strong>智能感知功能</strong>：代码补全、悬停信息、参数提示、错误诊断<br>✅ <strong>Language Server Protocol</strong>：LSP架构、客户端&#x2F;服务器开发<br>✅ <strong>代码操作能力</strong>：格式化、重构、快速修复、代码导航</p><h3 id=核心技术回顾><a href=#核心技术回顾 class=headerlink title=核心技术回顾></a>核心技术回顾</h3><ul><li><strong>语法文件开发</strong>：使用TextMate语法规则和正则表达式</li><li><strong>语义tokens</strong>：基于语言理解的智能高亮</li><li><strong>LSP通信</strong>：JSON-RPC协议、增量同步、错误处理</li><li><strong>诊断系统</strong>：语法检查、语义分析、样式建议</li><li><strong>智能补全</strong>：上下文感知、类型推断、代码片段</li></ul><hr><h2 id=🚀-下一步学习方向><a href=#🚀-下一步学习方向 class=headerlink title="🚀 下一步学习方向"></a>🚀 下一步学习方向</h2><p>在下一阶段（高级主题），我们将学习：</p><ul><li>🐛 <strong>调试器扩展</strong>：Debug Adapter Protocol、断点管理</li><li>⚙️ <strong>任务系统</strong>：自定义构建任务、工具链集成</li><li>📂 <strong>源代码管理</strong>：SCM Provider、版本控制集成</li><li>🔧 <strong>工作区增强</strong>：虚拟文件系统、远程开发支持</li></ul><p>继续深入学习之前，建议：</p><ol><li>实践开发一个简单语言的完整支持</li><li>研究现有优秀语言扩展的实现</li><li>理解LSP协议的高级特性</li><li>优化语言服务器的性能</li></ol><hr><p><strong>相关资源</strong></p><ul><li><a target=_blank rel=noopener href=https://microsoft.github.io/language-server-protocol/ >Language Server Protocol规范</a></li><li><a target=_blank rel=noopener href=https://macromates.com/manual/en/language_grammars>TextMate语法指南</a></li><li><a target=_blank rel=noopener href=https://code.visualstudio.com/api/language-extensions/overview>VS Code语言扩展API</a></li><li><a target=_blank rel=noopener href=https://github.com/microsoft/vscode-extension-samples/tree/main/lsp-sample>LSP示例实现</a></li></ul><p>恭喜你完成了VS Code扩展开发的语言扩展阶段！现在你已经具备了开发专业级编程语言工具的能力。</p></article><div class=post-copyright><div class=post-copyright__author><span class=post-copyright-meta><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class=post-copyright-info><a href=https://alunworker.com>AlunWorker</a></span></div><div class=post-copyright__type><span class=post-copyright-meta><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class=post-copyright-info><a href=https://alunworker.com/vscode/extension/05-language-extensions/ >https://alunworker.com/vscode/extension/05-language-extensions/</a></span></div><div class=post-copyright__notice><span class=post-copyright-meta><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class=post-copyright-info>本博客所有文章除特别声明外，均采用 <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank>CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href=https://alunworker.com target=_blank>AlunWorker</a>！</span></div></div><div class=tag_share><div class=post-meta__tag-list><a class=post-meta__tags href=/tags/VSCode/ >VSCode</a><a class=post-meta__tags href=/tags/%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/ >插件开发</a><a class=post-meta__tags href=/tags/%E8%AF%AD%E8%A8%80%E6%89%A9%E5%B1%95/ >语言扩展</a><a class=post-meta__tags href=/tags/Language-Server/ >Language Server</a><a class=post-meta__tags href=/tags/%E8%AF%AD%E6%B3%95%E9%AB%98%E4%BA%AE/ >语法高亮</a><a class=post-meta__tags href=/tags/%E6%99%BA%E8%83%BD%E6%84%9F%E7%9F%A5/ >智能感知</a></div><div class=post_share><div class=social-share data-image=/images/icon.webp data-sites=facebook,twitter,wechat,weibo,qq></div><link rel=stylesheet href=https://lib.baomitu.com/social-share.js/1.0.16/css/share.min.css media=print onload='this.media="all"'><script src=https://lib.baomitu.com/social-share.js/1.0.16/js/social-share.min.js defer></script></div></div><nav class=pagination-post id=pagination><div class="prev-post pull-left"><a href=/vscode/extension/04-ux-design/ title="VS Code 扩展开发阶段四：用户体验设计 - UX原则与交互模式"><div class=cover style=background:var(--default-bg-color)></div><div class=pagination-info><div class=label>上一篇</div><div class=prev_info>VS Code 扩展开发阶段四：用户体验设计 - UX原则与交互模式</div></div></a></div><div class="next-post pull-right"><a href=/vscode/extension/06-advanced-topics/ title="VS Code 扩展开发阶段六：高级主题 - 调试器、任务系统与SCM集成"><div class=cover style=background:var(--default-bg-color)></div><div class=pagination-info><div class=label>下一篇</div><div class=next_info>VS Code 扩展开发阶段六：高级主题 - 调试器、任务系统与SCM集成</div></div></a></div></nav><div class=relatedPosts><div class=headline><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class=relatedPosts-list><div><a href=/vscode/extension/01-foundation/ title="VS Code 扩展开发阶段一：基础入门 - 环境搭建与核心概念"><div class=cover style=background:var(--default-bg-color)></div><div class="content is-center"><div class=date><i class="far fa-calendar-alt fa-fw"></i> 2025-09-20</div><div class=title>VS Code 扩展开发阶段一：基础入门 - 环境搭建与核心概念</div></div></a></div><div><a href=/vscode/extension/02-core-capabilities/ title="VS Code 扩展开发阶段二：核心能力开发 - 主题、工作台与编辑器功能"><div class=cover style=background:var(--default-bg-color)></div><div class="content is-center"><div class=date><i class="far fa-calendar-alt fa-fw"></i> 2025-09-20</div><div class=title>VS Code 扩展开发阶段二：核心能力开发 - 主题、工作台与编辑器功能</div></div></a></div><div><a href=/vscode/extension/03-advanced-guides/ title="VS Code 扩展开发阶段三：扩展指南专题 - AI集成、WebView与自定义编辑器"><div class=cover style=background:var(--default-bg-color)></div><div class="content is-center"><div class=date><i class="far fa-calendar-alt fa-fw"></i> 2025-09-20</div><div class=title>VS Code 扩展开发阶段三：扩展指南专题 - AI集成、WebView与自定义编辑器</div></div></a></div><div><a href=/vscode/extension/04-ux-design/ title="VS Code 扩展开发阶段四：用户体验设计 - UX原则与交互模式"><div class=cover style=background:var(--default-bg-color)></div><div class="content is-center"><div class=date><i class="far fa-calendar-alt fa-fw"></i> 2025-09-20</div><div class=title>VS Code 扩展开发阶段四：用户体验设计 - UX原则与交互模式</div></div></a></div><div><a href=/vscode/extension/06-advanced-topics/ title="VS Code 扩展开发阶段六：高级主题 - 调试器、任务系统与SCM集成"><div class=cover style=background:var(--default-bg-color)></div><div class="content is-center"><div class=date><i class="far fa-calendar-alt fa-fw"></i> 2025-09-20</div><div class=title>VS Code 扩展开发阶段六：高级主题 - 调试器、任务系统与SCM集成</div></div></a></div><div><a href=/vscode/extension/07-testing-publishing/ title="VS Code 扩展开发阶段七：测试与发布 - 质量保证与市场发布"><div class=cover style=background:var(--default-bg-color)></div><div class="content is-center"><div class=date><i class="far fa-calendar-alt fa-fw"></i> 2025-09-20</div><div class=title>VS Code 扩展开发阶段七：测试与发布 - 质量保证与市场发布</div></div></a></div></div></div></div><div class=aside-content id=aside-content><div class="card-widget card-info"><div class=is-center><div class=avatar-img><img src=/images/loading.gif data-original=/images/icon.webp onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt=avatar></div><div class=author-info__name>AlunWorker</div><div class=author-info__description>越努力越幸运!</div></div><div class="card-info-data site-data is-center"><a href=/archives/ ><div class=headline>文章</div><div class=length-num>82</div></a><a href=/tags/ ><div class=headline>标签</div><div class=length-num>174</div></a><a href=/categories/ ><div class=headline>分类</div><div class=length-num>14</div></a></div><a id=card-info-btn target=_blank rel=noopener href=https://github.com/xxxxxx><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class=sticky_layout><div class=card-widget id=card-toc><div class=item-headline><i class="fas fa-stream"></i><span>目录</span><span class=toc-percentage></span></div><div class=toc-content><ol class=toc><li class="toc-item toc-level-2"><a class=toc-link href=#%F0%9F%8E%AF-%E5%AD%A6%E4%B9%A0%E7%9B%AE%E6%A0%87><span class=toc-number>1.</span> <span class=toc-text>🎯 学习目标</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%F0%9F%93%9D-%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86%EF%BC%9A%E8%AF%AD%E6%B3%95%E9%AB%98%E4%BA%AE%E4%B8%8E%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE><span class=toc-number>2.</span> <span class=toc-text>📝 第一部分：语法高亮与基础配置</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#1-1-TextMate%E8%AF%AD%E6%B3%95%E5%BC%80%E5%8F%91><span class=toc-number>2.1.</span> <span class=toc-text>1.1 TextMate语法开发</span></a><ol class=toc-child><li class="toc-item toc-level-4"><a class=toc-link href=#%E8%AF%AD%E6%B3%95%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84><span class=toc-number>2.1.1.</span> <span class=toc-text>语法文件结构</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#%E8%AF%AD%E8%A8%80%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6><span class=toc-number>2.1.2.</span> <span class=toc-text>语言配置文件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class=toc-link href=#1-2-%E8%AF%AD%E4%B9%89%E9%AB%98%E4%BA%AE%E5%AE%9E%E7%8E%B0><span class=toc-number>2.2.</span> <span class=toc-text>1.2 语义高亮实现</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#1-3-%E4%BB%A3%E7%A0%81%E7%89%87%E6%AE%B5%E7%B3%BB%E7%BB%9F><span class=toc-number>2.3.</span> <span class=toc-text>1.3 代码片段系统</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%F0%9F%94%8D-%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%EF%BC%9A%E6%99%BA%E8%83%BD%E6%84%9F%E7%9F%A5%E5%8A%9F%E8%83%BD><span class=toc-number>3.</span> <span class=toc-text>🔍 第二部分：智能感知功能</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#2-1-%E4%BB%A3%E7%A0%81%E8%A1%A5%E5%85%A8%E6%8F%90%E4%BE%9B%E8%80%85><span class=toc-number>3.1.</span> <span class=toc-text>2.1 代码补全提供者</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#2-2-%E6%82%AC%E5%81%9C%E4%BF%A1%E6%81%AF%E6%8F%90%E4%BE%9B%E8%80%85><span class=toc-number>3.2.</span> <span class=toc-text>2.2 悬停信息提供者</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#2-3-%E8%AF%8A%E6%96%AD%E6%8F%90%E4%BE%9B%E8%80%85><span class=toc-number>3.3.</span> <span class=toc-text>2.3 诊断提供者</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%F0%9F%8C%90-%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86%EF%BC%9ALanguage-Server-Protocol-LSP><span class=toc-number>4.</span> <span class=toc-text>🌐 第三部分：Language Server Protocol (LSP)</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#3-1-LSP%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%BC%80%E5%8F%91><span class=toc-number>4.1.</span> <span class=toc-text>3.1 LSP客户端开发</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#3-2-LSP%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%BC%80%E5%8F%91><span class=toc-number>4.2.</span> <span class=toc-text>3.2 LSP服务器开发</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%F0%9F%93%9A-%E6%9C%AC%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93><span class=toc-number>5.</span> <span class=toc-text>📚 本阶段总结</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E5%9B%9E%E9%A1%BE><span class=toc-number>5.1.</span> <span class=toc-text>核心技术回顾</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%F0%9F%9A%80-%E4%B8%8B%E4%B8%80%E6%AD%A5%E5%AD%A6%E4%B9%A0%E6%96%B9%E5%90%91><span class=toc-number>6.</span> <span class=toc-text>🚀 下一步学习方向</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class=item-headline><i class="fas fa-history"></i><span>最新文章</span></div><div class=aside-list><div class="aside-list-item no-cover"><div class=content><a class=title href=/vscode/extension/01-foundation/ title="VS Code 扩展开发阶段一：基础入门 - 环境搭建与核心概念">VS Code 扩展开发阶段一：基础入门 - 环境搭建与核心概念</a><time datetime=2025-09-19T16:00:00.000Z title="发表于 2025-09-20 00:00:00">2025-09-20</time></div></div><div class="aside-list-item no-cover"><div class=content><a class=title href=/vscode/extension/02-core-capabilities/ title="VS Code 扩展开发阶段二：核心能力开发 - 主题、工作台与编辑器功能">VS Code 扩展开发阶段二：核心能力开发 - 主题、工作台与编辑器功能</a><time datetime=2025-09-19T16:00:00.000Z title="发表于 2025-09-20 00:00:00">2025-09-20</time></div></div><div class="aside-list-item no-cover"><div class=content><a class=title href=/vscode/extension/03-advanced-guides/ title="VS Code 扩展开发阶段三：扩展指南专题 - AI集成、WebView与自定义编辑器">VS Code 扩展开发阶段三：扩展指南专题 - AI集成、WebView与自定义编辑器</a><time datetime=2025-09-19T16:00:00.000Z title="发表于 2025-09-20 00:00:00">2025-09-20</time></div></div><div class="aside-list-item no-cover"><div class=content><a class=title href=/vscode/extension/04-ux-design/ title="VS Code 扩展开发阶段四：用户体验设计 - UX原则与交互模式">VS Code 扩展开发阶段四：用户体验设计 - UX原则与交互模式</a><time datetime=2025-09-19T16:00:00.000Z title="发表于 2025-09-20 00:00:00">2025-09-20</time></div></div><div class="aside-list-item no-cover"><div class=content><a class=title href=/vscode/extension/05-language-extensions/ title="VS Code 扩展开发阶段五：语言扩展开发 - 语法高亮、智能感知与LSP">VS Code 扩展开发阶段五：语言扩展开发 - 语法高亮、智能感知与LSP</a><time datetime=2025-09-19T16:00:00.000Z title="发表于 2025-09-20 00:00:00">2025-09-20</time></div></div></div></div></div></div></main><footer id=footer style=background:#000><div id=footer-wrap><div class=copyright>&copy;2020 - 2025 By AlunWorker</div><div class=framework-info><span>框架 </span><a target=_blank rel=noopener href=https://hexo.io>Hexo</a><span class=footer-separator>|</span><span>主题 </span><a target=_blank rel=noopener href=https://github.com/jerryc127/hexo-theme-butterfly>Butterfly</a></div></div></footer></div><div id=rightside><div id=rightside-config-hide><button id=readmode type=button title=阅读模式><i class="fas fa-book-open"></i></button><button id=darkmode type=button title=浅色和深色模式转换><i class="fas fa-adjust"></i></button><button id=hide-aside-btn type=button title=单栏和双栏切换><i class="fas fa-arrows-alt-h"></i></button></div><div id=rightside-config-show><button id=rightside-config type=button title=设置><i class="fas fa-cog fa-spin"></i></button><button class=close id=mobile-toc-button type=button title=目录><i class="fas fa-list-ul"></i></button><button id=go-up type=button title=回到顶部><span class=scroll-percent></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src=/ ></script><div class=js-pjax></div><script async data-pjax src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><div id=local-search><div class=search-dialog><nav class=search-nav><span class=search-dialog-title>搜索</span><span id=loading-status></span><button class=search-close-button><i class="fas fa-times"></i></button></nav><div class=is-center id=loading-database><i class="fas fa-spinner fa-pulse"></i><span> 数据库加载中</span></div><div class=search-wrap><div id=local-search-input><div class=local-search-box><input class=local-search-box--input placeholder=搜索文章 type=text></div></div><hr><div id=local-search-results></div><div id=local-search-stats-wrap></div></div></div><div id=search-mask></div><script src="/js/search/local-search.js?v=4.13.0"></script></div></div><style>[bg-lazy]{background-image:none!important;background-color:#eee!important}</style><script>window.imageLazyLoadSetting={isSPA:!1,preloadRatio:1,processImages:null}</script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})})</script><script>!function(r){r.imageLazyLoadSetting.processImages=t;var e=r.imageLazyLoadSetting.isSPA,n=r.imageLazyLoadSetting.preloadRatio||1,c=a();function a(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(){e&&(c=a());for(var t,o=0;o<c.length;o++)0<=(t=(t=c[o]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(r.innerHeight*n||document.documentElement.clientHeight*n)&&function(){var t,e,n,a,i=c[o];e=function(){c=c.filter(function(t){return i!==t}),r.imageLazyLoadSetting.onImageLoaded&&r.imageLazyLoadSetting.onImageLoaded(i)},(t=i).hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),e()):(n=new Image,a=t.getAttribute("data-original"),n.onload=function(){t.src=a,t.removeAttribute("data-original"),e()},t.src!==a&&(n.src=a))}()}function i(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",i),r.addEventListener("resize",i),r.addEventListener("orientationchange",i)}(this)</script></body></html>